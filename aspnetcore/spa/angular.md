---
title: Utilisez le modèle de projet angulaire avec ASP.NET Core
author: SteveSandersonMS
description: Découvrez comment démarrer avec le modèle de projet Application Page unique (SPA) de ASP.NET Core pour angulaire et l’interface CLI angulaire.
manager: wpickett
ms.author: scaddie
ms.custom: mvc
ms.date: 02/21/2018
ms.devlang: csharp
ms.prod: aspnet-core
ms.technology: aspnet
ms.topic: article
uid: spa/angular
ms.openlocfilehash: b4e48f40c3d4e3167e7fdb3534d2c33b3544592c
ms.sourcegitcommit: 9bc34b8269d2a150b844c3b8646dcb30278a95ea
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 05/12/2018
---
# <a name="use-the-angular-project-template-with-aspnet-core"></a><span data-ttu-id="0927e-103">Utilisez le modèle de projet angulaire avec ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="0927e-103">Use the Angular project template with ASP.NET Core</span></span>

> [!NOTE]
> <span data-ttu-id="0927e-104">Cette documentation n’est pas sur le modèle de projet angulaire incluse dans ASP.NET 2.0 de base.</span><span class="sxs-lookup"><span data-stu-id="0927e-104">This documentation isn't about the Angular project template included in ASP.NET Core 2.0.</span></span> <span data-ttu-id="0927e-105">Il s’agit du modèle angulaire plus récente à laquelle vous pouvez mettre à jour manuellement.</span><span class="sxs-lookup"><span data-stu-id="0927e-105">It's about the newer Angular template to which you can update manually.</span></span> <span data-ttu-id="0927e-106">Par défaut, le modèle est inclus dans ASP.NET Core 2.1.</span><span class="sxs-lookup"><span data-stu-id="0927e-106">The template is included in ASP.NET Core 2.1 by default.</span></span>

<span data-ttu-id="0927e-107">Le modèle de projet angulaire mis à jour fournit un point de départ pratique pour ASP.NET Core applications à l’aide d’angulaire et l’interface CLI angulaire pour implémenter une interface utilisateur côté client riche (IU).</span><span class="sxs-lookup"><span data-stu-id="0927e-107">The updated Angular project template provides a convenient starting point for ASP.NET Core apps using Angular and the Angular CLI to implement a rich, client-side user interface (UI).</span></span>

<span data-ttu-id="0927e-108">Le modèle est équivalent à la création d’un projet ASP.NET Core pour agir comme un serveur principal d’API et un projet CLI angulaire d’agir comme une interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0927e-108">The template is equivalent to creating an ASP.NET Core project to act as an API backend and an Angular CLI project to act as a UI.</span></span> <span data-ttu-id="0927e-109">Le modèle offre l’avantage d’héberger les deux types de projets dans un projet d’application unique.</span><span class="sxs-lookup"><span data-stu-id="0927e-109">The template offers the convenience of hosting both project types in a single app project.</span></span> <span data-ttu-id="0927e-110">Par conséquent, le projet d’application peut être généré et publié sous la forme d’une unité unique.</span><span class="sxs-lookup"><span data-stu-id="0927e-110">Consequently, the app project can be built and published as a single unit.</span></span>

## <a name="create-a-new-app"></a><span data-ttu-id="0927e-111">Créer une application</span><span class="sxs-lookup"><span data-stu-id="0927e-111">Create a new app</span></span>

<span data-ttu-id="0927e-112">Si vous utilisez ASP.NET Core 2.0, assurez-vous que vous avez [installé le modèle de projet angulaire mis à jour](xref:spa/index#installation).</span><span class="sxs-lookup"><span data-stu-id="0927e-112">If using ASP.NET Core 2.0, ensure you've [installed the updated Angular project template](xref:spa/index#installation).</span></span> <span data-ttu-id="0927e-113">Si vous avez ASP.NET Core 2.1, il n’est pas nécessaire pour l’installer.</span><span class="sxs-lookup"><span data-stu-id="0927e-113">If you have ASP.NET Core 2.1, there's no need to install it.</span></span>

<span data-ttu-id="0927e-114">Créez un nouveau projet à partir d’une invite de commandes à l’aide de la commande `dotnet new angular` dans un répertoire vide.</span><span class="sxs-lookup"><span data-stu-id="0927e-114">Create a new project from a command prompt using the command `dotnet new angular` in an empty directory.</span></span> <span data-ttu-id="0927e-115">Par exemple, les commandes suivantes créent l’application dans un *application mon nouveau* active et basculer vers ce répertoire :</span><span class="sxs-lookup"><span data-stu-id="0927e-115">For example, the following commands create the app in a *my-new-app* directory and switch to that directory:</span></span>

```console
dotnet new angular -o my-new-app
cd my-new-app
```

<span data-ttu-id="0927e-116">Exécutez l’application à partir de Visual Studio ou le .NET Core CLI :</span><span class="sxs-lookup"><span data-stu-id="0927e-116">Run the app from either Visual Studio or the .NET Core CLI:</span></span>

# <a name="visual-studiotabvisual-studio"></a>[<span data-ttu-id="0927e-117">Visual Studio</span><span class="sxs-lookup"><span data-stu-id="0927e-117">Visual Studio</span></span>](#tab/visual-studio/)

<span data-ttu-id="0927e-118">Ouvrez généré *.csproj* , et exécutez l’application normalement à partir de là.</span><span class="sxs-lookup"><span data-stu-id="0927e-118">Open the generated *.csproj* file, and run the app as normal from there.</span></span>

<span data-ttu-id="0927e-119">Le processus de génération restaure npm dépendent de la première exécution, ce qui peut prendre plusieurs minutes.</span><span class="sxs-lookup"><span data-stu-id="0927e-119">The build process restores npm dependencies on the first run, which can take several minutes.</span></span> <span data-ttu-id="0927e-120">Les builds suivantes sont beaucoup plus rapides.</span><span class="sxs-lookup"><span data-stu-id="0927e-120">Subsequent builds are much faster.</span></span>

# <a name="net-core-clitabnetcore-cli"></a>[<span data-ttu-id="0927e-121">CLI .NET Core</span><span class="sxs-lookup"><span data-stu-id="0927e-121">.NET Core CLI</span></span>](#tab/netcore-cli/)

<span data-ttu-id="0927e-122">Assurez-vous d’avoir une variable d’environnement appelée `ASPNETCORE_Environment` avec la valeur `Development`.</span><span class="sxs-lookup"><span data-stu-id="0927e-122">Ensure you have an environment variable called `ASPNETCORE_Environment` with a value of `Development`.</span></span> <span data-ttu-id="0927e-123">Sur Windows (dans les invites de non-PowerShell), exécutez `SET ASPNETCORE_Environment=Development`.</span><span class="sxs-lookup"><span data-stu-id="0927e-123">On Windows (in non-PowerShell prompts), run `SET ASPNETCORE_Environment=Development`.</span></span> <span data-ttu-id="0927e-124">Sur Linux ou macOS, exécutez `export ASPNETCORE_Environment=Development`.</span><span class="sxs-lookup"><span data-stu-id="0927e-124">On Linux or macOS, run `export ASPNETCORE_Environment=Development`.</span></span>

<span data-ttu-id="0927e-125">Exécutez [dotnet build](/dotnet/core/tools/dotnet-build) pour vérifier l’application se génère correctement.</span><span class="sxs-lookup"><span data-stu-id="0927e-125">Run [dotnet build](/dotnet/core/tools/dotnet-build) to verify the app builds correctly.</span></span> <span data-ttu-id="0927e-126">Sur la première exécution, le processus de génération restaure les dépendances de npm, qui peuvent prendre plusieurs minutes.</span><span class="sxs-lookup"><span data-stu-id="0927e-126">On the first run, the build process restores npm dependencies, which can take several minutes.</span></span> <span data-ttu-id="0927e-127">Les builds suivantes sont beaucoup plus rapides.</span><span class="sxs-lookup"><span data-stu-id="0927e-127">Subsequent builds are much faster.</span></span>

<span data-ttu-id="0927e-128">Exécutez [dotnet exécuter](/dotnet/core/tools/dotnet-run) pour démarrer l’application.</span><span class="sxs-lookup"><span data-stu-id="0927e-128">Run [dotnet run](/dotnet/core/tools/dotnet-run) to start the app.</span></span> <span data-ttu-id="0927e-129">Un message semblable au suivant est enregistré :</span><span class="sxs-lookup"><span data-stu-id="0927e-129">A message similar to the following is logged:</span></span>

```console
Now listening on: http://localhost:<port>
```

<span data-ttu-id="0927e-130">Accédez à cette URL dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="0927e-130">Navigate to this URL in a browser.</span></span>

<span data-ttu-id="0927e-131">L’application démarre une instance du serveur angulaire CLI en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="0927e-131">The app starts up an instance of the Angular CLI server in the background.</span></span> <span data-ttu-id="0927e-132">Un message semblable au suivant est consigné : <em>NG Live un serveur de développement est à l’écoute sur localhost :&lt;otherport&gt;, ouvrez votre navigateur sur http://localhost:&lt; otherport&gt; /</em>  .</span><span class="sxs-lookup"><span data-stu-id="0927e-132">A message similar to the following is logged: <em>NG Live Development Server is listening on localhost:&lt;otherport&gt;, open your browser on http://localhost:&lt;otherport&gt;/</em>.</span></span> <span data-ttu-id="0927e-133">Ignorer ce message&mdash;il a <strong>pas</strong> l’URL de l’application ASP.NET Core et CLI angulaire combinée.</span><span class="sxs-lookup"><span data-stu-id="0927e-133">Ignore this message&mdash;it's <strong>not</strong> the URL for the combined ASP.NET Core and Angular CLI app.</span></span>

---

<span data-ttu-id="0927e-134">Le modèle de projet crée une application ASP.NET Core et une application angulaire.</span><span class="sxs-lookup"><span data-stu-id="0927e-134">The project template creates an ASP.NET Core app and an Angular app.</span></span> <span data-ttu-id="0927e-135">L’application ASP.NET Core est destinée à être utilisé pour l’accès aux données, l’autorisation et autres problèmes côté serveur.</span><span class="sxs-lookup"><span data-stu-id="0927e-135">The ASP.NET Core app is intended to be used for data access, authorization, and other server-side concerns.</span></span> <span data-ttu-id="0927e-136">L’application angulaire, résidant dans le *ClientApp* sous-répertoire, est destiné à être utilisé pour tous les problèmes de l’interface utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0927e-136">The Angular app, residing in the *ClientApp* subdirectory, is intended to be used for all UI concerns.</span></span>

## <a name="add-pages-images-styles-modules-etc"></a><span data-ttu-id="0927e-137">Ajouter des pages, les images, les styles, les modules, etc.</span><span class="sxs-lookup"><span data-stu-id="0927e-137">Add pages, images, styles, modules, etc.</span></span>

<span data-ttu-id="0927e-138">Le *ClientApp* répertoire contient une application angulaire CLI standard.</span><span class="sxs-lookup"><span data-stu-id="0927e-138">The *ClientApp* directory contains a standard Angular CLI app.</span></span> <span data-ttu-id="0927e-139">Consultez officielle [documentation angulaire](https://github.com/angular/angular-cli/wiki) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="0927e-139">See the official [Angular documentation](https://github.com/angular/angular-cli/wiki) for more information.</span></span>

<span data-ttu-id="0927e-140">Il existe de légères différences entre l’application angulaire créés par ce modèle et celui créé par angulaire CLI lui-même (via `ng new`) ; Toutefois, les fonctionnalités de l’application sont identiques.</span><span class="sxs-lookup"><span data-stu-id="0927e-140">There are slight differences between the Angular app created by this template and the one created by Angular CLI itself (via `ng new`); however, the app's capabilities are unchanged.</span></span> <span data-ttu-id="0927e-141">L’application créée par le modèle contient un [Bootstrap](https://getbootstrap.com/)-en fonction de la mise en page et un exemple de routage de base.</span><span class="sxs-lookup"><span data-stu-id="0927e-141">The app created by the template contains a [Bootstrap](https://getbootstrap.com/)-based layout and a basic routing example.</span></span>

## <a name="run-ng-commands"></a><span data-ttu-id="0927e-142">Exécutez les commandes ng</span><span class="sxs-lookup"><span data-stu-id="0927e-142">Run ng commands</span></span>

<span data-ttu-id="0927e-143">Dans une invite de commandes, basculez vers le *ClientApp* sous-répertoire :</span><span class="sxs-lookup"><span data-stu-id="0927e-143">In a command prompt, switch to the *ClientApp* subdirectory:</span></span>

```console
cd ClientApp
```

<span data-ttu-id="0927e-144">Si vous avez le `ng` outil installé de manière globale, vous pouvez exécuter une de ses commandes.</span><span class="sxs-lookup"><span data-stu-id="0927e-144">If you have the `ng` tool installed globally, you can run any of its commands.</span></span> <span data-ttu-id="0927e-145">Par exemple, vous pouvez exécuter `ng lint`, `ng test`, ou toute autre [commandes CLI angulaire](https://github.com/angular/angular-cli/wiki#additional-commands).</span><span class="sxs-lookup"><span data-stu-id="0927e-145">For example, you can run `ng lint`, `ng test`, or any of the other [Angular CLI commands](https://github.com/angular/angular-cli/wiki#additional-commands).</span></span> <span data-ttu-id="0927e-146">Il est inutile d’exécuter `ng serve` , car votre application ASP.NET Core porte servant à la fois côté client et côté serveur des parties de votre application.</span><span class="sxs-lookup"><span data-stu-id="0927e-146">There's no need to run `ng serve` though, because your ASP.NET Core app deals with serving both server-side and client-side parts of your app.</span></span> <span data-ttu-id="0927e-147">En interne, il utilise `ng serve` dans le développement.</span><span class="sxs-lookup"><span data-stu-id="0927e-147">Internally, it uses `ng serve` in development.</span></span>

<span data-ttu-id="0927e-148">Si vous n’avez pas les `ng` outil est installé, exécutez `npm run ng` à la place.</span><span class="sxs-lookup"><span data-stu-id="0927e-148">If you don't have the `ng` tool installed, run `npm run ng` instead.</span></span> <span data-ttu-id="0927e-149">Par exemple, vous pouvez exécuter `npm run ng lint` ou `npm run ng test`.</span><span class="sxs-lookup"><span data-stu-id="0927e-149">For example, you can run `npm run ng lint` or `npm run ng test`.</span></span>

## <a name="install-npm-packages"></a><span data-ttu-id="0927e-150">Installer des packages npm</span><span class="sxs-lookup"><span data-stu-id="0927e-150">Install npm packages</span></span>

<span data-ttu-id="0927e-151">Pour installer des packages tiers npm, utilisez une invite de commandes dans le *ClientApp* sous-répertoire.</span><span class="sxs-lookup"><span data-stu-id="0927e-151">To install third-party npm packages, use a command prompt in the *ClientApp* subdirectory.</span></span> <span data-ttu-id="0927e-152">Par exemple :</span><span class="sxs-lookup"><span data-stu-id="0927e-152">For example:</span></span>

```console
cd ClientApp
npm install --save <package_name>
```

## <a name="publish-and-deploy"></a><span data-ttu-id="0927e-153">Publier et déployer</span><span class="sxs-lookup"><span data-stu-id="0927e-153">Publish and deploy</span></span>

<span data-ttu-id="0927e-154">Dans le développement, l’application s’exécute en mode optimisé pour des raisons pratiques de développement.</span><span class="sxs-lookup"><span data-stu-id="0927e-154">In development, the app runs in a mode optimized for developer convenience.</span></span> <span data-ttu-id="0927e-155">Par exemple, JavaScript offres incluent des mappages de sources (de sorte que lors du débogage, vous pouvez voir votre code TypeScript d’origine).</span><span class="sxs-lookup"><span data-stu-id="0927e-155">For example, JavaScript bundles include source maps (so that when debugging, you can see your original TypeScript code).</span></span> <span data-ttu-id="0927e-156">L’application surveille les modifications de fichier TypeScript, HTML et CSS sur le disque et recompile automatiquement et recharge lorsqu’il rencontre ces fichiers modifier.</span><span class="sxs-lookup"><span data-stu-id="0927e-156">The app watches for TypeScript, HTML, and CSS file changes on disk and automatically recompiles and reloads when it sees those files change.</span></span>

<span data-ttu-id="0927e-157">Dans la production, ont une version de votre application qui est optimisée pour les performances.</span><span class="sxs-lookup"><span data-stu-id="0927e-157">In production, serve a version of your app that's optimized for performance.</span></span> <span data-ttu-id="0927e-158">Il est configuré pour se produire automatiquement.</span><span class="sxs-lookup"><span data-stu-id="0927e-158">This is configured to happen automatically.</span></span> <span data-ttu-id="0927e-159">Lorsque vous publiez, la configuration de build émet un réduite, anticipée de temps (AOA) compilés build de votre code côté client.</span><span class="sxs-lookup"><span data-stu-id="0927e-159">When you publish, the build configuration emits a minified, ahead-of-time (AoT) compiled build of your client-side code.</span></span> <span data-ttu-id="0927e-160">Contrairement à la version de développement, la build de production ne nécessite pas Node.js être installé sur le serveur (sauf si vous avez activé [côté serveur pré-rendu](#server-side-rendering)).</span><span class="sxs-lookup"><span data-stu-id="0927e-160">Unlike the development build, the production build doesn't require Node.js to be installed on the server (unless you have enabled [server-side prerendering](#server-side-rendering)).</span></span>

<span data-ttu-id="0927e-161">Vous pouvez utiliser standard [méthodes de déploiement et d’hébergement ASP.NET Core](xref:host-and-deploy/index).</span><span class="sxs-lookup"><span data-stu-id="0927e-161">You can use standard [ASP.NET Core hosting and deployment methods](xref:host-and-deploy/index).</span></span>

## <a name="run-ng-serve-independently"></a><span data-ttu-id="0927e-162">Exécutez « ng serve » indépendamment</span><span class="sxs-lookup"><span data-stu-id="0927e-162">Run "ng serve" independently</span></span>

<span data-ttu-id="0927e-163">Le projet est configuré pour démarrer sa propre instance du serveur angulaire CLI en arrière-plan lorsque l’application ASP.NET Core démarre en mode de développement.</span><span class="sxs-lookup"><span data-stu-id="0927e-163">The project is configured to start its own instance of the Angular CLI server in the background when the ASP.NET Core app starts in development mode.</span></span> <span data-ttu-id="0927e-164">Ceci est pratique, car vous n’êtes pas obligé d’exécuter un serveur distinct manuellement.</span><span class="sxs-lookup"><span data-stu-id="0927e-164">This is convenient because you don't have to run a separate server manually.</span></span>

<span data-ttu-id="0927e-165">Il existe un inconvénient de ce programme d’installation par défaut.</span><span class="sxs-lookup"><span data-stu-id="0927e-165">There's a drawback to this default setup.</span></span> <span data-ttu-id="0927e-166">Chaque fois que vous modifiez votre code c# et base ASP.NET application doit redémarrer, le serveur CLI angulaire redémarre.</span><span class="sxs-lookup"><span data-stu-id="0927e-166">Each time you modify your C# code and your ASP.NET Core app needs to restart, the Angular CLI server restarts.</span></span> <span data-ttu-id="0927e-167">Environ 10 secondes est requis pour démarrer la sauvegarde.</span><span class="sxs-lookup"><span data-stu-id="0927e-167">Around 10 seconds is required to start back up.</span></span> <span data-ttu-id="0927e-168">Si vous apportez des modifications de code c# fréquentes et que vous ne souhaitez pas attendre CLI angulaire à redémarrer, exécutez le serveur angulaire CLI en externe, indépendamment du processus ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="0927e-168">If you're making frequent C# code edits and don't want to wait for Angular CLI to restart, run the Angular CLI server externally, independently of the ASP.NET Core process.</span></span> <span data-ttu-id="0927e-169">Pour cela :</span><span class="sxs-lookup"><span data-stu-id="0927e-169">To do so:</span></span>

1. <span data-ttu-id="0927e-170">Dans une invite de commandes, basculez vers le *ClientApp* sous-répertoire et lancer le serveur de développement angulaire CLI :</span><span class="sxs-lookup"><span data-stu-id="0927e-170">In a command prompt, switch to the *ClientApp* subdirectory, and launch the Angular CLI development server:</span></span>

    ```console
    cd ClientApp
    npm start
    ```

    > [!IMPORTANT]
    > <span data-ttu-id="0927e-171">Utilisez `npm start` pour lancer le serveur de développement CLI angulaire ne pas `ng serve`, de sorte que la configuration dans *package.json* est respectée.</span><span class="sxs-lookup"><span data-stu-id="0927e-171">Use `npm start` to launch the Angular CLI development server, not `ng serve`, so that the configuration in *package.json* is respected.</span></span> <span data-ttu-id="0927e-172">Pour passer des paramètres supplémentaires au serveur CLI angulaire, ajoutez-les à la `scripts` de ligne dans votre *package.json* fichier.</span><span class="sxs-lookup"><span data-stu-id="0927e-172">To pass additional parameters to the Angular CLI server, add them to the relevant `scripts` line in your *package.json* file.</span></span>

2. <span data-ttu-id="0927e-173">Modifiez votre application ASP.NET Core pour utiliser l’instance CLI angulaire externe au lieu de lancer un de ses propres.</span><span class="sxs-lookup"><span data-stu-id="0927e-173">Modify your ASP.NET Core app to use the external Angular CLI instance instead of launching one of its own.</span></span> <span data-ttu-id="0927e-174">Dans votre *démarrage* de classe, remplacez le `spa.UseAngularCliServer` invocation avec les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="0927e-174">In your *Startup* class, replace the `spa.UseAngularCliServer` invocation with the following:</span></span>

    ```csharp
    spa.UseProxyToSpaDevelopmentServer("http://localhost:4200");
    ```

<span data-ttu-id="0927e-175">Lorsque vous démarrez votre application ASP.NET Core, il ne sera pas lancer un serveur CLI angulaire.</span><span class="sxs-lookup"><span data-stu-id="0927e-175">When you start your ASP.NET Core app, it won't launch an Angular CLI server.</span></span> <span data-ttu-id="0927e-176">L’instance que vous avez démarré manuellement est utilisé à la place.</span><span class="sxs-lookup"><span data-stu-id="0927e-176">The instance you started manually is used instead.</span></span> <span data-ttu-id="0927e-177">Cela lui permet de démarrer et redémarrer plus rapidement.</span><span class="sxs-lookup"><span data-stu-id="0927e-177">This enables it to start and restart faster.</span></span> <span data-ttu-id="0927e-178">Il attend n’est plus angulaire CLI régénérer la chaque fois que votre application cliente.</span><span class="sxs-lookup"><span data-stu-id="0927e-178">It's no longer waiting for Angular CLI to rebuild your client app each time.</span></span>

## <a name="server-side-rendering"></a><span data-ttu-id="0927e-179">Rendu côté serveur</span><span class="sxs-lookup"><span data-stu-id="0927e-179">Server-side rendering</span></span>

<span data-ttu-id="0927e-180">Une fonctionnalité de performances, vous pouvez choisir pour les rendre votre application angulaire sur le serveur, ainsi que son exécution sur le client.</span><span class="sxs-lookup"><span data-stu-id="0927e-180">As a performance feature, you can choose to pre-render your Angular app on the server as well as running it on the client.</span></span> <span data-ttu-id="0927e-181">Cela signifie que les navigateurs recevront balisage HTML qui représente l’interface utilisateur initiale de votre application, de façon à afficher même avant le téléchargement et l’exécution de vos groupes de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="0927e-181">This means that browsers receive HTML markup representing your app's initial UI, so they display it even before downloading and executing your JavaScript bundles.</span></span> <span data-ttu-id="0927e-182">La plupart de l’implémentation de ce provient d’une fonctionnalité angulaire appelée [angulaire universelle](https://universal.angular.io/).</span><span class="sxs-lookup"><span data-stu-id="0927e-182">Most of the implementation of this comes from an Angular feature called [Angular Universal](https://universal.angular.io/).</span></span>

> [!TIP]
> <span data-ttu-id="0927e-183">L’activation de rendu côté serveur (SSR) présente un nombre de complications supplémentaires à la fois au cours de développement et de déploiement.</span><span class="sxs-lookup"><span data-stu-id="0927e-183">Enabling server-side rendering (SSR) introduces a number of extra complications both during development and deployment.</span></span> <span data-ttu-id="0927e-184">Lecture [présente deux inconvénients : SSR](#drawbacks-of-ssr) pour déterminer si SSR est adapté à vos besoins.</span><span class="sxs-lookup"><span data-stu-id="0927e-184">Read [drawbacks of SSR](#drawbacks-of-ssr) to determine if SSR is a good fit for your requirements.</span></span>

<span data-ttu-id="0927e-185">Pour activer SSR, vous devez effectuer un certain nombre d’ajouts à votre projet.</span><span class="sxs-lookup"><span data-stu-id="0927e-185">To enable SSR, you need to make a number of additions to your project.</span></span>

<span data-ttu-id="0927e-186">Dans le *démarrage* (classe), *après* la ligne qui configure `spa.Options.SourcePath`, et *avant* l’appel à `UseAngularCliServer` ou `UseProxyToSpaDevelopmentServer`, ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="0927e-186">In the *Startup* class, *after* the line that configures `spa.Options.SourcePath`, and *before* the call to `UseAngularCliServer` or `UseProxyToSpaDevelopmentServer`, add the following:</span></span>

[!code-csharp[](sample/AngularServerSideRendering/Startup.cs?name=snippet_Call_UseSpa&highlight=5-12)]

<span data-ttu-id="0927e-187">En mode de développement, ce code tente de créer le groupe de SSR en exécutant le script `build:ssr`, qui est défini dans *ClientApp\package.json*.</span><span class="sxs-lookup"><span data-stu-id="0927e-187">In development mode, this code attempts to build the SSR bundle by running the script `build:ssr`, which is defined in *ClientApp\package.json*.</span></span> <span data-ttu-id="0927e-188">Cette opération génère une application angulaire nommée `ssr`, qui n’est pas encore défini.</span><span class="sxs-lookup"><span data-stu-id="0927e-188">This builds an Angular app named `ssr`, which isn't yet defined.</span></span> 

<span data-ttu-id="0927e-189">À la fin de la `apps` tableau *ClientApp/.angular-cli.json*, définir une application supplémentaire avec le nom `ssr`.</span><span class="sxs-lookup"><span data-stu-id="0927e-189">At the end of the `apps` array in *ClientApp/.angular-cli.json*, define an extra app with name `ssr`.</span></span> <span data-ttu-id="0927e-190">Utilisez les options suivantes :</span><span class="sxs-lookup"><span data-stu-id="0927e-190">Use the following options:</span></span>

[!code-json[](sample/AngularServerSideRendering/ClientApp/.angular-cli.json?range=24-41)]

<span data-ttu-id="0927e-191">Cette nouvelle configuration de l’application SSR requiert deux fichiers supplémentaires : *tsconfig.server.json* et *main.server.ts*.</span><span class="sxs-lookup"><span data-stu-id="0927e-191">This new SSR-enabled app configuration requires two further files: *tsconfig.server.json* and *main.server.ts*.</span></span> <span data-ttu-id="0927e-192">Le *tsconfig.server.json* fichier spécifie les options de la compilation TypeScript.</span><span class="sxs-lookup"><span data-stu-id="0927e-192">The *tsconfig.server.json* file specifies TypeScript compilation options.</span></span> <span data-ttu-id="0927e-193">Le *main.server.ts* fichier sert de point d’entrée du code pendant SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-193">The *main.server.ts* file serves as the code entry point during SSR.</span></span>

<span data-ttu-id="0927e-194">Ajouter un nouveau fichier appelé *tsconfig.server.json* à l’intérieur de *ClientApp/src* (en même temps qu’existants *tsconfig.app.json*), qui contient les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="0927e-194">Add a new file called *tsconfig.server.json* inside *ClientApp/src* (alongside the existing *tsconfig.app.json*), containing the following:</span></span>

[!code-json[](sample/AngularServerSideRendering/ClientApp/src/tsconfig.server.json)]

<span data-ttu-id="0927e-195">Ce fichier configure le compilateur AOA d’angulaire rechercher un module appelé `app.server.module`.</span><span class="sxs-lookup"><span data-stu-id="0927e-195">This file configures Angular's AoT compiler to look for a module called `app.server.module`.</span></span> <span data-ttu-id="0927e-196">Ajoutez ceci en créant un nouveau fichier à *ClientApp/src/app/app.server.module.ts* (en même temps qu’existants *app.module.ts*) qui contient les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="0927e-196">Add this by creating a new file at *ClientApp/src/app/app.server.module.ts* (alongside the existing *app.module.ts*) containing the following:</span></span> 

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/app/app.server.module.ts)]

<span data-ttu-id="0927e-197">Ce module hérite de votre côté client `app.module` et définit quels modules Angular supplémentaires sont disponibles au cours de SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-197">This module inherits from your client-side `app.module` and defines which extra Angular modules are available during SSR.</span></span>

<span data-ttu-id="0927e-198">N’oubliez pas que la nouvelle `ssr` entrée dans *.angular-cli.json* référencé d’un fichier de point d’entrée appelé *main.server.ts*.</span><span class="sxs-lookup"><span data-stu-id="0927e-198">Recall that the new `ssr` entry in *.angular-cli.json* referenced an entry point file called *main.server.ts*.</span></span> <span data-ttu-id="0927e-199">Vous n’avez pas encore ajouté de ce fichier et êtes maintenant temps de le faire.</span><span class="sxs-lookup"><span data-stu-id="0927e-199">You haven't yet added that file, and now is time to do so.</span></span> <span data-ttu-id="0927e-200">Créer un nouveau fichier à *ClientApp/src/main.server.ts* (en même temps qu’existants *main.ts*), qui contient les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="0927e-200">Create a new file at *ClientApp/src/main.server.ts* (alongside the existing *main.ts*), containing the following:</span></span>

[!code-typescript[](sample/AngularServerSideRendering/ClientApp/src/main.server.ts)]

<span data-ttu-id="0927e-201">Code de ce fichier s’ASP.NET Core exécute pour chaque demande lorsqu’il exécute la `UseSpaPrerendering` intergiciel (middleware) que vous avez ajouté à la *démarrage* classe.</span><span class="sxs-lookup"><span data-stu-id="0927e-201">This file's code is what ASP.NET Core executes for each request when it runs the `UseSpaPrerendering` middleware that you added to the *Startup* class.</span></span> <span data-ttu-id="0927e-202">Il porte sur la réception `params` à partir du code .NET (par exemple, l’URL demandée) et effectuer des appels aux API de SSR angulaire pour obtenir le code HTML résultant.</span><span class="sxs-lookup"><span data-stu-id="0927e-202">It deals with receiving `params` from the .NET code (such as the URL being requested), and making calls to Angular SSR APIs to get the resulting HTML.</span></span> 

<span data-ttu-id="0927e-203">Proprement parler, cela est suffisant pour activer SSR en mode de développement.</span><span class="sxs-lookup"><span data-stu-id="0927e-203">Strictly-speaking, this is sufficient to enable SSR in development mode.</span></span> <span data-ttu-id="0927e-204">Il est primordial d’effectuer une modification finale afin que votre application fonctionne correctement lors de la publication.</span><span class="sxs-lookup"><span data-stu-id="0927e-204">It's essential to make one final change so that your app works correctly when published.</span></span> <span data-ttu-id="0927e-205">Dans main de votre application *.csproj* de fichiers, définissez le `BuildServerSideRenderer` valeur de la propriété `true`:</span><span class="sxs-lookup"><span data-stu-id="0927e-205">In your app's main *.csproj* file, set the `BuildServerSideRenderer` property value to `true`:</span></span>

[!code-xml[](sample/AngularServerSideRendering/AngularServerSideRendering.csproj?name=snippet_EnableBuildServerSideRenderer)]

<span data-ttu-id="0927e-206">Cela configure le processus de génération pour exécuter `build:ssr` lors de la publication et de déployer les fichiers SSR sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="0927e-206">This configures the build process to run `build:ssr` during publishing and deploy the SSR files to the server.</span></span> <span data-ttu-id="0927e-207">Si vous n’activez pas cette, SSR échoue en production.</span><span class="sxs-lookup"><span data-stu-id="0927e-207">If you don't enable this, SSR fails in production.</span></span>

<span data-ttu-id="0927e-208">Lorsque votre application s’exécute en mode de développement ou de production, le code angulaire restitue préalablement au format HTML sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="0927e-208">When your app runs in either development or production mode, the Angular code pre-renders as HTML on the server.</span></span> <span data-ttu-id="0927e-209">Le code côté client s’exécute normalement.</span><span class="sxs-lookup"><span data-stu-id="0927e-209">The client-side code executes as normal.</span></span>

### <a name="pass-data-from-net-code-into-typescript-code"></a><span data-ttu-id="0927e-210">Passer des données à partir du code .NET dans le code TypeScript</span><span class="sxs-lookup"><span data-stu-id="0927e-210">Pass data from .NET code into TypeScript code</span></span>

<span data-ttu-id="0927e-211">Au cours de SSR, vous pouvez souhaiter transmettre des données de chaque demande à partir de votre application ASP.NET Core dans votre application angulaire.</span><span class="sxs-lookup"><span data-stu-id="0927e-211">During SSR, you might want to pass per-request data from your ASP.NET Core app into your Angular app.</span></span> <span data-ttu-id="0927e-212">Par exemple, vous pouvez transmettre des informations sur le cookie ou quelque chose de lecture à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="0927e-212">For example, you could pass cookie information or something read from a database.</span></span> <span data-ttu-id="0927e-213">Pour ce faire, modifiez votre *démarrage* classe.</span><span class="sxs-lookup"><span data-stu-id="0927e-213">To do this, edit your *Startup* class.</span></span> <span data-ttu-id="0927e-214">Dans le rappel pour `UseSpaPrerendering`, définissez une valeur pour `options.SupplyData` telle que la suivante :</span><span class="sxs-lookup"><span data-stu-id="0927e-214">In the callback for `UseSpaPrerendering`, set a value for `options.SupplyData` such as the following:</span></span>

```csharp
options.SupplyData = (context, data) =>
{
    // Creates a new value called isHttpsRequest that's passed to TypeScript code
    data["isHttpsRequest"] = context.Request.IsHttps;
};
```

<span data-ttu-id="0927e-215">Le `SupplyData` vous permet de rappel transmettre arbitraires, chaque demande, les données JSON sérialisable (par exemple, chaînes, des valeurs booléennes ou des nombres).</span><span class="sxs-lookup"><span data-stu-id="0927e-215">The `SupplyData` callback lets you pass arbitrary, per-request, JSON-serializable data (for example, strings, booleans, or numbers).</span></span> <span data-ttu-id="0927e-216">Votre *main.server.ts* code reçoit comme `params.data`.</span><span class="sxs-lookup"><span data-stu-id="0927e-216">Your *main.server.ts* code receives this as `params.data`.</span></span> <span data-ttu-id="0927e-217">Par exemple, l’exemple de code précédent passe une valeur booléenne comme `params.data.isHttpsRequest` dans le `createServerRenderer` rappel.</span><span class="sxs-lookup"><span data-stu-id="0927e-217">For example, the preceding code sample passes a boolean value as `params.data.isHttpsRequest` into the `createServerRenderer` callback.</span></span> <span data-ttu-id="0927e-218">Vous pouvez le passer à d’autres parties de votre application en aucune façon pris en charge par angulaire.</span><span class="sxs-lookup"><span data-stu-id="0927e-218">You can pass this to other parts of your app in any way supported by Angular.</span></span> <span data-ttu-id="0927e-219">Par exemple, consultez Comment *main.server.ts* transmet le `BASE_URL` valeur à un composant dont le constructeur est déclaré pour le recevoir.</span><span class="sxs-lookup"><span data-stu-id="0927e-219">For example, see how *main.server.ts* passes the `BASE_URL` value to any component whose constructor is declared to receive it.</span></span>

### <a name="drawbacks-of-ssr"></a><span data-ttu-id="0927e-220">Inconvénients de SSR</span><span class="sxs-lookup"><span data-stu-id="0927e-220">Drawbacks of SSR</span></span>

<span data-ttu-id="0927e-221">Pas toutes les applications tirent parti SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-221">Not all apps benefit from SSR.</span></span> <span data-ttu-id="0927e-222">Le principal avantage est perçu des performances.</span><span class="sxs-lookup"><span data-stu-id="0927e-222">The primary benefit is perceived performance.</span></span> <span data-ttu-id="0927e-223">Les visiteurs atteindre votre application via une connexion réseau lente ou sur les périphériques mobiles lents voir l’interface utilisateur initiale rapidement, même si elle prend un certain temps pour extraire ou analyser les regroupements de JavaScript.</span><span class="sxs-lookup"><span data-stu-id="0927e-223">Visitors reaching your app over a slow network connection or on slow mobile devices see the initial UI quickly, even if it takes a while to fetch or parse the JavaScript bundles.</span></span> <span data-ttu-id="0927e-224">Toutefois, plusieurs SPAs sont principalement utilisés via des réseaux d’entreprise interne rapide sur les ordinateurs rapides dans lequel l’application s’affiche presque instantanément.</span><span class="sxs-lookup"><span data-stu-id="0927e-224">However, many SPAs are mainly used over fast, internal company networks on fast computers where the app appears almost instantly.</span></span>

<span data-ttu-id="0927e-225">En même temps, il existe des inconvénients importants pour l’activation de SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-225">At the same time, there are significant drawbacks to enabling SSR.</span></span> <span data-ttu-id="0927e-226">Il ajoute une complexité au processus de développement.</span><span class="sxs-lookup"><span data-stu-id="0927e-226">It adds complexity to your development process.</span></span> <span data-ttu-id="0927e-227">Votre code doit s’exécuter dans deux environnements différents : côté client et côté serveur (dans un environnement de Node.js appelée à partir de ASP.NET Core).</span><span class="sxs-lookup"><span data-stu-id="0927e-227">Your code must run in two different environments: client-side and server-side (in a Node.js environment invoked from ASP.NET Core).</span></span> <span data-ttu-id="0927e-228">Voici quelques points à l’esprit :</span><span class="sxs-lookup"><span data-stu-id="0927e-228">Here are some things to bear in mind:</span></span>

* <span data-ttu-id="0927e-229">SSR requiert une installation de Node.js sur vos serveurs de production.</span><span class="sxs-lookup"><span data-stu-id="0927e-229">SSR requires a Node.js installation on your production servers.</span></span> <span data-ttu-id="0927e-230">C’est automatiquement le cas pour certains scénarios de déploiement, telles que les Services d’application Azure, mais pas pour d’autres, tels que Azure Service Fabric.</span><span class="sxs-lookup"><span data-stu-id="0927e-230">This is automatically the case for some deployment scenarios, such as Azure App Services, but not for others, such as Azure Service Fabric.</span></span>
* <span data-ttu-id="0927e-231">L’activation de la `BuildServerSideRenderer` fait de générer votre *node_modules* active à publier.</span><span class="sxs-lookup"><span data-stu-id="0927e-231">Enabling the `BuildServerSideRenderer` build flag causes your *node_modules* directory to publish.</span></span> <span data-ttu-id="0927e-232">Ce dossier contient 20 000 fichiers, ce qui augmente le temps de déploiement.</span><span class="sxs-lookup"><span data-stu-id="0927e-232">This folder contains 20,000+ files, which increases deployment time.</span></span>
* <span data-ttu-id="0927e-233">Pour exécuter votre code dans un environnement de Node.js, il ne peut pas s’appuient sur l’existence d’un navigateur JavaScript APIs spécifiques telles que `window` ou `localStorage`.</span><span class="sxs-lookup"><span data-stu-id="0927e-233">To run your code in a Node.js environment, it can't rely on the existence of browser-specific JavaScript APIs such as `window` or `localStorage`.</span></span> <span data-ttu-id="0927e-234">Si votre code (ou une bibliothèque tierce que vous référencez) tente d’utiliser ces API, vous obtiendrez une erreur au cours de SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-234">If your code (or some third-party library you reference) tries to use these APIs, you'll get an error during SSR.</span></span> <span data-ttu-id="0927e-235">Par exemple, n’utilisez pas jQuery, car elle référence d’API spécifiques au navigateur dans de nombreux endroits.</span><span class="sxs-lookup"><span data-stu-id="0927e-235">For example, don't use jQuery because it references browser-specific APIs in many places.</span></span> <span data-ttu-id="0927e-236">Pour éviter les erreurs, vous devez éviter de SSR ou éviter l’API ou des bibliothèques spécifiques au navigateur.</span><span class="sxs-lookup"><span data-stu-id="0927e-236">To prevent errors, you must either avoid SSR or avoid browser-specific APIs or libraries.</span></span> <span data-ttu-id="0927e-237">Vous pouvez encapsuler tous les appels à ces API dans les vérifications pour vous assurer qu’ils ne sont pas appelés au cours de SSR.</span><span class="sxs-lookup"><span data-stu-id="0927e-237">You can wrap any calls to such APIs in checks to ensure they aren't invoked during SSR.</span></span> <span data-ttu-id="0927e-238">Par exemple, utiliser un contrôle tel que le suivant dans le code JavaScript ou TypeScript :</span><span class="sxs-lookup"><span data-stu-id="0927e-238">For example, use a check such as the following in JavaScript or TypeScript code:</span></span>

    ```javascript
    if (typeof window !== 'undefined') {
        // Call browser-specific APIs here
    }
    ```
