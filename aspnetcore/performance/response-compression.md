---
title: "Intergiciel (middleware) de réponse Compression pour ASP.NET Core"
author: guardrex
description: "En savoir plus sur la compression de la réponse et comment utiliser un intergiciel (middleware) de réponse Compression dans les applications ASP.NET Core."
keywords: "ASP.NET Core, performances, la compression de la réponse, gzip, encodage, intergiciel (middleware)"
ms.author: riande
manager: wpickett
ms.date: 08/20/2017
ms.topic: article
ms.assetid: de621887-c5c9-4ac8-9efd-f5cc0457a134
ms.technology: aspnet
ms.prod: asp.net-core
uid: performance/response-compression
ms.openlocfilehash: 86244179115fe6a7d0f7298495086a96ee9570d9
ms.sourcegitcommit: 12e5194936b7e820efc5505a2d5d4f84e88eb5ef
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/11/2018
---
# <a name="response-compression-middleware-for-aspnet-core"></a><span data-ttu-id="b407a-104">Intergiciel (middleware) de réponse Compression pour ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="b407a-104">Response Compression Middleware for ASP.NET Core</span></span>

<span data-ttu-id="b407a-105">Par [Luke Latham](https://github.com/guardrex)</span><span class="sxs-lookup"><span data-stu-id="b407a-105">By [Luke Latham](https://github.com/guardrex)</span></span>

<span data-ttu-id="b407a-106">[Affichez ou téléchargez l’exemple de code](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples) ([procédure de téléchargement](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="b407a-106">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

<span data-ttu-id="b407a-107">La bande passante réseau est une ressource limitée.</span><span class="sxs-lookup"><span data-stu-id="b407a-107">Network bandwidth is a limited resource.</span></span> <span data-ttu-id="b407a-108">Réduire la taille de la réponse de généralement d’augmente souvent considérablement la réactivité d’une application.</span><span class="sxs-lookup"><span data-stu-id="b407a-108">Reducing the size of the response usually increases the responsiveness of an app, often dramatically.</span></span> <span data-ttu-id="b407a-109">Une pour réduire la taille de la charge utile consiste à compresser les réponses de l’application.</span><span class="sxs-lookup"><span data-stu-id="b407a-109">One way to reduce payload sizes is to compress an app's responses.</span></span>

## <a name="when-to-use-response-compression-middleware"></a><span data-ttu-id="b407a-110">Quand utiliser l’intergiciel (middleware) de réponse Compression</span><span class="sxs-lookup"><span data-stu-id="b407a-110">When to use Response Compression Middleware</span></span>
<span data-ttu-id="b407a-111">Utiliser les technologies de compression de la réponse basée sur le serveur dans IIS, Apache ou Nginx.</span><span class="sxs-lookup"><span data-stu-id="b407a-111">Use server-based response compression technologies in IIS, Apache, or Nginx.</span></span> <span data-ttu-id="b407a-112">Les performances de l’intergiciel (middleware) probablement ne sera pas correspondre à celui des modules de serveur.</span><span class="sxs-lookup"><span data-stu-id="b407a-112">The performance of the middleware probably won't match that of the server modules.</span></span> <span data-ttu-id="b407a-113">[Serveur HTTP.sys](xref:fundamentals/servers/httpsys) et [Kestrel](xref:fundamentals/servers/kestrel) n’offrent actuellement pas prise en charge de la compression intégrée.</span><span class="sxs-lookup"><span data-stu-id="b407a-113">[HTTP.sys server](xref:fundamentals/servers/httpsys) and [Kestrel](xref:fundamentals/servers/kestrel) don't currently offer built-in compression support.</span></span>

<span data-ttu-id="b407a-114">Utilisez réponse Compression intergiciel (middleware) lorsque vous êtes :</span><span class="sxs-lookup"><span data-stu-id="b407a-114">Use Response Compression Middleware when you're:</span></span>

* <span data-ttu-id="b407a-115">Impossible d’utiliser les technologies de compression basée sur le serveur suivant :</span><span class="sxs-lookup"><span data-stu-id="b407a-115">Unable to use the following server-based compression technologies:</span></span>
  * [<span data-ttu-id="b407a-116">Module de la Compression dynamique IIS</span><span class="sxs-lookup"><span data-stu-id="b407a-116">IIS Dynamic Compression module</span></span>](https://www.iis.net/overview/reliability/dynamiccachingandcompression)
  * [<span data-ttu-id="b407a-117">Module de mod_deflate Apache</span><span class="sxs-lookup"><span data-stu-id="b407a-117">Apache mod_deflate module</span></span>](http://httpd.apache.org/docs/current/mod/mod_deflate.html)
  * [<span data-ttu-id="b407a-118">La décompression et NGINX Compression</span><span class="sxs-lookup"><span data-stu-id="b407a-118">NGINX Compression and Decompression</span></span>](https://www.nginx.com/resources/admin-guide/compression-and-decompression/)
* <span data-ttu-id="b407a-119">Hébergement directement sur :</span><span class="sxs-lookup"><span data-stu-id="b407a-119">Hosting directly on:</span></span>
  * <span data-ttu-id="b407a-120">[Serveur HTTP.sys](xref:fundamentals/servers/httpsys) (anciennement appelé [WebListener](xref:fundamentals/servers/weblistener))</span><span class="sxs-lookup"><span data-stu-id="b407a-120">[HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called [WebListener](xref:fundamentals/servers/weblistener))</span></span>
  * [<span data-ttu-id="b407a-121">Kestrel</span><span class="sxs-lookup"><span data-stu-id="b407a-121">Kestrel</span></span>](xref:fundamentals/servers/kestrel)

## <a name="response-compression"></a><span data-ttu-id="b407a-122">Compression de la réponse</span><span class="sxs-lookup"><span data-stu-id="b407a-122">Response compression</span></span>
<span data-ttu-id="b407a-123">En règle générale, toute réponse ne compressée pas en mode natif peut bénéficier de la compression de la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-123">Usually, any response not natively compressed can benefit from response compression.</span></span> <span data-ttu-id="b407a-124">Pas en mode natif compressées en général, les réponses sont : CSS, JavaScript, HTML, XML et JSON.</span><span class="sxs-lookup"><span data-stu-id="b407a-124">Responses not natively compressed typically include: CSS, JavaScript, HTML, XML, and JSON.</span></span> <span data-ttu-id="b407a-125">Vous ne doivent pas compresser les actifs compressés en mode natif, telles que des fichiers PNG.</span><span class="sxs-lookup"><span data-stu-id="b407a-125">You shouldn't compress natively compressed assets, such as PNG files.</span></span> <span data-ttu-id="b407a-126">Si vous tentez de davantage de compresser une réponse compressée en mode natif, toute petite réduction supplémentaire dans le temps de taille et de transmission sera probablement être éclipsée par le temps de traitement de la compression.</span><span class="sxs-lookup"><span data-stu-id="b407a-126">If you attempt to further compress a natively compressed response, any small additional reduction in size and transmission time will likely be overshadowed by the time it took to process the compression.</span></span> <span data-ttu-id="b407a-127">Ne pas compresser les fichiers inférieurs à environ 150-1000 octets (selon le contenu du fichier et l’efficacité de compression).</span><span class="sxs-lookup"><span data-stu-id="b407a-127">Don't compress files smaller than about 150-1000 bytes (depending on the file's content and the efficiency of compression).</span></span> <span data-ttu-id="b407a-128">La surcharge de la compression des petits fichiers peut produire un fichier compressé plus volumineux que le fichier non compressé.</span><span class="sxs-lookup"><span data-stu-id="b407a-128">The overhead of compressing small files may produce a compressed file larger than the uncompressed file.</span></span>

<span data-ttu-id="b407a-129">Lorsqu’un client peut traiter le contenu compressé, le client informe le serveur de ses capacités en envoyant la `Accept-Encoding` en-tête avec la demande.</span><span class="sxs-lookup"><span data-stu-id="b407a-129">When a client can process compressed content, the client must inform the server of its capabilities by sending the `Accept-Encoding` header with the request.</span></span> <span data-ttu-id="b407a-130">Lorsqu’un serveur envoie un contenu compressé, il doit inclure les informations contenues dans le `Content-Encoding` en-tête sur la façon dont la réponse compressée est encodée.</span><span class="sxs-lookup"><span data-stu-id="b407a-130">When a server sends compressed content, it must include information in the `Content-Encoding` header on how the compressed response is encoded.</span></span> <span data-ttu-id="b407a-131">Contenu désignations de codage pris en charge par l’intergiciel (middleware) sont affichées dans le tableau suivant.</span><span class="sxs-lookup"><span data-stu-id="b407a-131">Content encoding designations supported by the middleware are shown in the following table.</span></span>

| <span data-ttu-id="b407a-132">`Accept-Encoding`valeurs d’en-tête</span><span class="sxs-lookup"><span data-stu-id="b407a-132">`Accept-Encoding` header values</span></span> | <span data-ttu-id="b407a-133">Intergiciel (middleware) pris en charge</span><span class="sxs-lookup"><span data-stu-id="b407a-133">Middleware Supported</span></span> | <span data-ttu-id="b407a-134">Description</span><span class="sxs-lookup"><span data-stu-id="b407a-134">Description</span></span>                                                 |
| :-----------------------------: | :------------------: | ----------------------------------------------------------- |
| `br`                            | <span data-ttu-id="b407a-135">Non</span><span class="sxs-lookup"><span data-stu-id="b407a-135">No</span></span>                   | <span data-ttu-id="b407a-136">Format de données compressées Brotli</span><span class="sxs-lookup"><span data-stu-id="b407a-136">Brotli Compressed Data Format</span></span>                               |
| `compress`                      | <span data-ttu-id="b407a-137">Non</span><span class="sxs-lookup"><span data-stu-id="b407a-137">No</span></span>                   | <span data-ttu-id="b407a-138">Format de données « compresser » UNIX</span><span class="sxs-lookup"><span data-stu-id="b407a-138">UNIX "compress" data format</span></span>                                 |
| `deflate`                       | <span data-ttu-id="b407a-139">Non</span><span class="sxs-lookup"><span data-stu-id="b407a-139">No</span></span>                   | <span data-ttu-id="b407a-140">les données compressées dans le format de données « zlib » « deflate »</span><span class="sxs-lookup"><span data-stu-id="b407a-140">"deflate" compressed data inside the "zlib" data format</span></span>     |
| `exi`                           | <span data-ttu-id="b407a-141">Non</span><span class="sxs-lookup"><span data-stu-id="b407a-141">No</span></span>                   | <span data-ttu-id="b407a-142">Échange efficace de XML de W3C</span><span class="sxs-lookup"><span data-stu-id="b407a-142">W3C Efficient XML Interchange</span></span>                               |
| `gzip`                          | <span data-ttu-id="b407a-143">Oui (valeur par défaut)</span><span class="sxs-lookup"><span data-stu-id="b407a-143">Yes (default)</span></span>        | <span data-ttu-id="b407a-144">format de fichier GZIP</span><span class="sxs-lookup"><span data-stu-id="b407a-144">gzip file format</span></span>                                            |
| `identity`                      | <span data-ttu-id="b407a-145">Oui</span><span class="sxs-lookup"><span data-stu-id="b407a-145">Yes</span></span>                  | <span data-ttu-id="b407a-146">Identificateur de « Aucun codage » : la réponse ne doit pas être encodée.</span><span class="sxs-lookup"><span data-stu-id="b407a-146">"No encoding" identifier: The response must not be encoded.</span></span> |
| `pack200-gzip`                  | <span data-ttu-id="b407a-147">Non</span><span class="sxs-lookup"><span data-stu-id="b407a-147">No</span></span>                   | <span data-ttu-id="b407a-148">Format de transfert réseau pour les Archives de Java</span><span class="sxs-lookup"><span data-stu-id="b407a-148">Network Transfer Format for Java Archives</span></span>                   |
| `*`                             | <span data-ttu-id="b407a-149">Oui</span><span class="sxs-lookup"><span data-stu-id="b407a-149">Yes</span></span>                  | <span data-ttu-id="b407a-150">Aucun contenu disponible n'encodage pas explicitement demandée</span><span class="sxs-lookup"><span data-stu-id="b407a-150">Any available content encoding not explicitly requested</span></span>     |

<span data-ttu-id="b407a-151">Pour plus d’informations, consultez la [IANA officiel de codage liste contenu](http://www.iana.org/assignments/http-parameters/http-parameters.xml#http-content-coding-registry).</span><span class="sxs-lookup"><span data-stu-id="b407a-151">For more information, see the [IANA Official Content Coding List](http://www.iana.org/assignments/http-parameters/http-parameters.xml#http-content-coding-registry).</span></span>

<span data-ttu-id="b407a-152">L’intergiciel (middleware) vous permet d’ajouter des fournisseurs de compression supplémentaire personnalisée `Accept-Encoding` les valeurs d’en-tête.</span><span class="sxs-lookup"><span data-stu-id="b407a-152">The middleware allows you to add additional compression providers for custom `Accept-Encoding` header values.</span></span> <span data-ttu-id="b407a-153">Pour plus d’informations, consultez [fournisseurs personnalisés](#custom-providers) ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="b407a-153">For more information, see [Custom Providers](#custom-providers) below.</span></span>

<span data-ttu-id="b407a-154">L’intergiciel (middleware) est capable de réagir à la valeur de qualité (qvalue, `q`) lors de l’envoi par le client afin de hiérarchiser les schémas de compression de pondération.</span><span class="sxs-lookup"><span data-stu-id="b407a-154">The middleware is capable of reacting to quality value (qvalue, `q`) weighting when sent by the client to prioritize compression schemes.</span></span> <span data-ttu-id="b407a-155">Pour plus d’informations, consultez [7231 relative aux RFC : encodage](https://tools.ietf.org/html/rfc7231#section-5.3.4).</span><span class="sxs-lookup"><span data-stu-id="b407a-155">For more information, see [RFC 7231: Accept-Encoding](https://tools.ietf.org/html/rfc7231#section-5.3.4).</span></span>

<span data-ttu-id="b407a-156">Algorithmes de compression sont soumis à un compromis entre la vitesse de la compression et l’efficacité de la compression.</span><span class="sxs-lookup"><span data-stu-id="b407a-156">Compression algorithms are subject to a tradeoff between compression speed and the effectiveness of the compression.</span></span> <span data-ttu-id="b407a-157">*Efficacité* dans ce contexte fait référence à la taille de la sortie après la compression.</span><span class="sxs-lookup"><span data-stu-id="b407a-157">*Effectiveness* in this context refers to the size of the output after compression.</span></span> <span data-ttu-id="b407a-158">La plus petite taille est obtenue par le meilleur *optimale* la compression.</span><span class="sxs-lookup"><span data-stu-id="b407a-158">The smallest size is achieved by the most *optimal* compression.</span></span>

<span data-ttu-id="b407a-159">Les en-têtes impliquées dans la demande, envoi, la mise en cache et la réception de contenu compressé sont décrits dans le tableau ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="b407a-159">The headers involved in requesting, sending, caching, and receiving compressed content are described in the table below.</span></span>

| <span data-ttu-id="b407a-160">Header</span><span class="sxs-lookup"><span data-stu-id="b407a-160">Header</span></span>             | <span data-ttu-id="b407a-161">Rôle</span><span class="sxs-lookup"><span data-stu-id="b407a-161">Role</span></span> |
| ------------------ | ---- |
| `Accept-Encoding`  | <span data-ttu-id="b407a-162">Envoyé à partir du client au serveur pour indiquer le contenu de codage des schémas acceptables pour le client.</span><span class="sxs-lookup"><span data-stu-id="b407a-162">Sent from the client to the server to indicate the content encoding schemes acceptable to the client.</span></span> |
| `Content-Encoding` | <span data-ttu-id="b407a-163">Envoyé à partir du serveur au client pour indiquer le codage du contenu de la charge utile.</span><span class="sxs-lookup"><span data-stu-id="b407a-163">Sent from the server to the client to indicate the encoding of the content in the payload.</span></span> |
| `Content-Length`   | <span data-ttu-id="b407a-164">Lors de la compression, le `Content-Length` en-tête est supprimé, depuis les modifications de contenu du corps lors de la compression de la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-164">When compression occurs, the `Content-Length` header is removed, since the body content changes when the response is compressed.</span></span> |
| `Content-MD5`      | <span data-ttu-id="b407a-165">Lors de la compression, le `Content-MD5` en-tête est supprimé, car le contenu du corps a changé et le hachage n’est plus valide.</span><span class="sxs-lookup"><span data-stu-id="b407a-165">When compression occurs, the `Content-MD5` header is removed, since the body content has changed and the hash is no longer valid.</span></span> |
| `Content-Type`     | <span data-ttu-id="b407a-166">Spécifie le type MIME du contenu.</span><span class="sxs-lookup"><span data-stu-id="b407a-166">Specifies the MIME type of the content.</span></span> <span data-ttu-id="b407a-167">Chaque réponse doit spécifier son `Content-Type`.</span><span class="sxs-lookup"><span data-stu-id="b407a-167">Every response should specify its `Content-Type`.</span></span> <span data-ttu-id="b407a-168">L’intergiciel (middleware) vérifie cette valeur pour déterminer si la réponse doit être compressée.</span><span class="sxs-lookup"><span data-stu-id="b407a-168">The middleware checks this value to determine if the response should be compressed.</span></span> <span data-ttu-id="b407a-169">L’intergiciel (middleware) spécifie un jeu de [par défaut des types MIME](#mime-types) il peut encoder, mais vous pouvez remplacer ou ajouter des types MIME.</span><span class="sxs-lookup"><span data-stu-id="b407a-169">The middleware specifies a set of [default MIME types](#mime-types) that it can encode, but you can replace or add MIME types.</span></span> |
| `Vary`             | <span data-ttu-id="b407a-170">Lors de l’envoi par le serveur avec la valeur `Accept-Encoding` aux clients et serveurs proxy, le `Vary` en-tête indique au client ou au proxy qu’il doit mettre en cache (différentes) réponses en fonction de la valeur de la `Accept-Encoding` en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="b407a-170">When sent by the server with a value of `Accept-Encoding` to clients and proxies, the `Vary` header indicates to the client or proxy that it should cache (vary) responses based on the value of the `Accept-Encoding` header of the request.</span></span> <span data-ttu-id="b407a-171">Le résultat de contenu avec le `Vary: Accept-Encoding` en-tête est que les deux compressées et non compressées réponses sont mis en cache séparément.</span><span class="sxs-lookup"><span data-stu-id="b407a-171">The result of returning content with the `Vary: Accept-Encoding` header is that both compressed and uncompressed responses are cached separately.</span></span> |

<span data-ttu-id="b407a-172">Vous pouvez explorer les fonctionnalités de l’intergiciel de compression de la réponse avec la [exemple d’application](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples).</span><span class="sxs-lookup"><span data-stu-id="b407a-172">You can explore the features of the Response Compression Middleware with the [sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/response-compression/samples).</span></span> <span data-ttu-id="b407a-173">L’exemple illustre :</span><span class="sxs-lookup"><span data-stu-id="b407a-173">The sample illustrates:</span></span>
* <span data-ttu-id="b407a-174">La compression des réponses d’application à l’aide de gzip et fournisseurs de compression personnalisé.</span><span class="sxs-lookup"><span data-stu-id="b407a-174">The compression of app responses using gzip and custom compression providers.</span></span>
* <span data-ttu-id="b407a-175">Comment ajouter un type MIME à la liste par défaut des types MIME pour la compression.</span><span class="sxs-lookup"><span data-stu-id="b407a-175">How to add a MIME type to the default list of MIME types for compression.</span></span>

## <a name="package"></a><span data-ttu-id="b407a-176">Package</span><span class="sxs-lookup"><span data-stu-id="b407a-176">Package</span></span>
<span data-ttu-id="b407a-177">Pour inclure l’intergiciel (middleware) dans votre projet, ajoutez une référence à la [ `Microsoft.AspNetCore.ResponseCompression` ](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) du package ou utilisez le [ `Microsoft.AspNetCore.All` ](https://www.nuget.org/packages/Microsoft.AspNetCore.All/) package.</span><span class="sxs-lookup"><span data-stu-id="b407a-177">To include the middleware in your project, add a reference to the [`Microsoft.AspNetCore.ResponseCompression`](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) package or use the [`Microsoft.AspNetCore.All`](https://www.nuget.org/packages/Microsoft.AspNetCore.All/) package.</span></span> <span data-ttu-id="b407a-178">Cette fonctionnalité est disponible pour les applications qui ciblent ASP.NET Core 1.1 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="b407a-178">This feature is available for apps that target ASP.NET Core 1.1 or later.</span></span>

## <a name="configuration"></a><span data-ttu-id="b407a-179">Configuration</span><span class="sxs-lookup"><span data-stu-id="b407a-179">Configuration</span></span>
<span data-ttu-id="b407a-180">Le code suivant illustre l’activation de l’intergiciel de compression de la réponse avec l’avec la compression gzip par défaut et pour les types MIME par défaut.</span><span class="sxs-lookup"><span data-stu-id="b407a-180">The following code shows how to enable the Response Compression Middleware with the with the default gzip compression and for default MIME types.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="b407a-181">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="b407a-181">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](response-compression/samples/2.x/StartupBasic.cs?name=snippet1&highlight=4,8)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="b407a-182">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="b407a-182">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](response-compression/samples/1.x/StartupBasic.cs?name=snippet1&highlight=3,8)]

---

> [!NOTE]
> <span data-ttu-id="b407a-183">Utiliser un outil tel que [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), ou [Postman](https://www.getpostman.com/) pour définir le `Accept-Encoding` en-tête de demande et d’étudier les en-têtes de réponse, la taille et le corps.</span><span class="sxs-lookup"><span data-stu-id="b407a-183">Use a tool like [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), or [Postman](https://www.getpostman.com/) to set the `Accept-Encoding` request header and study the response headers, size, and body.</span></span>

<span data-ttu-id="b407a-184">Soumettre une demande pour l’exemple d’application sans la `Accept-Encoding` en-tête et observez que la réponse n’est pas compressée.</span><span class="sxs-lookup"><span data-stu-id="b407a-184">Submit a request to the sample app without the `Accept-Encoding` header and observe that the response is uncompressed.</span></span> <span data-ttu-id="b407a-185">Le `Content-Encoding` et `Vary` en-têtes ne sont pas présents sur la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-185">The `Content-Encoding` and `Vary` headers aren't present on the response.</span></span>

![Fenêtre Fiddler indiquant le résultat d’une demande sans l’en-tête Accept-Encoding.](response-compression/_static/request-uncompressed.png)

<span data-ttu-id="b407a-188">Soumettre une demande pour l’exemple d’application avec le `Accept-Encoding: gzip` en-tête et observez que la réponse est compressée.</span><span class="sxs-lookup"><span data-stu-id="b407a-188">Submit a request to the sample app with the `Accept-Encoding: gzip` header and observe that the response is compressed.</span></span> <span data-ttu-id="b407a-189">Le `Content-Encoding` et `Vary` en-têtes sont présents sur la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-189">The `Content-Encoding` and `Vary` headers are present on the response.</span></span>

![Fenêtre Fiddler affichant le résultat d’une demande avec l’en-tête Accept-Encoding et la valeur gzip.](response-compression/_static/request-compressed.png)

## <a name="providers"></a><span data-ttu-id="b407a-193">Fournisseurs</span><span class="sxs-lookup"><span data-stu-id="b407a-193">Providers</span></span>
### <a name="gzipcompressionprovider"></a><span data-ttu-id="b407a-194">GzipCompressionProvider</span><span class="sxs-lookup"><span data-stu-id="b407a-194">GzipCompressionProvider</span></span>
<span data-ttu-id="b407a-195">Utilisez le `GzipCompressionProvider` pour compresser les réponses avec gzip.</span><span class="sxs-lookup"><span data-stu-id="b407a-195">Use the `GzipCompressionProvider` to compress responses with gzip.</span></span> <span data-ttu-id="b407a-196">Il s’agit du fournisseur de compression par défaut si aucune n’est spécifiée.</span><span class="sxs-lookup"><span data-stu-id="b407a-196">This is the default compression provider if none are specified.</span></span> <span data-ttu-id="b407a-197">Vous pouvez définir la compression au niveau de la `GzipCompressionProviderOptions`.</span><span class="sxs-lookup"><span data-stu-id="b407a-197">You can set the compression level with the `GzipCompressionProviderOptions`.</span></span> 

<span data-ttu-id="b407a-198">Le fournisseur de la compression gzip par défaut est le niveau de compression plus rapide (`CompressionLevel.Fastest`), ce qui ne peut pas produire la compression la plus efficace.</span><span class="sxs-lookup"><span data-stu-id="b407a-198">The gzip compression provider defaults to the fastest compression level (`CompressionLevel.Fastest`), which might not produce the most efficient compression.</span></span> <span data-ttu-id="b407a-199">Si la compression la plus efficace est souhaitée, vous pouvez configurer l’intergiciel (middleware) de compression optimale.</span><span class="sxs-lookup"><span data-stu-id="b407a-199">If the most efficient compression is desired, you can configure the middleware for optimal compression.</span></span>

| <span data-ttu-id="b407a-200">Niveau de compression</span><span class="sxs-lookup"><span data-stu-id="b407a-200">Compression Level</span></span>                | <span data-ttu-id="b407a-201">Description</span><span class="sxs-lookup"><span data-stu-id="b407a-201">Description</span></span>                                                                                                   |
| -------------------------------- | ------------------------------------------------------------------------------------------------------------- |
| `CompressionLevel.Fastest`       | <span data-ttu-id="b407a-202">La compression doit se terminer aussi rapidement que possible, même si le résultat n’est pas compressé de façon optimale.</span><span class="sxs-lookup"><span data-stu-id="b407a-202">Compression should complete as quickly as possible, even if the resulting output is not optimally compressed.</span></span> |
| `CompressionLevel.NoCompression` | <span data-ttu-id="b407a-203">Aucune compression ne doit être effectuée.</span><span class="sxs-lookup"><span data-stu-id="b407a-203">No compression should be performed.</span></span>                                                                           |
| `CompressionLevel.Optimal`       | <span data-ttu-id="b407a-204">Les réponses doivent être compressées optimale, même si la compression prend plus de temps pour terminer.</span><span class="sxs-lookup"><span data-stu-id="b407a-204">Responses should be optimally compressed, even if the compression takes more time to complete.</span></span>                |


# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="b407a-205">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="b407a-205">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=3,8-11)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="b407a-206">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="b407a-206">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=5,10-13)]

---

## <a name="mime-types"></a><span data-ttu-id="b407a-207">types MIME</span><span class="sxs-lookup"><span data-stu-id="b407a-207">MIME types</span></span>
<span data-ttu-id="b407a-208">L’intergiciel (middleware) spécifie un ensemble par défaut des types MIME pour la compression :</span><span class="sxs-lookup"><span data-stu-id="b407a-208">The middleware specifies a default set of MIME types for compression:</span></span>
* `text/plain`
* `text/css`
* `application/javascript`
* `text/html`
* `application/xml`
* `text/xml`
* `application/json`
* `text/json`

<span data-ttu-id="b407a-209">Vous pouvez remplacer ou ajouter des types MIME avec les options de l’intergiciel de compression de la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-209">You can replace or append MIME types with the Response Compression Middleware options.</span></span> <span data-ttu-id="b407a-210">Notez que les caractères génériques MIME types, tels que `text/*` ne sont pas pris en charge.</span><span class="sxs-lookup"><span data-stu-id="b407a-210">Note that wildcard MIME types, such as `text/*` aren't supported.</span></span> <span data-ttu-id="b407a-211">L’exemple d’application ajoute un type MIME pour `image/svg+xml` et compresse et sert les ASP.NET Core image de bannière (*banner.svg*).</span><span class="sxs-lookup"><span data-stu-id="b407a-211">The sample app adds a MIME type for `image/svg+xml` and compresses and serves the ASP.NET Core banner image (*banner.svg*).</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="b407a-212">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="b407a-212">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=5)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="b407a-213">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="b407a-213">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=7)]

---

### <a name="custom-providers"></a><span data-ttu-id="b407a-214">Fournisseurs personnalisés</span><span class="sxs-lookup"><span data-stu-id="b407a-214">Custom providers</span></span>
<span data-ttu-id="b407a-215">Vous pouvez créer des implémentations personnalisées de la compression avec `ICompressionProvider`.</span><span class="sxs-lookup"><span data-stu-id="b407a-215">You can create custom compression implementations with `ICompressionProvider`.</span></span> <span data-ttu-id="b407a-216">Le `EncodingName` représente le contenu que cet encodage `ICompressionProvider` produit.</span><span class="sxs-lookup"><span data-stu-id="b407a-216">The `EncodingName` represents the content encoding that this `ICompressionProvider` produces.</span></span> <span data-ttu-id="b407a-217">L’intergiciel (middleware) utilise ces informations pour choisir le fournisseur en fonction de la liste spécifiée dans le `Accept-Encoding` en-tête de la demande.</span><span class="sxs-lookup"><span data-stu-id="b407a-217">The middleware uses this information to choose the provider based on the list specified in the `Accept-Encoding` header of the request.</span></span>

<span data-ttu-id="b407a-218">À l’aide de l’exemple d’application, le client envoie une demande avec le `Accept-Encoding: mycustomcompression` en-tête.</span><span class="sxs-lookup"><span data-stu-id="b407a-218">Using the sample app, the client submits a request with the `Accept-Encoding: mycustomcompression` header.</span></span> <span data-ttu-id="b407a-219">L’intergiciel (middleware) utilise l’implémentation personnalisée de la compression et retourne la réponse avec un `Content-Encoding: mycustomcompression` en-tête.</span><span class="sxs-lookup"><span data-stu-id="b407a-219">The middleware uses the custom compression implementation and returns the response with a `Content-Encoding: mycustomcompression` header.</span></span> <span data-ttu-id="b407a-220">Le client doit être en mesure de décompresser l’encodage personnalisé dans l’ordre pour une implémentation personnalisée de la compression fonctionne.</span><span class="sxs-lookup"><span data-stu-id="b407a-220">The client must be able to decompress the custom encoding in order for a custom compression implementation to work.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="b407a-221">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="b407a-221">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](response-compression/samples/2.x/Program.cs?name=snippet1&highlight=4)]

[!code-csharp[Main](response-compression/samples/2.x/CustomCompressionProvider.cs?name=snippet1)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="b407a-222">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="b407a-222">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet2&highlight=6)]

[!code-csharp[Main](response-compression/samples/1.x/CustomCompressionProvider.cs?name=snippet1)]

---

<span data-ttu-id="b407a-223">Soumettre une demande pour l’exemple d’application avec le `Accept-Encoding: mycustomcompression` en-tête et observez les en-têtes de réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-223">Submit a request to the sample app with the `Accept-Encoding: mycustomcompression` header and observe the response headers.</span></span> <span data-ttu-id="b407a-224">Le `Vary` et `Content-Encoding` en-têtes sont présents sur la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-224">The `Vary` and `Content-Encoding` headers are present on the response.</span></span> <span data-ttu-id="b407a-225">Le corps de réponse (non affiché) n’est pas compressé par l’exemple.</span><span class="sxs-lookup"><span data-stu-id="b407a-225">The response body (not shown) isn't compressed by the sample.</span></span> <span data-ttu-id="b407a-226">Il n’est pas une implémentation de la compression dans le `CustomCompressionProvider` classe de l’exemple.</span><span class="sxs-lookup"><span data-stu-id="b407a-226">There isn't a compression implementation in the `CustomCompressionProvider` class of the sample.</span></span> <span data-ttu-id="b407a-227">Toutefois, l’exemple montre où vous pouvez implémenter un algorithme de compression de ce type.</span><span class="sxs-lookup"><span data-stu-id="b407a-227">However, the sample shows where you would implement such a compression algorithm.</span></span>

![Fenêtre Fiddler affichant le résultat d’une demande avec l’en-tête Accept-Encoding et la valeur mycustomcompression.](response-compression/_static/request-custom-compression.png)

## <a name="compression-with-secure-protocol"></a><span data-ttu-id="b407a-230">Compression avec un protocole sécurisé</span><span class="sxs-lookup"><span data-stu-id="b407a-230">Compression with secure protocol</span></span>
<span data-ttu-id="b407a-231">Les réponses compressées via des connexions sécurisées peuvent être contrôlées par le `EnableForHttps` option, qui est désactivée par défaut.</span><span class="sxs-lookup"><span data-stu-id="b407a-231">Compressed responses over secure connections can be controlled with the `EnableForHttps` option, which is disabled by default.</span></span> <span data-ttu-id="b407a-232">À l’aide de la compression des pages générées dynamiquement permettre entraîner des problèmes de sécurité telles que la [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) et [violation](https://wikipedia.org/wiki/BREACH_(security_exploit)) attaques.</span><span class="sxs-lookup"><span data-stu-id="b407a-232">Using compression with dynamically generated pages can lead to security problems such as the [CRIME](https://wikipedia.org/wiki/CRIME_(security_exploit)) and [BREACH](https://wikipedia.org/wiki/BREACH_(security_exploit)) attacks.</span></span>

## <a name="adding-the-vary-header"></a><span data-ttu-id="b407a-233">Ajout de l’en-tête Vary</span><span class="sxs-lookup"><span data-stu-id="b407a-233">Adding the Vary header</span></span>
<span data-ttu-id="b407a-234">Si la compression des réponses basée sur la `Accept-Encoding` en-tête, il existe potentiellement plusieurs versions compressées de la réponse et une version non compressée.</span><span class="sxs-lookup"><span data-stu-id="b407a-234">When compressing responses based on the `Accept-Encoding` header, there are potentially multiple compressed versions of the response and an uncompressed version.</span></span> <span data-ttu-id="b407a-235">Afin d’indiquer les caches de client et le proxy que plusieurs versions existent et doivent être stockées, les `Vary` en-tête est ajouté avec un `Accept-Encoding` valeur.</span><span class="sxs-lookup"><span data-stu-id="b407a-235">In order to instruct client and proxy caches that multiple versions exist and should be stored, the `Vary` header is added with an `Accept-Encoding` value.</span></span> <span data-ttu-id="b407a-236">Dans ASP.NET Core 1.x, ajout de la `Vary` en-tête dans la réponse s’effectue manuellement.</span><span class="sxs-lookup"><span data-stu-id="b407a-236">In ASP.NET Core 1.x, adding the `Vary` header to the response is accomplished manually.</span></span> <span data-ttu-id="b407a-237">Dans ASP.NET Core ajoute de l’intergiciel (middleware) 2.x, le `Vary` en-tête automatiquement lors de la réponse est compressée.</span><span class="sxs-lookup"><span data-stu-id="b407a-237">In ASP.NET Core 2.x, the middleware adds the `Vary` header automatically when the response is compressed.</span></span>

<span data-ttu-id="b407a-238">**ASP.NET Core 1.x uniquement**</span><span class="sxs-lookup"><span data-stu-id="b407a-238">**ASP.NET Core 1.x only**</span></span>

[!code-csharp[Main](response-compression/samples/1.x/Startup.cs?name=snippet1)]

## <a name="middleware-issue-when-behind-an-nginx-reverse-proxy"></a><span data-ttu-id="b407a-239">Problème d’intergiciel (middleware) lorsque derrière un proxy inverse Nginx</span><span class="sxs-lookup"><span data-stu-id="b407a-239">Middleware issue when behind an Nginx reverse proxy</span></span>
<span data-ttu-id="b407a-240">Lorsqu’une demande est transmise par Nginx, le `Accept-Encoding` en-tête est supprimé.</span><span class="sxs-lookup"><span data-stu-id="b407a-240">When a request is proxied by Nginx, the `Accept-Encoding` header is removed.</span></span> <span data-ttu-id="b407a-241">Cela empêche l’intergiciel (middleware) de la compression de la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-241">This prevents the middleware from compressing the response.</span></span> <span data-ttu-id="b407a-242">Pour plus d’informations, consultez [NGINX : la Compression et décompression](https://www.nginx.com/resources/admin-guide/compression-and-decompression/).</span><span class="sxs-lookup"><span data-stu-id="b407a-242">For more information, see [NGINX: Compression and Decompression](https://www.nginx.com/resources/admin-guide/compression-and-decompression/).</span></span> <span data-ttu-id="b407a-243">Ce problème est suivi par [Figure exclut la compression de pass-through pour nginx (BasicMiddleware #123)](https://github.com/aspnet/BasicMiddleware/issues/123).</span><span class="sxs-lookup"><span data-stu-id="b407a-243">This issue is tracked by [Figure out pass-through compression for nginx (BasicMiddleware #123)](https://github.com/aspnet/BasicMiddleware/issues/123).</span></span>

## <a name="working-with-iis-dynamic-compression"></a><span data-ttu-id="b407a-244">Utilisation de la compression dynamique IIS</span><span class="sxs-lookup"><span data-stu-id="b407a-244">Working with IIS dynamic compression</span></span>
<span data-ttu-id="b407a-245">Si vous avez un IIS dynamique Compression Module actif configuré au niveau du serveur que vous voulez désactiver pour une application, vous pouvez le faire avec un ajout à votre *web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="b407a-245">If you have an active IIS Dynamic Compression Module configured at the server level that you would like to disable for an app, you can do so with an addition to your *web.config* file.</span></span> <span data-ttu-id="b407a-246">Pour plus d’informations, consultez [modules IIS de la désactivation de](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="b407a-246">For more information, see [Disabling IIS modules](xref:host-and-deploy/iis/modules#disabling-iis-modules).</span></span>

## <a name="troubleshooting"></a><span data-ttu-id="b407a-247">Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="b407a-247">Troubleshooting</span></span>
<span data-ttu-id="b407a-248">Utiliser un outil tel que [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), ou [Postman](https://www.getpostman.com/), qui permettent de définir la `Accept-Encoding` en-tête de demande et d’étudier les en-têtes de réponse, la taille et le corps.</span><span class="sxs-lookup"><span data-stu-id="b407a-248">Use a tool like [Fiddler](http://www.telerik.com/fiddler), [Firebug](http://getfirebug.com/), or [Postman](https://www.getpostman.com/), which allow you to set the `Accept-Encoding` request header and study the response headers, size, and body.</span></span> <span data-ttu-id="b407a-249">L’intergiciel de compression de la réponse compresse les réponses qui remplissent les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="b407a-249">The Response Compression Middleware compresses responses that meet the following conditions:</span></span>
* <span data-ttu-id="b407a-250">Le `Accept-Encoding` en-tête est présent avec la valeur `gzip`, `*`, ou l’encodage personnalisé qui correspond à un fournisseur de compression personnalisé que vous avez établi.</span><span class="sxs-lookup"><span data-stu-id="b407a-250">The `Accept-Encoding` header is present with a value of `gzip`, `*`, or custom encoding that matches a custom compression provider that you've established.</span></span> <span data-ttu-id="b407a-251">La valeur ne doit pas être `identity` ou avoir une valeur de qualité (qvalue, `q`) définissant égale à 0 (zéro).</span><span class="sxs-lookup"><span data-stu-id="b407a-251">The value must not be `identity` or have a quality value (qvalue, `q`) setting of 0 (zero).</span></span>
* <span data-ttu-id="b407a-252">Le type MIME (`Content-Type`) doit être défini et doit correspondre à un type MIME configuré sur le `ResponseCompressionOptions`.</span><span class="sxs-lookup"><span data-stu-id="b407a-252">The MIME type (`Content-Type`) must be set and must match a MIME type configured on the `ResponseCompressionOptions`.</span></span>
* <span data-ttu-id="b407a-253">La demande ne doit pas inclure le `Content-Range` en-tête.</span><span class="sxs-lookup"><span data-stu-id="b407a-253">The request must not include the `Content-Range` header.</span></span>
* <span data-ttu-id="b407a-254">La demande doit utiliser un protocole non sécurisé (http), sauf si un protocole sécurisé (https) est configuré dans les options de l’intergiciel de compression de la réponse.</span><span class="sxs-lookup"><span data-stu-id="b407a-254">The request must use insecure protocol (http), unless secure protocol (https) is configured in the Response Compression Middleware options.</span></span> <span data-ttu-id="b407a-255">*Notez le danger [décrite ci-dessus](#compression-with-secure-protocol) lors de l’activation de la compression du contenu sécurisée.*</span><span class="sxs-lookup"><span data-stu-id="b407a-255">*Note the danger [described above](#compression-with-secure-protocol) when enabling secure content compression.*</span></span>

## <a name="additional-resources"></a><span data-ttu-id="b407a-256">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="b407a-256">Additional resources</span></span>
* [<span data-ttu-id="b407a-257">Démarrage d’une application</span><span class="sxs-lookup"><span data-stu-id="b407a-257">Application Startup</span></span>](xref:fundamentals/startup)
* [<span data-ttu-id="b407a-258">Intergiciel (middleware)</span><span class="sxs-lookup"><span data-stu-id="b407a-258">Middleware</span></span>](xref:fundamentals/middleware)
* [<span data-ttu-id="b407a-259">Mozilla MSDN : Accepter-Encoding</span><span class="sxs-lookup"><span data-stu-id="b407a-259">Mozilla Developer Network: Accept-Encoding</span></span>](https://developer.mozilla.org/docs/Web/HTTP/Headers/Accept-Encoding)
* [<span data-ttu-id="b407a-260">La Section 7231 relative aux RFC 3.1.2.1 : Codings de contenu</span><span class="sxs-lookup"><span data-stu-id="b407a-260">RFC 7231 Section 3.1.2.1: Content Codings</span></span>](https://tools.ietf.org/html/rfc7231#section-3.1.2.1)
* [<span data-ttu-id="b407a-261">La Section 7230 RFC 4.2.3 : Codage Gzip</span><span class="sxs-lookup"><span data-stu-id="b407a-261">RFC 7230 Section 4.2.3: Gzip Coding</span></span>](https://tools.ietf.org/html/rfc7230#section-4.2.3)
* [<span data-ttu-id="b407a-262">Version de spécification du format fichier GZIP 4.3</span><span class="sxs-lookup"><span data-stu-id="b407a-262">GZIP file format specification version 4.3</span></span>](http://www.ietf.org/rfc/rfc1952.txt)
