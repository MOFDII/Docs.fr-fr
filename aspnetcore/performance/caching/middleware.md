---
title: Réponse mise en cache d’intergiciel (middleware) dans ASP.NET Core
author: guardrex
description: Découvrez comment configurer et utiliser un intergiciel (middleware) de réponse mise en cache dans ASP.NET Core.
manager: wpickett
monikerRange: '>= aspnetcore-1.1'
ms.author: riande
ms.custom: mvc
ms.date: 01/26/2017
ms.prod: asp.net-core
ms.topic: article
uid: performance/caching/middleware
ms.openlocfilehash: 7ceccffa39baf5f13d63c26e78c64a595bb42f60
ms.sourcegitcommit: 726ffab258070b4fe6cf950bf030ce10c0c07bb4
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 06/04/2018
ms.locfileid: "34734495"
---
# <a name="response-caching-middleware-in-aspnet-core"></a><span data-ttu-id="6c306-103">Réponse mise en cache d’intergiciel (middleware) dans ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="6c306-103">Response Caching Middleware in ASP.NET Core</span></span>

<span data-ttu-id="6c306-104">Par [Luke Latham](https://github.com/guardrex) et [John Luo](https://github.com/JunTaoLuo)</span><span class="sxs-lookup"><span data-stu-id="6c306-104">By [Luke Latham](https://github.com/guardrex) and [John Luo](https://github.com/JunTaoLuo)</span></span>

<span data-ttu-id="6c306-105">[Afficher ou télécharger l’exemple de code ASP.NET Core 2.1](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/caching/middleware/samples) ([comment télécharger](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="6c306-105">[View or download ASP.NET Core 2.1 sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/performance/caching/middleware/samples) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

<span data-ttu-id="6c306-106">Cet article explique comment configurer un intergiciel (middleware) de réponse mise en cache dans une application ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="6c306-106">This article explains how to configure Response Caching Middleware in an ASP.NET Core app.</span></span> <span data-ttu-id="6c306-107">L’intergiciel (middleware) détermine quand les réponses sont mis en cache, les réponses de magasins et sert des réponses à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-107">The middleware determines when responses are cacheable, stores responses, and serves responses from cache.</span></span> <span data-ttu-id="6c306-108">Pour obtenir une présentation de la mise en cache HTTP et le `ResponseCache` d’attribut, consultez [réponse mise en cache](xref:performance/caching/response).</span><span class="sxs-lookup"><span data-stu-id="6c306-108">For an introduction to HTTP caching and the `ResponseCache` attribute, see [Response Caching](xref:performance/caching/response).</span></span>

## <a name="package"></a><span data-ttu-id="6c306-109">Package</span><span class="sxs-lookup"><span data-stu-id="6c306-109">Package</span></span>

<span data-ttu-id="6c306-110">Pour inclure l’intergiciel (middleware) dans votre projet, ajoutez une référence à la [Microsoft.AspNetCore.ResponseCompression](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) du package ou utilisez le [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app), qui est disponible pour une utilisation dans ASP.NET Core 2.1 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="6c306-110">To include the middleware in your project, add a reference to the [Microsoft.AspNetCore.ResponseCompression](https://www.nuget.org/packages/Microsoft.AspNetCore.ResponseCompression/) package or use the [Microsoft.AspNetCore.App metapackage](xref:fundamentals/metapackage-app), which is available for use in ASP.NET Core 2.1 or later.</span></span>

## <a name="configuration"></a><span data-ttu-id="6c306-111">Configuration</span><span class="sxs-lookup"><span data-stu-id="6c306-111">Configuration</span></span>

<span data-ttu-id="6c306-112">Dans `ConfigureServices`, ajoutez l’intergiciel (middleware) à la collection de service.</span><span class="sxs-lookup"><span data-stu-id="6c306-112">In `ConfigureServices`, add the middleware to the service collection.</span></span>

[!code-csharp[](middleware/samples/2.x/ResponseCachingMiddleware/Startup.cs?name=snippet1&highlight=9)]

<span data-ttu-id="6c306-113">Configurer l’application pour utiliser l’intergiciel (middleware) avec la `UseResponseCaching` méthode d’extension, qui ajoute l’intergiciel (middleware) au pipeline de traitement de la demande.</span><span class="sxs-lookup"><span data-stu-id="6c306-113">Configure the app to use the middleware with the `UseResponseCaching` extension method, which adds the middleware to the request processing pipeline.</span></span> <span data-ttu-id="6c306-114">L’exemple d’application ajoute un [ `Cache-Control` ](https://tools.ietf.org/html/rfc7234#section-5.2) en-tête dans la réponse qui met en cache les réponses de mise en cache pendant 10 secondes.</span><span class="sxs-lookup"><span data-stu-id="6c306-114">The sample app adds a [`Cache-Control`](https://tools.ietf.org/html/rfc7234#section-5.2) header to the response that caches cacheable responses for up to 10 seconds.</span></span> <span data-ttu-id="6c306-115">L’exemple envoie une [ `Vary` ](https://tools.ietf.org/html/rfc7231#section-7.1.4) en-tête pour configurer l’intergiciel (middleware) pour servir une réponse mise en cache d’uniquement si le [ `Accept-Encoding` ](https://tools.ietf.org/html/rfc7231#section-5.3.4) en-tête des demandes ultérieures correspond à celle de la demande d’origine.</span><span class="sxs-lookup"><span data-stu-id="6c306-115">The sample sends a [`Vary`](https://tools.ietf.org/html/rfc7231#section-7.1.4) header to configure the middleware to serve a cached response only if the [`Accept-Encoding`](https://tools.ietf.org/html/rfc7231#section-5.3.4) header of subsequent requests matches that of the original request.</span></span> <span data-ttu-id="6c306-116">Dans l’exemple de code qui suit, [CacheControlHeaderValue](/dotnet/api/microsoft.net.http.headers.cachecontrolheadervalue) et [HeaderNames](/dotnet/api/microsoft.net.http.headers.headernames) nécessitent un `using` instruction pour le [Microsoft.Net.Http.Headers](/dotnet/api/microsoft.net.http.headers) espace de noms.</span><span class="sxs-lookup"><span data-stu-id="6c306-116">In the code example that follows, [CacheControlHeaderValue](/dotnet/api/microsoft.net.http.headers.cachecontrolheadervalue) and [HeaderNames](/dotnet/api/microsoft.net.http.headers.headernames) require a `using` statement for the [Microsoft.Net.Http.Headers](/dotnet/api/microsoft.net.http.headers) namespace.</span></span>

[!code-csharp[](middleware/samples/2.x/ResponseCachingMiddleware/Startup.cs?name=snippet2&highlight=17,21-28)]

<span data-ttu-id="6c306-117">Intergiciel (middleware) de réponse mise en cache met uniquement en cache les réponses du serveur qui génèrent un code d’état 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="6c306-117">Response Caching Middleware only caches server responses that result in a 200 (OK) status code.</span></span> <span data-ttu-id="6c306-118">Autres réponses, y compris [les pages d’erreur](xref:fundamentals/error-handling), sont ignorées par l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="6c306-118">Any other responses, including [error pages](xref:fundamentals/error-handling), are ignored by the middleware.</span></span>

> [!WARNING]
> <span data-ttu-id="6c306-119">Qui contient le contenu pour les clients authentifiés de réponses doivent être marquées comme ne pouvant pas être afin d’éviter l’intergiciel (middleware) de stockage et traitement des ces réponses.</span><span class="sxs-lookup"><span data-stu-id="6c306-119">Responses containing content for authenticated clients must be marked as not cacheable to prevent the middleware from storing and serving those responses.</span></span> <span data-ttu-id="6c306-120">Consultez [Conditions pour la mise en cache](#conditions-for-caching) pour plus d’informations sur la façon dont l’intergiciel (middleware) détermine si une réponse est mis en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-120">See [Conditions for caching](#conditions-for-caching) for details on how the middleware determines if a response is cacheable.</span></span>

## <a name="options"></a><span data-ttu-id="6c306-121">Options</span><span class="sxs-lookup"><span data-stu-id="6c306-121">Options</span></span>

<span data-ttu-id="6c306-122">L’intergiciel (middleware) offre trois options pour contrôler la réponse mise en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-122">The middleware offers three options for controlling response caching.</span></span>

| <span data-ttu-id="6c306-123">Option</span><span class="sxs-lookup"><span data-stu-id="6c306-123">Option</span></span>                | <span data-ttu-id="6c306-124">Description</span><span class="sxs-lookup"><span data-stu-id="6c306-124">Description</span></span> |
| --------------------- | ----------- |
| <span data-ttu-id="6c306-125">UseCaseSensitivePaths</span><span class="sxs-lookup"><span data-stu-id="6c306-125">UseCaseSensitivePaths</span></span> | <span data-ttu-id="6c306-126">Détermine si les réponses sont mises en cache sur les chemins d’accès qui respecte la casse.</span><span class="sxs-lookup"><span data-stu-id="6c306-126">Determines if responses are cached on case-sensitive paths.</span></span> <span data-ttu-id="6c306-127">La valeur par défaut est `false`.</span><span class="sxs-lookup"><span data-stu-id="6c306-127">The default value is `false`.</span></span> |
| <span data-ttu-id="6c306-128">MaximumBodySize</span><span class="sxs-lookup"><span data-stu-id="6c306-128">MaximumBodySize</span></span>       | <span data-ttu-id="6c306-129">La mise en cache plus grande taille pour le corps de réponse en octets.</span><span class="sxs-lookup"><span data-stu-id="6c306-129">The largest cacheable size for the response body in bytes.</span></span> <span data-ttu-id="6c306-130">La valeur par défaut est `64 * 1024 * 1024` (64 Mo).</span><span class="sxs-lookup"><span data-stu-id="6c306-130">The default value is `64 * 1024 * 1024` (64 MB).</span></span> |
| <span data-ttu-id="6c306-131">SizeLimit</span><span class="sxs-lookup"><span data-stu-id="6c306-131">SizeLimit</span></span>             | <span data-ttu-id="6c306-132">La limite de taille pour l’intergiciel (middleware) du cache de la réponse en octets.</span><span class="sxs-lookup"><span data-stu-id="6c306-132">The size limit for the response cache middleware in bytes.</span></span> <span data-ttu-id="6c306-133">La valeur par défaut est `100 * 1024 * 1024` (100 Mo).</span><span class="sxs-lookup"><span data-stu-id="6c306-133">The default value is `100 * 1024 * 1024` (100 MB).</span></span> |

<span data-ttu-id="6c306-134">L’exemple suivant configure l’intergiciel (middleware) pour :</span><span class="sxs-lookup"><span data-stu-id="6c306-134">The following example configures the middleware to:</span></span>

* <span data-ttu-id="6c306-135">Mettre en cache les réponses inférieures ou égales à 1 024 octets.</span><span class="sxs-lookup"><span data-stu-id="6c306-135">Cache responses smaller than or equal to 1,024 bytes.</span></span>
* <span data-ttu-id="6c306-136">Stocker les réponses par des chemins d’accès qui respecte la casse (par exemple, `/page1` et `/Page1` sont stockés séparément).</span><span class="sxs-lookup"><span data-stu-id="6c306-136">Store the responses by case-sensitive paths (for example, `/page1` and `/Page1` are stored separately).</span></span>

```csharp
services.AddResponseCaching(options =>
{
    options.UseCaseSensitivePaths = true;
    options.MaximumBodySize = 1024;
});
```

## <a name="varybyquerykeys"></a><span data-ttu-id="6c306-137">VaryByQueryKeys</span><span class="sxs-lookup"><span data-stu-id="6c306-137">VaryByQueryKeys</span></span>

<span data-ttu-id="6c306-138">Lorsque vous utilisez les contrôleurs MVC/Web API ou des modèles de page de Pages Razor, le `ResponseCache` attribut spécifie les paramètres nécessaires pour définir les en-têtes appropriés pour la réponse mise en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-138">When using MVC/Web API controllers or Razor Pages page models, the `ResponseCache` attribute specifies the parameters necessary for setting the appropriate headers for response caching.</span></span> <span data-ttu-id="6c306-139">Le seul paramètre de la `ResponseCache` attribut nécessitant strictement l’intergiciel (middleware) est `VaryByQueryKeys`, qui ne correspond pas à un en-tête HTTP réels.</span><span class="sxs-lookup"><span data-stu-id="6c306-139">The only parameter of the `ResponseCache` attribute that strictly requires the middleware is `VaryByQueryKeys`, which doesn't correspond to an actual HTTP header.</span></span> <span data-ttu-id="6c306-140">Pour plus d’informations, consultez [ResponseCache attribut](xref:performance/caching/response#responsecache-attribute).</span><span class="sxs-lookup"><span data-stu-id="6c306-140">For more information, see [ResponseCache Attribute](xref:performance/caching/response#responsecache-attribute).</span></span>

<span data-ttu-id="6c306-141">Lorsque vous N'utilisez pas le `ResponseCache` attribut, la mise en cache de réponse peut varier avec le `VaryByQueryKeys` fonctionnalité.</span><span class="sxs-lookup"><span data-stu-id="6c306-141">When not using the `ResponseCache` attribute, response caching can be varied with the `VaryByQueryKeys` feature.</span></span> <span data-ttu-id="6c306-142">Utilisez le `ResponseCachingFeature` directement à partir de la `IFeatureCollection` de la `HttpContext`:</span><span class="sxs-lookup"><span data-stu-id="6c306-142">Use the `ResponseCachingFeature` directly from the `IFeatureCollection` of the `HttpContext`:</span></span>

```csharp
var responseCachingFeature = context.HttpContext.Features.Get<IResponseCachingFeature>();
if (responseCachingFeature != null)
{
    responseCachingFeature.VaryByQueryKeys = new[] { "MyKey" };
}
```

<span data-ttu-id="6c306-143">À l’aide d’une seule valeur égale à `*` dans `VaryByQueryKeys` varie en fonction du cache par tous les paramètres de requête de demande.</span><span class="sxs-lookup"><span data-stu-id="6c306-143">Using a single value equal to `*` in `VaryByQueryKeys` varies the cache by all request query parameters.</span></span>

## <a name="http-headers-used-by-response-caching-middleware"></a><span data-ttu-id="6c306-144">En-têtes HTTP utilisés par un intergiciel (middleware) de réponse mise en cache</span><span class="sxs-lookup"><span data-stu-id="6c306-144">HTTP headers used by Response Caching Middleware</span></span>

<span data-ttu-id="6c306-145">Réponse mise en cache par l’intergiciel (middleware) est configuré à l’aide d’en-têtes HTTP.</span><span class="sxs-lookup"><span data-stu-id="6c306-145">Response caching by the middleware is configured using HTTP headers.</span></span>

| <span data-ttu-id="6c306-146">Header</span><span class="sxs-lookup"><span data-stu-id="6c306-146">Header</span></span> | <span data-ttu-id="6c306-147">Détails</span><span class="sxs-lookup"><span data-stu-id="6c306-147">Details</span></span> |
| ------ | ------- |
| <span data-ttu-id="6c306-148">Autorisation</span><span class="sxs-lookup"><span data-stu-id="6c306-148">Authorization</span></span> | <span data-ttu-id="6c306-149">La réponse n’est pas mis en cache si l’en-tête existe.</span><span class="sxs-lookup"><span data-stu-id="6c306-149">The response isn't cached if the header exists.</span></span> |
| <span data-ttu-id="6c306-150">Cache-Control</span><span class="sxs-lookup"><span data-stu-id="6c306-150">Cache-Control</span></span> | <span data-ttu-id="6c306-151">L’intergiciel (middleware) considère uniquement la mise en cache des réponses marqués avec la `public` directive de cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-151">The middleware only considers caching responses marked with the `public` cache directive.</span></span> <span data-ttu-id="6c306-152">Contrôler la mise en cache avec les paramètres suivants :</span><span class="sxs-lookup"><span data-stu-id="6c306-152">Control caching with the following parameters:</span></span><ul><li><span data-ttu-id="6c306-153">max-age</span><span class="sxs-lookup"><span data-stu-id="6c306-153">max-age</span></span></li><li><span data-ttu-id="6c306-154">max périmée&#8224;</span><span class="sxs-lookup"><span data-stu-id="6c306-154">max-stale&#8224;</span></span></li><li><span data-ttu-id="6c306-155">frais de min</span><span class="sxs-lookup"><span data-stu-id="6c306-155">min-fresh</span></span></li><li><span data-ttu-id="6c306-156">doit-revalidate.</span><span class="sxs-lookup"><span data-stu-id="6c306-156">must-revalidate</span></span></li><li><span data-ttu-id="6c306-157">Aucun cache</span><span class="sxs-lookup"><span data-stu-id="6c306-157">no-cache</span></span></li><li><span data-ttu-id="6c306-158">Aucun magasin</span><span class="sxs-lookup"><span data-stu-id="6c306-158">no-store</span></span></li><li><span data-ttu-id="6c306-159">seul if-mise en cache</span><span class="sxs-lookup"><span data-stu-id="6c306-159">only-if-cached</span></span></li><li><span data-ttu-id="6c306-160">private</span><span class="sxs-lookup"><span data-stu-id="6c306-160">private</span></span></li><li><span data-ttu-id="6c306-161">public</span><span class="sxs-lookup"><span data-stu-id="6c306-161">public</span></span></li><li><span data-ttu-id="6c306-162">s-maxage</span><span class="sxs-lookup"><span data-stu-id="6c306-162">s-maxage</span></span></li><li><span data-ttu-id="6c306-163">proxy-revalidate.&#8225;</span><span class="sxs-lookup"><span data-stu-id="6c306-163">proxy-revalidate&#8225;</span></span></li></ul><span data-ttu-id="6c306-164">&#8224;Si aucune limite n’est spécifiée pour `max-stale`, l’intergiciel (middleware) n’effectue aucune action.</span><span class="sxs-lookup"><span data-stu-id="6c306-164">&#8224;If no limit is specified to `max-stale`, the middleware takes no action.</span></span><br><span data-ttu-id="6c306-165">&#8225;`proxy-revalidate`a le même effet que `must-revalidate`.</span><span class="sxs-lookup"><span data-stu-id="6c306-165">&#8225;`proxy-revalidate` has the same effect as `must-revalidate`.</span></span><br><br><span data-ttu-id="6c306-166">Pour plus d’informations, consultez [7231 relative aux RFC : demander des Directives de Cache-Control](https://tools.ietf.org/html/rfc7234#section-5.2.1).</span><span class="sxs-lookup"><span data-stu-id="6c306-166">For more information, see [RFC 7231: Request Cache-Control Directives](https://tools.ietf.org/html/rfc7234#section-5.2.1).</span></span> |
| <span data-ttu-id="6c306-167">Pragma</span><span class="sxs-lookup"><span data-stu-id="6c306-167">Pragma</span></span> | <span data-ttu-id="6c306-168">A `Pragma: no-cache` en-tête dans la requête produit le même effet que `Cache-Control: no-cache`.</span><span class="sxs-lookup"><span data-stu-id="6c306-168">A `Pragma: no-cache` header in the request produces the same effect as `Cache-Control: no-cache`.</span></span> <span data-ttu-id="6c306-169">Cet en-tête est remplacé par les directives pertinentes dans le `Cache-Control` en-tête, le cas échéant.</span><span class="sxs-lookup"><span data-stu-id="6c306-169">This header is overridden by the relevant directives in the `Cache-Control` header, if present.</span></span> <span data-ttu-id="6c306-170">Pris en compte pour la compatibilité descendante avec HTTP/1.0.</span><span class="sxs-lookup"><span data-stu-id="6c306-170">Considered for backward compatibility with HTTP/1.0.</span></span> |
| <span data-ttu-id="6c306-171">Set-Cookie</span><span class="sxs-lookup"><span data-stu-id="6c306-171">Set-Cookie</span></span> | <span data-ttu-id="6c306-172">La réponse n’est pas mis en cache si l’en-tête existe.</span><span class="sxs-lookup"><span data-stu-id="6c306-172">The response isn't cached if the header exists.</span></span> <span data-ttu-id="6c306-173">Un intergiciel (middleware) dans le pipeline de traitement de la requête qui définit un ou plusieurs cookies empêche l’intergiciel (middleware) réponse mise en cache de la mise en cache la réponse (par exemple, le [fournisseur de TempData basé sur cookie](xref:fundamentals/app-state#tempdata)).</span><span class="sxs-lookup"><span data-stu-id="6c306-173">Any middleware in the request processing pipeline that sets one or more cookies prevents the Response Caching Middleware from caching the response (for example, the [cookie-based TempData provider](xref:fundamentals/app-state#tempdata)).</span></span>  |
| <span data-ttu-id="6c306-174">Vary</span><span class="sxs-lookup"><span data-stu-id="6c306-174">Vary</span></span> | <span data-ttu-id="6c306-175">Le `Vary` en-tête est utilisé pour faire varier la réponse mise en cache par un autre en-tête.</span><span class="sxs-lookup"><span data-stu-id="6c306-175">The `Vary` header is used to vary the cached response by another header.</span></span> <span data-ttu-id="6c306-176">Par exemple, mettre en cache les réponses par l’encodage en incluant le `Vary: Accept-Encoding` en-tête, qui met en cache les réponses pour les demandes avec des en-têtes `Accept-Encoding: gzip` et `Accept-Encoding: text/plain` séparément.</span><span class="sxs-lookup"><span data-stu-id="6c306-176">For example, cache responses by encoding by including the `Vary: Accept-Encoding` header, which caches responses for requests with headers `Accept-Encoding: gzip` and `Accept-Encoding: text/plain` separately.</span></span> <span data-ttu-id="6c306-177">Une réponse avec une valeur d’en-tête de `*` n’est jamais stocké.</span><span class="sxs-lookup"><span data-stu-id="6c306-177">A response with a header value of `*` is never stored.</span></span> |
| <span data-ttu-id="6c306-178">Arrive à expiration</span><span class="sxs-lookup"><span data-stu-id="6c306-178">Expires</span></span> | <span data-ttu-id="6c306-179">Une réponse jugée obsolète par cet en-tête n’est pas enregistrer ou à récupérer, sauf si remplacées par d’autres `Cache-Control` en-têtes.</span><span class="sxs-lookup"><span data-stu-id="6c306-179">A response deemed stale by this header isn't stored or retrieved unless overridden by other `Cache-Control` headers.</span></span> |
| <span data-ttu-id="6c306-180">If-None-Match</span><span class="sxs-lookup"><span data-stu-id="6c306-180">If-None-Match</span></span> | <span data-ttu-id="6c306-181">La réponse complète est pris en charge à partir du cache si la valeur n’est pas `*` et `ETag` de la réponse ne correspond à aucune des valeurs fournies.</span><span class="sxs-lookup"><span data-stu-id="6c306-181">The full response is served from cache if the value isn't `*` and the `ETag` of the response doesn't match any of the values provided.</span></span> <span data-ttu-id="6c306-182">Sinon, une réponse 304 (non modifié) est pris en charge.</span><span class="sxs-lookup"><span data-stu-id="6c306-182">Otherwise, a 304 (Not Modified) response is served.</span></span> |
| <span data-ttu-id="6c306-183">If-Modified-Since</span><span class="sxs-lookup"><span data-stu-id="6c306-183">If-Modified-Since</span></span> | <span data-ttu-id="6c306-184">Si le `If-None-Match` en-tête n’est pas présent, une réponse complet est pris en charge à partir du cache si la date de la réponse mise en cache est plus récente que la valeur fournie.</span><span class="sxs-lookup"><span data-stu-id="6c306-184">If the `If-None-Match` header isn't present, a full response is served from cache if the cached response date is newer than the value provided.</span></span> <span data-ttu-id="6c306-185">Sinon, une réponse 304 (non modifié) est pris en charge.</span><span class="sxs-lookup"><span data-stu-id="6c306-185">Otherwise, a 304 (Not Modified) response is served.</span></span> |
| <span data-ttu-id="6c306-186">Date</span><span class="sxs-lookup"><span data-stu-id="6c306-186">Date</span></span> | <span data-ttu-id="6c306-187">Lorsque le traitement à partir du cache, le `Date` en-tête est défini par l’intergiciel (middleware) s’il n’a pas été fourni sur la réponse d’origine.</span><span class="sxs-lookup"><span data-stu-id="6c306-187">When serving from cache, the `Date` header is set by the middleware if it wasn't provided on the original response.</span></span> |
| <span data-ttu-id="6c306-188">Content-Length</span><span class="sxs-lookup"><span data-stu-id="6c306-188">Content-Length</span></span> | <span data-ttu-id="6c306-189">Lorsque le traitement à partir du cache, le `Content-Length` en-tête est défini par l’intergiciel (middleware) s’il n’a pas été fourni sur la réponse d’origine.</span><span class="sxs-lookup"><span data-stu-id="6c306-189">When serving from cache, the `Content-Length` header is set by the middleware if it wasn't provided on the original response.</span></span> |
| <span data-ttu-id="6c306-190">Durée de vie</span><span class="sxs-lookup"><span data-stu-id="6c306-190">Age</span></span> | <span data-ttu-id="6c306-191">Le `Age` en-tête envoyé dans la réponse d’origine est ignoré.</span><span class="sxs-lookup"><span data-stu-id="6c306-191">The `Age` header sent in the original response is ignored.</span></span> <span data-ttu-id="6c306-192">L’intergiciel (middleware) calcule une nouvelle valeur avec une réponse mise en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-192">The middleware computes a new value when serving a cached response.</span></span> |

## <a name="caching-respects-request-cache-control-directives"></a><span data-ttu-id="6c306-193">La mise en cache respecte les directives de contrôle du Cache de demande</span><span class="sxs-lookup"><span data-stu-id="6c306-193">Caching respects request Cache-Control directives</span></span>

<span data-ttu-id="6c306-194">L’intergiciel (middleware) respecte les règles de la [spécification de la mise en cache à HTTP 1.1](https://tools.ietf.org/html/rfc7234#section-5.2).</span><span class="sxs-lookup"><span data-stu-id="6c306-194">The middleware respects the rules of the [HTTP 1.1 Caching specification](https://tools.ietf.org/html/rfc7234#section-5.2).</span></span> <span data-ttu-id="6c306-195">Les règles nécessitent un cache d’honorer valide `Cache-Control` en-tête envoyé par le client.</span><span class="sxs-lookup"><span data-stu-id="6c306-195">The rules require a cache to honor a valid `Cache-Control` header sent by the client.</span></span> <span data-ttu-id="6c306-196">Dans la spécification d’un client peut envoyer des demandes avec un `no-cache` valeur d’en-tête et de forcer le serveur génère une nouvelle réponse pour chaque demande.</span><span class="sxs-lookup"><span data-stu-id="6c306-196">Under the specification, a client can make requests with a `no-cache` header value and force the server to generate a new response for every request.</span></span> <span data-ttu-id="6c306-197">Actuellement, il n’existe aucun contrôle du développeur sur ce comportement de mise en cache lors de l’utilisation de l’intergiciel (middleware), car l’intergiciel (middleware) est conforme à la spécification officielle de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-197">Currently, there's no developer control over this caching behavior when using the middleware because the middleware adheres to the official caching specification.</span></span>

<span data-ttu-id="6c306-198">Pour contrôler le comportement de mise en cache plus, Explorer d’autres fonctionnalités de mise en cache de ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="6c306-198">For more control over caching behavior, explore other caching features of ASP.NET Core.</span></span> <span data-ttu-id="6c306-199">Consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="6c306-199">See the following topics:</span></span>

* [<span data-ttu-id="6c306-200">Mettre en cache en mémoire</span><span class="sxs-lookup"><span data-stu-id="6c306-200">Cache in-memory</span></span>](xref:performance/caching/memory)
* [<span data-ttu-id="6c306-201">Utiliser un cache distribué</span><span class="sxs-lookup"><span data-stu-id="6c306-201">Work with a distributed cache</span></span>](xref:performance/caching/distributed)
* [<span data-ttu-id="6c306-202">Mettre en cache d’assistance de balise dans le cœur d’ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="6c306-202">Cache Tag Helper in ASP.NET Core MVC</span></span>](xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper)
* [<span data-ttu-id="6c306-203">Tag Helper de cache distribué</span><span class="sxs-lookup"><span data-stu-id="6c306-203">Distributed Cache Tag Helper</span></span>](xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper)

## <a name="troubleshooting"></a><span data-ttu-id="6c306-204">Résolution des problèmes</span><span class="sxs-lookup"><span data-stu-id="6c306-204">Troubleshooting</span></span>

<span data-ttu-id="6c306-205">Si le comportement de mise en cache n’est pas comme prévu, vérifiez que les réponses sont mis en cache et capable de servies à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-205">If caching behavior isn't as expected, confirm that responses are cacheable and capable of being served from the cache.</span></span> <span data-ttu-id="6c306-206">Examinez les en-têtes entrants de la demande et la réponse sortante.</span><span class="sxs-lookup"><span data-stu-id="6c306-206">Examine the request's incoming headers and the response's outgoing headers.</span></span> <span data-ttu-id="6c306-207">Activer [journalisation](xref:fundamentals/logging/index) pour aider au débogage.</span><span class="sxs-lookup"><span data-stu-id="6c306-207">Enable [logging](xref:fundamentals/logging/index) to help with debugging.</span></span>

<span data-ttu-id="6c306-208">Lorsque les tests et le dépannage du comportement de mise en cache, un navigateur peut définir les en-têtes de demande qui affectent la mise en cache comme indésirables.</span><span class="sxs-lookup"><span data-stu-id="6c306-208">When testing and troubleshooting caching behavior, a browser may set request headers that affect caching in undesirable ways.</span></span> <span data-ttu-id="6c306-209">Par exemple, un navigateur peut-être définir le `Cache-Control` en-tête `no-cache` ou `max-age=0` lors de l’actualisation d’une page.</span><span class="sxs-lookup"><span data-stu-id="6c306-209">For example, a browser may set the `Cache-Control` header to `no-cache` or `max-age=0` when refreshing a page.</span></span> <span data-ttu-id="6c306-210">Les outils suivants peuvent définir explicitement les en-têtes de demande et sont recommandés pour le test de la mise en cache :</span><span class="sxs-lookup"><span data-stu-id="6c306-210">The following tools can explicitly set request headers and are preferred for testing caching:</span></span>

* [<span data-ttu-id="6c306-211">Fiddler</span><span class="sxs-lookup"><span data-stu-id="6c306-211">Fiddler</span></span>](https://www.telerik.com/fiddler)
* [<span data-ttu-id="6c306-212">Postman</span><span class="sxs-lookup"><span data-stu-id="6c306-212">Postman</span></span>](https://www.getpostman.com/)

### <a name="conditions-for-caching"></a><span data-ttu-id="6c306-213">Conditions pour la mise en cache</span><span class="sxs-lookup"><span data-stu-id="6c306-213">Conditions for caching</span></span>

* <span data-ttu-id="6c306-214">La demande doit entraîner une réponse du serveur avec un code d’état 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="6c306-214">The request must result in a server response with a 200 (OK) status code.</span></span>
* <span data-ttu-id="6c306-215">La méthode de demande doit être GET ou HEAD.</span><span class="sxs-lookup"><span data-stu-id="6c306-215">The request method must be GET or HEAD.</span></span>
* <span data-ttu-id="6c306-216">Intergiciel Terminal, tel que [intergiciel (middleware) du fichier statique](xref:fundamentals/static-files), ne doit pas traiter la réponse avant de l’intergiciel (middleware) réponse mise en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-216">Terminal middleware, such as [Static File Middleware](xref:fundamentals/static-files), must not process the response prior to the Response Caching Middleware.</span></span>
* <span data-ttu-id="6c306-217">Le `Authorization` en-tête ne doit pas être présent.</span><span class="sxs-lookup"><span data-stu-id="6c306-217">The `Authorization` header must not be present.</span></span>
* <span data-ttu-id="6c306-218">`Cache-Control` paramètres de l’en-tête doivent être valides, et la réponse doit être marquée `public` et pas marquée `private`.</span><span class="sxs-lookup"><span data-stu-id="6c306-218">`Cache-Control` header parameters must be valid, and the response must be marked `public` and not marked `private`.</span></span>
* <span data-ttu-id="6c306-219">Le `Pragma: no-cache` en-tête ne doit pas être présent si la `Cache-Control` en-tête n’est pas présent, comme le `Cache-Control` en-tête remplace le `Pragma` en-tête lorsqu’il est présent.</span><span class="sxs-lookup"><span data-stu-id="6c306-219">The `Pragma: no-cache` header must not be present if the `Cache-Control` header isn't present, as the `Cache-Control` header overrides the `Pragma` header when present.</span></span>
* <span data-ttu-id="6c306-220">Le `Set-Cookie` en-tête ne doit pas être présent.</span><span class="sxs-lookup"><span data-stu-id="6c306-220">The `Set-Cookie` header must not be present.</span></span>
* <span data-ttu-id="6c306-221">`Vary` paramètres de l’en-tête doivent être valide et non égal à `*`.</span><span class="sxs-lookup"><span data-stu-id="6c306-221">`Vary` header parameters must be valid and not equal to `*`.</span></span>
* <span data-ttu-id="6c306-222">Le `Content-Length` valeur d’en-tête (si défini) doit correspondre à la taille du corps de réponse.</span><span class="sxs-lookup"><span data-stu-id="6c306-222">The `Content-Length` header value (if set) must match the size of the response body.</span></span>
* <span data-ttu-id="6c306-223">Le [IHttpSendFileFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpsendfilefeature) n’est pas utilisé.</span><span class="sxs-lookup"><span data-stu-id="6c306-223">The [IHttpSendFileFeature](/dotnet/api/microsoft.aspnetcore.http.features.ihttpsendfilefeature) isn't used.</span></span>
* <span data-ttu-id="6c306-224">La réponse ne doit pas être périmée tel que spécifié par le `Expires` en-tête et le `max-age` et `s-maxage` directives de cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-224">The response must not be stale as specified by the `Expires` header and the `max-age` and `s-maxage` cache directives.</span></span>
* <span data-ttu-id="6c306-225">Mise en mémoire tampon de réponse doit être réussie et la taille de la réponse doit être inférieure à la configuration ou par défaut `SizeLimit`.</span><span class="sxs-lookup"><span data-stu-id="6c306-225">Response buffering must be successful, and the size of the response must be smaller than the configured or default `SizeLimit`.</span></span>
* <span data-ttu-id="6c306-226">La réponse doit être mise en cache en fonction de la [RFC 7234](https://tools.ietf.org/html/rfc7234) spécifications.</span><span class="sxs-lookup"><span data-stu-id="6c306-226">The response must be cacheable according to the [RFC 7234](https://tools.ietf.org/html/rfc7234) specifications.</span></span> <span data-ttu-id="6c306-227">Par exemple, le `no-store` directive ne doit pas exister dans les champs d’en-tête de demande ou de réponse.</span><span class="sxs-lookup"><span data-stu-id="6c306-227">For example, the `no-store` directive must not exist in request or response header fields.</span></span> <span data-ttu-id="6c306-228">Consultez *Section 3 : le stockage des réponses dans les Caches* de [RFC 7234](https://tools.ietf.org/html/rfc7234) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="6c306-228">See *Section 3: Storing Responses in Caches* of [RFC 7234](https://tools.ietf.org/html/rfc7234) for details.</span></span>

> [!NOTE]
> <span data-ttu-id="6c306-229">Définit des attaques par le système de côté pour la génération de jetons sécurisés pour empêcher la falsification de demande d’intersites (CSRF) le `Cache-Control` et `Pragma` en-têtes `no-cache` afin que les réponses ne sont pas mises en cache.</span><span class="sxs-lookup"><span data-stu-id="6c306-229">The Antiforgery system for generating secure tokens to prevent Cross-Site Request Forgery (CSRF) attacks sets the `Cache-Control` and `Pragma` headers to `no-cache` so that responses aren't cached.</span></span> <span data-ttu-id="6c306-230">Pour plus d’informations sur la désactivation des jetons de côté pour les éléments de formulaire HTML, consultez [configuration côtée d’ASP.NET Core](xref:security/anti-request-forgery#aspnet-core-antiforgery-configuration).</span><span class="sxs-lookup"><span data-stu-id="6c306-230">For information on how to disable antiforgery tokens for HTML form elements, see [ASP.NET Core antiforgery configuration](xref:security/anti-request-forgery#aspnet-core-antiforgery-configuration).</span></span>

## <a name="additional-resources"></a><span data-ttu-id="6c306-231">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="6c306-231">Additional resources</span></span>

* [<span data-ttu-id="6c306-232">Démarrage d’une application</span><span class="sxs-lookup"><span data-stu-id="6c306-232">Application Startup</span></span>](xref:fundamentals/startup)
* [<span data-ttu-id="6c306-233">Intergiciel (middleware)</span><span class="sxs-lookup"><span data-stu-id="6c306-233">Middleware</span></span>](xref:fundamentals/middleware/index)
* [<span data-ttu-id="6c306-234">Mettre en cache en mémoire</span><span class="sxs-lookup"><span data-stu-id="6c306-234">Cache in-memory</span></span>](xref:performance/caching/memory)
* [<span data-ttu-id="6c306-235">Utiliser un cache distribué</span><span class="sxs-lookup"><span data-stu-id="6c306-235">Work with a distributed cache</span></span>](xref:performance/caching/distributed)
* [<span data-ttu-id="6c306-236">Détecter les modifications à l’aide de jetons de modification</span><span class="sxs-lookup"><span data-stu-id="6c306-236">Detect changes with change tokens</span></span>](xref:fundamentals/primitives/change-tokens)
* [<span data-ttu-id="6c306-237">Mise en cache des réponses</span><span class="sxs-lookup"><span data-stu-id="6c306-237">Response caching</span></span>](xref:performance/caching/response)
* [<span data-ttu-id="6c306-238">Tag Helper de cache</span><span class="sxs-lookup"><span data-stu-id="6c306-238">Cache Tag Helper</span></span>](xref:mvc/views/tag-helpers/builtin-th/cache-tag-helper)
* [<span data-ttu-id="6c306-239">Tag Helper de cache distribué</span><span class="sxs-lookup"><span data-stu-id="6c306-239">Distributed Cache Tag Helper</span></span>](xref:mvc/views/tag-helpers/builtin-th/distributed-cache-tag-helper)
