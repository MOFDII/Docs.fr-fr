---
title: "Authentification de cloud de site web d’API avec Azure Active Directory B2C"
author: camsoper
description: "Découvrez comment configurer l’authentification d’Azure Active Directory B2C avec l’API Web ASP.NET principale. Tester l’API avec Postman de web authentifié."
ms.author: casoper
manager: wpickett
ms.date: 01/25/2018
ms.topic: tutorial
ms.technology: aspnet
ms.prod: asp.net-core
ms.custom: mvc
uid: security/authentication/azure-ad-b2c-webapi
ms.openlocfilehash: d768e2daf2464b282b097e935ef6c5f85e8705f5
ms.sourcegitcommit: 016f4d58663bcd442930227022de23fb3abee0b3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/12/2018
---
# <a name="cloud-authentication-in-web-apis-with-azure-active-directory-b2c"></a><span data-ttu-id="0ce1a-104">Authentification de cloud de site web d’API avec Azure Active Directory B2C</span><span class="sxs-lookup"><span data-stu-id="0ce1a-104">Cloud authentication in web APIs with Azure Active Directory B2C</span></span>

<span data-ttu-id="0ce1a-105">Auteur : [Cam Soper](https://twitter.com/camsoper)</span><span class="sxs-lookup"><span data-stu-id="0ce1a-105">By [Cam Soper](https://twitter.com/camsoper)</span></span>

<span data-ttu-id="0ce1a-106">[Azure B2C Active Directory](/azure/active-directory-b2c/active-directory-b2c-overview) (B2C Active Directory de Azure) est une solution de gestion des identités de cloud pour les applications web et mobiles.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-106">[Azure Active Directory B2C](/azure/active-directory-b2c/active-directory-b2c-overview) (Azure AD B2C) is a cloud identity management solution for web and mobile apps.</span></span> <span data-ttu-id="0ce1a-107">Le service fournit l’authentification pour les applications hébergées dans le cloud et locales.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-107">The service provides authentication for apps hosted in the cloud and on-premises.</span></span> <span data-ttu-id="0ce1a-108">Types d’authentification, les comptes individuels, les comptes de réseau social et fédérés des comptes d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-108">Authentication types include individual accounts, social network accounts, and federated enterprise accounts.</span></span> <span data-ttu-id="0ce1a-109">En outre, Azure AD B2C peut fournir l’authentification multifacteur avec une configuration minimale.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-109">Additionally, Azure AD B2C can provide multi-factor authentication with minimal configuration.</span></span>

> [!TIP]
> <span data-ttu-id="0ce1a-110">Azure Active Directory (Azure AD) Azure Active Directory B2C sont des offres de produits distincts.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-110">Azure Active Directory (Azure AD) Azure AD B2C are separate product offerings.</span></span> <span data-ttu-id="0ce1a-111">Un locataire Azure AD représente une organisation, alors qu’un locataire Azure AD B2C représente une collection d’identités à utiliser avec les applications de confiance.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-111">An Azure AD tenant represents an organization, while an Azure AD B2C tenant represents a collection of identities to be used with relying party applications.</span></span> <span data-ttu-id="0ce1a-112">Pour plus d’informations, consultez [Azure AD B2C : Forum aux questions (FAQ)](/azure/active-directory-b2c/active-directory-b2c-faqs).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-112">To learn more, see [Azure AD B2C: Frequently asked questions (FAQ)](/azure/active-directory-b2c/active-directory-b2c-faqs).</span></span>

<span data-ttu-id="0ce1a-113">Étant donné que l’API web ont aucune interface utilisateur, ils ne peuvent pas rediriger l’utilisateur vers un service de jeton sécurisé comme Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-113">Since web APIs have no user interface, they're unable to redirect the user to a secure token service like Azure AD B2C.</span></span> <span data-ttu-id="0ce1a-114">Au lieu de cela, l’API est passé un jeton de support à partir de l’application appelante qui a déjà authentifié l’utilisateur avec Azure Active Directory B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-114">Instead, the API is passed a bearer token from the calling app, which has already authenticated the user with Azure AD B2C.</span></span> <span data-ttu-id="0ce1a-115">L’API puis valide le jeton sans intervention de l’utilisateur directe.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-115">The API then validates the token without direct user interaction.</span></span>

<span data-ttu-id="0ce1a-116">Dans ce didacticiel, vous devez savoir comment :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-116">In this tutorial, learn how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="0ce1a-117">Créer un locataire Azure Active Directory B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-117">Create an Azure Active Directory B2C tenant.</span></span>
> * <span data-ttu-id="0ce1a-118">Enregistrer une API Web dans Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-118">Register a Web API in Azure AD B2C.</span></span>
> * <span data-ttu-id="0ce1a-119">Utiliser Visual Studio pour créer une API Web configuré pour utiliser le locataire Azure AD B2C pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-119">Use Visual Studio to create a Web API configured to use the Azure AD B2C tenant for authentication.</span></span>
> * <span data-ttu-id="0ce1a-120">Configurer des stratégies de contrôle du comportement du client Azure Active Directory B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-120">Configure policies controlling the behavior of the Azure AD B2C tenant.</span></span>
> * <span data-ttu-id="0ce1a-121">Postman utilisé pour simuler une application web qui présente une boîte de dialogue de connexion, récupère un jeton et l’utilise pour effectuer une demande dans l’API web.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-121">Use Postman to simulate a web app which presents a login dialog, retrieves a token, and uses it to make a request against the web API.</span></span>

## <a name="prerequisites"></a><span data-ttu-id="0ce1a-122">Prérequis</span><span class="sxs-lookup"><span data-stu-id="0ce1a-122">Prerequisites</span></span>

<span data-ttu-id="0ce1a-123">Les éléments suivants sont requis pour cette procédure pas à pas :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-123">The following are required for this walkthrough:</span></span>

* [<span data-ttu-id="0ce1a-124">Abonnement Microsoft Azure</span><span class="sxs-lookup"><span data-stu-id="0ce1a-124">Microsoft Azure subscription</span></span>](https://azure.microsoft.com/free/?ref=microsoft.com&utm_source=microsoft.com&utm_medium=docs&utm_campaign=visualstudio)
* <span data-ttu-id="0ce1a-125">[Visual Studio 2017](https://aka.ms/vsdownload?utm_source=mscom&utm_campaign=msdocs) (toute édition)</span><span class="sxs-lookup"><span data-stu-id="0ce1a-125">[Visual Studio 2017](https://aka.ms/vsdownload?utm_source=mscom&utm_campaign=msdocs) (any edition)</span></span>
* [<span data-ttu-id="0ce1a-126">Postman</span><span class="sxs-lookup"><span data-stu-id="0ce1a-126">Postman</span></span>](https://www.getpostman.com/postman)

## <a name="create-the-azure-active-directory-b2c-tenant"></a><span data-ttu-id="0ce1a-127">Créer le client Azure Active Directory B2C</span><span class="sxs-lookup"><span data-stu-id="0ce1a-127">Create the Azure Active Directory B2C tenant</span></span>

<span data-ttu-id="0ce1a-128">Créer un client Azure AD B2C [comme décrit dans la documentation](/azure/active-directory-b2c/active-directory-b2c-get-started).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-128">Create an Azure AD B2C tenant [as described in the documentation](/azure/active-directory-b2c/active-directory-b2c-get-started).</span></span> <span data-ttu-id="0ce1a-129">Lorsque vous y êtes invité, associant le locataire d’un abonnement Azure est facultatif pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-129">When prompted, associating the tenant with an Azure subscription is optional for this tutorial.</span></span>

## <a name="configure-a-sign-up-or-sign-in-policy"></a><span data-ttu-id="0ce1a-130">Configurer une stratégie d’inscription ou de la connexion</span><span class="sxs-lookup"><span data-stu-id="0ce1a-130">Configure a sign-up or sign-in policy</span></span>

<span data-ttu-id="0ce1a-131">Utilisez les étapes de la documentation d’Azure AD B2C à [créer une stratégie d’inscription ou connectez-vous](/azure/active-directory-b2c/active-directory-b2c-reference-policies#create-a-sign-up-or-sign-in-policy).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-131">Use the steps in the Azure AD B2C documentation to [create a sign-up or sign-in policy](/azure/active-directory-b2c/active-directory-b2c-reference-policies#create-a-sign-up-or-sign-in-policy).</span></span> <span data-ttu-id="0ce1a-132">Nom de la stratégie **SiUpIn**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-132">Name the policy **SiUpIn**.</span></span>  <span data-ttu-id="0ce1a-133">Utilisez les valeurs de l’exemple fournis dans la documentation de **fournisseurs d’identité**, **des attributs d’abonnement**, et **revendications de l’Application**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-133">Use the example values provided in the documentation for **Identity providers**, **Sign-up attributes**, and **Application claims**.</span></span> <span data-ttu-id="0ce1a-134">À l’aide de la **exécuter maintenant** bouton pour tester la stratégie, comme décrit dans la documentation est facultative.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-134">Using the **Run now** button to test the policy as described in the documentation is optional.</span></span>

## <a name="register-the-api-in-azure-ad-b2c"></a><span data-ttu-id="0ce1a-135">Registre de l’API dans Azure AD B2C</span><span class="sxs-lookup"><span data-stu-id="0ce1a-135">Register the API in Azure AD B2C</span></span>

<span data-ttu-id="0ce1a-136">Dans le locataire Azure AD B2C nouvellement créé, inscrire votre à l’aide de l’API [les étapes décrites dans la documentation](/azure/active-directory-b2c/active-directory-b2c-app-registration#register-a-web-api) sous le **enregistrer une API web** section.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-136">In the newly created Azure AD B2C tenant, register your API using [the steps in the documentation](/azure/active-directory-b2c/active-directory-b2c-app-registration#register-a-web-api) under the **Register a web API** section.</span></span>

<span data-ttu-id="0ce1a-137">Utilisez les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-137">Use the following values:</span></span>

| <span data-ttu-id="0ce1a-138">Paramètre</span><span class="sxs-lookup"><span data-stu-id="0ce1a-138">Setting</span></span>                       | <span data-ttu-id="0ce1a-139">Value</span><span class="sxs-lookup"><span data-stu-id="0ce1a-139">Value</span></span>               | <span data-ttu-id="0ce1a-140">Notes</span><span class="sxs-lookup"><span data-stu-id="0ce1a-140">Notes</span></span>                                                                                  |
|-------------------------------|---------------------|----------------------------------------------------------------------------------------|
| <span data-ttu-id="0ce1a-141">**Name**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-141">**Name**</span></span>                      | <span data-ttu-id="0ce1a-142">*&lt;Nom de l’API&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-142">*&lt;API name&gt;*</span></span>  | <span data-ttu-id="0ce1a-143">Entrez un **nom** pour l’application qui décrivent votre application aux consommateurs.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-143">Enter a **Name** for the app that describes your app to consumers.</span></span>                     |
| <span data-ttu-id="0ce1a-144">**Inclure l’application web ou des API**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-144">**Include web app / web API**</span></span> | <span data-ttu-id="0ce1a-145">Oui</span><span class="sxs-lookup"><span data-stu-id="0ce1a-145">Yes</span></span>                 |                                                                                        |
| <span data-ttu-id="0ce1a-146">**Autoriser les flux implicites**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-146">**Allow implicit flow**</span></span>       | <span data-ttu-id="0ce1a-147">Oui</span><span class="sxs-lookup"><span data-stu-id="0ce1a-147">Yes</span></span>                 |                                                                                        |
| <span data-ttu-id="0ce1a-148">**URL de réponse**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-148">**Reply URL**</span></span>                 | `https://localhost` | <span data-ttu-id="0ce1a-149">URL de réponse sont les points de terminaison où Azure AD B2C retourne tout jeton de demande de votre application.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-149">Reply URLs are endpoints where Azure AD B2C returns any tokens that your app requests.</span></span> |
| <span data-ttu-id="0ce1a-150">**URI ID d’application**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-150">**App ID URI**</span></span>                | <span data-ttu-id="0ce1a-151">*api*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-151">*api*</span></span>               | <span data-ttu-id="0ce1a-152">L’URI n’a pas besoin de correspondre à une adresse physique.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-152">The URI doesn't need to resolve to a physical address.</span></span> <span data-ttu-id="0ce1a-153">Il doit être unique.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-153">It only needs to be unique.</span></span>     |
| <span data-ttu-id="0ce1a-154">**Inclure le client natif**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-154">**Include native client**</span></span>     | <span data-ttu-id="0ce1a-155">Non</span><span class="sxs-lookup"><span data-stu-id="0ce1a-155">No</span></span>                  |                                                                                        |

<span data-ttu-id="0ce1a-156">Une fois que l’API est inscrit, la liste des applications et des API dans le client s’affiche.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-156">After the API is registered, the list of apps and APIs in the tenant is displayed.</span></span> <span data-ttu-id="0ce1a-157">Sélectionnez l’API a été enregistré.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-157">Select the API that was just registered.</span></span> <span data-ttu-id="0ce1a-158">Sélectionnez le **copie** icône à droite de la **ID d’Application** champ pour le copier dans le Presse-papiers.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-158">Select the **Copy** icon to the right of the **Application ID** field to copy it to the clipboard.</span></span> <span data-ttu-id="0ce1a-159">Sélectionnez **publié étendues** et vérifiez la valeur par défaut *user_impersonation* étendue est présente.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-159">Select **Published scopes** and verify the default *user_impersonation* scope is present.</span></span>

## <a name="create-an-aspnet-core-app-in-visual-studio-2017"></a><span data-ttu-id="0ce1a-160">Créer une application ASP.NET Core dans Visual Studio 2017</span><span class="sxs-lookup"><span data-stu-id="0ce1a-160">Create an ASP.NET Core app in Visual Studio 2017</span></span>

<span data-ttu-id="0ce1a-161">Le modèle d’Application Web de Visual Studio peut être configuré pour utiliser le locataire Azure AD B2C pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-161">The Visual Studio Web Application template can be configured to use the Azure AD B2C tenant for authentication.</span></span>

<span data-ttu-id="0ce1a-162">Dans Visual Studio :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-162">In Visual Studio:</span></span>

1. <span data-ttu-id="0ce1a-163">Créez une application web ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-163">Create a new ASP.NET Core Web Application.</span></span> 
2. <span data-ttu-id="0ce1a-164">Sélectionnez **API Web** à partir de la liste des modèles.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-164">Select **Web API** from the list of templates.</span></span>
3. <span data-ttu-id="0ce1a-165">Sélectionnez le **modifier l’authentification** bouton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-165">Select the **Change Authentication** button.</span></span>
    
    ![Bouton de modifier l’authentification](./azure-ad-b2c-webapi/change-auth-button.png)

4. <span data-ttu-id="0ce1a-167">Dans le **modifier l’authentification** boîte de dialogue, sélectionnez **comptes d’utilisateur individuels**, puis sélectionnez **se connecter à un magasin d’utilisateur existant dans le cloud** dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-167">In the **Change Authentication** dialog, select **Individual User Accounts**, and then select **Connect to an existing user store in the cloud** in the dropdown.</span></span> 
    
    ![Boîte de dialogue Modifier l’authentification](./azure-ad-b2c-webapi/change-auth-dialog.png)

5. <span data-ttu-id="0ce1a-169">Remplissez le formulaire avec les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-169">Complete the form with the following values:</span></span>
    
    | <span data-ttu-id="0ce1a-170">Paramètre</span><span class="sxs-lookup"><span data-stu-id="0ce1a-170">Setting</span></span>                       | <span data-ttu-id="0ce1a-171">Value</span><span class="sxs-lookup"><span data-stu-id="0ce1a-171">Value</span></span>                                                 |
    |-------------------------------|-------------------------------------------------------|
    | <span data-ttu-id="0ce1a-172">**Nom de domaine**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-172">**Domain Name**</span></span>               | <span data-ttu-id="0ce1a-173">*&lt;le nom de domaine de votre client B2C&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-173">*&lt;the domain name of your B2C tenant&gt;*</span></span>          |
    | <span data-ttu-id="0ce1a-174">**ID d’application**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-174">**Application ID**</span></span>            | <span data-ttu-id="0ce1a-175">*&lt;Collez l’ID d’Application à partir du Presse-papiers&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-175">*&lt;paste the Application ID from the clipboard&gt;*</span></span> |
    | <span data-ttu-id="0ce1a-176">**Stratégie d’inscription ou de la connexion**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-176">**Sign-up or sign-in policy**</span></span> | `B2C_1_SiUpIn`                                        |
    
    <span data-ttu-id="0ce1a-177">Sélectionnez **OK** pour fermer la **modifier l’authentification** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-177">Select **OK** to close the **Change Authentication** dialog.</span></span> <span data-ttu-id="0ce1a-178">Sélectionnez **OK** pour créer l’application web.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-178">Select **OK** to create the web app.</span></span>

<span data-ttu-id="0ce1a-179">Visual Studio crée l’API web avec un contrôleur nommé *le fichier ValuesController.cs* qui retourne des valeurs codées en dur pour les demandes GET.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-179">Visual Studio creates the web API with a controller named *ValuesController.cs* that returns hard-coded values for GET requests.</span></span> <span data-ttu-id="0ce1a-180">La classe est décorée avec le [attribut Authorize](xref:security/authorization/simple), de sorte que toutes les demandes nécessitent l’authentification.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-180">The class is decorated with the [Authorize attribute](xref:security/authorization/simple), so all requests require authentication.</span></span>

## <a name="run-the-web-api"></a><span data-ttu-id="0ce1a-181">Exécution de l’API web</span><span class="sxs-lookup"><span data-stu-id="0ce1a-181">Run the web API</span></span>

<span data-ttu-id="0ce1a-182">Dans Visual Studio, exécutez l’API.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-182">In Visual Studio, run the API.</span></span> <span data-ttu-id="0ce1a-183">Visual Studio lance un navigateur pointé URL racine de l’API.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-183">Visual Studio launches a browser pointed at the API's root URL.</span></span> <span data-ttu-id="0ce1a-184">Notez l’URL dans la barre d’adresses et laissez l’API en cours d’exécution en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-184">Note the URL in the address bar, and leave the API running in the background.</span></span>

> [!NOTE]
> <span data-ttu-id="0ce1a-185">Comme il n’existe aucun contrôleur défini pour l’URL racine, le navigateur affiche alors une erreur 404 (page introuvable).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-185">Since there is no controller defined for the root URL, the browser displays a 404 (page not found) error.</span></span> <span data-ttu-id="0ce1a-186">Ce comportement est normal.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-186">This is expected behavior.</span></span>

## <a name="use-postman-to-get-a-token-and-test-the-api"></a><span data-ttu-id="0ce1a-187">Postman permet d’obtenir un jeton et l’API de test</span><span class="sxs-lookup"><span data-stu-id="0ce1a-187">Use Postman to get a token and test the API</span></span>

<span data-ttu-id="0ce1a-188">[Postman](https://getpostman.com/postman) est un outil de test web API.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-188">[Postman](https://getpostman.com/postman) is a tool for testing web APIs.</span></span> <span data-ttu-id="0ce1a-189">Pour ce didacticiel, Postman simule une application web qui accède à l’API web part de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-189">For this tutorial, Postman simulates a web app that accesses the web API on the user's behalf.</span></span>

### <a name="register-postman-as-a-web-app"></a><span data-ttu-id="0ce1a-190">Inscrire Postman comme une application web</span><span class="sxs-lookup"><span data-stu-id="0ce1a-190">Register Postman as a web app</span></span>

<span data-ttu-id="0ce1a-191">Étant donné que Postman simule une application web qui peut obtenir des jetons provenant du locataire Azure AD B2C, elle doit être inscrite dans le client comme une application web.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-191">Since Postman simulates a web app that can obtain tokens from the Azure AD B2C tenant, it must be registered in the tenant as a web app.</span></span> <span data-ttu-id="0ce1a-192">Enregistrer à l’aide de Postman [les étapes décrites dans la documentation](/azure/active-directory-b2c/active-directory-b2c-app-registration#register-a-web-app) sous le **inscrire une application web** section.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-192">Register Postman using [the steps in the documentation](/azure/active-directory-b2c/active-directory-b2c-app-registration#register-a-web-app) under the **Register a web app** section.</span></span> <span data-ttu-id="0ce1a-193">Arrêter à la **créer une question secrète du client web application** section.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-193">Stop at the **Create a web app client secret** section.</span></span> <span data-ttu-id="0ce1a-194">Une clé secrète client n’est pas nécessaire pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-194">A client secret isn't required for this tutorial.</span></span> 

<span data-ttu-id="0ce1a-195">Utilisez les valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-195">Use the following values:</span></span>

| <span data-ttu-id="0ce1a-196">Paramètre</span><span class="sxs-lookup"><span data-stu-id="0ce1a-196">Setting</span></span>                       | <span data-ttu-id="0ce1a-197">Value</span><span class="sxs-lookup"><span data-stu-id="0ce1a-197">Value</span></span>                            | <span data-ttu-id="0ce1a-198">Notes</span><span class="sxs-lookup"><span data-stu-id="0ce1a-198">Notes</span></span>                           |
|-------------------------------|----------------------------------|---------------------------------|
| <span data-ttu-id="0ce1a-199">**Name**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-199">**Name**</span></span>                      | <span data-ttu-id="0ce1a-200">Postman</span><span class="sxs-lookup"><span data-stu-id="0ce1a-200">Postman</span></span>                          |                                 |
| <span data-ttu-id="0ce1a-201">**Inclure l’application web ou des API**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-201">**Include web app / web API**</span></span> | <span data-ttu-id="0ce1a-202">Oui</span><span class="sxs-lookup"><span data-stu-id="0ce1a-202">Yes</span></span>                              |                                 |
| <span data-ttu-id="0ce1a-203">**Autoriser les flux implicites**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-203">**Allow implicit flow**</span></span>       | <span data-ttu-id="0ce1a-204">Oui</span><span class="sxs-lookup"><span data-stu-id="0ce1a-204">Yes</span></span>                              |                                 |
| <span data-ttu-id="0ce1a-205">**URL de réponse**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-205">**Reply URL**</span></span>                 | `https://getpostman.com/postman` |                                 |
| <span data-ttu-id="0ce1a-206">**URI ID d’application**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-206">**App ID URI**</span></span>                | <span data-ttu-id="0ce1a-207">*&lt;Laissez vide&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-207">*&lt;leave blank&gt;*</span></span>            | <span data-ttu-id="0ce1a-208">Non requis pour ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-208">Not required for this tutorial.</span></span> |
| <span data-ttu-id="0ce1a-209">**Inclure le client natif**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-209">**Include native client**</span></span>     | <span data-ttu-id="0ce1a-210">Non</span><span class="sxs-lookup"><span data-stu-id="0ce1a-210">No</span></span>                               |                                 |

<span data-ttu-id="0ce1a-211">L’application web qui vient d’être inscrit nécessite une autorisation pour accéder à l’API web part de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-211">The newly registered web app needs permission to access the web API on the user's behalf.</span></span>  

1. <span data-ttu-id="0ce1a-212">Sélectionnez **Postman** dans la liste des applications, puis sélectionnez **l’accès aux API** à partir du menu de gauche.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-212">Select **Postman** in the list of apps and then select **API access** from the menu on the left.</span></span>
2. <span data-ttu-id="0ce1a-213">Sélectionnez **+ ajouter**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-213">Select **+ Add**.</span></span>
3. <span data-ttu-id="0ce1a-214">Dans le **sélectionner une API** liste déroulante, sélectionnez le nom de l’API web.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-214">In the **Select API** dropdown, select the name of the web API.</span></span>
4. <span data-ttu-id="0ce1a-215">Dans le **étendues** liste déroulante, assurez-vous que toutes les étendues sont sélectionnées.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-215">In the **Select Scopes** dropdown, ensure all scopes are selected.</span></span>
5. <span data-ttu-id="0ce1a-216">Sélectionnez **Ok**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-216">Select **Ok**.</span></span>

<span data-ttu-id="0ce1a-217">Notez l’ID d’Application de l’application Postman, est nécessaire pour obtenir un jeton de support.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-217">Note the Postman app's Application ID, as it's required to obtain a bearer token.</span></span>

### <a name="create-a-postman-request"></a><span data-ttu-id="0ce1a-218">Créer une demande de Postman</span><span class="sxs-lookup"><span data-stu-id="0ce1a-218">Create a Postman request</span></span>

<span data-ttu-id="0ce1a-219">Lancez Postman.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-219">Launch Postman.</span></span> <span data-ttu-id="0ce1a-220">Par défaut, Postman affiche le **créer un nouveau** boîte de dialogue après le lancement.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-220">By default, Postman displays the **Create New** dialog upon launching.</span></span> <span data-ttu-id="0ce1a-221">Si la boîte de dialogue n’est pas affichée, sélectionnez le **+ nouveau** bouton dans le coin supérieur gauche.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-221">If the dialog isn't displayed, select the **+ New** button in the upper left.</span></span>

<span data-ttu-id="0ce1a-222">À partir de la **créer un nouveau** boîte de dialogue :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-222">From the **Create New** dialog:</span></span>

1. <span data-ttu-id="0ce1a-223">Sélectionnez **demande**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-223">Select **Request**.</span></span>
    
    ![Bouton de demande](./azure-ad-b2c-webapi/postman-create-new.png)

2. <span data-ttu-id="0ce1a-225">Entrez *obtenir les valeurs* dans les **nom de la demande** boîte.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-225">Enter *Get Values* in the **Request name** box.</span></span>
3. <span data-ttu-id="0ce1a-226">Sélectionnez **+ créer une Collection de** pour créer une nouvelle collection pour stocker la demande.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-226">Select **+ Create Collection** to create a new collection for storing the request.</span></span> <span data-ttu-id="0ce1a-227">Nom de la collection *les didacticiels ASP.NET Core* , puis sélectionnez la coche.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-227">Name the collection *ASP.NET Core tutorials* and then select the checkmark.</span></span>
    
    ![Création d’un regroupement](./azure-ad-b2c-webapi/postman-create-collection.png)

4. <span data-ttu-id="0ce1a-229">Sélectionnez le **enregistrer dans les didacticiels ASP.NET Core** bouton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-229">Select the **Save to ASP.NET Core tutorials** button.</span></span>

### <a name="test-the-web-api-withoutauthentication"></a><span data-ttu-id="0ce1a-230">Tester l’API web withoutauthentication</span><span class="sxs-lookup"><span data-stu-id="0ce1a-230">Test the web API withoutauthentication</span></span>

<span data-ttu-id="0ce1a-231">Pour vérifier que l’API web nécessite une authentification, tout d’abord effectuer une demande sans authentification.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-231">To verify that the web API requires authentication, first make a request without authentication.</span></span>

1. <span data-ttu-id="0ce1a-232">Dans le **Entrez l’URL de demande** , entrez l’URL pour `ValuesController`.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-232">In the **Enter request URL** box, enter the URL for `ValuesController`.</span></span> <span data-ttu-id="0ce1a-233">L’URL est identique à celle affichée dans le navigateur avec **api/valeurs** ajouté.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-233">The URL is the same as displayed in the browser with **api/values** appended.</span></span> <span data-ttu-id="0ce1a-234">Un exemple serait `https://localhost:44375/api/values`.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-234">An example would be `https://localhost:44375/api/values`.</span></span>
2. <span data-ttu-id="0ce1a-235">Sélectionnez le **envoyer** bouton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-235">Select the **Send** button.</span></span>
3. <span data-ttu-id="0ce1a-236">Notez l’état de la réponse est *401 non autorisé*.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-236">Note the status of the response is *401 Unauthorized*.</span></span>

    ![réponse non autorisé 401](./azure-ad-b2c-webapi/postman-401-status.png)

### <a name="obtain-a-bearer-token"></a><span data-ttu-id="0ce1a-238">Obtenir un jeton de support</span><span class="sxs-lookup"><span data-stu-id="0ce1a-238">Obtain a bearer token</span></span>

<span data-ttu-id="0ce1a-239">Pour rendre une demande authentifiée à l’API web, un jeton de support est nécessaire.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-239">To make an authenticated request to the web API, a bearer token is required.</span></span> <span data-ttu-id="0ce1a-240">Postman permet de facilement se connecter au locataire Azure AD B2C et obtenir un jeton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-240">Postman makes it easy to sign in to the Azure AD B2C tenant and obtain a token.</span></span>

1. <span data-ttu-id="0ce1a-241">Sur le **autorisation** sous l’onglet du **TYPE** liste déroulante, sélectionnez **OAuth 2.0**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-241">On the **Authorization** tab, in the **TYPE** dropdown, select **OAuth 2.0**.</span></span> <span data-ttu-id="0ce1a-242">Dans le **ajouter des données d’autorisation** liste déroulante, sélectionnez **en-têtes de la requête**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-242">In the **Add authorization data to** dropdown, select **Request Headers**.</span></span> <span data-ttu-id="0ce1a-243">Sélectionnez **accéder nouveau jeton**.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-243">Select **Get New Access Token**.</span></span>
    
    ![Onglet autorisation avec des paramètres](./azure-ad-b2c-webapi/postman-auth-tab.png)

2. <span data-ttu-id="0ce1a-245">Terminer la **obtenir nouveau jeton d’accès** boîte de dialogue comme suit :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-245">Complete the **GET NEW ACCESS TOKEN** dialog as follows:</span></span>
    
    | <span data-ttu-id="0ce1a-246">Paramètre</span><span class="sxs-lookup"><span data-stu-id="0ce1a-246">Setting</span></span>                   | <span data-ttu-id="0ce1a-247">Value</span><span class="sxs-lookup"><span data-stu-id="0ce1a-247">Value</span></span>                                                                                         | <span data-ttu-id="0ce1a-248">Notes</span><span class="sxs-lookup"><span data-stu-id="0ce1a-248">Notes</span></span>                                                                                      |
    |---------------------------|-----------------------------------------------------------------------------------------------|--------------------------------------------------------------------------------------------|
    | <span data-ttu-id="0ce1a-249">**Nom du jeton**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-249">**Token Name**</span></span>            | <span data-ttu-id="0ce1a-250">*&lt;nom du jeton&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-250">*&lt;token name&gt;*</span></span>                                                                          | <span data-ttu-id="0ce1a-251">Entrez un nom descriptif pour le jeton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-251">Enter a descriptive name for the token.</span></span>                                                    |
    | <span data-ttu-id="0ce1a-252">**Type d’accès**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-252">**Grant Type**</span></span>            | <span data-ttu-id="0ce1a-253">Implicite</span><span class="sxs-lookup"><span data-stu-id="0ce1a-253">Implicit</span></span>                                                                                      |                                                                                            |
    | <span data-ttu-id="0ce1a-254">**URL de rappel**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-254">**Callback URL**</span></span>          | `https://getpostman.com/postman`                                                              |                                                                                            |
    | <span data-ttu-id="0ce1a-255">**URL d’authentification**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-255">**Auth URL**</span></span>              | `https://login.microsoftonline.com/<tenant domain name>/oauth2/v2.0/authorize?p=B2C_1_SiUpIn` | <span data-ttu-id="0ce1a-256">Remplacez  *&lt;nom_domaine_client&gt;*  avec le nom de domaine du locataire sans crochets pointus.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-256">Replace *&lt;tenant domain name&gt;* with the tenant's domain name without angle brackets.</span></span> |
    | <span data-ttu-id="0ce1a-257">**ID de client**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-257">**Client ID**</span></span>             | <span data-ttu-id="0ce1a-258">*&lt;Entrez l’application Postman <b>ID d’Application</b>&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-258">*&lt;enter the Postman app's <b>Application ID</b>&gt;*</span></span>                                       |                                                                                            |
    | <span data-ttu-id="0ce1a-259">**Question secrète du client**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-259">**Client Secret**</span></span>         | <span data-ttu-id="0ce1a-260">*&lt;Laissez vide&gt;*</span><span class="sxs-lookup"><span data-stu-id="0ce1a-260">*&lt;leave blank&gt;*</span></span>                                                                         |                                                                                            |
    | <span data-ttu-id="0ce1a-261">**Portée**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-261">**Scope**</span></span>                 | `https://<tenant domain name>/api/user_impersonation openid offline_access`                   | <span data-ttu-id="0ce1a-262">Remplacez  *&lt;nom_domaine_client&gt;*  avec le nom de domaine du locataire sans crochets pointus.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-262">Replace *&lt;tenant domain name&gt;* with the tenant's domain name without angle brackets.</span></span> |
    | <span data-ttu-id="0ce1a-263">**Authentification du client**</span><span class="sxs-lookup"><span data-stu-id="0ce1a-263">**Client Authentication**</span></span> | <span data-ttu-id="0ce1a-264">Envoyer des informations d’identification du client dans le corps</span><span class="sxs-lookup"><span data-stu-id="0ce1a-264">Send client credentials in body</span></span>                                                               |                                                                                            |
    
3. <span data-ttu-id="0ce1a-265">Sélectionnez le **demander un jeton** bouton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-265">Select the **Request Token** button.</span></span>

4. <span data-ttu-id="0ce1a-266">Postman ouvre une nouvelle fenêtre contenant la boîte de dialogue de connexion du locataire Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-266">Postman opens a new window containing the Azure AD B2C tenant's sign in dialog.</span></span> <span data-ttu-id="0ce1a-267">Connectez-vous avec un compte existant (si un a été créé les stratégies de test) ou sélectionnez **s’inscrire maintenant** pour créer un nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-267">Sign in with an existing account (if one was created testing the policies) or select **Sign up now** to create a new account.</span></span> <span data-ttu-id="0ce1a-268">Le **votre mot de passe oublié ?** lien est utilisé pour réinitialiser un mot de passe oublié.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-268">The **Forgot your password?** link is used to reset a forgotten password.</span></span>

5. <span data-ttu-id="0ce1a-269">Une fois connecté avec succès, la fenêtre se ferme et le **gérer les jetons d’accès** boîte de dialogue s’affiche.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-269">After successfully signing in, the window closes and the **MANAGE ACCESS TOKENS** dialog appears.</span></span> <span data-ttu-id="0ce1a-270">Faites défiler vers le bas et sélectionnez le **utilisez jeton** bouton.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-270">Scroll down to the bottom and select the **Use Token** button.</span></span>
    
    ![Où trouver le bouton « Token usage »](./azure-ad-b2c-webapi/postman-access-token.png)

### <a name="test-the-web-api-with-authentication"></a><span data-ttu-id="0ce1a-272">L’API web avec l’authentification de test</span><span class="sxs-lookup"><span data-stu-id="0ce1a-272">Test the web API with authentication</span></span>

<span data-ttu-id="0ce1a-273">Sélectionnez le **envoyer** bouton Envoyer la demande à nouveau.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-273">Select the **Send** button to send the request again.</span></span> <span data-ttu-id="0ce1a-274">Cette fois, l’état de réponse est *200 OK* et la charge utile JSON est visible sur la réponse **corps** onglet.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-274">This time, the response status is *200 OK* and the JSON payload is visible on the response **Body** tab.</span></span>
    
![État de réussite et de charge utile](./azure-ad-b2c-webapi/postman-success.png)

## <a name="next-steps"></a><span data-ttu-id="0ce1a-276">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="0ce1a-276">Next steps</span></span>

<span data-ttu-id="0ce1a-277">Dans ce didacticiel, vous avez appris à :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-277">In this tutorial, you learned how to:</span></span>

> [!div class="checklist"]
> * <span data-ttu-id="0ce1a-278">Créer un locataire Azure Active Directory B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-278">Create an Azure Active Directory B2C tenant.</span></span>
> * <span data-ttu-id="0ce1a-279">Enregistrer une API Web dans Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-279">Register a Web API in Azure AD B2C.</span></span>
> * <span data-ttu-id="0ce1a-280">Utiliser Visual Studio pour créer une API Web configuré pour utiliser le locataire Azure AD B2C pour l’authentification.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-280">Use Visual Studio to create a Web API configured to use the Azure AD B2C tenant for authentication.</span></span>
> * <span data-ttu-id="0ce1a-281">Configurer des stratégies de contrôle du comportement du client Azure Active Directory B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-281">Configure policies controlling the behavior of the Azure AD B2C tenant.</span></span>
> * <span data-ttu-id="0ce1a-282">Postman utilisé pour simuler une application web qui présente une boîte de dialogue de connexion, récupère un jeton et l’utilise pour effectuer une demande dans l’API web.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-282">Use Postman to simulate a web app which presents a login dialog, retrieves a token, and uses it to make a request against the web API.</span></span>

<span data-ttu-id="0ce1a-283">Continuer à développer votre API par l’apprentissage à :</span><span class="sxs-lookup"><span data-stu-id="0ce1a-283">Continue developing your API by learning to:</span></span>

* <span data-ttu-id="0ce1a-284">[Sécuriser une ASP.NET Core application web à l’aide d’Azure AD B2C](xref:security/authentication/azure-ad-b2c).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-284">[Secure an ASP.NET Core web app using Azure AD B2C](xref:security/authentication/azure-ad-b2c).</span></span>
* <span data-ttu-id="0ce1a-285">[Appeler une API web de .NET à partir d’une application web de .NET à l’aide d’Azure AD B2C](/azure/active-directory-b2c/active-directory-b2c-devquickstarts-web-api-dotnet).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-285">[Call a .NET web API from a .NET web app using Azure AD B2C](/azure/active-directory-b2c/active-directory-b2c-devquickstarts-web-api-dotnet).</span></span>
* <span data-ttu-id="0ce1a-286">[Personnaliser l’interface utilisateur de Azure AD B2C](/azure/active-directory-b2c/active-directory-b2c-reference-ui-customization).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-286">[Customize the Azure AD B2C user interface](/azure/active-directory-b2c/active-directory-b2c-reference-ui-customization).</span></span>
* <span data-ttu-id="0ce1a-287">[Configurer les exigences de complexité de mot de passe](/azure/active-directory-b2c/active-directory-b2c-reference-password-complexity).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-287">[Configure password complexity requirements](/azure/active-directory-b2c/active-directory-b2c-reference-password-complexity).</span></span>
* <span data-ttu-id="0ce1a-288">[Activer l’authentification multifacteur](/azure/active-directory-b2c/active-directory-b2c-reference-mfa).</span><span class="sxs-lookup"><span data-stu-id="0ce1a-288">[Enable multi-factor authentication](/azure/active-directory-b2c/active-directory-b2c-reference-mfa).</span></span>
* <span data-ttu-id="0ce1a-289">Configurer les fournisseurs d’identité supplémentaires, telles que [Microsoft](/azure/active-directory-b2c/active-directory-b2c-setup-msa-app), [Facebook](/azure/active-directory-b2c/active-directory-b2c-setup-fb-app), [Google](/azure/active-directory-b2c/active-directory-b2c-setup-goog-app), [Amazon](/azure/active-directory-b2c/active-directory-b2c-setup-amzn-app), [Twitter ](/azure/active-directory-b2c/active-directory-b2c-setup-twitter-app)et d’autres.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-289">Configure additional identity providers, such as [Microsoft](/azure/active-directory-b2c/active-directory-b2c-setup-msa-app), [Facebook](/azure/active-directory-b2c/active-directory-b2c-setup-fb-app), [Google](/azure/active-directory-b2c/active-directory-b2c-setup-goog-app), [Amazon](/azure/active-directory-b2c/active-directory-b2c-setup-amzn-app), [Twitter](/azure/active-directory-b2c/active-directory-b2c-setup-twitter-app), and others.</span></span>
* <span data-ttu-id="0ce1a-290">[Utiliser l’API Azure AD Graph](/azure/active-directory-b2c/active-directory-b2c-devquickstarts-graph-dotnet) pour récupérer des informations supplémentaires, telles que l’appartenance au groupe, du locataire Azure AD B2C.</span><span class="sxs-lookup"><span data-stu-id="0ce1a-290">[Use the Azure AD Graph API](/azure/active-directory-b2c/active-directory-b2c-devquickstarts-graph-dotnet) to retrieve additional user information, such as group membership, from the Azure AD B2C tenant.</span></span>
