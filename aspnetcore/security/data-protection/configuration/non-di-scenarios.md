---
title: "Scénarios pour la Protection des données dans ASP.NET Core non-DI"
author: rick-anderson
description: "Découvrez comment prendre en charge les scénarios de protection de données où vous ne peut pas ou ne souhaitez pas utiliser un service fourni par injection de dépendances."
manager: wpickett
ms.author: riande
ms.date: 10/14/2016
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: security/data-protection/configuration/non-di-scenarios
ms.openlocfilehash: d878bd20489876f919f2a8e0149f3f000cbf72d8
ms.sourcegitcommit: 7ac15eaae20b6d70e65f3650af050a7880115cbf
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 03/02/2018
---
# <a name="non-di-aware-scenarios-for-data-protection-in-aspnet-core"></a><span data-ttu-id="43416-103">Scénarios pour la Protection des données dans ASP.NET Core non-DI</span><span class="sxs-lookup"><span data-stu-id="43416-103">Non-DI aware scenarios for Data Protection in ASP.NET Core</span></span>

<span data-ttu-id="43416-104">Par [Rick Anderson](https://twitter.com/RickAndMSFT)</span><span class="sxs-lookup"><span data-stu-id="43416-104">By [Rick Anderson](https://twitter.com/RickAndMSFT)</span></span>

<span data-ttu-id="43416-105">Le système de Protection des données ASP.NET Core est normalement [ajouté à un conteneur de service](xref:security/data-protection/consumer-apis/overview) et consommé par les composants dépendants via l’injection de dépendance (DI).</span><span class="sxs-lookup"><span data-stu-id="43416-105">The ASP.NET Core Data Protection system is normally [added to a service container](xref:security/data-protection/consumer-apis/overview) and consumed by dependent components via dependency injection (DI).</span></span> <span data-ttu-id="43416-106">Toutefois, il existe des cas où cela n’est pas possible ou souhaitée, en particulier lors de l’importation du système dans une application existante.</span><span class="sxs-lookup"><span data-stu-id="43416-106">However, there are cases where this isn't feasible or desired, especially when importing the system into an existing app.</span></span>

<span data-ttu-id="43416-107">Pour prendre en charge ces scénarios, le [Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) package fournit un type concret, [DataProtectionProvider](/dotnet/api/Microsoft.AspNetCore.DataProtection.DataProtectionProvider), qui offre un moyen simple d’utiliser la Protection des données sans se baser sur DI.</span><span class="sxs-lookup"><span data-stu-id="43416-107">To support these scenarios, the [Microsoft.AspNetCore.DataProtection.Extensions](https://www.nuget.org/packages/Microsoft.AspNetCore.DataProtection.Extensions/) package provides a concrete type, [DataProtectionProvider](/dotnet/api/Microsoft.AspNetCore.DataProtection.DataProtectionProvider), which offers a simple way to use Data Protection without relying on DI.</span></span> <span data-ttu-id="43416-108">Le `DataProtectionProvider` type implémente [IDataProtectionProvider](/dotnet/api/microsoft.aspnetcore.dataprotection.idataprotectionprovider).</span><span class="sxs-lookup"><span data-stu-id="43416-108">The `DataProtectionProvider` type implements [IDataProtectionProvider](/dotnet/api/microsoft.aspnetcore.dataprotection.idataprotectionprovider).</span></span> <span data-ttu-id="43416-109">Construction `DataProtectionProvider` requiert l’installation en fournissant un [DirectoryInfo](/dotnet/api/system.io.directoryinfo) instance pour indiquer où les clés de chiffrement du fournisseur doivent être stockées, comme dans l’exemple de code suivant :</span><span class="sxs-lookup"><span data-stu-id="43416-109">Constructing `DataProtectionProvider` only requires providing a [DirectoryInfo](/dotnet/api/system.io.directoryinfo) instance to indicate where the provider's cryptographic keys should be stored, as seen in the following code sample:</span></span>

[!code-none[](non-di-scenarios/_static/nodisample1.cs)]

<span data-ttu-id="43416-110">Par défaut, le `DataProtectionProvider` type concret ne chiffre pas les matières premières de clés avant de le rendre au système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="43416-110">By default, the `DataProtectionProvider` concrete type doesn't encrypt raw key material before persisting it to the file system.</span></span> <span data-ttu-id="43416-111">Il s’agit pour prendre en charge les scénarios où les points de développeur à un partage réseau et le système de Protection des données ne peut pas déduire automatiquement un mécanisme de chiffrement de clé approprié au repos.</span><span class="sxs-lookup"><span data-stu-id="43416-111">This is to support scenarios where the developer points to a network share and the Data Protection system can't automatically deduce an appropriate at-rest key encryption mechanism.</span></span>

<span data-ttu-id="43416-112">En outre, le `DataProtectionProvider` type concret ne [isoler les applications](xref:security/data-protection/configuration/overview#per-application-isolation) par défaut.</span><span class="sxs-lookup"><span data-stu-id="43416-112">Additionally, the `DataProtectionProvider` concrete type doesn't [isolate apps](xref:security/data-protection/configuration/overview#per-application-isolation) by default.</span></span> <span data-ttu-id="43416-113">Toutes les applications en utilisant le même répertoire clé peuvent partager les charges utiles tant que leurs [objectif paramètres](xref:security/data-protection/consumer-apis/purpose-strings) correspondent.</span><span class="sxs-lookup"><span data-stu-id="43416-113">All apps using the same key directory can share payloads as long as their [purpose parameters](xref:security/data-protection/consumer-apis/purpose-strings) match.</span></span>

<span data-ttu-id="43416-114">Le [DataProtectionProvider](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionprovider) constructeur accepte un rappel de configuration facultative qui peut être utilisé pour ajuster les comportements du système.</span><span class="sxs-lookup"><span data-stu-id="43416-114">The [DataProtectionProvider](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionprovider) constructor accepts an optional configuration callback that can be used to adjust the behaviors of the system.</span></span> <span data-ttu-id="43416-115">L’exemple ci-dessous illustre la restauration d’isolation avec un appel explicite à [SetApplicationName](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionbuilderextensions.setapplicationname).</span><span class="sxs-lookup"><span data-stu-id="43416-115">The sample below demonstrates restoring isolation with an explicit call to [SetApplicationName](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionbuilderextensions.setapplicationname).</span></span> <span data-ttu-id="43416-116">L’exemple illustre également la configuration du système pour chiffrer automatiquement des clés persistantes à l’aide de DPAPI Windows.</span><span class="sxs-lookup"><span data-stu-id="43416-116">The sample also demonstrates configuring the system to automatically encrypt persisted keys using Windows DPAPI.</span></span> <span data-ttu-id="43416-117">Si le répertoire pointe vers un partage UNC, vous pouvez d’à distribuer un certificat partagé sur tous les ordinateurs appropriés et pour configurer le système pour utiliser le chiffrement de base de certificat avec un appel à [ProtectKeysWithCertificate](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionbuilderextensions.protectkeyswithcertificate).</span><span class="sxs-lookup"><span data-stu-id="43416-117">If the directory points to a UNC share, you may wish to distribute a shared certificate across all relevant machines and to configure the system to use certificate-based encryption with a call to [ProtectKeysWithCertificate](/dotnet/api/microsoft.aspnetcore.dataprotection.dataprotectionbuilderextensions.protectkeyswithcertificate).</span></span>

[!code-none[](non-di-scenarios/_static/nodisample2.cs)]

> [!TIP]
> <span data-ttu-id="43416-118">Instances de la `DataProtectionProvider` type concret sont coûteuses à créer.</span><span class="sxs-lookup"><span data-stu-id="43416-118">Instances of the `DataProtectionProvider` concrete type are expensive to create.</span></span> <span data-ttu-id="43416-119">Si une application conserve plusieurs instances de ce type et ils tous utilisent le même répertoire de stockage de clés, peut dégrader les performances de l’application.</span><span class="sxs-lookup"><span data-stu-id="43416-119">If an app maintains multiple instances of this type and if they're all using the same key storage directory, app performance might degrade.</span></span> <span data-ttu-id="43416-120">Si vous utilisez la `DataProtectionProvider` type, nous recommandons que vous créez ce type une seule fois et réutilisez autant que possible.</span><span class="sxs-lookup"><span data-stu-id="43416-120">If you use the `DataProtectionProvider` type, we recommend that you create this type once and reuse it as much as possible.</span></span> <span data-ttu-id="43416-121">Le `DataProtectionProvider` type et tous les [IDataProtector](/dotnet/api/microsoft.aspnetcore.dataprotection.idataprotector) instances créées à partir de celui-ci sont thread-safe pour les appelants plusieurs.</span><span class="sxs-lookup"><span data-stu-id="43416-121">The `DataProtectionProvider` type and all [IDataProtector](/dotnet/api/microsoft.aspnetcore.dataprotection.idataprotector) instances created from it are thread-safe for multiple callers.</span></span>
