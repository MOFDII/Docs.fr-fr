---
title: "Intergiciel (middleware) dans ASP.NET Core de réécriture d’URL"
author: guardrex
description: "En savoir plus sur les URL de réécriture et de redirection d’intergiciel (middleware) réécriture d’URL dans les applications ASP.NET Core."
keywords: "ASP.NET Core, réécriture d’URL, réécriture d’URL, URL de redirection, la redirection d’URL, intergiciel (middleware), apache_mod"
ms.author: riande
manager: wpickett
ms.date: 08/17/2017
ms.topic: article
ms.assetid: e6130638-c410-4161-9921-b658ce988bd1
ms.technology: aspnet
ms.prod: asp.net-core
uid: fundamentals/url-rewriting
ms.openlocfilehash: 754af24f4dcf054dd89eaa5f237ab680bf2d1172
ms.sourcegitcommit: df2157ae9aeea0075772719c29784425c783e82a
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/10/2018
---
# <a name="url-rewriting-middleware-in-aspnet-core"></a><span data-ttu-id="ad4ba-104">Intergiciel (middleware) dans ASP.NET Core de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-104">URL Rewriting Middleware in ASP.NET Core</span></span>

<span data-ttu-id="ad4ba-105">Par [Luke Latham](https://github.com/guardrex) et [Mikael Mengistu](https://github.com/mikaelm12)</span><span class="sxs-lookup"><span data-stu-id="ad4ba-105">By [Luke Latham](https://github.com/guardrex) and [Mikael Mengistu](https://github.com/mikaelm12)</span></span>

<span data-ttu-id="ad4ba-106">[Affichez ou téléchargez l’exemple de code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([procédure de téléchargement](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="ad4ba-106">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

<span data-ttu-id="ad4ba-107">Réécriture d’URL est le fait de la modification de requête URL basées sur une ou plusieurs règles prédéfinies.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-107">URL rewriting is the act of modifying request URLs based on one or more predefined rules.</span></span> <span data-ttu-id="ad4ba-108">Réécriture d’URL de crée une abstraction entre les emplacements de ressources et leurs adresses afin que les emplacements et les adresses ne sont pas étroitement liés.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-108">URL rewriting creates an abstraction between resource locations and their addresses so that the locations and addresses are not tightly linked.</span></span> <span data-ttu-id="ad4ba-109">Il existe plusieurs scénarios où il est utile de réécriture d’URL :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-109">There are several scenarios where URL rewriting is valuable:</span></span>
* <span data-ttu-id="ad4ba-110">Déplacez ou remplacez temporairement ou définitivement des ressources du serveur tout en conservant les localisateurs stables pour ces ressources</span><span class="sxs-lookup"><span data-stu-id="ad4ba-110">Moving or replacing server resources temporarily or permanently while maintaining stable locators for those resources</span></span>
* <span data-ttu-id="ad4ba-111">Fractionnement entre différentes applications ou entre les zones d’une application de traitement des demandes</span><span class="sxs-lookup"><span data-stu-id="ad4ba-111">Splitting request processing across different apps or across areas of one app</span></span>
* <span data-ttu-id="ad4ba-112">Suppression, l’ajout ou la réorganisation des segments d’URL sur les requêtes entrantes</span><span class="sxs-lookup"><span data-stu-id="ad4ba-112">Removing, adding, or reorganizing URL segments on incoming requests</span></span>
* <span data-ttu-id="ad4ba-113">Optimisation des URL publiques pour l’optimisation de moteur de recherche (SEO)</span><span class="sxs-lookup"><span data-stu-id="ad4ba-113">Optimizing public URLs for Search Engine Optimization (SEO)</span></span>
* <span data-ttu-id="ad4ba-114">Autoriser l’utilisation d’une URL publique conviviale pour aider les personnes à prédire le contenu, qu'ils trouveront en suivant un lien</span><span class="sxs-lookup"><span data-stu-id="ad4ba-114">Permitting the use of friendly public URLs to help people predict the content they will find by following a link</span></span>
* <span data-ttu-id="ad4ba-115">Redirection des demandes non sécurisées pour sécuriser les points de terminaison</span><span class="sxs-lookup"><span data-stu-id="ad4ba-115">Redirecting insecure requests to secure endpoints</span></span>
* <span data-ttu-id="ad4ba-116">Empêche toute image hotlinking</span><span class="sxs-lookup"><span data-stu-id="ad4ba-116">Preventing image hotlinking</span></span>

<span data-ttu-id="ad4ba-117">Vous pouvez définir des règles pour modifier l’URL de plusieurs façons, notamment regex, les règles de module mod_rewrite Apache, les règles du Module de réécriture IIS et à l’aide de la logique de règle personnalisée.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-117">You can define rules for changing the URL in several ways, including regex, Apache mod_rewrite module rules, IIS Rewrite Module rules, and using custom rule logic.</span></span> <span data-ttu-id="ad4ba-118">Ce document présente la réécriture d’URL avec des instructions sur l’utilisation d’intergiciel (middleware) réécriture d’URL dans les applications ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-118">This document introduces URL rewriting with instructions on how to use URL Rewriting Middleware in ASP.NET Core apps.</span></span>

> [!NOTE]
> <span data-ttu-id="ad4ba-119">Réécriture d’URL peut réduire les performances d’une application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-119">URL rewriting can reduce the performance of an app.</span></span> <span data-ttu-id="ad4ba-120">Si possible, vous devez limiter le nombre et la complexité des règles.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-120">Where feasible, you should limit the number and complexity of rules.</span></span>

## <a name="url-redirect-and-url-rewrite"></a><span data-ttu-id="ad4ba-121">Réécriture de redirection d’URL et l’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-121">URL redirect and URL rewrite</span></span>
<span data-ttu-id="ad4ba-122">La différence dans la formulation entre *redirection d’URL* et *réécriture d’URL* peut sembler subtiles au premier mais a des implications importantes pour fournir des ressources pour les clients.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-122">The difference in wording between *URL redirect* and *URL rewrite* may seem subtle at first but has important implications for providing resources to clients.</span></span> <span data-ttu-id="ad4ba-123">Intergiciel (middleware) d’ASP.NET Core URL réécriture est capable de répondre la nécessité pour les deux.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-123">ASP.NET Core's URL Rewriting Middleware is capable of meeting the need for both.</span></span>

<span data-ttu-id="ad4ba-124">A *redirection d’URL* est une opération côté client, où il est invité à accéder à une ressource à une autre adresse.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-124">A *URL redirect* is a client-side operation, where the client is instructed to access a resource at another address.</span></span> <span data-ttu-id="ad4ba-125">Cela requiert un aller-retour vers le serveur, et l’URL de redirection retournée au client apparaît dans la barre d’adresses du navigateur lorsque le client envoie une nouvelle requête pour la ressource.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-125">This requires a round-trip to the server, and the redirect URL returned to the client appears in the browser's address bar when the client makes a new request for the resource.</span></span> <span data-ttu-id="ad4ba-126">Si `/resource` est *redirigé* à `/different-resource`, les demandes des clients `/resource`, et le serveur répond que le client doit obtenir la ressource au `/different-resource` avec un code d’état qui indique que la redirection est temporaire ou permanent.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-126">If `/resource` is *redirected* to `/different-resource`, the client requests `/resource`, and the server responds that the client should obtain the resource at `/different-resource` with a status code indicating that the redirect is either temporary or permanent.</span></span> <span data-ttu-id="ad4ba-127">Le client exécute une nouvelle demande de la ressource à l’URL de redirection.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-127">The client executes a new request for the resource at the redirect URL.</span></span>

![Un point de terminaison de service WebAPI a été modifié temporairement de la version 1 (v1) vers la version 2 (v2) sur le serveur.](url-rewriting/_static/url_redirect.png)

<span data-ttu-id="ad4ba-133">Lors de la redirection des demandes vers une URL différente, vous indiquez si la redirection est permanente ou temporaire.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-133">When redirecting requests to a different URL, you indicate whether the redirect is permanent or temporary.</span></span> <span data-ttu-id="ad4ba-134">Le code d’état (déplacé définitivement) 301 sert à indiquer au client que toutes les futures demandes pour la ressource doivent utiliser la nouvelle URL où la ressource a une nouvelle URL permanente et que vous souhaitez.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-134">The 301 (Moved Permanently) status code is used where the resource has a new, permanent URL and you wish to instruct the client that all future requests for the resource should use the new URL.</span></span> <span data-ttu-id="ad4ba-135">*Le client peut mettre en cache la réponse lors de la réception d’un code de 301 état.*</span><span class="sxs-lookup"><span data-stu-id="ad4ba-135">*The client may cache the response when a 301 status code is received.*</span></span> <span data-ttu-id="ad4ba-136">Le code d’état 302 (trouvé) est utilisé lorsque la redirection est temporaire ou généralement l’objet à modifier, de sorte que le client ne doit pas stocker et réutiliser l’URL de redirection dans le futur.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-136">The 302 (Found) status code is used where the redirection is temporary or generally subject to change, such that the client shouldn't store and reuse the redirect URL in the future.</span></span> <span data-ttu-id="ad4ba-137">Pour plus d’informations, consultez [le document RFC 2616 : définitions de Code d’état](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-137">For more information, see [RFC 2616: Status Code Definitions](https://www.w3.org/Protocols/rfc2616/rfc2616-sec10.html).</span></span>

<span data-ttu-id="ad4ba-138">A *réécriture d’URL* est une opération côté serveur pour fournir une ressource à partir d’une adresse de ressources différent.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-138">A *URL rewrite* is a server-side operation to provide a resource from a different resource address.</span></span> <span data-ttu-id="ad4ba-139">Réécriture d’URL ne nécessite pas un aller-retour au serveur.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-139">Rewriting a URL doesn't require a round-trip to the server.</span></span> <span data-ttu-id="ad4ba-140">L’URL réécrite n’est pas retourné au client et n’apparaître pas dans la barre d’adresses du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-140">The rewritten URL isn't returned to the client and won't appear in the browser's address bar.</span></span> <span data-ttu-id="ad4ba-141">Lorsque `/resource` est *réécrit* à `/different-resource`, les demandes des clients `/resource`et le serveur *en interne* extrait la ressource au `/different-resource`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-141">When `/resource` is *rewritten* to `/different-resource`, the client requests `/resource`, and the server *internally* fetches the resource at `/different-resource`.</span></span> <span data-ttu-id="ad4ba-142">Bien que le client peut être en mesure de récupérer la ressource à l’URL réécrite, le client ne sera pas informé que la ressource existe à l’URL réécrite lorsqu’il effectue sa demande et reçoit la réponse.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-142">Although the client might be able to retrieve the resource at the rewritten URL, the client won't be informed that the resource exists at the rewritten URL when it makes its request and receives the response.</span></span>

![Un point de terminaison de service WebAPI a été modifié à partir de la version 1 (v1) vers la version 2 (v2) sur le serveur.](url-rewriting/_static/url_rewrite.png)

## <a name="url-rewriting-sample-app"></a><span data-ttu-id="ad4ba-147">URL réécriture exemple d’application</span><span class="sxs-lookup"><span data-stu-id="ad4ba-147">URL rewriting sample app</span></span>
<span data-ttu-id="ad4ba-148">Vous pouvez explorer les fonctionnalités de l’intergiciel de réécriture d’URL avec le [URL réécriture exemple d’application](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-148">You can explore the features of the URL Rewriting Middleware with the [URL rewriting sample app](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/url-rewriting/samples/).</span></span> <span data-ttu-id="ad4ba-149">L’application s’applique la réécriture et règles de redirection et affiche l’URL réécrite ou redirigée.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-149">The app applies rewrite and redirect rules and shows the rewritten or redirected URL.</span></span>

## <a name="when-to-use-url-rewriting-middleware"></a><span data-ttu-id="ad4ba-150">Quand utiliser le Middleware de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-150">When to use URL Rewriting Middleware</span></span>
<span data-ttu-id="ad4ba-151">Utiliser le Middleware de réécriture d’URL lorsque vous ne pouvez pas utiliser le [module de réécriture d’URL](https://www.iis.net/downloads/microsoft/url-rewrite) avec IIS sur Windows Server, le [module mod_rewrite d’Apache](https://httpd.apache.org/docs/2.4/rewrite/) sur serveur Apache, [réécriture d’URL sur Nginx](https://www.nginx.com/blog/creating-nginx-rewrite-rules/), ou si votre application est hébergée sur [serveur HTTP.sys](xref:fundamentals/servers/httpsys) (anciennement appelé [WebListener](xref:fundamentals/servers/weblistener)).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-151">Use URL Rewriting Middleware when you are unable to use the [URL Rewrite module](https://www.iis.net/downloads/microsoft/url-rewrite) with IIS on Windows Server, the [Apache mod_rewrite module](https://httpd.apache.org/docs/2.4/rewrite/) on Apache Server, [URL rewriting on Nginx](https://www.nginx.com/blog/creating-nginx-rewrite-rules/), or your app is hosted on [HTTP.sys server](xref:fundamentals/servers/httpsys) (formerly called [WebListener](xref:fundamentals/servers/weblistener)).</span></span> <span data-ttu-id="ad4ba-152">Les principales raisons d’utiliser l’URL réécriture technologies serveur dans IIS, Apache ou Nginx sont que l’intergiciel (middleware) ne prend pas en charge toutes les fonctionnalités de ces modules et les performances de l’intergiciel (middleware) probablement ne sera pas correspondre à celui des modules.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-152">The main reasons to use the server-based URL rewriting technologies in IIS, Apache, or Nginx are that the middleware doesn't support the full features of these modules and the performance of the middleware probably won't match that of the modules.</span></span> <span data-ttu-id="ad4ba-153">Il existe toutefois certaines fonctionnalités des modules de serveur ne fonctionnent pas avec les projets ASP.NET Core, telles que la `IsFile` et `IsDirectory` contraintes du module de réécriture d’IIS.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-153">However, there are some features of the server modules that don't work with ASP.NET Core projects, such as the `IsFile` and `IsDirectory` constraints of the IIS Rewrite module.</span></span> <span data-ttu-id="ad4ba-154">Dans ces scénarios, utilisez plutôt l’intergiciel (middleware).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-154">In these scenarios, use the middleware instead.</span></span>

## <a name="package"></a><span data-ttu-id="ad4ba-155">Package</span><span class="sxs-lookup"><span data-stu-id="ad4ba-155">Package</span></span>
<span data-ttu-id="ad4ba-156">Pour inclure l’intergiciel (middleware) dans votre projet, ajoutez une référence à la [ `Microsoft.AspNetCore.Rewrite` ](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite/) package.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-156">To include the middleware in your project, add a reference to the [`Microsoft.AspNetCore.Rewrite`](https://www.nuget.org/packages/Microsoft.AspNetCore.Rewrite/) package.</span></span> <span data-ttu-id="ad4ba-157">Cette fonctionnalité est disponible pour les applications qui ciblent ASP.NET Core 1.1 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-157">This feature is available for apps that target ASP.NET Core 1.1 or later.</span></span>

## <a name="extension-and-options"></a><span data-ttu-id="ad4ba-158">Extension et options</span><span class="sxs-lookup"><span data-stu-id="ad4ba-158">Extension and options</span></span>
<span data-ttu-id="ad4ba-159">Établir votre réécriture d’URL et de rediriger les règles en créant une instance de la `RewriteOptions` classe avec des méthodes d’extension pour chacun de vos règles.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-159">Establish your URL rewrite and redirect rules by creating an instance of the `RewriteOptions` class with extension methods for each of your rules.</span></span> <span data-ttu-id="ad4ba-160">Chaîner plusieurs règles dans l’ordre que vous souhaitez transformer.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-160">Chain multiple rules in the order that you would like them processed.</span></span> <span data-ttu-id="ad4ba-161">Le `RewriteOptions` sont passés dans l’intergiciel de réécriture d’URL lorsqu’elle est ajoutée au pipeline de demande avec `app.UseRewriter(options);`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-161">The `RewriteOptions` are passed into the URL Rewriting Middleware as it's added to the request pipeline with `app.UseRewriter(options);`.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-162">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-162">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-163">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-163">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1)]

---

### <a name="url-redirect"></a><span data-ttu-id="ad4ba-164">Redirection d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-164">URL redirect</span></span>
<span data-ttu-id="ad4ba-165">Utilisez `AddRedirect` pour rediriger les demandes.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-165">Use `AddRedirect` to redirect requests.</span></span> <span data-ttu-id="ad4ba-166">Le premier paramètre contient votre expression régulière pour la correspondance sur le chemin d’accès de l’URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-166">The first parameter contains your regex for matching on the path of the incoming URL.</span></span> <span data-ttu-id="ad4ba-167">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-167">The second parameter is the replacement string.</span></span> <span data-ttu-id="ad4ba-168">Le troisième paramètre, s’il est présent, spécifie le code d’état.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-168">The third parameter, if present, specifies the status code.</span></span> <span data-ttu-id="ad4ba-169">Si vous ne spécifiez pas le code d’état, la valeur par défaut 302 (trouvé), ce qui indique que la ressource est temporairement déplacée ou remplacée.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-169">If you don't specify the status code, it defaults to 302 (Found), which indicates that the resource is temporarily moved or replaced.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-170">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-170">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=5)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-171">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-171">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=2)]

---

<span data-ttu-id="ad4ba-172">Dans un navigateur avec des outils de développement activé, faire une demande à l’exemple d’application avec le chemin d’accès `/redirect-rule/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-172">In a browser with developer tools enabled, make a request to the sample app with the path `/redirect-rule/1234/5678`.</span></span> <span data-ttu-id="ad4ba-173">L’expression régulière correspond au chemin de la demande sur `redirect-rule/(.*)`, et le chemin d’accès est remplacé par `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-173">The regex matches the request path on `redirect-rule/(.*)`, and the path is replaced with `/redirected/1234/5678`.</span></span> <span data-ttu-id="ad4ba-174">La redirection des URL est envoyée au client avec un code d’état 302 (trouvé).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-174">The redirect URL is sent back to the client with a 302 (Found) status code.</span></span> <span data-ttu-id="ad4ba-175">Le navigateur envoie une nouvelle demande à l’URL de redirection, qui apparaît dans la barre d’adresses du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-175">The browser makes a new request at the redirect URL, which appears in the browser's address bar.</span></span> <span data-ttu-id="ad4ba-176">Dans la mesure où aucune règle dans l’exemple d’application ne correspond à l’URL de redirection, la deuxième demande reçoit la réponse 200 (OK) à partir de l’application et le corps de la réponse indique l’URL de redirection.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-176">Since no rules in the sample app match on the redirect URL, the second request receives a 200 (OK) response from the app and the body of the response shows the redirect URL.</span></span> <span data-ttu-id="ad4ba-177">Un aller-retour vers le serveur lorsqu’une URL est *redirigé*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-177">A roundtrip is made to the server when a URL is *redirected*.</span></span>

> [!WARNING]
> <span data-ttu-id="ad4ba-178">Soyez prudent lors de l’établissement de vos règles de redirection.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-178">Be cautious when establishing your redirect rules.</span></span> <span data-ttu-id="ad4ba-179">Vos règles de redirection sont évaluées à chaque demande à l’application, y compris après une redirection.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-179">Your redirect rules are evaluated on each request to the app, including after a redirect.</span></span> <span data-ttu-id="ad4ba-180">Il est facile d’accidentellement une boucle de redirection infinie.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-180">It's easy to accidently create a loop of infinite redirects.</span></span>

<span data-ttu-id="ad4ba-181">Demande d’origine :`/redirect-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-181">Original Request: `/redirect-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses de suivi](url-rewriting/_static/add_redirect.png)

<span data-ttu-id="ad4ba-183">La partie de l’expression entre parenthèses est appelée un *groupe de capture*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-183">The part of the expression contained within parentheses is called a *capture group*.</span></span> <span data-ttu-id="ad4ba-184">Le point (`.`) de l’expression signifie *correspond à n’importe quel caractère*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-184">The dot (`.`) of the expression means *match any character*.</span></span> <span data-ttu-id="ad4ba-185">L’astérisque (`*`) indique *correspond au caractère précédent zéro ou plusieurs fois*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-185">The asterisk (`*`) indicates *match the preceding character zero or more times*.</span></span> <span data-ttu-id="ad4ba-186">Par conséquent, les segments de chemin de deux derniers accès de l’URL, `1234/5678`, sont capturées par le groupe de capture `(.*)`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-186">Therefore, the last two path segments of the URL, `1234/5678`, are captured by capture group `(.*)`.</span></span> <span data-ttu-id="ad4ba-187">Toute valeur fournie dans l’URL de demande après `redirect-rule/` est capturé par ce groupe de capture unique.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-187">Any value you provide in the request URL after `redirect-rule/` is captured by this single capture group.</span></span>

<span data-ttu-id="ad4ba-188">Dans la chaîne de remplacement, les groupes capturés sont injectées dans la chaîne avec le signe dollar (`$`) suivi du numéro de séquence de la capture.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-188">In the replacement string, captured groups are injected into the string with the dollar sign (`$`) followed by the sequence number of the capture.</span></span> <span data-ttu-id="ad4ba-189">La première valeur de groupe de capture est obtenue avec `$1`, le second avec `$2`, ils continuent de séquence pour les groupes de capture dans votre expression régulière.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-189">The first capture group value is obtained with `$1`, the second with `$2`, and they continue in sequence for the capture groups in your regex.</span></span> <span data-ttu-id="ad4ba-190">Il est uniquement un groupe capturé dans l’expression régulière règle de redirection dans l’exemple d’application, qu’un seul groupe injecté dans la chaîne de remplacement, qui est `$1`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-190">There's only one captured group in the redirect rule regex in the sample app, so there's only one injected group in the replacement string, which is `$1`.</span></span> <span data-ttu-id="ad4ba-191">Lorsque la règle est appliquée, l’URL devient `/redirected/1234/5678`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-191">When the rule is applied, the URL becomes `/redirected/1234/5678`.</span></span>

<a name="url-redirect-to-secure-endpoint"></a>
### <a name="url-redirect-to-a-secure-endpoint"></a><span data-ttu-id="ad4ba-192">Redirection d’URL à un point de terminaison sécurisé</span><span class="sxs-lookup"><span data-stu-id="ad4ba-192">URL redirect to a secure endpoint</span></span>
<span data-ttu-id="ad4ba-193">Utilisez `AddRedirectToHttps` pour rediriger les demandes HTTP vers le même hôte et le chemin d’accès à l’aide de HTTPS (`https://`).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-193">Use `AddRedirectToHttps` to redirect HTTP requests to the same host and path using HTTPS (`https://`).</span></span> <span data-ttu-id="ad4ba-194">Si le code d’état n’est pas fourni, la valeur de l’intergiciel (middleware) par défaut 302 (trouvé).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-194">If the status code isn't supplied, the middleware defaults to 302 (Found).</span></span> <span data-ttu-id="ad4ba-195">Si le port n’est pas fourni, l’intergiciel (middleware) par défaut est `null`, ce qui signifie que le protocole modifie à `https://` et le client accède à la ressource sur le port 443.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-195">If the port isn't supplied, the middleware defaults to `null`, which means the protocol changes to `https://` and the client accesses the resource on port 443.</span></span> <span data-ttu-id="ad4ba-196">L’exemple montre comment définir le code d’état à partir de 301 (déplacé définitivement) et modifiez le port à 5001.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-196">The example shows how to set the status code to 301 (Moved Permanently) and change the port to 5001.</span></span>
```csharp
var options = new RewriteOptions()
    .AddRedirectToHttps(301, 5001);

app.UseRewriter(options);
```
<span data-ttu-id="ad4ba-197">Utilisez `AddRedirectToHttpsPermanent` pour rediriger les demandes non sécurisées vers le même hôte et le chemin d’accès avec le protocole HTTPS sécurisé (`https://` sur le port 443).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-197">Use `AddRedirectToHttpsPermanent` to redirect insecure requests to the same host and path with secure HTTPS protocol (`https://` on port 443).</span></span> <span data-ttu-id="ad4ba-198">L’intergiciel (middleware) définit le code d’état à partir de 301 (déplacé définitivement).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-198">The middleware sets the status code to 301 (Moved Permanently).</span></span>

<span data-ttu-id="ad4ba-199">L’exemple d’application est capable de montrant comment utiliser `AddRedirectToHttps` ou `AddRedirectToHttpsPermanent`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-199">The sample app is capable of demonstrating how to use `AddRedirectToHttps` or `AddRedirectToHttpsPermanent`.</span></span> <span data-ttu-id="ad4ba-200">Ajoutez la méthode d’extension pour le `RewriteOptions`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-200">Add the extension method to the `RewriteOptions`.</span></span> <span data-ttu-id="ad4ba-201">Effectuer une demande non sécurisée à l’application à n’importe quelle URL.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-201">Make an insecure request to the app at any URL.</span></span> <span data-ttu-id="ad4ba-202">Ignorer l’avertissement que le certificat auto-signé n’est pas fiable de sécurité de navigateur.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-202">Dismiss the browser security warning that the self-signed certificate is untrusted.</span></span>

<span data-ttu-id="ad4ba-203">Demande d’origine à l’aide `AddRedirectToHttps(301, 5001)`:`/secure`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-203">Original Request using `AddRedirectToHttps(301, 5001)`: `/secure`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses de suivi](url-rewriting/_static/add_redirect_to_https.png)

<span data-ttu-id="ad4ba-205">Demande d’origine à l’aide `AddRedirectToHttpsPermanent`:`/secure`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-205">Original Request using `AddRedirectToHttpsPermanent`: `/secure`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses de suivi](url-rewriting/_static/add_redirect_to_https_permanent.png)

### <a name="url-rewrite"></a><span data-ttu-id="ad4ba-207">Réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-207">URL rewrite</span></span>
<span data-ttu-id="ad4ba-208">Utilisez `AddRewrite` pour créer une règle de réécriture d’URL.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-208">Use `AddRewrite` to create a rule for rewriting URLs.</span></span> <span data-ttu-id="ad4ba-209">Le premier paramètre contient votre expression régulière pour la correspondance sur le chemin d’accès URL entrante.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-209">The first parameter contains your regex for matching on the incoming URL path.</span></span> <span data-ttu-id="ad4ba-210">Le deuxième paramètre est la chaîne de remplacement.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-210">The second parameter is the replacement string.</span></span> <span data-ttu-id="ad4ba-211">Le troisième paramètre, `skipRemainingRules: {true|false}`, indique à l’intergiciel (middleware) ou non ignorer les règles de réécriture supplémentaires si la règle actuelle est appliquée.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-211">The third parameter, `skipRemainingRules: {true|false}`, indicates to the middleware whether or not to skip additional rewrite rules if the current rule is applied.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-212">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-212">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=6)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-213">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-213">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=3)]

---

<span data-ttu-id="ad4ba-214">Demande d’origine :`/rewrite-rule/1234/5678`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-214">Original Request: `/rewrite-rule/1234/5678`</span></span>

![Fenêtre de navigateur avec des outils de développement le suivi de la demande et réponse](url-rewriting/_static/add_rewrite.png)

<span data-ttu-id="ad4ba-216">La première chose que vous remarquerez dans l’expression régulière est le premier (`^`) au début de l’expression.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-216">The first thing you notice in the regex is the carat (`^`) at the beginning of the expression.</span></span> <span data-ttu-id="ad4ba-217">Cela signifie que correspondance commence au début du chemin d’accès d’URL.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-217">This means that matching starts at the beginning of the URL path.</span></span>

<span data-ttu-id="ad4ba-218">Dans l’exemple précédent avec la règle de redirection, `redirect-rule/(.*)`, il n’existe aucun premier au début de l’expression régulière ; par conséquent, peuvent précéder tous les caractères `redirect-rule/` dans le chemin d’accès pour une correspondance réussie.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-218">In the earlier example with the redirect rule, `redirect-rule/(.*)`, there's no carat at the start of the regex; therefore, any characters may precede `redirect-rule/` in the path for a successful match.</span></span>

| <span data-ttu-id="ad4ba-219">Chemin d’accès</span><span class="sxs-lookup"><span data-stu-id="ad4ba-219">Path</span></span>                               | <span data-ttu-id="ad4ba-220">Faire correspondre à</span><span class="sxs-lookup"><span data-stu-id="ad4ba-220">Match</span></span> |
| ---------------------------------- | :---: |
| `/redirect-rule/1234/5678`         | <span data-ttu-id="ad4ba-221">Oui</span><span class="sxs-lookup"><span data-stu-id="ad4ba-221">Yes</span></span>   |
| `/my-cool-redirect-rule/1234/5678` | <span data-ttu-id="ad4ba-222">Oui</span><span class="sxs-lookup"><span data-stu-id="ad4ba-222">Yes</span></span>   |
| `/anotherredirect-rule/1234/5678`  | <span data-ttu-id="ad4ba-223">Oui</span><span class="sxs-lookup"><span data-stu-id="ad4ba-223">Yes</span></span>   |

<span data-ttu-id="ad4ba-224">La règle de réécriture, `^rewrite-rule/(\d+)/(\d+)`, correspond uniquement aux chemins d’accès s’ils démarrent avec `rewrite-rule/`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-224">The rewrite rule, `^rewrite-rule/(\d+)/(\d+)`, only matches paths if they start with `rewrite-rule/`.</span></span> <span data-ttu-id="ad4ba-225">Notez la différence dans la correspondance entre la règle de réécriture ci-dessous et la règle de redirection ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-225">Notice the difference in matching between the rewrite rule below and the redirect rule above.</span></span>

| <span data-ttu-id="ad4ba-226">Chemin d’accès</span><span class="sxs-lookup"><span data-stu-id="ad4ba-226">Path</span></span>                              | <span data-ttu-id="ad4ba-227">Faire correspondre à</span><span class="sxs-lookup"><span data-stu-id="ad4ba-227">Match</span></span> |
| --------------------------------- | :---: |
| `/rewrite-rule/1234/5678`         | <span data-ttu-id="ad4ba-228">Oui</span><span class="sxs-lookup"><span data-stu-id="ad4ba-228">Yes</span></span>   |
| `/my-cool-rewrite-rule/1234/5678` | <span data-ttu-id="ad4ba-229">Non</span><span class="sxs-lookup"><span data-stu-id="ad4ba-229">No</span></span>    |
| `/anotherrewrite-rule/1234/5678`  | <span data-ttu-id="ad4ba-230">Non</span><span class="sxs-lookup"><span data-stu-id="ad4ba-230">No</span></span>    |

<span data-ttu-id="ad4ba-231">Suivant le `^rewrite-rule/` partie de l’expression, il existe deux groupes de capture, `(\d+)/(\d+)`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-231">Following the `^rewrite-rule/` portion of the expression, there are two capture groups, `(\d+)/(\d+)`.</span></span> <span data-ttu-id="ad4ba-232">Le `\d` signifie *correspond à un chiffre (nombre)*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-232">The `\d` signifies *match a digit (number)*.</span></span> <span data-ttu-id="ad4ba-233">Le signe plus (`+`) signifie *correspond à un ou plusieurs au caractère précédent*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-233">The plus sign (`+`) means *match one or more of the preceding character*.</span></span> <span data-ttu-id="ad4ba-234">Par conséquent, l’URL doit contenir un nombre suivi d’une oblique suivie d’un autre nombre.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-234">Therefore, the URL must contain a number followed by a forward-slash followed by another number.</span></span> <span data-ttu-id="ad4ba-235">Ces groupes sont injectées dans l’URL réécrite en tant que la capture `$1` et `$2`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-235">These capture groups are injected into the rewritten URL as `$1` and `$2`.</span></span> <span data-ttu-id="ad4ba-236">La chaîne de remplacement de règle de réécriture place les groupes capturés dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-236">The rewrite rule replacement string places the captured groups into the querystring.</span></span> <span data-ttu-id="ad4ba-237">Le chemin d’accès demandé de `/rewrite-rule/1234/5678` est réécrite pour obtenir la ressource au `/rewritten?var1=1234&var2=5678`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-237">The requested path of `/rewrite-rule/1234/5678` is rewritten to obtain the resource at `/rewritten?var1=1234&var2=5678`.</span></span> <span data-ttu-id="ad4ba-238">Si une chaîne de requête est présent dans la demande d’origine, il est conservé lors de l’URL est réécrite.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-238">If a querystring is present on the original request, it's preserved when the URL is rewritten.</span></span>

<span data-ttu-id="ad4ba-239">Il n’existe aucun aller-retour vers le serveur pour obtenir la ressource.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-239">There's no roundtrip to the server to obtain the resource.</span></span> <span data-ttu-id="ad4ba-240">Si la ressource existe, il a extraite et retournée au client avec un code d’état du 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-240">If the resource exists, it's fetched and returned to the client with a 200 (OK) status code.</span></span> <span data-ttu-id="ad4ba-241">Étant donné que le client n’est pas redirigé, l’URL dans la barre d’adresse de navigateur ne change pas.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-241">Because the client isn't redirected, the URL in the browser address bar doesn't change.</span></span> <span data-ttu-id="ad4ba-242">Comme le client est concerné, l’opération de réécriture d’URL ne s’est produite.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-242">As far as the client is concerned, the URL rewrite operation never occurred.</span></span>

> [!NOTE]
> <span data-ttu-id="ad4ba-243">Utilisez `skipRemainingRules: true` autant que possible, car les règles de correspondance est un processus coûteux et réduit le temps de réponse d’application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-243">Use `skipRemainingRules: true` whenever possible, because matching rules is an expensive process and reduces app response time.</span></span> <span data-ttu-id="ad4ba-244">Pour la réponse plus rapide de l’application :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-244">For the fastest app response:</span></span>
> * <span data-ttu-id="ad4ba-245">Commande vos règles de réécriture de la règle de mise en correspondance plus fréquemment à la règle de mise en correspondance moins fréquemment.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-245">Order your rewrite rules from the most frequently matched rule to the least frequently matched rule.</span></span>
> * <span data-ttu-id="ad4ba-246">Ignorer le traitement des règles restantes lorsqu’une correspondance est trouvée et aucun traitement de la règle supplémentaire n’est requis.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-246">Skip the processing of the remaining rules when a match occurs and no additional rule processing is required.</span></span>

### <a name="apache-modrewrite"></a><span data-ttu-id="ad4ba-247">Mod_rewrite d’Apache</span><span class="sxs-lookup"><span data-stu-id="ad4ba-247">Apache mod_rewrite</span></span>
<span data-ttu-id="ad4ba-248">Appliquer des règles de mod_rewrite Apache avec `AddApacheModRewrite`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-248">Apply Apache mod_rewrite rules with `AddApacheModRewrite`.</span></span> <span data-ttu-id="ad4ba-249">Assurez-vous que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-249">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ad4ba-250">Pour plus d’informations et des exemples de règles de mod_rewrite, consultez [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-250">For more information and examples of mod_rewrite rules, see [Apache mod_rewrite](https://httpd.apache.org/docs/2.4/rewrite/).</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-251">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-251">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="ad4ba-252">A `StreamReader` est utilisé pour lire les règles à partir de la *ApacheModRewrite.txt* fichier de règles.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-252">A `StreamReader` is used to read the rules from the *ApacheModRewrite.txt* rules file.</span></span>

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=1,7)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-253">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-253">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="ad4ba-254">Le premier paramètre prend une `IFileProvider`, qui est fourni [Injection de dépendance](dependency-injection.md).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-254">The first parameter takes an `IFileProvider`, which is provided via [Dependency Injection](dependency-injection.md).</span></span> <span data-ttu-id="ad4ba-255">Le `IHostingEnvironment` est injecté pour fournir le `ContentRootFileProvider`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-255">The `IHostingEnvironment` is injected to provide the `ContentRootFileProvider`.</span></span> <span data-ttu-id="ad4ba-256">Le deuxième paramètre est le chemin d’accès à votre fichier de règles, qui est *ApacheModRewrite.txt* dans l’exemple d’application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-256">The second parameter is the path to your rules file, which is *ApacheModRewrite.txt* in the sample app.</span></span>

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=4)]

---

<span data-ttu-id="ad4ba-257">L’exemple d’application redirige les demandes de `/apache-mod-rules-redirect/(.\*)` à `/redirected?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-257">The sample app redirects requests from `/apache-mod-rules-redirect/(.\*)` to `/redirected?id=$1`.</span></span> <span data-ttu-id="ad4ba-258">Le code d’état de réponse est 302 (trouvé).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-258">The response status code is 302 (Found).</span></span>

[!code[Main](url-rewriting/samples/2.x/ApacheModRewrite.txt)]

<span data-ttu-id="ad4ba-259">Demande d’origine :`/apache-mod-rules-redirect/1234`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-259">Original Request: `/apache-mod-rules-redirect/1234`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses de suivi](url-rewriting/_static/add_apache_mod_redirect.png)

##### <a name="supported-server-variables"></a><span data-ttu-id="ad4ba-261">Variables de serveur pris en charge</span><span class="sxs-lookup"><span data-stu-id="ad4ba-261">Supported server variables</span></span>
<span data-ttu-id="ad4ba-262">L’intergiciel (middleware) prend en charge les variables de serveur Apache mod_rewrite suivantes :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-262">The middleware supports the following Apache mod_rewrite server variables:</span></span>
* <span data-ttu-id="ad4ba-263">CONN_REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-263">CONN_REMOTE_ADDR</span></span>
* <span data-ttu-id="ad4ba-264">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-264">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ad4ba-265">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ad4ba-265">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ad4ba-266">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ad4ba-266">HTTP_COOKIE</span></span>
* <span data-ttu-id="ad4ba-267">HTTP_FORWARDED</span><span class="sxs-lookup"><span data-stu-id="ad4ba-267">HTTP_FORWARDED</span></span>
* <span data-ttu-id="ad4ba-268">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ad4ba-268">HTTP_HOST</span></span>
* <span data-ttu-id="ad4ba-269">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ad4ba-269">HTTP_REFERER</span></span>
* <span data-ttu-id="ad4ba-270">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-270">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ad4ba-271">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ad4ba-271">HTTPS</span></span>
* <span data-ttu-id="ad4ba-272">IPV6</span><span class="sxs-lookup"><span data-stu-id="ad4ba-272">IPV6</span></span>
* <span data-ttu-id="ad4ba-273">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ad4ba-273">QUERY_STRING</span></span>
* <span data-ttu-id="ad4ba-274">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-274">REMOTE_ADDR</span></span>
* <span data-ttu-id="ad4ba-275">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-275">REMOTE_PORT</span></span>
* <span data-ttu-id="ad4ba-276">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ad4ba-276">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ad4ba-277">REQUEST_METHOD</span><span class="sxs-lookup"><span data-stu-id="ad4ba-277">REQUEST_METHOD</span></span>
* <span data-ttu-id="ad4ba-278">REQUEST_SCHEME</span><span class="sxs-lookup"><span data-stu-id="ad4ba-278">REQUEST_SCHEME</span></span>
* <span data-ttu-id="ad4ba-279">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ad4ba-279">REQUEST_URI</span></span>
* <span data-ttu-id="ad4ba-280">SCRIPT_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ad4ba-280">SCRIPT_FILENAME</span></span>
* <span data-ttu-id="ad4ba-281">SERVER_ADDR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-281">SERVER_ADDR</span></span>
* <span data-ttu-id="ad4ba-282">SERVER_PORT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-282">SERVER_PORT</span></span>
* <span data-ttu-id="ad4ba-283">SERVER_PROTOCOL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-283">SERVER_PROTOCOL</span></span>
* <span data-ttu-id="ad4ba-284">HEURE</span><span class="sxs-lookup"><span data-stu-id="ad4ba-284">TIME</span></span>
* <span data-ttu-id="ad4ba-285">TIME_DAY</span><span class="sxs-lookup"><span data-stu-id="ad4ba-285">TIME_DAY</span></span>
* <span data-ttu-id="ad4ba-286">TIME_HOUR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-286">TIME_HOUR</span></span>
* <span data-ttu-id="ad4ba-287">TIME_MIN</span><span class="sxs-lookup"><span data-stu-id="ad4ba-287">TIME_MIN</span></span>
* <span data-ttu-id="ad4ba-288">TIME_MON</span><span class="sxs-lookup"><span data-stu-id="ad4ba-288">TIME_MON</span></span>
* <span data-ttu-id="ad4ba-289">TIME_SEC</span><span class="sxs-lookup"><span data-stu-id="ad4ba-289">TIME_SEC</span></span>
* <span data-ttu-id="ad4ba-290">TIME_WDAY</span><span class="sxs-lookup"><span data-stu-id="ad4ba-290">TIME_WDAY</span></span>
* <span data-ttu-id="ad4ba-291">TIME_YEAR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-291">TIME_YEAR</span></span>

### <a name="iis-url-rewrite-module-rules"></a><span data-ttu-id="ad4ba-292">Règles du Module de réécriture d’URL IIS</span><span class="sxs-lookup"><span data-stu-id="ad4ba-292">IIS URL Rewrite Module rules</span></span>
<span data-ttu-id="ad4ba-293">Pour utiliser les règles qui s’appliquent pour le Module de réécriture d’URL IIS, utilisez `AddIISUrlRewrite`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-293">To use rules that apply to the IIS URL Rewrite Module, use `AddIISUrlRewrite`.</span></span> <span data-ttu-id="ad4ba-294">Assurez-vous que le fichier de règles est déployé avec l’application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-294">Make sure that the rules file is deployed with the app.</span></span> <span data-ttu-id="ad4ba-295">Ne pas diriger l’intergiciel (middleware) à utiliser votre *web.config* fichier lors de l’exécution sur Windows Server IIS.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-295">Don't direct the middleware to use your *web.config* file when running on Windows Server IIS.</span></span> <span data-ttu-id="ad4ba-296">Avec IIS, ces règles doivent être stockées en dehors de votre *web.config* pour éviter les conflits avec le module de réécriture d’IIS.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-296">With IIS, these rules should be stored outside of your *web.config* to avoid conflicts with the IIS Rewrite module.</span></span> <span data-ttu-id="ad4ba-297">Pour plus d’informations et des exemples de règles du Module de réécriture d’URL IIS, consultez [à l’aide de réécriture d’Url Module 2.0](https://docs.microsoft.com/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) et [référence de Configuration de Module de réécriture de URL](https://docs.microsoft.com/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-297">For more information and examples of IIS URL Rewrite Module rules, see [Using Url Rewrite Module 2.0](https://docs.microsoft.com/iis/extensions/url-rewrite-module/using-url-rewrite-module-20) and [URL Rewrite Module Configuration Reference](https://docs.microsoft.com/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference).</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-298">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-298">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="ad4ba-299">A `StreamReader` est utilisé pour lire les règles à partir de la *IISUrlRewrite.xml* fichier de règles.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-299">A `StreamReader` is used to read the rules from the *IISUrlRewrite.xml* rules file.</span></span>

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=2,8)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-300">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-300">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="ad4ba-301">Le premier paramètre prend une `IFileProvider`, tandis que le deuxième paramètre est le chemin d’accès à votre fichier de règles XML, qui est *IISUrlRewrite.xml* dans l’exemple d’application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-301">The first parameter takes an `IFileProvider`, while the second parameter is the path to your XML rules file, which is *IISUrlRewrite.xml* in the sample app.</span></span>

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=5)]

---

<span data-ttu-id="ad4ba-302">L’exemple d’application réécrit les demandes de `/iis-rules-rewrite/(.*)` à `/rewritten?id=$1`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-302">The sample app rewrites requests from `/iis-rules-rewrite/(.*)` to `/rewritten?id=$1`.</span></span> <span data-ttu-id="ad4ba-303">La réponse est envoyée au client avec un code d’état 200 (OK).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-303">The response is sent to the client with a 200 (OK) status code.</span></span>

[!code-xml[Main](url-rewriting/samples/2.x/IISUrlRewrite.xml)]

<span data-ttu-id="ad4ba-304">Demande d’origine :`/iis-rules-rewrite/1234`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-304">Original Request: `/iis-rules-rewrite/1234`</span></span>

![Fenêtre de navigateur avec des outils de développement le suivi de la demande et réponse](url-rewriting/_static/add_iis_url_rewrite.png)

<span data-ttu-id="ad4ba-306">Si vous avez un Module de réécriture IIS active avec des règles au niveau du serveur configurés qui auraient un impact sur votre application de façons indésirables, vous pouvez désactiver le Module de réécriture IIS pour une application.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-306">If you have an active IIS Rewrite Module with server-level rules configured that would impact your app in undesirable ways, you can disable the IIS Rewrite Module for an app.</span></span> <span data-ttu-id="ad4ba-307">Pour plus d’informations, consultez [modules IIS de la désactivation de](xref:hosting/iis-modules#disabling-iis-modules).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-307">For more information, see [Disabling IIS modules](xref:hosting/iis-modules#disabling-iis-modules).</span></span>

#### <a name="unsupported-features"></a><span data-ttu-id="ad4ba-308">Fonctionnalités prises en charge</span><span class="sxs-lookup"><span data-stu-id="ad4ba-308">Unsupported features</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-309">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-309">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="ad4ba-310">L’intergiciel (middleware) publié avec ASP.NET Core 2.x ne prend pas en charge les fonctionnalités de Module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-310">The middleware released with ASP.NET Core 2.x doesn't support the following IIS URL Rewrite Module features:</span></span>
* <span data-ttu-id="ad4ba-311">Règles de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="ad4ba-311">Outbound Rules</span></span>
* <span data-ttu-id="ad4ba-312">Variables de serveur personnalisé</span><span class="sxs-lookup"><span data-stu-id="ad4ba-312">Custom Server Variables</span></span>
* <span data-ttu-id="ad4ba-313">Caractères génériques</span><span class="sxs-lookup"><span data-stu-id="ad4ba-313">Wildcards</span></span>
* <span data-ttu-id="ad4ba-314">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="ad4ba-314">LogRewrittenUrl</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-315">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-315">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="ad4ba-316">L’intergiciel (middleware) publié avec ASP.NET Core 1.x ne prend pas en charge les fonctionnalités de Module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-316">The middleware released with ASP.NET Core 1.x doesn't support the following IIS URL Rewrite Module features:</span></span>
* <span data-ttu-id="ad4ba-317">Règles globales</span><span class="sxs-lookup"><span data-stu-id="ad4ba-317">Global Rules</span></span>
* <span data-ttu-id="ad4ba-318">Règles de trafic sortant</span><span class="sxs-lookup"><span data-stu-id="ad4ba-318">Outbound Rules</span></span>
* <span data-ttu-id="ad4ba-319">Réécrivez les mappages</span><span class="sxs-lookup"><span data-stu-id="ad4ba-319">Rewrite Maps</span></span>
* <span data-ttu-id="ad4ba-320">Action de CustomResponse</span><span class="sxs-lookup"><span data-stu-id="ad4ba-320">CustomResponse Action</span></span>
* <span data-ttu-id="ad4ba-321">Variables de serveur personnalisé</span><span class="sxs-lookup"><span data-stu-id="ad4ba-321">Custom Server Variables</span></span>
* <span data-ttu-id="ad4ba-322">Caractères génériques</span><span class="sxs-lookup"><span data-stu-id="ad4ba-322">Wildcards</span></span>
* <span data-ttu-id="ad4ba-323">Action : CustomResponse</span><span class="sxs-lookup"><span data-stu-id="ad4ba-323">Action:CustomResponse</span></span>
* <span data-ttu-id="ad4ba-324">LogRewrittenUrl</span><span class="sxs-lookup"><span data-stu-id="ad4ba-324">LogRewrittenUrl</span></span>

---

#### <a name="supported-server-variables"></a><span data-ttu-id="ad4ba-325">Variables de serveur pris en charge</span><span class="sxs-lookup"><span data-stu-id="ad4ba-325">Supported server variables</span></span>
<span data-ttu-id="ad4ba-326">L’intergiciel (middleware) prend en charge les variables de serveur de Module de réécriture d’URL IIS suivantes :</span><span class="sxs-lookup"><span data-stu-id="ad4ba-326">The middleware supports the following IIS URL Rewrite Module server variables:</span></span>
* <span data-ttu-id="ad4ba-327">CONTENT_LENGTH</span><span class="sxs-lookup"><span data-stu-id="ad4ba-327">CONTENT_LENGTH</span></span>
* <span data-ttu-id="ad4ba-328">TYPE_CONTENU</span><span class="sxs-lookup"><span data-stu-id="ad4ba-328">CONTENT_TYPE</span></span>
* <span data-ttu-id="ad4ba-329">HTTP_ACCEPT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-329">HTTP_ACCEPT</span></span>
* <span data-ttu-id="ad4ba-330">HTTP_CONNECTION</span><span class="sxs-lookup"><span data-stu-id="ad4ba-330">HTTP_CONNECTION</span></span>
* <span data-ttu-id="ad4ba-331">HTTP_COOKIE</span><span class="sxs-lookup"><span data-stu-id="ad4ba-331">HTTP_COOKIE</span></span>
* <span data-ttu-id="ad4ba-332">HTTP_HOST</span><span class="sxs-lookup"><span data-stu-id="ad4ba-332">HTTP_HOST</span></span>
* <span data-ttu-id="ad4ba-333">HTTP_REFERER</span><span class="sxs-lookup"><span data-stu-id="ad4ba-333">HTTP_REFERER</span></span>
* <span data-ttu-id="ad4ba-334">HTTP_URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-334">HTTP_URL</span></span>
* <span data-ttu-id="ad4ba-335">HTTP_USER_AGENT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-335">HTTP_USER_AGENT</span></span>
* <span data-ttu-id="ad4ba-336">HTTPS</span><span class="sxs-lookup"><span data-stu-id="ad4ba-336">HTTPS</span></span>
* <span data-ttu-id="ad4ba-337">LOCAL_ADDR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-337">LOCAL_ADDR</span></span>
* <span data-ttu-id="ad4ba-338">QUERY_STRING</span><span class="sxs-lookup"><span data-stu-id="ad4ba-338">QUERY_STRING</span></span>
* <span data-ttu-id="ad4ba-339">REMOTE_ADDR</span><span class="sxs-lookup"><span data-stu-id="ad4ba-339">REMOTE_ADDR</span></span>
* <span data-ttu-id="ad4ba-340">REMOTE_PORT</span><span class="sxs-lookup"><span data-stu-id="ad4ba-340">REMOTE_PORT</span></span>
* <span data-ttu-id="ad4ba-341">REQUEST_FILENAME</span><span class="sxs-lookup"><span data-stu-id="ad4ba-341">REQUEST_FILENAME</span></span>
* <span data-ttu-id="ad4ba-342">REQUEST_URI</span><span class="sxs-lookup"><span data-stu-id="ad4ba-342">REQUEST_URI</span></span>

> [!NOTE]
> <span data-ttu-id="ad4ba-343">Vous pouvez également obtenir un `IFileProvider` via un `PhysicalFileProvider`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-343">You can also obtain an `IFileProvider` via a `PhysicalFileProvider`.</span></span> <span data-ttu-id="ad4ba-344">Cette approche peut fournir une plus grande flexibilité pour l’emplacement de la réécriture de vos fichiers de règles.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-344">This approach may provide greater flexibility for the location of your rewrite rules files.</span></span> <span data-ttu-id="ad4ba-345">Assurez-vous que vos fichiers de règles de réécriture sont déployés sur le serveur dans le chemin d’accès que vous fournissez.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-345">Make sure that your rewrite rules files are deployed to the server at the path you provide.</span></span>
> ```csharp
> PhysicalFileProvider fileProvider = new PhysicalFileProvider(Directory.GetCurrentDirectory());
> ```

### <a name="method-based-rule"></a><span data-ttu-id="ad4ba-346">Règle basée sur une méthode</span><span class="sxs-lookup"><span data-stu-id="ad4ba-346">Method-based rule</span></span>
<span data-ttu-id="ad4ba-347">Utilisez `Add(Action<RewriteContext> applyRule)` pour implémenter votre propre logique de règle dans une méthode.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-347">Use `Add(Action<RewriteContext> applyRule)` to implement your own rule logic in a method.</span></span> <span data-ttu-id="ad4ba-348">Le `RewriteContext` expose le `HttpContext` pour une utilisation dans votre méthode.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-348">The `RewriteContext` exposes the `HttpContext` for use in your method.</span></span> <span data-ttu-id="ad4ba-349">Le `context.Result` détermine comment supplémentaires du pipeline de gestion du traitement.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-349">The `context.Result` determines how additional pipeline processing is handled.</span></span>

| <span data-ttu-id="ad4ba-350">contexte. Résultat</span><span class="sxs-lookup"><span data-stu-id="ad4ba-350">context.Result</span></span>                       | <span data-ttu-id="ad4ba-351">Action</span><span class="sxs-lookup"><span data-stu-id="ad4ba-351">Action</span></span>                                                          |
| ------------------------------------ | --------------------------------------------------------------- |
| <span data-ttu-id="ad4ba-352">`RuleResult.ContinueRules` (par défaut)</span><span class="sxs-lookup"><span data-stu-id="ad4ba-352">`RuleResult.ContinueRules` (default)</span></span> | <span data-ttu-id="ad4ba-353">Application des règles</span><span class="sxs-lookup"><span data-stu-id="ad4ba-353">Continue applying rules</span></span>                                         |
| `RuleResult.EndResponse`             | <span data-ttu-id="ad4ba-354">Cesser d’appliquer les règles et envoyer la réponse</span><span class="sxs-lookup"><span data-stu-id="ad4ba-354">Stop applying rules and send the response</span></span>                       |
| `RuleResult.SkipRemainingRules`      | <span data-ttu-id="ad4ba-355">Cesser d’appliquer les règles et d’envoyer le contexte de l’intergiciel (middleware) suivant</span><span class="sxs-lookup"><span data-stu-id="ad4ba-355">Stop applying rules and send the context to the next middleware</span></span> |

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-356">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-356">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=9)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-357">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-357">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=6)]

---

<span data-ttu-id="ad4ba-358">L’exemple d’application montre une méthode qui redirige les demandes de chemins d’accès qui se termine par *.xml*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-358">The sample app demonstrates a method that redirects requests for paths that end with *.xml*.</span></span> <span data-ttu-id="ad4ba-359">Si vous faites une demande `/file.xml`, il est redirigé vers `/xmlfiles/file.xml`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-359">If you make a request for `/file.xml`, it's redirected to `/xmlfiles/file.xml`.</span></span> <span data-ttu-id="ad4ba-360">Le code d’état est défini sur 301 (déplacé définitivement).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-360">The status code is set to 301 (Moved Permanently).</span></span> <span data-ttu-id="ad4ba-361">Pour une redirection, vous devez définir explicitement le code d’état de la réponse ; Sinon, un code d’état 200 (OK) est retourné et la redirection ne se produise sur le client.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-361">For a redirect, you must explicitly set the status code of the response; otherwise, a 200 (OK) status code is returned and the redirect won't occur on the client.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-362">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-362">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/RewriteRules.cs?name=snippet1)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-363">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-363">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet2)]

---

<span data-ttu-id="ad4ba-364">Demande d’origine :`/file.xml`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-364">Original Request: `/file.xml`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses pour file.xml de suivi](url-rewriting/_static/add_redirect_xml_requests.png)

### <a name="irule-based-rule"></a><span data-ttu-id="ad4ba-366">Règle basée sur les IRule</span><span class="sxs-lookup"><span data-stu-id="ad4ba-366">IRule-based rule</span></span>
<span data-ttu-id="ad4ba-367">Utilisez `Add(IRule)` pour implémenter votre propre logique de règle dans une classe qui dérive de `IRule`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-367">Use `Add(IRule)` to implement your own rule logic in a class that derives from `IRule`.</span></span> <span data-ttu-id="ad4ba-368">À l’aide un `IRule` offre davantage de flexibilité principal à l’aide de l’approche d’une règle basée sur une méthode.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-368">Using an `IRule` provides greater flexibility over using the method-based rule approach.</span></span> <span data-ttu-id="ad4ba-369">Votre classe dérivée peut inclure un constructeur, où vous pouvez passer des paramètres pour le `ApplyRule` (méthode).</span><span class="sxs-lookup"><span data-stu-id="ad4ba-369">Your derived class may include a constructor, where you can pass in parameters for the `ApplyRule` method.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-370">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-370">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/Program.cs?name=snippet1&highlight=10-11)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-371">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-371">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/Startup.cs?name=snippet1&highlight=7-8)]

---

<span data-ttu-id="ad4ba-372">Les valeurs des paramètres dans l’exemple d’application pour le `extension` et `newPath` sont vérifiées afin de répondre à plusieurs conditions.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-372">The values of the parameters in the sample app for the `extension` and the `newPath` are checked to meet several conditions.</span></span> <span data-ttu-id="ad4ba-373">Le `extension` doit contenir une valeur, et la valeur doit être *.png*, *.jpg*, ou *.gif*.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-373">The `extension` must contain a value, and the value must be *.png*, *.jpg*, or *.gif*.</span></span> <span data-ttu-id="ad4ba-374">Si le `newPath` n’est pas valide, un `ArgumentException` est levée.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-374">If the `newPath` isn't valid, an `ArgumentException` is thrown.</span></span> <span data-ttu-id="ad4ba-375">Si vous faites une demande *image.png*, il est redirigé vers `/png-images/image.png`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-375">If you make a request for *image.png*, it's redirected to `/png-images/image.png`.</span></span> <span data-ttu-id="ad4ba-376">Si vous faites une demande *image.jpg*, il est redirigé vers `/jpg-images/image.jpg`.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-376">If you make a request for *image.jpg*, it's redirected to `/jpg-images/image.jpg`.</span></span> <span data-ttu-id="ad4ba-377">Le code d’état a la valeur 301 (déplacé définitivement) et le `context.Result` est définie pour arrêter les règles de traitement et d’envoyer la réponse.</span><span class="sxs-lookup"><span data-stu-id="ad4ba-377">The status code is set to 301 (Moved Permanently), and the `context.Result` is set to stop processing rules and send the response.</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="ad4ba-378">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-378">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

[!code-csharp[Main](url-rewriting/samples/2.x/RewriteRules.cs?name=snippet2)]

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="ad4ba-379">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="ad4ba-379">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

[!code-csharp[Main](url-rewriting/samples/1.x/RewriteRule.cs?name=snippet1)]

---

<span data-ttu-id="ad4ba-380">Demande d’origine :`/image.png`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-380">Original Request: `/image.png`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses pour image.png de suivi](url-rewriting/_static/add_redirect_png_requests.png)

<span data-ttu-id="ad4ba-382">Demande d’origine :`/image.jpg`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-382">Original Request: `/image.jpg`</span></span>

![Fenêtre de navigateur avec des outils de développement les demandes et réponses pour image.jpg de suivi](url-rewriting/_static/add_redirect_jpg_requests.png)

## <a name="regex-examples"></a><span data-ttu-id="ad4ba-384">Exemples d’expressions régulières</span><span class="sxs-lookup"><span data-stu-id="ad4ba-384">Regex examples</span></span>

| <span data-ttu-id="ad4ba-385">Goal</span><span class="sxs-lookup"><span data-stu-id="ad4ba-385">Goal</span></span> | <span data-ttu-id="ad4ba-386">Chaîne d’expression régulière &</span><span class="sxs-lookup"><span data-stu-id="ad4ba-386">Regex String &</span></span><br><span data-ttu-id="ad4ba-387">Exemple de correspondance</span><span class="sxs-lookup"><span data-stu-id="ad4ba-387">Match Example</span></span> | <span data-ttu-id="ad4ba-388">Chaîne de remplacement &</span><span class="sxs-lookup"><span data-stu-id="ad4ba-388">Replacement String &</span></span><br><span data-ttu-id="ad4ba-389">Exemple de sortie</span><span class="sxs-lookup"><span data-stu-id="ad4ba-389">Output Example</span></span> |
| ---- | :-----------------------------: | :------------------------------------: |
| <span data-ttu-id="ad4ba-390">Chemin d’accès de réécriture dans la chaîne de requête</span><span class="sxs-lookup"><span data-stu-id="ad4ba-390">Rewrite path into querystring</span></span> | `^path/(.*)/(.*)`<br>`/path/abc/123` | `path?var1=$1&var2=$2`<br>`/path?var1=abc&var2=123` |
| <span data-ttu-id="ad4ba-391">Barre oblique de fin de la frange</span><span class="sxs-lookup"><span data-stu-id="ad4ba-391">Strip trailing slash</span></span> | `(.*)/$`<br>`/path/` | `$1`<br>`/path` |
| <span data-ttu-id="ad4ba-392">Appliquer la barre oblique de fin</span><span class="sxs-lookup"><span data-stu-id="ad4ba-392">Enforce trailing slash</span></span> | `(.*[^/])$`<br>`/path` | `$1/`<br>`/path/` |
| <span data-ttu-id="ad4ba-393">Éviter la réécriture des demandes spécifiques</span><span class="sxs-lookup"><span data-stu-id="ad4ba-393">Avoid rewriting specific requests</span></span> | `(.*[^(\.axd)])$`<br><span data-ttu-id="ad4ba-394">Oui :`/resource.htm`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-394">Yes: `/resource.htm`</span></span><br><span data-ttu-id="ad4ba-395">No :`/resource.axd`</span><span class="sxs-lookup"><span data-stu-id="ad4ba-395">No: `/resource.axd`</span></span> | `rewritten/$1`<br>`/rewritten/resource.htm`<br>`/resource.axd` |
| <span data-ttu-id="ad4ba-396">Réorganiser les segments d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-396">Rearrange URL segments</span></span> | `path/(.*)/(.*)/(.*)`<br>`path/1/2/3` | `path/$3/$2/$1`<br>`path/3/2/1` |
| <span data-ttu-id="ad4ba-397">Remplacer un segment d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-397">Replace a URL segment</span></span> | `^(.*)/segment2/(.*)`<br>`/segment1/segment2/segment3` | `$1/replaced/$2`<br>`/segment1/replaced/segment3` |

## <a name="additional-resources"></a><span data-ttu-id="ad4ba-398">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="ad4ba-398">Additional resources</span></span>
* [<span data-ttu-id="ad4ba-399">Démarrage d’une application</span><span class="sxs-lookup"><span data-stu-id="ad4ba-399">Application Startup</span></span>](startup.md)
* [<span data-ttu-id="ad4ba-400">Intergiciel (middleware)</span><span class="sxs-lookup"><span data-stu-id="ad4ba-400">Middleware</span></span>](middleware.md)
* [<span data-ttu-id="ad4ba-401">Expressions régulières dans .NET</span><span class="sxs-lookup"><span data-stu-id="ad4ba-401">Regular expressions in .NET</span></span>](/dotnet/articles/standard/base-types/regular-expressions)
* [<span data-ttu-id="ad4ba-402">Langage des expressions régulières - Aide-mémoire</span><span class="sxs-lookup"><span data-stu-id="ad4ba-402">Regular expression language - quick reference</span></span>](/dotnet/articles/standard/base-types/quick-ref)
* [<span data-ttu-id="ad4ba-403">Mod_rewrite d’Apache</span><span class="sxs-lookup"><span data-stu-id="ad4ba-403">Apache mod_rewrite</span></span>](https://httpd.apache.org/docs/2.4/rewrite/)
* [<span data-ttu-id="ad4ba-404">À l’aide du Module de réécriture d’Url 2.0 (pour IIS)</span><span class="sxs-lookup"><span data-stu-id="ad4ba-404">Using Url Rewrite Module 2.0 (for IIS)</span></span>](https://docs.microsoft.com/iis/extensions/url-rewrite-module/using-url-rewrite-module-20)
* [<span data-ttu-id="ad4ba-405">Référence de Configuration de Module de réécriture d’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-405">URL Rewrite Module Configuration Reference</span></span>](https://docs.microsoft.com/iis/extensions/url-rewrite-module/url-rewrite-module-configuration-reference)
* [<span data-ttu-id="ad4ba-406">Forum de Module de réécriture de URL IIS</span><span class="sxs-lookup"><span data-stu-id="ad4ba-406">IIS URL Rewrite Module Forum</span></span>](https://forums.iis.net/1152.aspx)
* [<span data-ttu-id="ad4ba-407">Conserver une structure simple de l’URL</span><span class="sxs-lookup"><span data-stu-id="ad4ba-407">Keep a simple URL structure</span></span>](https://support.google.com/webmasters/answer/76329?hl=en)
* [<span data-ttu-id="ad4ba-408">Réécriture d’URL 10 conseils et astuces</span><span class="sxs-lookup"><span data-stu-id="ad4ba-408">10 URL Rewriting Tips and Tricks</span></span>](http://ruslany.net/2009/04/10-url-rewriting-tips-and-tricks/)
* [<span data-ttu-id="ad4ba-409">Barre oblique ou ne pas en barre oblique</span><span class="sxs-lookup"><span data-stu-id="ad4ba-409">To slash or not to slash</span></span>](https://webmasters.googleblog.com/2010/04/to-slash-or-not-to-slash.html)
