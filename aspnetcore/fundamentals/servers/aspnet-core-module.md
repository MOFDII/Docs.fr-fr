---
title: Module ASP.NET Core
author: tdykstra
description: "Présente le module ASP.NET Core (ANCM), module IIS qui permet au serveur web Kestrel d’utiliser IIS ou IIS Express en tant que serveur proxy inverse."
manager: wpickett
ms.author: tdykstra
ms.custom: H1Hack27Feb2017
ms.date: 08/03/2017
ms.prod: asp.net-core
ms.technology: aspnet
ms.topic: article
uid: fundamentals/servers/aspnet-core-module
ms.openlocfilehash: 4337bc42c5454d6a9634a396d9c89f3518af148b
ms.sourcegitcommit: a510f38930abc84c4b302029d019a34dfe76823b
ms.translationtype: HT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/30/2018
---
# <a name="introduction-to-aspnet-core-module"></a><span data-ttu-id="bc9d2-103">Introduction au module ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bc9d2-103">Introduction to ASP.NET Core Module</span></span>

<span data-ttu-id="bc9d2-104">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl) et [Chris Ross](https://github.com/Tratcher)</span><span class="sxs-lookup"><span data-stu-id="bc9d2-104">By [Tom Dykstra](https://github.com/tdykstra), [Rick Strahl](https://github.com/RickStrahl), and [Chris Ross](https://github.com/Tratcher)</span></span> 

<span data-ttu-id="bc9d2-105">Le module ASP.NET Core (ANCM) vous permet d’exécuter des applications ASP.NET Core derrière IIS, en profitant à la fois des qualités d’IIS (sécurité, facilité de gestion, entre autres) et de [Kestrel](kestrel.md) (rapidité).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-105">ASP.NET Core Module (ANCM) lets you run ASP.NET Core applications behind IIS, using IIS for what it's good at (security, manageability, and lots more) and using [Kestrel](kestrel.md) for what it's good at (being really fast), and getting the benefits from both technologies at once.</span></span> <span data-ttu-id="bc9d2-106">**Le module ANCM fonctionne uniquement avec Kestrel ; il n’est pas compatible avec WebListener (dans ASP.NET Core 1.x) ou HTTP.sys (dans 2.x).**</span><span class="sxs-lookup"><span data-stu-id="bc9d2-106">**ANCM works only with Kestrel; it isn't compatible with WebListener (in ASP.NET Core 1.x) or HTTP.sys (in 2.x).**</span></span> 

<span data-ttu-id="bc9d2-107">Versions Windows prises en charge :</span><span class="sxs-lookup"><span data-stu-id="bc9d2-107">Supported Windows versions:</span></span>

* <span data-ttu-id="bc9d2-108">Windows 7 et Windows Server 2008 R2 et ultérieur</span><span class="sxs-lookup"><span data-stu-id="bc9d2-108">Windows 7 and Windows Server 2008 R2 and later</span></span>

<span data-ttu-id="bc9d2-109">[Affichez ou téléchargez l’exemple de code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([procédure de téléchargement](xref:tutorials/index#how-to-download-a-sample))</span><span class="sxs-lookup"><span data-stu-id="bc9d2-109">[View or download sample code](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample) ([how to download](xref:tutorials/index#how-to-download-a-sample))</span></span>

## <a name="what-aspnet-core-module-does"></a><span data-ttu-id="bc9d2-110">Ce que fait le module ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bc9d2-110">What ASP.NET Core Module does</span></span>

<span data-ttu-id="bc9d2-111">Le module ANCM est un module IIS natif qui se connecte au pipeline IIS et redirige le trafic vers l’application ASP.NET Core backend.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-111">ANCM is a native IIS module that hooks into the IIS pipeline and redirects traffic to the backend ASP.NET Core application.</span></span> <span data-ttu-id="bc9d2-112">La plupart des autres modules, tels que l’authentification Windows, conservent néanmoins la possibilité de s’exécuter.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-112">Most other modules, such as windows authentication, still get a chance to run.</span></span> <span data-ttu-id="bc9d2-113">Le module ANCM ne prend le contrôle que quand un gestionnaire est sélectionné pour la demande et qu’un mappage de gestionnaire est défini dans le fichier *web.config* de l’application.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-113">ANCM only takes control when a handler is selected for the request, and handler mapping is defined in the application *web.config* file.</span></span>

<span data-ttu-id="bc9d2-114">Étant donné que les applications ASP.NET Core s’exécutent dans un processus distinct du processus de travail IIS, ANCM traite également le processus de gestion.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-114">Because ASP.NET Core applications run in a process separate from the IIS worker process, ANCM also does process management.</span></span> <span data-ttu-id="bc9d2-115">ANCM démarre le processus de l’application ASP.NET Core lorsque la première requête arrive et le redémarre lorsque qu’il s’arrête.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-115">ANCM starts the process for the ASP.NET Core application when the first request comes in and restarts it when it crashes.</span></span> <span data-ttu-id="bc9d2-116">Il s’agit essentiellement d'un comportement similaire aux applications ASP.NET classiques qui s’exécutent in-process dans IIS et sont gérées par le service WAS (Windows Activation Service).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-116">This is essentially the same behavior as classic ASP.NET applications that run in-process in IIS and are managed by WAS (Windows Activation Service).</span></span>

<span data-ttu-id="bc9d2-117">Voici un diagramme qui illustre les relations entre IIS, le module ANCM et les applications ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-117">Here's a diagram that illustrates the relationship between IIS, ANCM, and ASP.NET Core applications.</span></span>

![Module ASP.NET Core](aspnet-core-module/_static/ancm.png)

<span data-ttu-id="bc9d2-119">Les demandes proviennent du web et atteignent le pilote Http.Sys en mode noyau qui les achemine vers IIS sur le port principal (80) ou le port SSL (443).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-119">Requests come in from the Web and hit the kernel mode Http.Sys driver which routes them into IIS on the primary port (80) or SSL port (443).</span></span> <span data-ttu-id="bc9d2-120">Le module ANCM transfère les demandes à l’application ASP.NET Core sur le port HTTP configuré pour l’application, qui n’est pas le port 80/443.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-120">ANCM forwards the requests to the ASP.NET Core application on the HTTP port configured for the application, which isn't port 80/443.</span></span>

<span data-ttu-id="bc9d2-121">Kestrel écoute le trafic en provenance de ANCM.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-121">Kestrel listens for traffic coming from ANCM.</span></span>  <span data-ttu-id="bc9d2-122">ANCM spécifie le port via une variable d’environnement au démarrage et la méthode [UseIISIntegration](#call-useiisintegration) configure le serveur pour écouter sur `http://localhost:{port}`.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-122">ANCM specifies the port via environment variable at startup, and the [UseIISIntegration](#call-useiisintegration) method configures the server to listen on `http://localhost:{port}`.</span></span> <span data-ttu-id="bc9d2-123">Il existe des vérifications supplémentaires pour rejeter les demandes ne provenant pas de ANCM.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-123">There are additional checks to reject requests not from ANCM.</span></span> <span data-ttu-id="bc9d2-124">(ANCM ne prend pas en charge le transfert HTTPS, pour que les demandes soient transférées via HTTP, même si IIS les reçoit via le protocole HTTPS.)</span><span class="sxs-lookup"><span data-stu-id="bc9d2-124">(ANCM doesn't support HTTPS forwarding, so requests are forwarded over HTTP even if received by IIS over HTTPS.)</span></span>

<span data-ttu-id="bc9d2-125">Kestrel récupère les demandes en provenance du module ANCM et les transmet au pipeline d’intergiciel (middleware) ASP.NET Core, qui les traite, puis les passe en tant qu’instances `HttpContext` à la logique d’application.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-125">Kestrel picks up requests from ANCM and pushes them into the ASP.NET Core middleware pipeline, which then handles them and passes them on as `HttpContext` instances to application logic.</span></span> <span data-ttu-id="bc9d2-126">Les réponses de l’application sont ensuite passées à IIS, qui les renvoient au client HTTP à l’origine des demandes.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-126">The application's responses are then passed back to IIS, which pushes them back out to the HTTP client that initiated the requests.</span></span>

<span data-ttu-id="bc9d2-127">Le module ANCM a d’autres fonctions :</span><span class="sxs-lookup"><span data-stu-id="bc9d2-127">ANCM has a few other functions as well:</span></span>

* <span data-ttu-id="bc9d2-128">Il définit des variables d’environnement.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-128">Sets environment variables.</span></span>
* <span data-ttu-id="bc9d2-129">Il journalise la sortie `stdout` dans un stockage de fichiers.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-129">Logs `stdout` output to file storage.</span></span>
* <span data-ttu-id="bc9d2-130">Il transfère les jetons d’authentification Windows.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-130">Forwards Windows authentication tokens.</span></span>

## <a name="how-to-use-ancm-in-aspnet-core-apps"></a><span data-ttu-id="bc9d2-131">Comment utiliser le module ANCM dans les applications ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bc9d2-131">How to use ANCM in ASP.NET Core apps</span></span>

<span data-ttu-id="bc9d2-132">Cette section fournit une vue d’ensemble du processus de configuration d’un serveur IIS et d’une application ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-132">This section provides an overview of the process for setting up an IIS server and ASP.NET Core application.</span></span> <span data-ttu-id="bc9d2-133">Pour obtenir des instructions détaillées, consultez [Hôte sur Windows avec IIS](xref:host-and-deploy/iis/index).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-133">For detailed instructions, see [Host on Windows with IIS](xref:host-and-deploy/iis/index).</span></span>

### <a name="install-ancm"></a><span data-ttu-id="bc9d2-134">Installer le module ANCM</span><span class="sxs-lookup"><span data-stu-id="bc9d2-134">Install ANCM</span></span>


<span data-ttu-id="bc9d2-135">Le module ASP.NET Core doit être installé dans IIS sur vos serveurs et dans IIS Express sur vos machines de développement.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-135">The ASP.NET Core Module has to be installed in IIS on your servers and in IIS Express on your development machines.</span></span> <span data-ttu-id="bc9d2-136">Pour les serveurs, le module ANCM est inclus dans le [bundle d’hébergement Windows Server .NET Core](https://aka.ms/dotnetcore-2-windowshosting).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-136">For servers, ANCM is included in the [.NET Core Windows Server Hosting bundle](https://aka.ms/dotnetcore-2-windowshosting).</span></span> <span data-ttu-id="bc9d2-137">Pour les machines de développement, Visual Studio installe automatiquement le module ANCM dans IIS Express, ainsi que dans IIS s’il est déjà installé sur les machines.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-137">For development machines, Visual Studio automatically installs ANCM in IIS Express, and in IIS if it's already installed on the machine.</span></span>

### <a name="install-the-iisintegration-nuget-package"></a><span data-ttu-id="bc9d2-138">Installer le package NuGet IISIntegration</span><span class="sxs-lookup"><span data-stu-id="bc9d2-138">Install the IISIntegration NuGet package</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="bc9d2-139">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-139">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="bc9d2-140">Le package [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) est inclus dans les métapackages ASP.NET Core ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) et [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-140">The [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/) package is included in the ASP.NET Core metapackages ([Microsoft.AspNetCore](https://www.nuget.org/packages/Microsoft.AspNetCore/) and [Microsoft.AspNetCore.All](xref:fundamentals/metapackage)).</span></span> <span data-ttu-id="bc9d2-141">Si vous n’utilisez aucun métapackage, installez `Microsoft.AspNetCore.Server.IISIntegration` séparément.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-141">If you don't use one of the metapackages, install `Microsoft.AspNetCore.Server.IISIntegration` separately.</span></span> <span data-ttu-id="bc9d2-142">Le package `IISIntegration` est un pack d’interopérabilité qui lit les variables d’environnement diffusées par le module ANCM pour configurer votre application.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-142">The `IISIntegration` package is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="bc9d2-143">Les variables d’environnement fournissent des informations de configuration, telles que le port d’écoute.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-143">The environment variables provide configuration information, such as the port to listen on.</span></span> 

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="bc9d2-144">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-144">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="bc9d2-145">Dans votre application, vous devez installer [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-145">In your application, install [Microsoft.AspNetCore.Server.IISIntegration](https://www.nuget.org/packages/Microsoft.AspNetCore.Server.IISIntegration/).</span></span> <span data-ttu-id="bc9d2-146">Le package `IISIntegration` est un pack d’interopérabilité qui lit les variables d’environnement ANCM pour configurer votre application de diffusion.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-146">The `IISIntegration` package  is an interoperability pack that reads environment variables broadcast by ANCM to set up your app.</span></span> <span data-ttu-id="bc9d2-147">Les variables d’environnement fournissent des informations de configuration, telles que le port d’écoute.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-147">The environment variables provide configuration information, such as the port to listen on.</span></span> 

---

### <a name="call-useiisintegration"></a><span data-ttu-id="bc9d2-148">Appeler UseIISIntegration</span><span class="sxs-lookup"><span data-stu-id="bc9d2-148">Call UseIISIntegration</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="bc9d2-149">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-149">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="bc9d2-150">La méthode d’extension `UseIISIntegration` sur [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) est appelée automatiquement quand l’exécution recourt à IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-150">The `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder) is called automatically when you run with IIS.</span></span>

<span data-ttu-id="bc9d2-151">Si vous n’utilisez aucun métapackage ASP.NET Core et que vous n’avez pas installé le package `Microsoft.AspNetCore.Server.IISIntegration`, vous obtenez une erreur d’exécution.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-151">If you aren't using one of the ASP.NET Core metapackages and haven't installed the  `Microsoft.AspNetCore.Server.IISIntegration` package, you get a runtime error.</span></span> <span data-ttu-id="bc9d2-152">Si vous appelez `UseIISIntegration` explicitement et que le package n’est pas installé, vous obtenez une erreur de compilation.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-152">If you call `UseIISIntegration` explicitly, you get a compile time error if the package isn't installed.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="bc9d2-153">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-153">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="bc9d2-154">Dans la méthode `Main` de votre application, appelez la méthode d’extension `UseIISIntegration` sur [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-154">In your application's `Main` method, call the `UseIISIntegration` extension method on [`WebHostBuilder`](https://docs.microsoft.com/aspnet/core/api/microsoft.aspnetcore.hosting.webhostbuilder).</span></span> 

[!code-csharp[](aspnet-core-module/sample/Program.cs?name=snippet_Main&highlight=12)]

---

<span data-ttu-id="bc9d2-155">La méthode `UseIISIntegration` recherche les variables d’environnement définies par le module ANCM et n’effectue aucune opération si elle ne les trouve pas.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-155">The `UseIISIntegration` method looks for environment variables that ANCM sets, and it no-ops if they aren't found.</span></span> <span data-ttu-id="bc9d2-156">Ce comportement facilite les scénarios tels que le développement et les tests sur macOS ou Linux et le déploiement sur un serveur qui exécute IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-156">This behavior facilitates scenarios like developing and testing on macOS or Linux and deploying to a server that runs IIS.</span></span> <span data-ttu-id="bc9d2-157">Sur macOS ou Linux, Kestrel joue le rôle de serveur web ; mais quand l’application est déployée sur l’environnement IIS, elle utilise automatiquement le module ANCM et IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-157">While running on macOS or Linux, Kestrel acts as the web server; but when the app is deployed to the IIS environment, it automatically uses ANCM and IIS.</span></span>

### <a name="ancm-port-binding-overrides-other-port-bindings"></a><span data-ttu-id="bc9d2-158">La liaison de port du module ANCM remplace les autres liaisons de port</span><span class="sxs-lookup"><span data-stu-id="bc9d2-158">ANCM port binding overrides other port bindings</span></span>

# <a name="aspnet-core-2xtabaspnetcore2x"></a>[<span data-ttu-id="bc9d2-159">ASP.NET Core 2.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-159">ASP.NET Core 2.x</span></span>](#tab/aspnetcore2x)

<span data-ttu-id="bc9d2-160">ANCM génère un port dynamique à affecter au processus principal.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-160">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="bc9d2-161">La méthode `UseIISIntegration` récupère ce port dynamique et configure Kestrel pour écouter sur `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-161">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="bc9d2-162">Ceci remplace d’autres configurations URL, comme les appels à `UseUrls` ou à [l’API d’écoute de Kestrel](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-162">This overrides other URL configurations, such as calls to `UseUrls` or [Kestrel's Listen API](xref:fundamentals/servers/kestrel?tabs=aspnetcore2x#endpoint-configuration).</span></span> <span data-ttu-id="bc9d2-163">Ainsi, vous n’avez pas besoin d’appeler `UseUrls` ou l’API `Listen` de Kestrel quand vous utilisez le module ANCM.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-163">Therefore, you don't need to call `UseUrls` or Kestrel's `Listen` API when you use ANCM.</span></span> <span data-ttu-id="bc9d2-164">Si vous appelez `UseUrls` ou `Listen`, Kestrel est à l’écoute sur le port que vous spécifiez quand vous exécutez l’application sans IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-164">If you do call `UseUrls` or `Listen`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

# <a name="aspnet-core-1xtabaspnetcore1x"></a>[<span data-ttu-id="bc9d2-165">ASP.NET Core 1.x</span><span class="sxs-lookup"><span data-stu-id="bc9d2-165">ASP.NET Core 1.x</span></span>](#tab/aspnetcore1x)

<span data-ttu-id="bc9d2-166">ANCM génère un port dynamique à affecter au processus principal.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-166">ANCM generates a dynamic port to assign to the back-end process.</span></span> <span data-ttu-id="bc9d2-167">La méthode `UseIISIntegration` récupère ce port dynamique et configure Kestrel pour écouter sur `http://locahost:{dynamicPort}/`.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-167">The `UseIISIntegration` method picks up this dynamic port and configures Kestrel to listen on `http://locahost:{dynamicPort}/`.</span></span> <span data-ttu-id="bc9d2-168">Ceci remplace d’autres configurations URL, comme les appels à `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-168">This overrides other URL configurations, such as calls to `UseUrls`.</span></span> <span data-ttu-id="bc9d2-169">Par conséquent, vous n’avez pas besoin d’appeler `UseUrls` lorsque vous utilisez ANCM.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-169">Therefore, you don't need to call `UseUrls` when you use ANCM.</span></span> <span data-ttu-id="bc9d2-170">Si vous n’appelez pas `UseUrls`, Kestrel est à l’écoute sur le port que vous spécifiez lorsque vous exécutez l’application sans IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-170">If you do call `UseUrls`, Kestrel listens on the port you specify when you run the app without IIS.</span></span>

<span data-ttu-id="bc9d2-171">Dans ASP.NET Core 1.0, si vous appelez `UseUrls`, faites-le **avant** d’appeler `UseIISIntegration` afin que le port configuré par le module ANCM ne soit pas remplacé.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-171">In ASP.NET Core 1.0, if you call `UseUrls`, call it **before** you call `UseIISIntegration` so that the ANCM-configured port doesn't get overwritten.</span></span> <span data-ttu-id="bc9d2-172">Cet ordre d’appel n’est pas requis dans ASP.NET Core 1.1, car le paramètre du module ANCM remplace `UseUrls`.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-172">This calling order isn't required in ASP.NET Core 1.1, because the ANCM setting overrides `UseUrls`.</span></span>

---

### <a name="configure-ancm-options-in-webconfig"></a><span data-ttu-id="bc9d2-173">Configurer les options du module ANCM dans le fichier Web.config</span><span class="sxs-lookup"><span data-stu-id="bc9d2-173">Configure ANCM options in Web.config</span></span>

<span data-ttu-id="bc9d2-174">La configuration pour le module ASP.NET Core est stockée dans le fichier *web.config* qui se trouve dans le dossier racine de l’application.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-174">Configuration for the ASP.NET Core Module is stored in the *web.config* file that's located in the application's root folder.</span></span> <span data-ttu-id="bc9d2-175">Les paramètres de ce fichier pointent vers la commande de démarrage et les arguments qui démarrent votre application ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-175">Settings in this file point to the startup command and arguments that start your ASP.NET Core app.</span></span> <span data-ttu-id="bc9d2-176">Pour un exemple de code *web.config* et des conseils sur les options de configuration, consultez [référence de Configuration du module ASP.NET Core](xref:host-and-deploy/aspnet-core-module).</span><span class="sxs-lookup"><span data-stu-id="bc9d2-176">For sample *web.config* code and guidance on configuration options, see [ASP.NET Core Module Configuration Reference](xref:host-and-deploy/aspnet-core-module).</span></span>

### <a name="run-with-iis-express-in-development"></a><span data-ttu-id="bc9d2-177">Exécuter avec IIS Express dans l’environnement de développement</span><span class="sxs-lookup"><span data-stu-id="bc9d2-177">Run with IIS Express in development</span></span>

<span data-ttu-id="bc9d2-178">IIS Express peut être lancé par Visual Studio à l’aide du profil par défaut défini par les modèles ASP.NET Core.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-178">IIS Express can be launched by Visual Studio using the default profile defined by the ASP.NET Core templates.</span></span>

## <a name="proxy-configuration-uses-http-protocol-and-a-pairing-token"></a><span data-ttu-id="bc9d2-179">La configuration du proxy utilise le protocole HTTP et un jeton d’appariement</span><span class="sxs-lookup"><span data-stu-id="bc9d2-179">Proxy configuration uses HTTP protocol and a pairing token</span></span>

<span data-ttu-id="bc9d2-180">Le proxy créé entre ANCM et Kestrel utilise le protocole HTTP.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-180">The proxy created between the ANCM and Kestrel uses the HTTP protocol.</span></span> <span data-ttu-id="bc9d2-181">Utiliser HTTP est une optimisation des performances où le trafic entre ANCM et Kestrel a lieu sur une adresse de bouclage hors de l’interface réseau.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-181">Using HTTP is a performance optimization where the traffic between the ANCM and Kestrel takes place on a loopback address off of the network interface.</span></span> <span data-ttu-id="bc9d2-182">Il n’existe aucun risque d’écoute clandestine du trafic entre ANCM et Kestrel à partir d’un emplacement sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-182">There's no risk of eavesdropping the traffic between the ANCM and Kestrel from a location off of the server.</span></span>

<span data-ttu-id="bc9d2-183">Un jeton d’appariement est utilisé pour garantir que les demandes reçues par Kestrel ont été traitées par IIS et ne proviennent pas d’une autre source.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-183">A pairing token is used to guarantee that the requests received by Kestrel were proxied by IIS and didn't come from some other source.</span></span> <span data-ttu-id="bc9d2-184">Le jeton d’appariement est créé et défini dans une variable d’environnement (`ASPNETCORE_TOKEN`) par ANCM.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-184">The pairing token is created and set into an environment variable (`ASPNETCORE_TOKEN`) by the ANCM.</span></span> <span data-ttu-id="bc9d2-185">Le jeton d’appariement est également défini dans un en-tête (`MSAspNetCoreToken`) sur toutes les demandes traitées.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-185">The pairing token is also set into a header (`MSAspNetCoreToken`) on every proxied request.</span></span> <span data-ttu-id="bc9d2-186">L'intergiciel IIS vérifie chaque demande qu’il reçoit pour confirmer que la valeur d’en-tête du jeton d'appariement correspond à la valeur de la variable d’environnement.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-186">IIS Middleware checks each request it receives to confirm that the pairing token header value matches the environment variable value.</span></span> <span data-ttu-id="bc9d2-187">Si les valeurs de jeton ne correspondent pas, la demande est connectée et rejetée.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-187">If the token values are mismatched, the request is logged and rejected.</span></span> <span data-ttu-id="bc9d2-188">La variable d’environnement du jeton d'appariement et le trafic entre ANCM et Kestrel ne sont pas accessibles à partir d’un emplacement sur le serveur.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-188">The pairing token environment variable and the traffic between the ANCM and Kestrel aren't accessible from a location off of the server.</span></span> <span data-ttu-id="bc9d2-189">Sans connaître la valeur du jeton d'appariement, une personne malveillante ne peut pas soumettre des demandes qui contournent la vérification de l’intergiciel IIS.</span><span class="sxs-lookup"><span data-stu-id="bc9d2-189">Without knowing the pairing token value, an attacker can't submit requests that bypass the check in the IIS Middleware.</span></span>

## <a name="next-steps"></a><span data-ttu-id="bc9d2-190">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="bc9d2-190">Next steps</span></span>

<span data-ttu-id="bc9d2-191">Pour plus d'informations, reportez-vous aux ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="bc9d2-191">For more information, see the following resources:</span></span>

* [<span data-ttu-id="bc9d2-192">Exemple d’application pour cet article</span><span class="sxs-lookup"><span data-stu-id="bc9d2-192">Sample app for this article</span></span>](https://github.com/aspnet/Docs/tree/master/aspnetcore/fundamentals/servers/aspnet-core-module/sample)
* [<span data-ttu-id="bc9d2-193">Code source du module ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bc9d2-193">ASP.NET Core Module source code</span></span>](https://github.com/aspnet/AspNetCoreModule)
* [<span data-ttu-id="bc9d2-194">Informations de référence sur la configuration du module ASP.NET Core</span><span class="sxs-lookup"><span data-stu-id="bc9d2-194">ASP.NET Core Module Configuration Reference</span></span>](xref:host-and-deploy/aspnet-core-module)
* [<span data-ttu-id="bc9d2-195">Héberger sur Windows avec IIS</span><span class="sxs-lookup"><span data-stu-id="bc9d2-195">Host on Windows with IIS</span></span>](xref:host-and-deploy/iis/index)
