---
uid: web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
title: "La mise en cache des données dans une application Web Pages (Razor) Site pour de meilleures performances | Documents Microsoft"
author: tfitzmac
description: "Vous pouvez accélérer votre site Web en le faisant magasin : autrement dit, cache - les résultats des données qui habituellement prendrait beaucoup de temps pour récupérer ou traiter un..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/14/2014
ms.topic: article
ms.assetid: 961e525b-7700-469e-8a68-d7010b6fb68c
ms.technology: dotnet-webpages
ms.prod: .net-framework
msc.legacyurl: /web-pages/overview/performance-and-traffic/15-caching-to-improve-the-performance-of-your-website
msc.type: authoredcontent
ms.openlocfilehash: 742409219bd3b05f8ddf2c0d5034919fc9bf1d26
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2018
---
<a name="caching-data-in-an-aspnet-web-pages-razor-site-for-better-performance"></a><span data-ttu-id="f5013-103">Mise en cache des données dans un Site de Pages (Razor) Web ASP.NET pour de meilleures performances</span><span class="sxs-lookup"><span data-stu-id="f5013-103">Caching Data in an ASP.NET Web Pages (Razor) Site for Better Performance</span></span>
====================
<span data-ttu-id="f5013-104">par [Tom FitzMacken](https://github.com/tfitzmac)</span><span class="sxs-lookup"><span data-stu-id="f5013-104">by [Tom FitzMacken](https://github.com/tfitzmac)</span></span>

> <span data-ttu-id="f5013-105">Cet article explique comment utiliser un programme d’assistance en cache les informations pour améliorer les performances dans un site Web ASP.NET Web Pages (Razor).</span><span class="sxs-lookup"><span data-stu-id="f5013-105">This article explains how to use a helper to cache information for faster performance in an ASP.NET Web Pages (Razor) website.</span></span> <span data-ttu-id="f5013-106">Vous pouvez accélérer votre site Web en le faisant magasin &#8212; Autrement dit, le cache &#8212; les résultats des données qui habituellement prendrait beaucoup de temps pour récupérer ou traiter et qui ne changent pas souvent.</span><span class="sxs-lookup"><span data-stu-id="f5013-106">You can speed up your website by having it store &#8212; that is, cache &#8212; the results of data that ordinarily would take considerable time to retrieve or process and that does not change often.</span></span>
> 
> <span data-ttu-id="f5013-107">**Ce que vous allez apprendre :**</span><span class="sxs-lookup"><span data-stu-id="f5013-107">**What you'll learn:**</span></span> 
> 
> - <span data-ttu-id="f5013-108">L’utilisation de la mise en cache pour améliorer la réactivité de votre site Web.</span><span class="sxs-lookup"><span data-stu-id="f5013-108">How to use caching to improve the responsiveness of your website.</span></span>
> 
> <span data-ttu-id="f5013-109">Voici les fonctionnalités d’ASP.NET introduites dans l’article :</span><span class="sxs-lookup"><span data-stu-id="f5013-109">These are the ASP.NET features introduced in the article:</span></span>
> 
> - <span data-ttu-id="f5013-110">Le `WebCache` helper.</span><span class="sxs-lookup"><span data-stu-id="f5013-110">The `WebCache` helper.</span></span>
>   
> 
> ## <a name="software-versions-used-in-the-tutorial"></a><span data-ttu-id="f5013-111">Versions du logiciel utilisées dans le didacticiel</span><span class="sxs-lookup"><span data-stu-id="f5013-111">Software versions used in the tutorial</span></span>
> 
> 
> - <span data-ttu-id="f5013-112">Pages Web ASP.NET (Razor) 3</span><span class="sxs-lookup"><span data-stu-id="f5013-112">ASP.NET Web Pages (Razor) 3</span></span>
>   
> 
> <span data-ttu-id="f5013-113">Ce didacticiel fonctionne également avec ASP.NET Web Pages 2.</span><span class="sxs-lookup"><span data-stu-id="f5013-113">This tutorial also works with ASP.NET Web Pages 2.</span></span>


<span data-ttu-id="f5013-114">Chaque fois qu’un utilisateur demande une page de votre site, le serveur web doit effectuer un travail pour répondre à la demande.</span><span class="sxs-lookup"><span data-stu-id="f5013-114">Every time someone requests a page from your site, the web server has to do some work in order to fulfill the request.</span></span> <span data-ttu-id="f5013-115">Pour certaines de vos pages, le serveur peut avoir effectuer des tâches qui prennent (comparativement) beaucoup de temps, telles que la récupération des données à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="f5013-115">For some of your pages, the server might have to perform tasks that take a (comparatively) long time, such as retrieving data from a database.</span></span> <span data-ttu-id="f5013-116">Même si ces tâches ne prennent longtemps en termes absolus, si votre site rencontre un trafic important, une série de requêtes individuelles que le serveur web effectuer la tâche complexe ou lente risque peut s’ajouter une grande quantité de travail.</span><span class="sxs-lookup"><span data-stu-id="f5013-116">Even if these tasks don't take long in absolute terms, if your site experiences a lot of traffic, a whole series of individual requests that cause the web server to perform the complicated or slow task can add up to a lot of work.</span></span> <span data-ttu-id="f5013-117">Cela peut finalement affecter les performances du site.</span><span class="sxs-lookup"><span data-stu-id="f5013-117">This can ultimately affect the performance of the site.</span></span>

<span data-ttu-id="f5013-118">Permet d’améliorer les performances de votre site Web dans des circonstances, comme cela est en cache des données.</span><span class="sxs-lookup"><span data-stu-id="f5013-118">One way to improve the performance of your website in circumstances like this is to cache data.</span></span> <span data-ttu-id="f5013-119">Si votre site Obtient les demandes répétées pour les mêmes informations, les informations ne doivent pas être modifiés pour chaque personne, et il n’est pas temps sensibles, au lieu de nouveau l’extraction ou le recalcul, vous pouvez extraire les données une seule fois et puis stocker les résultats.</span><span class="sxs-lookup"><span data-stu-id="f5013-119">If your site gets repeated requests for the same information, and the information does not need to be modified for each person, and it's not time sensitive, instead of re-fetching or recalculating it, you can fetch the data once and then store the results.</span></span> <span data-ttu-id="f5013-120">La prochaine fois qu’une demande arrive pour que plus d’informations, vous laisser l’hors du cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-120">The next time a request comes in for that information, you just get it out of the cache.</span></span>

<span data-ttu-id="f5013-121">En règle générale, vous mettez en cache les informations qui ne changent pas fréquemment.</span><span class="sxs-lookup"><span data-stu-id="f5013-121">In general, you cache information that doesn't change frequently.</span></span> <span data-ttu-id="f5013-122">Lorsque vous placez les informations dans le cache, il est stocké en mémoire sur le serveur web.</span><span class="sxs-lookup"><span data-stu-id="f5013-122">When you put information in the cache, it's stored in memory on the web server.</span></span> <span data-ttu-id="f5013-123">Vous pouvez spécifier la durée pendant laquelle il doit être mis en cache, de quelques secondes à jours.</span><span class="sxs-lookup"><span data-stu-id="f5013-123">You can specify how long it should be cached, from seconds to days.</span></span> <span data-ttu-id="f5013-124">Lors de la période de mise en cache expire, les informations sont supprimées automatiquement à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-124">When the caching period expires, the information is automatically removed from the cache.</span></span>

> [!NOTE]
> <span data-ttu-id="f5013-125">Entrées dans le cache peuvent être supprimées pour des raisons autres que qu’ils ont expiré.</span><span class="sxs-lookup"><span data-stu-id="f5013-125">Entries in the cache might be removed for reasons other than that they've expired.</span></span> <span data-ttu-id="f5013-126">Par exemple, le serveur web peut temporairement manquer de mémoire et une façon qu’il puisse récupérer la mémoire consiste à lever les entrées du cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-126">For example, the web server might temporarily run low on memory, and one way it can reclaim memory is by throwing entries out of the cache.</span></span> <span data-ttu-id="f5013-127">Comme vous le verrez, même si vous avez placer les informations dans le cache, vous devez vérifier pour vous assurer qu’il est toujours active lorsque vous avez besoin.</span><span class="sxs-lookup"><span data-stu-id="f5013-127">As you'll see, even if you've put information into the cache, you have to check to be sure it's still there when you need it.</span></span>


<span data-ttu-id="f5013-128">Imaginez que votre site Web dispose d’une page qui affiche la température actuelle et les prévisions météorologiques.</span><span class="sxs-lookup"><span data-stu-id="f5013-128">Imagine your website has a page that displays the current temperature and weather forecast.</span></span> <span data-ttu-id="f5013-129">Pour obtenir ce type d’informations, vous pouvez envoyer une demande à un service externe.</span><span class="sxs-lookup"><span data-stu-id="f5013-129">To get this type of information, you might send a request to an external service.</span></span> <span data-ttu-id="f5013-130">Étant donné que ces informations ne changent pas beaucoup (dans un délai de deux heures, par exemple) et les appels externes nécessitant une heure et la bande passante, il est un bon candidat pour la mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-130">Since this information doesn't change much (within a two-hour time period, for example) and since external calls require time and bandwidth, it's a good candidate for caching.</span></span>

## <a name="adding-caching-to-a-page"></a><span data-ttu-id="f5013-131">Ajout de la mise en cache à une Page</span><span class="sxs-lookup"><span data-stu-id="f5013-131">Adding Caching to a Page</span></span>

<span data-ttu-id="f5013-132">ASP.NET inclut un `WebCache` assistance qui facilite la tâche Ajouter la mise en cache à votre site et ajouter des données dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-132">ASP.NET includes a `WebCache` helper that makes it easy to add caching to your site and add data to the cache.</span></span> <span data-ttu-id="f5013-133">Dans cette procédure, vous allez créer une page qui met en cache l’heure actuelle.</span><span class="sxs-lookup"><span data-stu-id="f5013-133">In this procedure, you'll create a page that caches the current time.</span></span> <span data-ttu-id="f5013-134">Cela n’est pas un exemple concret, étant donné que l’heure actuelle est un élément qui ne changent pas souvent et qui n’est plus complexe à calculer.</span><span class="sxs-lookup"><span data-stu-id="f5013-134">This isn't a real-world example, since the current time is something that does change often, and that moreover isn't complex to calculate.</span></span> <span data-ttu-id="f5013-135">Toutefois, il est un bon moyen pour illustrer l’action de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-135">However, it's a good way to illustrate caching in action.</span></span>

1. <span data-ttu-id="f5013-136">Ajouter une nouvelle page nommée *WebCache.cshtml* au site Web.</span><span class="sxs-lookup"><span data-stu-id="f5013-136">Add a new page named *WebCache.cshtml* to the website.</span></span>
2. <span data-ttu-id="f5013-137">Ajoutez le code et le balisage suivant à la page :</span><span class="sxs-lookup"><span data-stu-id="f5013-137">Add the following code and markup to the page:</span></span>

    [!code-cshtml[Main](15-caching-to-improve-the-performance-of-your-website/samples/sample1.cshtml)]

    <span data-ttu-id="f5013-138">Lors de la mise en cache des données, vous placez dans le cache à l’aide d’un nom de cela est unique sur le site Web.</span><span class="sxs-lookup"><span data-stu-id="f5013-138">When you cache data, you put it into the cache using a name this is unique across the website.</span></span> <span data-ttu-id="f5013-139">Dans ce cas, vous allez utiliser une entrée de cache nommée `CachedTime`.</span><span class="sxs-lookup"><span data-stu-id="f5013-139">In this case, you'll use a cache entry named `CachedTime`.</span></span> <span data-ttu-id="f5013-140">Il s’agit de la `cacheItemKey` indiqué dans l’exemple de code.</span><span class="sxs-lookup"><span data-stu-id="f5013-140">This is the `cacheItemKey` shown in the code example.</span></span>

    <span data-ttu-id="f5013-141">Le code lit d’abord le `CachedTime` l’entrée de cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-141">The code first reads the `CachedTime` cache entry.</span></span> <span data-ttu-id="f5013-142">Si une valeur est retournée (autrement dit, si l’entrée de cache n’est pas null), le code définit uniquement la valeur de la variable de temps pour les données du cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-142">If a value is returned (that is, if the cache entry isn't null), the code just sets the value of the time variable to the cache data.</span></span>

    <span data-ttu-id="f5013-143">Toutefois, si l’entrée de cache n’existe pas (autrement dit, il est null), le code définit la valeur d’heure, il ajoute au cache et définit une valeur d’expiration d’une minute.</span><span class="sxs-lookup"><span data-stu-id="f5013-143">However, if the cache entry doesn't exist (that is, it's null), the code sets the time value, adds it to the cache, and sets an expiration value to one minute.</span></span> <span data-ttu-id="f5013-144">Après une minute, l’entrée du cache est ignorée.</span><span class="sxs-lookup"><span data-stu-id="f5013-144">After one minute, the cache entry is discarded.</span></span> <span data-ttu-id="f5013-145">(La valeur d’expiration par défaut pour un élément dans le cache est de 20 minutes). La commande `WebCache.Set(cacheItemKey, time, 1, false)` montre comment ajouter la valeur de temps actuelle dans le cache et définir son expiration à 1 minute.</span><span class="sxs-lookup"><span data-stu-id="f5013-145">(The default expiration value for an item in the cache is 20 minutes.) The command `WebCache.Set(cacheItemKey, time, 1, false)` shows how to add the current time value to the cache and set its expiration to 1 minute.</span></span> <span data-ttu-id="f5013-146">Définition de la *slidingExpiration* paramètre `false` signifie que le délai d’expiration n’est pas renouvelé chaque fois qu’elle est demandée.</span><span class="sxs-lookup"><span data-stu-id="f5013-146">Setting the *slidingExpiration* parameter to `false` means the expiration time is not renewed each time it is requested.</span></span> <span data-ttu-id="f5013-147">Sa date d’expiration exactement 1 minute après que qu’il a été ajoutée au cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-147">It will expire exactly 1 minute after it was originally added to the cache.</span></span> <span data-ttu-id="f5013-148">Si vous définissez cette valeur sur `true` le délai d’expiration de 1 minute est réinitialisé chaque fois que la valeur est demandée à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-148">If you set this value to `true` the 1 minute expiration time is reset each time the value is requested from the cache.</span></span>

    <span data-ttu-id="f5013-149">Ce code illustre le modèle que vous devez toujours utiliser lorsque le cache de données.</span><span class="sxs-lookup"><span data-stu-id="f5013-149">This code illustrates the pattern you should always use when you cache data.</span></span> <span data-ttu-id="f5013-150">Avant d’obtenir quelque chose hors du cache, commencez toujours par vérifier si le `WebCache.Get` méthode a retourné une valeur null.</span><span class="sxs-lookup"><span data-stu-id="f5013-150">Before you get something out of the cache, always check first whether the `WebCache.Get` method has returned null.</span></span> <span data-ttu-id="f5013-151">Souvenez-vous que l’entrée de cache a peut-être expiré ou a peut-être été supprimée pour une raison quelconque, donc toute entrée donnée n’est jamais garantie dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-151">Remember that the cache entry might have expired or might have been removed for some other reason, so any given entry is never guaranteed to be in the cache.</span></span>
3. <span data-ttu-id="f5013-152">Exécutez *WebCache.cshtml* dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="f5013-152">Run *WebCache.cshtml* in a browser.</span></span> <span data-ttu-id="f5013-153">(Assurez-vous que la page est sélectionnée dans le **fichiers** espace de travail avant de l’exécuter.) La première fois que vous demandez la page, les données d’heure n’est pas dans le cache et le code doit ajouter la valeur d’heure dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-153">(Make sure the page is selected in the **Files** workspace before you run it.) The first time you request the page, the time data isn't in the cache, and the code has to add the time value to the cache.</span></span>

    ![cache-1](15-caching-to-improve-the-performance-of-your-website/_static/image1.jpg)
4. <span data-ttu-id="f5013-155">Actualiser *WebCache.cshtml* dans le navigateur.</span><span class="sxs-lookup"><span data-stu-id="f5013-155">Refresh *WebCache.cshtml* in the browser.</span></span> <span data-ttu-id="f5013-156">Cette fois, les données de temps sont dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-156">This time, the time data is in the cache.</span></span> <span data-ttu-id="f5013-157">Notez que l’heure n’a pas changé depuis la dernière fois que vous avez consulté la page.</span><span class="sxs-lookup"><span data-stu-id="f5013-157">Notice that the time hasn't changed since the last time you viewed the page.</span></span>

    ![cache-2](15-caching-to-improve-the-performance-of-your-website/_static/image2.jpg)
5. <span data-ttu-id="f5013-159">Patientez une minute de vider le cache, puis actualisez la page.</span><span class="sxs-lookup"><span data-stu-id="f5013-159">Wait one minute for the cache to be emptied, and then refresh the page.</span></span> <span data-ttu-id="f5013-160">La page indique à nouveau que les données de temps n’a pas été trouvées dans le cache, et l’heure de mise à jour est ajouté au cache.</span><span class="sxs-lookup"><span data-stu-id="f5013-160">The page again indicates that the time data wasn't found in the cache, and the updated time is added to the cache.</span></span>

<a id="Additional_Resources"></a>
## <a name="additional-resources"></a><span data-ttu-id="f5013-161">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="f5013-161">Additional Resources</span></span>


- [<span data-ttu-id="f5013-162">Affichage de données dans un graphique</span><span class="sxs-lookup"><span data-stu-id="f5013-162">Displaying Data in a Chart</span></span>](https://go.microsoft.com/fwlink/?LinkId=202895)
- <span data-ttu-id="f5013-163">[Référence de l’API de WebCache](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span><span class="sxs-lookup"><span data-stu-id="f5013-163">[WebCache API reference](https://msdn.microsoft.com/library/system.web.helpers.webcache(v=vs.99).aspx) (MSDN)</span></span>
