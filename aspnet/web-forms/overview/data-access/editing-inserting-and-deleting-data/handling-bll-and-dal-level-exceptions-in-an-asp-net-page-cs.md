---
uid: web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
title: La gestion des Exceptions au niveau de la couche BLL et de la couche DAL dans une Page ASP.NET (c#) | Documents Microsoft
author: rick-anderson
description: Dans ce didacticiel, nous verrons comment afficher un message d’erreur convivial, informatif doit se produire une exception lors d’une insertion, mise à jour ou opération de suppression de...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/17/2006
ms.topic: article
ms.assetid: 49d8a66c-3ea8-4087-839f-179d1d94512a
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs
msc.type: authoredcontent
ms.openlocfilehash: e7589584f3b0773a739b785c433ec45eeac3607e
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
<a name="handling-bll--and-dal-level-exceptions-in-an-aspnet-page-c"></a><span data-ttu-id="8f79a-103">La gestion des Exceptions au niveau de la couche BLL et de la couche DAL dans une Page ASP.NET (c#)</span><span class="sxs-lookup"><span data-stu-id="8f79a-103">Handling BLL- and DAL-Level Exceptions in an ASP.NET Page (C#)</span></span>
====================
<span data-ttu-id="8f79a-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="8f79a-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="8f79a-105">[Télécharger l’exemple d’application](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) ou [télécharger le PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span><span class="sxs-lookup"><span data-stu-id="8f79a-105">[Download Sample App](http://download.microsoft.com/download/9/c/1/9c1d03ee-29ba-4d58-aa1a-f201dcc822ea/ASPNET_Data_Tutorial_18_CS.exe) or [Download PDF](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/datatutorial18cs1.pdf)</span></span>

> <span data-ttu-id="8f79a-106">Dans ce didacticiel, nous verrons comment afficher un message d’erreur convivial, informatif doit se produire une exception lors d’une insertion, mise à jour ou opération de suppression d’un contrôle Web de données ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8f79a-106">In this tutorial we will see how to display a friendly, informative error message should an exception occur during an insert, update, or delete operation of an ASP.NET data Web control.</span></span>


## <a name="introduction"></a><span data-ttu-id="8f79a-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="8f79a-107">Introduction</span></span>

<span data-ttu-id="8f79a-108">Utilisation des données à partir de l’application web ASP.NET à l’aide d’une architecture d’application à plusieurs niveaux implique trois étapes générales suivantes :</span><span class="sxs-lookup"><span data-stu-id="8f79a-108">Working with data from an ASP.NET web application using a tiered application architecture involves the following three general steps:</span></span>

1. <span data-ttu-id="8f79a-109">Déterminer quelle méthode de la couche de logique métier doit être appelé et le paramètre des valeurs pour la passer.</span><span class="sxs-lookup"><span data-stu-id="8f79a-109">Determine what method of the Business Logic Layer needs to be invoked and what parameter values to pass it.</span></span> <span data-ttu-id="8f79a-110">Les valeurs de paramètre peuvent être codé en dur, assignée par programme, ou entrées entré par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-110">The parameter values can be hard coded, programmatically-assigned, or inputs entered by the user.</span></span>
2. <span data-ttu-id="8f79a-111">Appelez la méthode.</span><span class="sxs-lookup"><span data-stu-id="8f79a-111">Invoke the method.</span></span>
3. <span data-ttu-id="8f79a-112">Traiter les résultats.</span><span class="sxs-lookup"><span data-stu-id="8f79a-112">Process the results.</span></span> <span data-ttu-id="8f79a-113">Lorsque vous appelez une méthode de la couche BLL qui retourne des données, cela peut impliquer la liaison des données à un contrôle Web de données.</span><span class="sxs-lookup"><span data-stu-id="8f79a-113">When calling a BLL method that returns data, this may involve binding the data to a data Web control.</span></span> <span data-ttu-id="8f79a-114">Pour les méthodes BLL qui modifient les données, cela peut inclure l’exécution d’une action basée sur une valeur de retour ou en douceur gère toute exception qui a été créée à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="8f79a-114">For BLL methods that modify data, this may include performing some action based on a return value or gracefully handling any exception that arose in Step 2.</span></span>

<span data-ttu-id="8f79a-115">Comme nous l’avons vu dans la [didacticiel précédent](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), ObjectDataSource et les contrôles Web de données fournissent des points d’extensibilité pour les étapes 1 et 3.</span><span class="sxs-lookup"><span data-stu-id="8f79a-115">As we saw in the [previous tutorial](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md), both the ObjectDataSource and the data Web controls provide extensibility points for Steps 1 and 3.</span></span> <span data-ttu-id="8f79a-116">Le GridView, par exemple, déclenche son `RowUpdating` événement avant de pouvoir affecter ses valeurs de champ à son ObjectDataSource `UpdateParameters` collection ; sa `RowUpdated` événement est déclenché après l’ObjectDataSource a terminé l’opération.</span><span class="sxs-lookup"><span data-stu-id="8f79a-116">The GridView, for example, fires its `RowUpdating` event prior to assigning its field values to its ObjectDataSource's `UpdateParameters` collection; its `RowUpdated` event is raised after the ObjectDataSource has completed the operation.</span></span>

<span data-ttu-id="8f79a-117">Nous avons déjà examiné les événements qui déclenchent au cours de l’étape 1 et savez comment ils peuvent être utilisés pour personnaliser les paramètres d’entrée ou d’annuler l’opération.</span><span class="sxs-lookup"><span data-stu-id="8f79a-117">We've already examined the events that fire during Step 1 and have seen how they can be used to customize the input parameters or cancel the operation.</span></span> <span data-ttu-id="8f79a-118">Dans ce didacticiel, nous allons notre attention sur les événements qui déclenchent une fois l’opération terminée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-118">In this tutorial we'll turn our attention to the events that fire after the operation has completed.</span></span> <span data-ttu-id="8f79a-119">Avec ces gestionnaires d’événements post-niveau que pouvez, entre autres choses, déterminer si une exception s’est produite lors de l’opération et gérer de façon appropriée, afficher un message d’erreur convivial, information sur l’écran plutôt que par défaut pour ASP.NET standard page de l’exception.</span><span class="sxs-lookup"><span data-stu-id="8f79a-119">With these post-level event handlers we can, among other things, determine if an exception occurred during the operation and handle it gracefully, displaying a friendly, informative error message on the screen rather than defaulting to the standard ASP.NET exception page.</span></span>

<span data-ttu-id="8f79a-120">Pour illustrer l’utilisation de ces événements post-niveau, nous allons créer une page qui répertorie les produits dans un GridView modifiable.</span><span class="sxs-lookup"><span data-stu-id="8f79a-120">To illustrate working with these post-level events, let's create a page that lists the products in an editable GridView.</span></span> <span data-ttu-id="8f79a-121">Lorsque la mise à jour d’un produit, si une exception est levée notre ASP.NET page affiche un bref message ci-dessus le GridView qui explique qu’un problème s’est produite.</span><span class="sxs-lookup"><span data-stu-id="8f79a-121">When updating a product, if an exception is raised our ASP.NET page will display a short message above the GridView explaining that a problem has occurred.</span></span> <span data-ttu-id="8f79a-122">C’est parti !</span><span class="sxs-lookup"><span data-stu-id="8f79a-122">Let's get started!</span></span>

## <a name="step-1-creating-an-editable-gridview-of-products"></a><span data-ttu-id="8f79a-123">Étape 1 : Création d’un GridView modifiable de produits</span><span class="sxs-lookup"><span data-stu-id="8f79a-123">Step 1: Creating an Editable GridView of Products</span></span>

<span data-ttu-id="8f79a-124">Dans le didacticiel précédent, nous avons créé un GridView modifiable avec seulement deux champs, `ProductName` et `UnitPrice`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-124">In the previous tutorial we created an editable GridView with just two fields, `ProductName` and `UnitPrice`.</span></span> <span data-ttu-id="8f79a-125">Cela est requis la création d’une surcharge supplémentaire pour le `ProductsBLL` la classe `UpdateProduct` (méthode), celui qui acceptées uniquement trois paramètres d’entrée (nom du produit, le prix unitaire et ID) par opposition un paramètre pour chaque champ de produit.</span><span class="sxs-lookup"><span data-stu-id="8f79a-125">This required creating an additional overload for the `ProductsBLL` class's `UpdateProduct` method, one that only accepted three input parameters (the product's name, unit price, and ID) as opposed a parameter for each product field.</span></span> <span data-ttu-id="8f79a-126">Pour ce didacticiel, nous allons vous exercer cette technique, la création d’un contrôle GridView modifiable qui affiche le nom du produit, quantité par unité, le prix unitaire et des unités en stock, mais autorise uniquement le nom, le prix unitaire et des unités en stock à modifier.</span><span class="sxs-lookup"><span data-stu-id="8f79a-126">For this tutorial, let's practice this technique again, creating an editable GridView that displays the product's name, quantity per unit, unit price, and units in stock, but only allows the name, unit price, and units in stock to be edited.</span></span>

<span data-ttu-id="8f79a-127">Pour prendre en charge ce scénario, nous aurons besoin une autre surcharge de la `UpdateProduct` méthode, un constructeur qui accepte quatre paramètres : le nom du produit, le prix unitaire, les unités en stock et de code.</span><span class="sxs-lookup"><span data-stu-id="8f79a-127">To accommodate this scenario we'll need another overload of the `UpdateProduct` method, one that accepts four parameters: the product's name, unit price, units in stock, and ID.</span></span> <span data-ttu-id="8f79a-128">Ajoutez la méthode suivante à la `ProductsBLL` classe :</span><span class="sxs-lookup"><span data-stu-id="8f79a-128">Add the following method to the `ProductsBLL` class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample1.cs)]

<span data-ttu-id="8f79a-129">Cette méthode est terminée, nous sommes prêts à créer la page ASP.NET qui permet la modification de ces quatre champs produit particulier de.</span><span class="sxs-lookup"><span data-stu-id="8f79a-129">With this method complete, we're ready to create the ASP.NET page that allows for editing these four particular product fields.</span></span> <span data-ttu-id="8f79a-130">Ouvrez le `ErrorHandling.aspx` page dans le `EditInsertDelete` dossier et ajouter un contrôle GridView à la page via le concepteur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-130">Open the `ErrorHandling.aspx` page in the `EditInsertDelete` folder and add a GridView to the page through the Designer.</span></span> <span data-ttu-id="8f79a-131">Lier le contrôle GridView à une nouvelle ObjectDataSource, mappage la `Select()` méthode à la `ProductsBLL` la classe `GetProducts()` (méthode) et le `Update()` méthode à la `UpdateProduct` surcharge venez de créer.</span><span class="sxs-lookup"><span data-stu-id="8f79a-131">Bind the GridView to a new ObjectDataSource, mapping the `Select()` method to the `ProductsBLL` class's `GetProducts()` method and the `Update()` method to the `UpdateProduct` overload just created.</span></span>


<span data-ttu-id="8f79a-132">[![Utilisez la surcharge de méthode de UpdateProduct qui accepte quatre paramètres d’entrée](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-132">[![Use the UpdateProduct Method Overload That Accepts Four Input Parameters](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image2.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image1.png)</span></span>

<span data-ttu-id="8f79a-133">**Figure 1**: utilisez le `UpdateProduct` méthode surcharge qu’accepte quatre paramètres d’entrée ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-133">**Figure 1**: Use the `UpdateProduct` Method Overload That Accepts Four Input Parameters ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image3.png))</span></span>


<span data-ttu-id="8f79a-134">Cette opération crée un ObjectDataSource avec un `UpdateParameters` collection avec quatre paramètres et un GridView avec un champ pour chacun des champs de produit.</span><span class="sxs-lookup"><span data-stu-id="8f79a-134">This will create an ObjectDataSource with an `UpdateParameters` collection with four parameters and a GridView with a field for each of the product fields.</span></span> <span data-ttu-id="8f79a-135">Balisage déclaratif de l’ObjectDataSource affecte le `OldValuesParameterFormatString` la valeur de la propriété `original_{0}`, ce qui entraîne une exception, car la classe de notre BLL n’en attendez pas un paramètre d’entrée nommé `original_productID` à passer dans.</span><span class="sxs-lookup"><span data-stu-id="8f79a-135">The ObjectDataSource's declarative markup assigns the `OldValuesParameterFormatString` property the value `original_{0}`, which will cause an exception since our BLL class's don't expect an input parameter named `original_productID` to be passed in.</span></span> <span data-ttu-id="8f79a-136">N’oubliez pas de supprimer ce paramètre complètement à partir de la syntaxe déclarative (ou affectez-lui la valeur par défaut, `{0}`).</span><span class="sxs-lookup"><span data-stu-id="8f79a-136">Don't forget to remove this setting altogether from the declarative syntax (or set it to the default value, `{0}`).</span></span>

<span data-ttu-id="8f79a-137">Ensuite, alléger le contrôle GridView à inclure uniquement les `ProductName`, `QuantityPerUnit`, `UnitPrice`, et `UnitsInStock` BoundFields.</span><span class="sxs-lookup"><span data-stu-id="8f79a-137">Next, pare down the GridView to include only the `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` BoundFields.</span></span> <span data-ttu-id="8f79a-138">N’hésitez pas à appliquer au niveau du champ mise en forme vous jugez nécessaires (telles que la modification du `HeaderText` propriétés).</span><span class="sxs-lookup"><span data-stu-id="8f79a-138">Also feel free to apply any field-level formatting you deem necessary (such as changing the `HeaderText` properties).</span></span>

<span data-ttu-id="8f79a-139">Dans le didacticiel précédent, nous avons à la mise en forme le `UnitPrice` BoundField sous forme de devise à la fois en mode lecture seule et en mode édition.</span><span class="sxs-lookup"><span data-stu-id="8f79a-139">In the previous tutorial we looked at how to format the `UnitPrice` BoundField as a currency both in read-only mode and edit mode.</span></span> <span data-ttu-id="8f79a-140">Nous allons suivre le même ici.</span><span class="sxs-lookup"><span data-stu-id="8f79a-140">Let's do the same here.</span></span> <span data-ttu-id="8f79a-141">Rappelez-vous que cela nécessite la définition de la BoundField `DataFormatString` propriété `{0:c}`, ses `HtmlEncode` propriété `false`et son `ApplyFormatInEditMode` à `true`, comme illustré dans la Figure 2.</span><span class="sxs-lookup"><span data-stu-id="8f79a-141">Recall that this required setting the BoundField's `DataFormatString` property to `{0:c}`, its `HtmlEncode` property to `false`, and its `ApplyFormatInEditMode` to `true`, as shown in Figure 2.</span></span>


<span data-ttu-id="8f79a-142">[![Configurer le prix unitaire BoundField à afficher sous forme de devise](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-142">[![Configure the UnitPrice BoundField to Display as a Currency](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image5.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image4.png)</span></span>

<span data-ttu-id="8f79a-143">**Figure 2**: configurer le `UnitPrice` BoundField à afficher sous forme de devise ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-143">**Figure 2**: Configure the `UnitPrice` BoundField to Display as a Currency ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image6.png))</span></span>


<span data-ttu-id="8f79a-144">Mise en forme le `UnitPrice` comme une devise dans l’interface de modification nécessite la création d’un gestionnaire d’événements pour le contrôle du GridView `RowUpdating` événement qui analyse la chaîne au format monétaire dans un `decimal` valeur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-144">Formatting the `UnitPrice` as a currency in the editing interface requires creating an event handler for the GridView's `RowUpdating` event that parses the currency-formatted string into a `decimal` value.</span></span> <span data-ttu-id="8f79a-145">N’oubliez pas que le `RowUpdating` Gestionnaire d’événements à partir du dernier didacticiel également vérifiés pour s’assurer que l’utilisateur fourni un `UnitPrice` valeur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-145">Recall that the `RowUpdating` event handler from the last tutorial also checked to ensure that the user provided a `UnitPrice` value.</span></span> <span data-ttu-id="8f79a-146">Toutefois, pour ce didacticiel, nous allons autoriser l’utilisateur à omettre le prix.</span><span class="sxs-lookup"><span data-stu-id="8f79a-146">However, for this tutorial let's allow the user to omit the price.</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample2.cs)]

<span data-ttu-id="8f79a-147">Notre GridView inclut un `QuantityPerUnit` BoundField, mais cette BoundField doit être uniquement à des fins d’affichage et ne doit pas être modifiées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-147">Our GridView includes a `QuantityPerUnit` BoundField, but this BoundField should be only for display purposes and should not be editable by the user.</span></span> <span data-ttu-id="8f79a-148">Pour ce faire, il suffit de définir la BoundFields' `ReadOnly` propriété `true`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-148">To arrange this, simply set the BoundFields' `ReadOnly` property to `true`.</span></span>


<span data-ttu-id="8f79a-149">[![Définir le QuantityPerUnit BoundField en lecture seule](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-149">[![Make the QuantityPerUnit BoundField Read-Only](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image8.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image7.png)</span></span>

<span data-ttu-id="8f79a-150">**Figure 3**: Vérifiez la `QuantityPerUnit` BoundField en lecture seule ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-150">**Figure 3**: Make the `QuantityPerUnit` BoundField Read-Only ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image9.png))</span></span>


<span data-ttu-id="8f79a-151">Enfin, vérifiez la case à cocher Activer la modification de la balise active du GridView.</span><span class="sxs-lookup"><span data-stu-id="8f79a-151">Finally, check the Enable Editing checkbox from the GridView's smart tag.</span></span> <span data-ttu-id="8f79a-152">Après avoir effectué ces étapes le `ErrorHandling.aspx` le Concepteur de la page doit ressembler à la Figure 4.</span><span class="sxs-lookup"><span data-stu-id="8f79a-152">After completing these steps the `ErrorHandling.aspx` page's Designer should look similar to Figure 4.</span></span>


<span data-ttu-id="8f79a-153">[![Supprimer tous les dossiers sauf nécessaire BoundFields et vérifiez l’activer la case à cocher de modification](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-153">[![Remove All But the Needed BoundFields and Check the Enable Editing Checkbox](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image11.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image10.png)</span></span>

<span data-ttu-id="8f79a-154">**Figure 4**: supprimez tout le nécessaire BoundFields et cocher la case Activer la modification ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-154">**Figure 4**: Remove All But the Needed BoundFields and Check the Enable Editing Checkbox ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image12.png))</span></span>


<span data-ttu-id="8f79a-155">À ce stade, nous avons une liste de tous les produits `ProductName`, `QuantityPerUnit`, `UnitPrice`, et `UnitsInStock` champs ; Toutefois, seuls le `ProductName`, `UnitPrice`, et `UnitsInStock` champs peuvent être modifiés.</span><span class="sxs-lookup"><span data-stu-id="8f79a-155">At this point we have a list of all of the products' `ProductName`, `QuantityPerUnit`, `UnitPrice`, and `UnitsInStock` fields; however, only the `ProductName`, `UnitPrice`, and `UnitsInStock` fields can be edited.</span></span>


<span data-ttu-id="8f79a-156">[![Les utilisateurs peuvent désormais facilement modifier les noms des produits, les prix et les unités en Stock champs](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-156">[![Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image14.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image13.png)</span></span>

<span data-ttu-id="8f79a-157">**Figure 5**: les utilisateurs peuvent désormais facilement modifier produits noms prix et champs unités en Stock ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-157">**Figure 5**: Users Can Now Easily Edit Products' Names, Prices, and Units In Stock Fields ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image15.png))</span></span>


## <a name="step-2-gracefully-handling-dal-level-exceptions"></a><span data-ttu-id="8f79a-158">Étape 2 : Gestion normalement des Exceptions au niveau de la couche DAL</span><span class="sxs-lookup"><span data-stu-id="8f79a-158">Step 2: Gracefully Handling DAL-Level Exceptions</span></span>

<span data-ttu-id="8f79a-159">Bien que notre GridView modifiable fonctionne très lorsque les utilisateurs entrent des valeurs autorisées pour le nom du produit modifié, les prix et les unités en stock, entrer des valeurs illégales entraîne une exception.</span><span class="sxs-lookup"><span data-stu-id="8f79a-159">While our editable GridView works wonderfully when users enter legal values for the edited product's name, price, and units in stock, entering illegal values results in an exception.</span></span> <span data-ttu-id="8f79a-160">Par exemple, si vous omettez le `ProductName` valeur entraîne une [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) levée depuis le `ProductName` propriété dans le `ProdcutsRow` classe a son `AllowDBNull` propriété la valeur `false`; si la base de données est arrêté, un `SqlException` seront levées par le TableAdapter lorsque vous tentez de vous connecter à la base de données.</span><span class="sxs-lookup"><span data-stu-id="8f79a-160">For example, omitting the `ProductName` value causes a [NoNullAllowedException](https://msdn.microsoft.com/library/default.asp?url=/library/cpref/html/frlrfsystemdatanonullallowedexceptionclasstopic.asp) to be thrown since the `ProductName` property in the `ProdcutsRow` class has its `AllowDBNull` property set to `false`; if the database is down, a `SqlException` will be thrown by the TableAdapter when attempting to connect to the database.</span></span> <span data-ttu-id="8f79a-161">Sans effectuer aucune action, ces exceptions se propagent de la couche d’accès aux données à la couche de logique métier, puis dans la page ASP.NET et enfin à l’exécution d’ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8f79a-161">Without taking any action, these exceptions bubble up from the Data Access Layer to the Business Logic Layer, then to the ASP.NET page, and finally to the ASP.NET runtime.</span></span>

<span data-ttu-id="8f79a-162">En fonction de la configuration de votre application web et ou non que vous visitez l’application à partir de `localhost`, une exception non gérée peut entraîner une page d’erreur de serveur générique, un rapport d’erreur détaillé ou une page web conviviale.</span><span class="sxs-lookup"><span data-stu-id="8f79a-162">Depending on how your web application is configured and whether or not you're visiting the application from `localhost`, an unhandled exception can result in either a generic server-error page, a detailed error report, or a user-friendly web page.</span></span> <span data-ttu-id="8f79a-163">Consultez [Web Application une gestion d’erreurs dans ASP.NET](http://www.15seconds.com/issue/030102.htm) et [customErrors, élément](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) pour plus d’informations sur la façon dont le runtime ASP.NET répond à une exception non interceptée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-163">See [Web Application Error Handling in ASP.NET](http://www.15seconds.com/issue/030102.htm) and the [customErrors Element](https://msdn.microsoft.com/library/h0hfz6fc(VS.80).aspx) for more information on how the ASP.NET runtime responds to an uncaught exception.</span></span>

<span data-ttu-id="8f79a-164">La figure 6 illustre l’écran rencontré lors de la tentative de mise à jour d’un produit sans spécifier le `ProductName` valeur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-164">Figure 6 shows the screen encountered when attempting to update a product without specifying the `ProductName` value.</span></span> <span data-ttu-id="8f79a-165">Ceci est la valeur par défaut, le rapport d’erreurs détaillées affiché lorsque provenant de `localhost`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-165">This is the default detailed error report displayed when coming through `localhost`.</span></span>


<span data-ttu-id="8f79a-166">[![L’omission de détails de l’Exception affichage nom du produit](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-166">[![Omitting the Product's Name Will Display Exception Details](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image17.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image16.png)</span></span>

<span data-ttu-id="8f79a-167">**Figure 6**: l’omission nom sera affichage Détails du produit de l’Exception ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-167">**Figure 6**: Omitting the Product's Name Will Display Exception Details ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image18.png))</span></span>


<span data-ttu-id="8f79a-168">Si ces détails de l’exception sont utiles lorsque vous testez une application, présentant un utilisateur final d’écran en cas d’une exception est loin d’être idéal.</span><span class="sxs-lookup"><span data-stu-id="8f79a-168">While such exception details are helpful when testing an application, presenting an end user with such a screen in the face of an exception is less than ideal.</span></span> <span data-ttu-id="8f79a-169">Un utilisateur final probable ne sait pas ce un `NoNullAllowedException` est ou de la raison pour laquelle elle a été générée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-169">An end user likely doesn't know what a `NoNullAllowedException` is or why it was caused.</span></span> <span data-ttu-id="8f79a-170">Une meilleure approche consiste à l’utilisateur avec un message plus convivial expliquant que pose tente de mettre à jour le produit.</span><span class="sxs-lookup"><span data-stu-id="8f79a-170">A better approach is to present the user with a more user-friendly message explaining that there were problems attempting to update the product.</span></span>

<span data-ttu-id="8f79a-171">Si une exception se produit lors de l’exécution de l’opération, les événements post-niveau dans ObjectDataSource et le contrôle de données Web fournissent un moyen de détecter et d’annuler l’exception de se propager à l’exécution d’ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8f79a-171">If an exception occurs when performing the operation, the post-level events in both the ObjectDataSource and the data Web control provide a means to detect it and cancel the exception from bubbling up to the ASP.NET runtime.</span></span> <span data-ttu-id="8f79a-172">Dans notre exemple, nous allons créer un gestionnaire d’événements pour le contrôle du GridView `RowUpdated` événement qui détermine si une exception a été déclenchée et, dans ce cas, affiche les détails de l’exception dans un contrôle Web Label.</span><span class="sxs-lookup"><span data-stu-id="8f79a-172">For our example, let's create an event handler for the GridView's `RowUpdated` event that determines if an exception has fired and, if so, displays the exception details in a Label Web control.</span></span>

<span data-ttu-id="8f79a-173">Commencez par ajouter une étiquette à la page ASP.NET, en définissant ses `ID` propriété `ExceptionDetails` et supprimant sa `Text` propriété.</span><span class="sxs-lookup"><span data-stu-id="8f79a-173">Start by adding a Label to the ASP.NET page, setting its `ID` property to `ExceptionDetails` and clearing out its `Text` property.</span></span> <span data-ttu-id="8f79a-174">Pour dessiner des yeux de l’utilisateur à ce message, définissez son `CssClass` propriété `Warning`, qui est une classe CSS que nous avons ajouté à la `Styles.css` fichier dans le didacticiel précédent.</span><span class="sxs-lookup"><span data-stu-id="8f79a-174">In order to draw the user's eye to this message, set its `CssClass` property to `Warning`, which is a CSS class we added to the `Styles.css` file in the previous tutorial.</span></span> <span data-ttu-id="8f79a-175">Rappelez-vous que cette classe CSS provoque le texte de l’étiquette à afficher dans une police rouge, gras, italique très grande taille.</span><span class="sxs-lookup"><span data-stu-id="8f79a-175">Recall that this CSS class causes the Label's text to be displayed in a red, italic, bold, extra large font.</span></span>


<span data-ttu-id="8f79a-176">[![Ajouter un contrôle Web d’étiquette à la Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-176">[![Add a Label Web Control to the Page](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image20.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image19.png)</span></span>

<span data-ttu-id="8f79a-177">**Figure 7**: ajouter un contrôle Web d’étiquette à la Page ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-177">**Figure 7**: Add a Label Web Control to the Page ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image21.png))</span></span>


<span data-ttu-id="8f79a-178">Comme nous voulons que ce contrôle Web Label soit visible uniquement immédiatement après une exception s’est produite, définissez son `Visible` propriété sur false dans le `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="8f79a-178">Since we want this Label Web control to be visible only immediately after an exception has occurred, set its `Visible` property to false in the `Page_Load` event handler:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample3.cs)]

<span data-ttu-id="8f79a-179">Avec ce code, sur la première visite de page et les publications ultérieures le `ExceptionDetails` contrôle aura son `Visible` propriété `false`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-179">With this code, on the first page visit and subsequent postbacks the `ExceptionDetails` control will have its `Visible` property set to `false`.</span></span> <span data-ttu-id="8f79a-180">En cas d’une exception au niveau de la couche DAL ou de la couche BLL, ce qui nous pouvons détecter dans le GridView `RowUpdated` Gestionnaire d’événements, nous allons définir le `ExceptionDetails` du contrôle `Visible` true à la propriété.</span><span class="sxs-lookup"><span data-stu-id="8f79a-180">In the face of a DAL- or BLL-level exception, which we can detect in the GridView's `RowUpdated` event handler, we will set the `ExceptionDetails` control's `Visible` property to true.</span></span> <span data-ttu-id="8f79a-181">Étant donné que les gestionnaires d’événements de contrôle Web se produisent après le `Page_Load` Gestionnaire d’événements dans le cycle de vie de page, l’étiquette s’affiche.</span><span class="sxs-lookup"><span data-stu-id="8f79a-181">Since Web control event handlers occur after the `Page_Load` event handler in the page lifecycle, the Label will be shown.</span></span> <span data-ttu-id="8f79a-182">Toutefois, sur la publication suivante, le `Page_Load` reviendra de gestionnaire d’événements le `Visible` propriété revenir `false`, masquer à nouveau à partir de la vue.</span><span class="sxs-lookup"><span data-stu-id="8f79a-182">However, on the next postback, the `Page_Load` event handler will revert the `Visible` property back to `false`, hiding it from view again.</span></span>

> [!NOTE]
> <span data-ttu-id="8f79a-183">Ou bien, nous pouvons éliminer la nécessité pour le paramètre la `ExceptionDetails` du contrôle `Visible` propriété dans `Page_Load` en attribuant son `Visible` propriété `false` dans la syntaxe déclarative et la désactivation de son état d’affichage (définissant son `EnableViewState` propriété `false`).</span><span class="sxs-lookup"><span data-stu-id="8f79a-183">Alternatively, we could remove the necessity for setting the `ExceptionDetails` control's `Visible` property in `Page_Load` by assigning its `Visible` property `false` in the declarative syntax and disabling its view state (setting its `EnableViewState` property to `false`).</span></span> <span data-ttu-id="8f79a-184">Nous allons utiliser cette approche alternative dans un didacticiel futures.</span><span class="sxs-lookup"><span data-stu-id="8f79a-184">We'll use this alternative approach in a future tutorial.</span></span>


<span data-ttu-id="8f79a-185">Avec le contrôle Label est ajouté, est l’étape suivante pour créer le Gestionnaire d’événements pour le contrôle du GridView `RowUpdated` événement.</span><span class="sxs-lookup"><span data-stu-id="8f79a-185">With the Label control added, our next step is to create the event handler for the GridView's `RowUpdated` event.</span></span> <span data-ttu-id="8f79a-186">Sélectionnez le contrôle GridView dans le concepteur, accédez à la fenêtre Propriétés, cliquez sur l’icône d’éclair, qui répertorie les événements de GridView.</span><span class="sxs-lookup"><span data-stu-id="8f79a-186">Select the GridView in the Designer, go to the Properties window, and click the lightning bolt icon, listing the GridView's events.</span></span> <span data-ttu-id="8f79a-187">Il doit déjà être il d’une entrée pour le contrôle du GridView `RowUpdating` événement, comme nous avons créé un gestionnaire d’événements pour cet événement plus haut dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="8f79a-187">There should already be an entry there for the GridView's `RowUpdating` event, as we created an event handler for this event earlier in this tutorial.</span></span> <span data-ttu-id="8f79a-188">Créer un gestionnaire d’événements pour le `RowUpdated` également des événements.</span><span class="sxs-lookup"><span data-stu-id="8f79a-188">Create an event handler for the `RowUpdated` event as well.</span></span>


![Créer un gestionnaire d’événements pour l’événement RowUpdated de GridView](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image22.png)

<span data-ttu-id="8f79a-190">**Figure 8**: créer un gestionnaire d’événements pour le contrôle du GridView `RowUpdated` événement</span><span class="sxs-lookup"><span data-stu-id="8f79a-190">**Figure 8**: Create an Event Handler for the GridView's `RowUpdated` Event</span></span>


> [!NOTE]
> <span data-ttu-id="8f79a-191">Vous pouvez également créer le Gestionnaire d’événements via les listes déroulantes en haut du fichier de classe code-behind.</span><span class="sxs-lookup"><span data-stu-id="8f79a-191">You can also create the event handler through the drop-down lists at the top of the code-behind class file.</span></span> <span data-ttu-id="8f79a-192">Sélectionnez le contrôle GridView à partir de la liste déroulante à gauche et le `RowUpdated` événement à partir de celui situé à droite.</span><span class="sxs-lookup"><span data-stu-id="8f79a-192">Select the GridView from the drop-down list on the left and the `RowUpdated` event from the one on the right.</span></span>


<span data-ttu-id="8f79a-193">Création de ce gestionnaire d’événements ajoute le code suivant à la classe code-behind de la page ASP.NET :</span><span class="sxs-lookup"><span data-stu-id="8f79a-193">Creating this event handler will add the following code to the ASP.NET page's code-behind class:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample4.cs)]

<span data-ttu-id="8f79a-194">Second paramètre de ce gestionnaire d’événements est un objet de type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), qui a trois propriétés dignes d’intérêt pour la gestion des exceptions :</span><span class="sxs-lookup"><span data-stu-id="8f79a-194">This event handler's second input parameter is an object of type [GridViewUpdatedEventArgs](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridviewupdatedeventargs.aspx), which has three properties of interest for handling exceptions:</span></span>

- <span data-ttu-id="8f79a-195">`Exception` une référence à l’exception levée ; Si aucune exception n’a été levée, cette propriété a une valeur `null`</span><span class="sxs-lookup"><span data-stu-id="8f79a-195">`Exception` a reference to the thrown exception; if no exception has been thrown, this property will have a value of `null`</span></span>
- <span data-ttu-id="8f79a-196">`ExceptionHandled` valeur booléenne qui indique si l’exception a été gérée dans le `RowUpdated` Gestionnaire d’événements ; si `false` (la valeur par défaut), l’exception est à nouveau levée, percolation jusqu'à l’exécution d’ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8f79a-196">`ExceptionHandled` a Boolean value that indicates whether or not the exception was handled in the `RowUpdated` event handler; if `false` (the default), the exception is re-thrown, percolating up to the ASP.NET runtime</span></span>
- <span data-ttu-id="8f79a-197">`KeepInEditMode` Si la valeur `true` la ligne GridView modifiée reste en mode édition ; si `false` (la valeur par défaut), la ligne GridView revienne à son mode de lecture seule</span><span class="sxs-lookup"><span data-stu-id="8f79a-197">`KeepInEditMode` if set to `true` the edited GridView row remains in edit mode; if `false` (the default), the GridView row reverts back to its read-only mode</span></span>

<span data-ttu-id="8f79a-198">Notre code, puis vérifiez si `Exception` n’est pas `null`, ce qui signifie que qu’une exception a été levée pendant l’opération.</span><span class="sxs-lookup"><span data-stu-id="8f79a-198">Our code, then, should check to see if `Exception` is not `null`, meaning that an exception was raised while performing the operation.</span></span> <span data-ttu-id="8f79a-199">Si c’est le cas, nous voulons :</span><span class="sxs-lookup"><span data-stu-id="8f79a-199">If this is the case, we want to:</span></span>

- <span data-ttu-id="8f79a-200">Affichez un message convivial dans le `ExceptionDetails` étiquette</span><span class="sxs-lookup"><span data-stu-id="8f79a-200">Display a user-friendly message in the `ExceptionDetails` Label</span></span>
- <span data-ttu-id="8f79a-201">Indiquer que l’exception a été gérée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-201">Indicate that the exception was handled</span></span>
- <span data-ttu-id="8f79a-202">Conserver la ligne GridView en mode édition</span><span class="sxs-lookup"><span data-stu-id="8f79a-202">Keep the GridView row in edit mode</span></span>

<span data-ttu-id="8f79a-203">Le code suivant effectue ces objectifs :</span><span class="sxs-lookup"><span data-stu-id="8f79a-203">This following code accomplishes these objectives:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample5.cs)]

<span data-ttu-id="8f79a-204">Ce gestionnaire d’événements commence par vérifier si `e.Exception` est `null`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-204">This event handler begins by checking to see if `e.Exception` is `null`.</span></span> <span data-ttu-id="8f79a-205">S’il n’est pas le cas, le `ExceptionDetails` l’étiquette `Visible` est définie sur `true` et son `Text` propriété « S’est un problème de mise à jour du produit. »</span><span class="sxs-lookup"><span data-stu-id="8f79a-205">If it's not, the `ExceptionDetails` Label's `Visible` property is set to `true` and its `Text` property to "There was a problem updating the product."</span></span> <span data-ttu-id="8f79a-206">Les détails de l’exception réelle qui a été levée résident dans le `e.Exception` l’objet `InnerException` propriété.</span><span class="sxs-lookup"><span data-stu-id="8f79a-206">The details of the actual exception that was thrown reside in the `e.Exception` object's `InnerException` property.</span></span> <span data-ttu-id="8f79a-207">Cette exception interne est vérifiée et, s’il s’agit d’un type particulier, un message supplémentaire, utile est ajouté à la `ExceptionDetails` l’étiquette `Text` propriété.</span><span class="sxs-lookup"><span data-stu-id="8f79a-207">This inner exception is examined and, if it is of a particular type, an additional, helpful message is appended to the `ExceptionDetails` Label's `Text` property.</span></span> <span data-ttu-id="8f79a-208">Enfin, le `ExceptionHandled` et `KeepInEditMode` propriétés sont définies sur `true`.</span><span class="sxs-lookup"><span data-stu-id="8f79a-208">Lastly, the `ExceptionHandled` and `KeepInEditMode` properties are both set to `true`.</span></span>

<span data-ttu-id="8f79a-209">La figure 9 illustre une capture d’écran de cette page lors de l’omission du nom du produit ; La figure 10 illustre les résultats lorsque vous entrez une instruction non conforme `UnitPrice` valeur (-50).</span><span class="sxs-lookup"><span data-stu-id="8f79a-209">Figure 9 shows a screen shot of this page when omitting the name of the product; Figure 10 shows the results when entering an illegal `UnitPrice` value (-50).</span></span>


<span data-ttu-id="8f79a-210">[![Le ProductName BoundField doit contenir une valeur](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-210">[![The ProductName BoundField Must Contain a Value](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image24.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image23.png)</span></span>

<span data-ttu-id="8f79a-211">**Figure 9**: le `ProductName` BoundField doit contenir une valeur ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-211">**Figure 9**: The `ProductName` BoundField Must Contain a Value ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image25.png))</span></span>


<span data-ttu-id="8f79a-212">[![Les valeurs négatives UnitPrice sont pas autorisées](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-212">[![Negative UnitPrice Values are Not Allowed](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image27.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image26.png)</span></span>

<span data-ttu-id="8f79a-213">**La figure 10**: négatif `UnitPrice` les valeurs sont pas autorisés ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-213">**Figure 10**: Negative `UnitPrice` Values are Not Allowed ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image28.png))</span></span>


<span data-ttu-id="8f79a-214">En définissant le `e.ExceptionHandled` propriété `true`, le `RowUpdated` Gestionnaire d’événements a indiqué qu’il a géré l’exception.</span><span class="sxs-lookup"><span data-stu-id="8f79a-214">By setting the `e.ExceptionHandled` property to `true`, the `RowUpdated` event handler has indicated that it has handled the exception.</span></span> <span data-ttu-id="8f79a-215">Par conséquent, l’exception ne se propage jusqu'à l’exécution d’ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="8f79a-215">Therefore, the exception won't propagate up to the ASP.NET runtime.</span></span>

> [!NOTE]
> <span data-ttu-id="8f79a-216">Figures 9 et 10 montrent un moyen approprié pour gérer les exceptions levées en raison d’une entrée d’utilisateur non valide.</span><span class="sxs-lookup"><span data-stu-id="8f79a-216">Figures 9 and 10 show a graceful way to handle exceptions raised due to invalid user input.</span></span> <span data-ttu-id="8f79a-217">Dans l’idéal, cependant, ce type d’entrée non valide ne peut pas atteindre la couche de logique métier en premier lieu, comme la page ASP.NET doit s’assurer que les entrées de l’utilisateur sont valides avant d’appeler le `ProductsBLL` la classe `UpdateProduct` (méthode).</span><span class="sxs-lookup"><span data-stu-id="8f79a-217">Ideally, though, such invalid input will never reach the Business Logic Layer in the first place, as the ASP.NET page should ensure that the user's inputs are valid before invoking the `ProductsBLL` class's `UpdateProduct` method.</span></span> <span data-ttu-id="8f79a-218">Dans notre didacticiel suivant, que nous verrons comment ajouter des contrôles de validation pour les interfaces de modification et d’insertion pour vous assurer que les données envoyées à la couche de logique métier est conforme aux règles d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="8f79a-218">In our next tutorial we'll see how to add validation controls to the editing and inserting interfaces to ensure that the data submitted to the Business Logic Layer conforms to the business rules.</span></span> <span data-ttu-id="8f79a-219">Les contrôles de validation n'empêchent pas seulement l’appel de la `UpdateProduct` méthode jusqu'à ce que les données fournies par l’utilisateur sont valides, mais également fournissent une expérience utilisateur plus explicites pour l’identification des problèmes de saisie de données.</span><span class="sxs-lookup"><span data-stu-id="8f79a-219">The validation controls not only prevent the invocation of the `UpdateProduct` method until the user-supplied data is valid, but also provide a more informative user experience for identifying data entry problems.</span></span>


## <a name="step-3-gracefully-handling-bll-level-exceptions"></a><span data-ttu-id="8f79a-220">Étape 3 : Traitement normalement des Exceptions au niveau de la couche BLL</span><span class="sxs-lookup"><span data-stu-id="8f79a-220">Step 3: Gracefully Handling BLL-Level Exceptions</span></span>

<span data-ttu-id="8f79a-221">Lors de l’insertion, mise à jour ou supprimer des données, la couche d’accès aux données peut lever une exception en cas d’une erreur liée aux données.</span><span class="sxs-lookup"><span data-stu-id="8f79a-221">When inserting, updating, or deleting data, the Data Access Layer may throw an exception in the face of a data-related error.</span></span> <span data-ttu-id="8f79a-222">La base de données est peut-être hors connexion, une colonne de table de base de données requise aviez ne peut-être pas une valeur spécifiée ou une contrainte de niveau table a été violée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-222">The database may be offline, a required database table column might not have had a value specified, or a table-level constraint may have been violated.</span></span> <span data-ttu-id="8f79a-223">En plus des exceptions strictement liées aux données, la couche de logique métier pouvez utiliser des exceptions pour indiquer les cas de non-respect des règles d’entreprise.</span><span class="sxs-lookup"><span data-stu-id="8f79a-223">In addition to strictly data-related exceptions, the Business Logic Layer can use exceptions to indicate when business rules have been violated.</span></span> <span data-ttu-id="8f79a-224">Dans le [création d’une couche de logique métier](../introduction/creating-a-business-logic-layer-cs.md) (didacticiel), par exemple, nous avons ajouté une vérification de règle d’entreprise à l’original `UpdateProduct` de surcharge.</span><span class="sxs-lookup"><span data-stu-id="8f79a-224">In the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-cs.md) tutorial, for example, we added a business rule check to the original `UpdateProduct` overload.</span></span> <span data-ttu-id="8f79a-225">Plus précisément, si l’utilisateur a été marquant un produit comme étant suspendus, nous requis que le produit doit ne pas être la seule fournie par son fournisseur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-225">Specifically, if the user was marking a product as discontinued, we required that the product not be the only one provided by its supplier.</span></span> <span data-ttu-id="8f79a-226">Si cette condition a été violée, un `ApplicationException` a été levée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-226">If this condition was violated, an `ApplicationException` was thrown.</span></span>

<span data-ttu-id="8f79a-227">Pour le `UpdateProduct` surcharge créé dans ce didacticiel, vous allez ajouter une règle d’entreprise qui interdit le `UnitPrice` champ définie sur une nouvelle valeur qui est supérieur au double de l’original `UnitPrice` valeur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-227">For the `UpdateProduct` overload created in this tutorial, let's add a business rule that prohibits the `UnitPrice` field from being set to a new value that's more than twice the original `UnitPrice` value.</span></span> <span data-ttu-id="8f79a-228">Pour ce faire, vous devez ajuster le `UpdateProduct` surcharge afin qu’il effectue cette vérification et lève un `ApplicationException` si la règle est violée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-228">To accomplish this, adjust the `UpdateProduct` overload so that it performs this check and throws an `ApplicationException` if the rule is violated.</span></span> <span data-ttu-id="8f79a-229">La méthode de mise à jour suivante :</span><span class="sxs-lookup"><span data-stu-id="8f79a-229">The updated method follows:</span></span>


[!code-csharp[Main](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/samples/sample6.cs)]

<span data-ttu-id="8f79a-230">Avec cette modification, toute mise à jour de prix est supérieur à deux fois le prix existant entraîne une `ApplicationException` levée.</span><span class="sxs-lookup"><span data-stu-id="8f79a-230">With this change, any price update that is more than twice the existing price will cause an `ApplicationException` to be thrown.</span></span> <span data-ttu-id="8f79a-231">Tout comme l’exception levée à partir de la couche DAL, ce déclenché par couche BLL `ApplicationException` peuvent être détectés et gérés dans le GridView `RowUpdated` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="8f79a-231">Just like the exception raised from the DAL, this BLL-raised `ApplicationException` can be detected and handled in the GridView's `RowUpdated` event handler.</span></span> <span data-ttu-id="8f79a-232">En fait, le `RowUpdated` code du Gestionnaire d’événements lors de l’écriture, correctement détecte cette exception et afficher le `ApplicationException`de `Message` valeur de propriété.</span><span class="sxs-lookup"><span data-stu-id="8f79a-232">In fact, the `RowUpdated` event handler's code, as written, will correctly detect this exception and display the `ApplicationException`'s `Message` property value.</span></span> <span data-ttu-id="8f79a-233">La figure 11 illustre un capture d’écran lors un utilisateur tente de mettre à jour le prix de Tran à 50,00 $, qui est supérieure à deux fois son prix courant de 19,95 $.</span><span class="sxs-lookup"><span data-stu-id="8f79a-233">Figure 11 shows a screen shot when a user attempts to update the price of Chai to $50.00, which is more than double its current price of $19.95.</span></span>


<span data-ttu-id="8f79a-234">[![Les règles d’entreprise interdire les augmentations de prix que plus de deux fois le prix d’un produit](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="8f79a-234">[![The Business Rules Disallow Price Increases That More Than Double a Product's Price](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image30.png)](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image29.png)</span></span>

<span data-ttu-id="8f79a-235">**Figure 11**: interdire les augmentations de prix plus de deux fois le prix d’un produit des règles d’entreprise ([cliquez pour afficher l’image en taille réelle](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span><span class="sxs-lookup"><span data-stu-id="8f79a-235">**Figure 11**: The Business Rules Disallow Price Increases That More Than Double a Product's Price ([Click to view full-size image](handling-bll-and-dal-level-exceptions-in-an-asp-net-page-cs/_static/image31.png))</span></span>


> [!NOTE]
> <span data-ttu-id="8f79a-236">Dans l’idéal seraient de refactoriser nos règles de logique métier de le `UpdateProduct` surcharges de méthode dans une méthode courante.</span><span class="sxs-lookup"><span data-stu-id="8f79a-236">Ideally our business logic rules would be refactored out of the `UpdateProduct` method overloads and into a common method.</span></span> <span data-ttu-id="8f79a-237">Cela est considérée comme un exercice pour le lecteur.</span><span class="sxs-lookup"><span data-stu-id="8f79a-237">This is left as an exercise for the reader.</span></span>


## <a name="summary"></a><span data-ttu-id="8f79a-238">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="8f79a-238">Summary</span></span>

<span data-ttu-id="8f79a-239">Pendant l’insertion, mise à jour et la suppression des opérations, à la fois le données Web et le contrôle ObjectDataSource impliqués déclenchent les événements antérieurs et postérieurs au niveau que l’opération réelle serre-livres.</span><span class="sxs-lookup"><span data-stu-id="8f79a-239">During inserting, updating, and deleting operations, both the data Web control and the ObjectDataSource involved fire pre- and post-level events that bookend the actual operation.</span></span> <span data-ttu-id="8f79a-240">Comme nous l’avons vu dans ce didacticiel et le précédent, lorsque vous travaillez avec un GridView modifiable du GridView `RowUpdating` événement se déclenche, suivie de l’ObjectDataSource `Updating` événement, à partir de laquelle la commande de mise à jour est effectuée à l’ObjectDataSource objet sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="8f79a-240">As we saw in this tutorial and the preceding one, when working with an editable GridView the GridView's `RowUpdating` event fires, followed by the ObjectDataSource's `Updating` event, at which point the update command is made to the ObjectDataSource's underlying object.</span></span> <span data-ttu-id="8f79a-241">Une fois l’opération terminée, l’ObjectDataSource `Updated` se déclenche l’événement, suivi du GridView `RowUpdated` événement.</span><span class="sxs-lookup"><span data-stu-id="8f79a-241">After the operation has completed, the ObjectDataSource's `Updated` event fires, followed by the GridView's `RowUpdated` event.</span></span>

<span data-ttu-id="8f79a-242">Nous pouvons créer des gestionnaires d’événements pour les événements de niveau préalable afin de personnaliser les paramètres d’entrée ou pour les événements post-niveau pour inspecter et répondre aux résultats de l’opération.</span><span class="sxs-lookup"><span data-stu-id="8f79a-242">We can create event handlers for the pre-level events in order to customize the input parameters or for the post-level events in order to inspect and respond to the operation's results.</span></span> <span data-ttu-id="8f79a-243">Gestionnaires d’événements post-niveau sont couramment utilisés pour détecter si une exception s’est produite lors de l’opération.</span><span class="sxs-lookup"><span data-stu-id="8f79a-243">Post-level event handlers are most commonly used to detect whether an exception occurred during the operation.</span></span> <span data-ttu-id="8f79a-244">En cas d’une exception, ces gestionnaires d’événements post-niveau peuvent gérer éventuellement de l’exception sur leurs propres.</span><span class="sxs-lookup"><span data-stu-id="8f79a-244">In the face of an exception, these post-level event handlers can optionally handle the exception on their own.</span></span> <span data-ttu-id="8f79a-245">Dans ce didacticiel, nous avons vu comment gérer cette exception en affichant un message d’erreur convivial.</span><span class="sxs-lookup"><span data-stu-id="8f79a-245">In this tutorial we saw how to handle such an exception by displaying a friendly error message.</span></span>

<span data-ttu-id="8f79a-246">Dans l’étape suivante du didacticiel, nous verrons comment réduire la probabilité d’exceptions provenant de problèmes de mise en forme des données (par exemple, entrez une valeur négative `UnitPrice`).</span><span class="sxs-lookup"><span data-stu-id="8f79a-246">In the next tutorial we'll see how to lessen the likelihood of exceptions arising from data formatting issues (such as entering a negative `UnitPrice`).</span></span> <span data-ttu-id="8f79a-247">Plus précisément, nous allons examiner comment ajouter des contrôles de validation pour les interfaces de modification et d’insertion.</span><span class="sxs-lookup"><span data-stu-id="8f79a-247">Specifically, we'll look at how to add validation controls to the editing and inserting interfaces.</span></span>

<span data-ttu-id="8f79a-248">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="8f79a-248">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="8f79a-249">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="8f79a-249">About the Author</span></span>

<span data-ttu-id="8f79a-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept manuels ASP/ASP.NET et créateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="8f79a-250">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="8f79a-251">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="8f79a-251">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="8f79a-252">Son dernier ouvrage est [ *SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="8f79a-252">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="8f79a-253">Il peut être atteint à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou via son blog, qui se trouvent à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="8f79a-253">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="8f79a-254">Remerciements</span><span class="sxs-lookup"><span data-stu-id="8f79a-254">Special Thanks To</span></span>

<span data-ttu-id="8f79a-255">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="8f79a-255">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="8f79a-256">Entraîner un réviseur pour ce didacticiel a été Liz Shulok.</span><span class="sxs-lookup"><span data-stu-id="8f79a-256">Lead reviewer for this tutorial was Liz Shulok.</span></span> <span data-ttu-id="8f79a-257">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="8f79a-257">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="8f79a-258">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="8f79a-258">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8f79a-259">[Précédent](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
> [Suivant](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span><span class="sxs-lookup"><span data-stu-id="8f79a-259">[Previous](examining-the-events-associated-with-inserting-updating-and-deleting-cs.md)
[Next](adding-validation-controls-to-the-editing-and-inserting-interfaces-cs.md)</span></span>
