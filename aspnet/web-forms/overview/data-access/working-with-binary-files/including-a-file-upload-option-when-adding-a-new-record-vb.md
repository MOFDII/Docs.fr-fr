---
uid: web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
title: Options incluant un fichier de téléchargement lors de l’ajout d’un nouvel enregistrement (VB) | Documents Microsoft
author: rick-anderson
description: Ce didacticiel montre comment créer une interface Web qui permet à l’utilisateur à entrer des données de texte et télécharger les fichiers binaires. Pour illustrer l’options disponibles de t...
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/27/2007
ms.topic: article
ms.assetid: 5776281d-4637-4d1e-a65b-2621d2cade44
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/working-with-binary-files/including-a-file-upload-option-when-adding-a-new-record-vb
msc.type: authoredcontent
ms.openlocfilehash: 39608eef7cc88be56ef6e21820e4afcfaa4ffd8d
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30888651"
---
<a name="including-a-file-upload-option-when-adding-a-new-record-vb"></a><span data-ttu-id="903e6-104">Y compris une Option de téléchargement de fichier lors de l’ajout d’un nouvel enregistrement (VB)</span><span class="sxs-lookup"><span data-stu-id="903e6-104">Including a File Upload Option When Adding a New Record (VB)</span></span>
====================
<span data-ttu-id="903e6-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="903e6-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="903e6-106">[Télécharger l’exemple d’application](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) ou [télécharger le PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="903e6-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_56_VB.exe) or [Download PDF](including-a-file-upload-option-when-adding-a-new-record-vb/_static/datatutorial56vb1.pdf)</span></span>

> <span data-ttu-id="903e6-107">Ce didacticiel montre comment créer une interface Web qui permet à l’utilisateur à entrer des données de texte et télécharger les fichiers binaires.</span><span class="sxs-lookup"><span data-stu-id="903e6-107">This tutorial shows how to create a Web interface that allows the user to both enter text data and upload binary files.</span></span> <span data-ttu-id="903e6-108">Pour illustrer les options disponibles pour stocker des données binaires, un fichier sera enregistré dans la base de données tandis que l’autre est stocké dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="903e6-108">To illustrate the options available to store binary data, one file will be saved in the database while the other is stored in the file system.</span></span>


## <a name="introduction"></a><span data-ttu-id="903e6-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="903e6-109">Introduction</span></span>

<span data-ttu-id="903e6-110">Dans les deux didacticiels précédents, nous exploré techniques pour le stockage des données binaires qui sont associées avec le modèle de données d’application s, examiné comment utiliser le contrôle FileUpload pour envoyer des fichiers à partir du client au serveur web et vu comment présenter ces données binaires dans les données W contrôle d’EB.</span><span class="sxs-lookup"><span data-stu-id="903e6-110">In the previous two tutorials we explored techniques for storing binary data that is associated with the application s data model, looked at how to use the FileUpload control to send files from the client to the web server, and saw how to present this binary data in a data Web control.</span></span> <span data-ttu-id="903e6-111">Nous avons encore pour vous aider à associer les données téléchargées avec le modèle de données, bien que.</span><span class="sxs-lookup"><span data-stu-id="903e6-111">We ve yet to talk about how to associate uploaded data with the data model, though.</span></span>

<span data-ttu-id="903e6-112">Dans ce didacticiel, nous allons créer une page web pour ajouter une nouvelle catégorie.</span><span class="sxs-lookup"><span data-stu-id="903e6-112">In this tutorial we will create a web page to add a new category.</span></span> <span data-ttu-id="903e6-113">En plus des zones de texte pour le nom de catégorie et la description, cette page devrez inclure deux contrôles FileUpload pour la nouvelle image de catégorie s et un pour la brochure.</span><span class="sxs-lookup"><span data-stu-id="903e6-113">In addition to TextBoxes for the category s name and description, this page will need to include two FileUpload controls one for the new category s picture and one for the brochure.</span></span> <span data-ttu-id="903e6-114">L’image téléchargée sera stocké directement dans le nouvel enregistrement s `Picture` colonne, tandis que la brochure sera enregistrée dans le `~/Brochures` dossier avec le chemin d’accès au fichier enregistré dans le nouvel enregistrement s `BrochurePath` colonne.</span><span class="sxs-lookup"><span data-stu-id="903e6-114">The uploaded picture will be stored directly in the new record s `Picture` column, whereas the brochure will be saved to the `~/Brochures` folder with the path to the file saved in the new record s `BrochurePath` column.</span></span>

<span data-ttu-id="903e6-115">Avant de créer cette nouvelle page web, nous devrons mettre à jour de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="903e6-115">Before creating this new web page, we'll need to update the architecture.</span></span> <span data-ttu-id="903e6-116">Le `CategoriesTableAdapter` requête principale de s ne récupère pas le `Picture` colonne.</span><span class="sxs-lookup"><span data-stu-id="903e6-116">The `CategoriesTableAdapter` s main query does not retrieve the `Picture` column.</span></span> <span data-ttu-id="903e6-117">Par conséquent, générée automatiquement `Insert` méthode dispose uniquement des entrées pour le `CategoryName`, `Description`, et `BrochurePath` champs.</span><span class="sxs-lookup"><span data-stu-id="903e6-117">Consequently, the auto-generated `Insert` method only has inputs for the `CategoryName`, `Description`, and `BrochurePath` fields.</span></span> <span data-ttu-id="903e6-118">Par conséquent, nous devons créer une méthode supplémentaire dans le TableAdapter qui invite à indiquer les quatre `Categories` champs.</span><span class="sxs-lookup"><span data-stu-id="903e6-118">Therefore, we need to create an additional method in the TableAdapter that prompts for all four `Categories` fields.</span></span> <span data-ttu-id="903e6-119">La `CategoriesBLL` classe dans la couche de logique métier doit également être mis à jour.</span><span class="sxs-lookup"><span data-stu-id="903e6-119">The `CategoriesBLL` class in the Business Logic Layer will also need to be updated.</span></span>

## <a name="step-1-adding-aninsertwithpicturemethod-to-thecategoriestableadapter"></a><span data-ttu-id="903e6-120">Étape 1 : Ajout d’un`InsertWithPicture`méthode à la`CategoriesTableAdapter`</span><span class="sxs-lookup"><span data-stu-id="903e6-120">Step 1: Adding an`InsertWithPicture`Method to the`CategoriesTableAdapter`</span></span>

<span data-ttu-id="903e6-121">Lorsque nous avons créé la `CategoriesTableAdapter` dans les [création d’une couche d’accès aux données](../introduction/creating-a-data-access-layer-vb.md) didacticiel, nous avons configuré pour générer automatiquement `INSERT`, `UPDATE`, et `DELETE` instructions en fonction de la requête principale.</span><span class="sxs-lookup"><span data-stu-id="903e6-121">When we created the `CategoriesTableAdapter` back in the [Creating a Data Access Layer](../introduction/creating-a-data-access-layer-vb.md) tutorial, we configured it to automatically generate `INSERT`, `UPDATE`, and `DELETE` statements based on the main query.</span></span> <span data-ttu-id="903e6-122">En outre, nous avons demandé d’utiliser l’approche Direct de base de données, ce qui a créé les méthodes TableAdapter `Insert`, `Update`, et `Delete`.</span><span class="sxs-lookup"><span data-stu-id="903e6-122">Moreover, we instructed the TableAdapter to employ the DB Direct approach, which created the methods `Insert`, `Update`, and `Delete`.</span></span> <span data-ttu-id="903e6-123">Exécutent de ces méthodes générées automatiquement `INSERT`, `UPDATE`, et `DELETE` instructions et, par conséquent, acceptez les paramètres d’entrée basés sur les colonnes retournées par la requête principale.</span><span class="sxs-lookup"><span data-stu-id="903e6-123">These methods execute the auto-generated `INSERT`, `UPDATE`, and `DELETE` statements and, consequently, accept input parameters based on the columns returned by the main query.</span></span> <span data-ttu-id="903e6-124">Dans le [téléchargement de fichiers](uploading-files-vb.md) didacticiel, nous avons augmentés la `CategoriesTableAdapter` requête principale de s à utiliser le `BrochurePath` colonne.</span><span class="sxs-lookup"><span data-stu-id="903e6-124">In the [Uploading Files](uploading-files-vb.md) tutorial we augmented the `CategoriesTableAdapter` s main query to use the `BrochurePath` column.</span></span>

<span data-ttu-id="903e6-125">Étant donné que la `CategoriesTableAdapter` requête principale de s ne fait pas référence à la `Picture` colonne, nous pouvons ni ajouter un nouvel enregistrement ni mettre à jour un enregistrement existant avec une valeur pour le `Picture` colonne.</span><span class="sxs-lookup"><span data-stu-id="903e6-125">Since the `CategoriesTableAdapter` s main query does not reference the `Picture` column, we can neither add a new record nor update an existing record with a value for the `Picture` column.</span></span> <span data-ttu-id="903e6-126">Pour capturer ces informations, nous pouvons soit créer une nouvelle méthode du TableAdapter est utilisée en particulier pour insérer un enregistrement avec des données binaires ou nous pouvons personnaliser générées automatiquement `INSERT` instruction.</span><span class="sxs-lookup"><span data-stu-id="903e6-126">In order to capture this information, we can either create a new method in the TableAdapter that is used specifically to insert a record with binary data or we can customize the auto-generated `INSERT` statement.</span></span> <span data-ttu-id="903e6-127">Le problème avec la personnalisation générées automatiquement `INSERT` instruction est que nous risque notre personnalisations remplacées par l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="903e6-127">The problem with customizing the auto-generated `INSERT` statement is that we risk having our customizations overwritten by the wizard.</span></span> <span data-ttu-id="903e6-128">Par exemple, imaginons que nous avons personnalisé les `INSERT` instruction incluent l’utilisation de la `Picture` colonne.</span><span class="sxs-lookup"><span data-stu-id="903e6-128">For example, imagine that we customized the `INSERT` statement to include use of the `Picture` column.</span></span> <span data-ttu-id="903e6-129">Cela serait de mettre à jour le TableAdapter s `Insert` méthode pour inclure un paramètre d’entrée supplémentaire pour les données binaires de catégorie s image s.</span><span class="sxs-lookup"><span data-stu-id="903e6-129">This would update the TableAdapter s `Insert` method to include an additional input parameter for the category s picture s binary data.</span></span> <span data-ttu-id="903e6-130">Nous avons ensuite créer une méthode dans la couche de logique métier pour utiliser cette méthode de la couche DAL et appeler cette méthode de la couche BLL via la couche de présentation et tous les éléments de travail seraient très.</span><span class="sxs-lookup"><span data-stu-id="903e6-130">We could then create a method in the Business Logic Layer to use this DAL method and invoke this BLL method through the Presentation Layer, and everything would work wonderfully.</span></span> <span data-ttu-id="903e6-131">Autrement dit, jusqu'à ce que la prochaine fois que nous avons configuré le TableAdapter via l’Assistant Configuration de TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="903e6-131">That is, until the next time we configured the TableAdapter through the TableAdapter Configuration wizard.</span></span> <span data-ttu-id="903e6-132">Dès que l’Assistant terminée, notre personnalisations à la `INSERT` instruction serait remplacée, le `Insert` méthode retournerait à sa forme ancien et notre code compilera n’est plus !</span><span class="sxs-lookup"><span data-stu-id="903e6-132">As soon as the wizard completed, our customizations to the `INSERT` statement would be overwritten, the `Insert` method would revert to its old form, and our code would no longer compile!</span></span>

> [!NOTE]
> <span data-ttu-id="903e6-133">Ce problème est un problème lors de l’utilisation de procédures stockées au lieu d’instructions SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="903e6-133">This annoyance is a non-issue when using stored procedures instead of ad-hoc SQL statements.</span></span> <span data-ttu-id="903e6-134">Un didacticiel futures allez Explorer à l’aide de procédures stockées à la place d’instructions SQL ad hoc dans la couche d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="903e6-134">A future tutorial will explore using stored procedures in lieu of ad-hoc SQL statements in the Data Access Layer.</span></span>


<span data-ttu-id="903e6-135">Pour éviter ce risque casse-tête, plutôt que de personnaliser les instructions SQL générées automatiquement permettre de s plutôt créer une nouvelle méthode du TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="903e6-135">To avoid this potential headache, rather than customizing the auto-generated SQL statements let s instead create a new method for the TableAdapter.</span></span> <span data-ttu-id="903e6-136">Cette méthode, nommée `InsertWithPicture`, accepte les valeurs pour le `CategoryName`, `Description`, `BrochurePath`, et `Picture` colonnes et exécuter un `INSERT` instruction qui stocke toutes les quatre valeurs d’un nouvel enregistrement.</span><span class="sxs-lookup"><span data-stu-id="903e6-136">This method, named `InsertWithPicture`, will accept values for the `CategoryName`, `Description`, `BrochurePath`, and `Picture` columns and execute an `INSERT` statement that stores all four values in a new record.</span></span>

<span data-ttu-id="903e6-137">Ouvrez le DataSet typé et, dans le concepteur, cliquez sur le `CategoriesTableAdapter` en-tête de s et choisissez Ajouter une requête dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="903e6-137">Open the Typed DataSet and, from the Designer, right-click on the `CategoriesTableAdapter` s header and choose Add Query from the context menu.</span></span> <span data-ttu-id="903e6-138">Cette opération lance l’Assistant de Configuration de requête TableAdapter, qui commence par vous nous demander comment la requête TableAdapter doit-il accéder à la base de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-138">This launches the TableAdapter Query Configuration Wizard, which begins by asking us how the TableAdapter query should access the database.</span></span> <span data-ttu-id="903e6-139">Choisissez d’utiliser des instructions SQL et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="903e6-139">Choose Use SQL statements and click Next.</span></span> <span data-ttu-id="903e6-140">L’étape suivante vous invite à entrer pour le type de requête à générer.</span><span class="sxs-lookup"><span data-stu-id="903e6-140">The next step prompts for the type of query to be generated.</span></span> <span data-ttu-id="903e6-141">Dans la mesure où re de création d’une requête pour ajouter un nouvel enregistrement à la `Categories` de table, cliquez sur Insérer et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="903e6-141">Since we re creating a query to add a new record to the `Categories` table, choose INSERT and click Next.</span></span>


<span data-ttu-id="903e6-142">[![Sélectionnez l’Option d’insertion](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-142">[![Select the INSERT Option](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image1.png)</span></span>

<span data-ttu-id="903e6-143">**Figure 1**: sélectionnez l’Option d’insertion ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-143">**Figure 1**: Select the INSERT Option ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.png))</span></span>


<span data-ttu-id="903e6-144">Nous devons maintenant spécifier le `INSERT` instruction SQL.</span><span class="sxs-lookup"><span data-stu-id="903e6-144">We now need to specify the `INSERT` SQL statement.</span></span> <span data-ttu-id="903e6-145">L’Assistant suggère automatiquement un `INSERT` instruction correspondant à la requête principale de TableAdapter s.</span><span class="sxs-lookup"><span data-stu-id="903e6-145">The wizard automatically suggests an `INSERT` statement corresponding to the TableAdapter s main query.</span></span> <span data-ttu-id="903e6-146">Dans ce cas, il s une `INSERT` instruction insère les `CategoryName`, `Description`, et `BrochurePath` valeurs.</span><span class="sxs-lookup"><span data-stu-id="903e6-146">In this case, it s an `INSERT` statement that inserts the `CategoryName`, `Description`, and `BrochurePath` values.</span></span> <span data-ttu-id="903e6-147">L’instruction de mise à jour afin que les `Picture` colonne est incluse avec un `@Picture` paramètre, comme suit :</span><span class="sxs-lookup"><span data-stu-id="903e6-147">Update the statement so that the `Picture` column is included along with a `@Picture` parameter, like so:</span></span>


[!code-sql[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample1.sql)]

<span data-ttu-id="903e6-148">L’écran final de l’Assistant nous demande de nom de la nouvelle méthode du TableAdapter.</span><span class="sxs-lookup"><span data-stu-id="903e6-148">The final screen of the wizard asks us to name the new TableAdapter method.</span></span> <span data-ttu-id="903e6-149">Entrez `InsertWithPicture` et cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="903e6-149">Enter `InsertWithPicture` and click Finish.</span></span>


<span data-ttu-id="903e6-150">[![Nom de la nouvelle InsertWithPicture de TableAdapter (méthode)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-150">[![Name the New TableAdapter Method InsertWithPicture](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image2.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.png)</span></span>

<span data-ttu-id="903e6-151">**Figure 2**: nom de la nouvelle méthode TableAdapter `InsertWithPicture` ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-151">**Figure 2**: Name the New TableAdapter Method `InsertWithPicture` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.png))</span></span>


## <a name="step-2-updating-the-business-logic-layer"></a><span data-ttu-id="903e6-152">Étape 2 : Mise à jour de la couche de logique métier</span><span class="sxs-lookup"><span data-stu-id="903e6-152">Step 2: Updating the Business Logic Layer</span></span>

<span data-ttu-id="903e6-153">Étant donné que la couche de présentation doit uniquement interagir avec la couche de logique métier au lieu de contourner pour accéder directement à la couche d’accès aux données, nous devons créer une méthode de la couche BLL qui appelle la méthode de la couche DAL que nous venons de créer (`InsertWithPicture`).</span><span class="sxs-lookup"><span data-stu-id="903e6-153">Since the Presentation Layer should only interface with the Business Logic Layer rather than bypassing it to go directly to the Data Access Layer, we need to create a BLL method that invokes the DAL method we just created (`InsertWithPicture`).</span></span> <span data-ttu-id="903e6-154">Pour ce didacticiel, créez une méthode dans le `CategoriesBLL` classe nommée `InsertWithPicture` qui accepte comme entrée trois `String` s et un `Byte` tableau.</span><span class="sxs-lookup"><span data-stu-id="903e6-154">For this tutorial, create a method in the `CategoriesBLL` class named `InsertWithPicture` that accepts as input three `String` s and a `Byte` array.</span></span> <span data-ttu-id="903e6-155">Le `String` sont des paramètres d’entrée pour le nom de la catégorie s, la description et le chemin d’accès du fichier brochure, tandis que le `Byte` tableau est pour le contenu binaire de l’image de catégorie s.</span><span class="sxs-lookup"><span data-stu-id="903e6-155">The `String` input parameters are for the category s name, description, and brochure file path, while the `Byte` array is for the binary contents of the category s picture.</span></span> <span data-ttu-id="903e6-156">Comme le montre le code suivant, cette méthode de la couche BLL appelle la méthode correspondante de la couche DAL :</span><span class="sxs-lookup"><span data-stu-id="903e6-156">As the following code shows, this BLL method invokes the corresponding DAL method:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample2.vb)]

> [!NOTE]
> <span data-ttu-id="903e6-157">Assurez-vous que vous avez enregistré le DataSet typé avant d’ajouter le `InsertWithPicture` à la couche BLL (méthode).</span><span class="sxs-lookup"><span data-stu-id="903e6-157">Make sure that you have saved the Typed DataSet before adding the `InsertWithPicture` method to the BLL.</span></span> <span data-ttu-id="903e6-158">Étant donné que la `CategoriesTableAdapter` code de la classe est généré automatiquement en fonction du DataSet typé, si vous don t tout d’abord enregistrer les modifications apportées au DataSet typé la `Adapter` propriété a gagné t connaître le `InsertWithPicture` (méthode).</span><span class="sxs-lookup"><span data-stu-id="903e6-158">Since the `CategoriesTableAdapter` class code is auto-generated based on the Typed DataSet, if you don t first save your changes to the Typed DataSet the `Adapter` property won t know about the `InsertWithPicture` method.</span></span>


## <a name="step-3-listing-the-existing-categories-and-their-binary-data"></a><span data-ttu-id="903e6-159">Étape 3 : Liste des catégories existantes et leurs données binaires</span><span class="sxs-lookup"><span data-stu-id="903e6-159">Step 3: Listing the Existing Categories and their Binary Data</span></span>

<span data-ttu-id="903e6-160">Dans ce didacticiel, nous allons créer une page qui permet à un utilisateur final ajouter une nouvelle catégorie dans le système, en fournissant une image et la brochure pour la nouvelle catégorie.</span><span class="sxs-lookup"><span data-stu-id="903e6-160">In this tutorial we will create a page that allows an end user to add a new category to the system, providing a picture and brochure for the new category.</span></span> <span data-ttu-id="903e6-161">Dans le [didacticiel précédent](displaying-binary-data-in-the-data-web-controls-vb.md) nous avons utilisé un GridView avec ImageField et TemplateField pour afficher chaque nom de catégorie s, description, image et un lien pour télécharger son brochure.</span><span class="sxs-lookup"><span data-stu-id="903e6-161">In the [preceding tutorial](displaying-binary-data-in-the-data-web-controls-vb.md) we used a GridView with a TemplateField and ImageField to display each category s name, description, picture, and a link to download its brochure.</span></span> <span data-ttu-id="903e6-162">Permettent de s répliquer cette fonctionnalité pour ce didacticiel, la création d’une page qui répertorie toutes les catégories existantes et permet aux nouvelles sauvegardes à créer.</span><span class="sxs-lookup"><span data-stu-id="903e6-162">Let s replicate that functionality for this tutorial, creating a page that both lists all existing categories and allows for new ones to be created.</span></span>

<span data-ttu-id="903e6-163">Commencez par ouvrir le `DisplayOrDownload.aspx` page à partir de la `BinaryData` dossier.</span><span class="sxs-lookup"><span data-stu-id="903e6-163">Start by opening the `DisplayOrDownload.aspx` page from the `BinaryData` folder.</span></span> <span data-ttu-id="903e6-164">Accédez à la vue de Source et copiez le GridView et ObjectDataSource s la syntaxe déclarative, en les collant dans le `<asp:Content>` élément `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="903e6-164">Go to the Source view and copy the GridView and ObjectDataSource s declarative syntax, pasting it within the `<asp:Content>` element in `UploadInDetailsView.aspx`.</span></span> <span data-ttu-id="903e6-165">En outre, n’oubliez pas de copier sur le `GenerateBrochureLink` méthode à partir de la classe code-behind de `DisplayOrDownload.aspx` à `UploadInDetailsView.aspx`.</span><span class="sxs-lookup"><span data-stu-id="903e6-165">Also, don t forget to copy over the `GenerateBrochureLink` method from the code-behind class of `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx`.</span></span>


<span data-ttu-id="903e6-166">[![Copiez et collez la syntaxe déclarative à partir de DisplayOrDownload.aspx à UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-166">[![Copy and Paste the Declarative Syntax from DisplayOrDownload.aspx to UploadInDetailsView.aspx](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image3.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.png)</span></span>

<span data-ttu-id="903e6-167">**Figure 3**: copiez et collez la syntaxe déclarative à partir de `DisplayOrDownload.aspx` à `UploadInDetailsView.aspx` ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-167">**Figure 3**: Copy and Paste the Declarative Syntax from `DisplayOrDownload.aspx` to `UploadInDetailsView.aspx` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.png))</span></span>


<span data-ttu-id="903e6-168">Après avoir copié la syntaxe déclarative et `GenerateBrochureLink` méthode sur le `UploadInDetailsView.aspx` page, affichez la page via un navigateur pour vous assurer que tout a été correctement copiée.</span><span class="sxs-lookup"><span data-stu-id="903e6-168">After copying the declarative syntax and `GenerateBrochureLink` method over to the `UploadInDetailsView.aspx` page, view the page through a browser to ensure that everything was copied over correctly.</span></span> <span data-ttu-id="903e6-169">Vous devez voir un GridView qui répertorie les huit catégories qui inclut un lien pour télécharger la brochure, ainsi que l’image de catégorie s.</span><span class="sxs-lookup"><span data-stu-id="903e6-169">You should see a GridView listing the eight categories that includes a link to download the brochure as well as the category s picture.</span></span>


<span data-ttu-id="903e6-170">[![Vous devez maintenant voir chaque catégorie, ainsi que ses données binaires](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-170">[![You Should Now See Each Category Along with Its Binary Data](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image4.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.png)</span></span>

<span data-ttu-id="903e6-171">**Figure 4**: vous devez maintenant voir chaque catégorie le long d’avec ses données binaires ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-171">**Figure 4**: You Should Now See Each Category Along with Its Binary Data ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.png))</span></span>


## <a name="step-4-configuring-thecategoriesdatasourceto-support-inserting"></a><span data-ttu-id="903e6-172">Étape 4 : Configuration du`CategoriesDataSource`à l’insertion de la prise en charge</span><span class="sxs-lookup"><span data-stu-id="903e6-172">Step 4: Configuring the`CategoriesDataSource`to Support Inserting</span></span>

<span data-ttu-id="903e6-173">Le `CategoriesDataSource` ObjectDataSource utilisé par le `Categories` actuellement GridView ne fournit pas la possibilité d’insérer des données.</span><span class="sxs-lookup"><span data-stu-id="903e6-173">The `CategoriesDataSource` ObjectDataSource used by the `Categories` GridView currently does not provide the ability to insert data.</span></span> <span data-ttu-id="903e6-174">Pour prendre en charge d’insertion de ce contrôle de source de données, nous devons mapper ses `Insert` méthode vers une méthode de l’objet sous-jacent, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="903e6-174">In order to support inserting through this data source control, we need to map its `Insert` method to a method in its underlying object, `CategoriesBLL`.</span></span> <span data-ttu-id="903e6-175">En particulier, nous voulons mapper à la `CategoriesBLL` méthode que nous avons ajouté dans l’étape 2, `InsertWithPicture`.</span><span class="sxs-lookup"><span data-stu-id="903e6-175">In particular, we want to map it to the `CategoriesBLL` method we added back in Step 2, `InsertWithPicture`.</span></span>

<span data-ttu-id="903e6-176">Démarrez en cliquant sur le lien configurer la Source de données à partir de la balise active de ObjectDataSource s.</span><span class="sxs-lookup"><span data-stu-id="903e6-176">Start by clicking the Configure Data Source link from the ObjectDataSource s smart tag.</span></span> <span data-ttu-id="903e6-177">Le premier écran affiche l’objet de la source de données est configurée pour fonctionner avec, `CategoriesBLL`.</span><span class="sxs-lookup"><span data-stu-id="903e6-177">The first screen shows the object the data source is configured to work with, `CategoriesBLL`.</span></span> <span data-ttu-id="903e6-178">Laissez ce paramètre-cliquez sur Suivant pour passer à l’écran de définir des méthodes de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-178">Leave this setting as-is and click Next to advance to the Define Data Methods screen.</span></span> <span data-ttu-id="903e6-179">Déplacer vers l’onglet Insérer et choisir la `InsertWithPicture` méthode dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="903e6-179">Move to the INSERT tab and pick the `InsertWithPicture` method from the drop-down list.</span></span> <span data-ttu-id="903e6-180">Cliquez sur Terminer pour terminer l’Assistant.</span><span class="sxs-lookup"><span data-stu-id="903e6-180">Click Finish to complete the wizard.</span></span>


<span data-ttu-id="903e6-181">[![Configurer pour utiliser la méthode InsertWithPicture ObjectDataSource](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-181">[![Configure the ObjectDataSource to use the InsertWithPicture Method](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image5.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.png)</span></span>

<span data-ttu-id="903e6-182">**Figure 5**: configurer l’ObjectDataSource à utiliser le `InsertWithPicture` (méthode) ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-182">**Figure 5**: Configure the ObjectDataSource to use the `InsertWithPicture` Method ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.png))</span></span>


> [!NOTE]
> <span data-ttu-id="903e6-183">À la fin de l’Assistant, Visual Studio peut vous demander si vous souhaitez actualiser les champs et les clés, qui va être régénérée Web les données de contrôle des champs.</span><span class="sxs-lookup"><span data-stu-id="903e6-183">Upon completing the wizard, Visual Studio may ask if you want to Refresh Fields and Keys, which will regenerate the data Web controls fields.</span></span> <span data-ttu-id="903e6-184">Choisissez non, car vous sélectionnez Oui pour remplacer toutes les personnalisations de champ que vous avez apportées.</span><span class="sxs-lookup"><span data-stu-id="903e6-184">Choose No, because choosing Yes will overwrite any field customizations you may have made.</span></span>


<span data-ttu-id="903e6-185">Après la fin de l’Assistant, ObjectDataSource comprend maintenant une valeur pour son `InsertMethod` propriété ainsi que `InsertParameters` pour les colonnes de la catégorie de quatre, par le balisage déclaratif suivant montre :</span><span class="sxs-lookup"><span data-stu-id="903e6-185">After completing the wizard, the ObjectDataSource will now include a value for its `InsertMethod` property as well as `InsertParameters` for the four category columns, as the following declarative markup illustrates:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample3.aspx)]

## <a name="step-5-creating-the-inserting-interface"></a><span data-ttu-id="903e6-186">Étape 5 : Création de l’Interface de l’insertion</span><span class="sxs-lookup"><span data-stu-id="903e6-186">Step 5: Creating the Inserting Interface</span></span>

<span data-ttu-id="903e6-187">Comme tout d’abord traitées dans le [une vue d’ensemble d’insertion, de mise à jour et de suppression des données](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), le contrôle DetailsView fournit une interface d’insertion intégrée qui peut être utilisée lorsque vous travaillez avec un contrôle de source de données qui prend en charge l’insertion.</span><span class="sxs-lookup"><span data-stu-id="903e6-187">As first covered in the [An Overview of Inserting, Updating, and Deleting Data](../editing-inserting-and-deleting-data/an-overview-of-inserting-updating-and-deleting-data-vb.md), the DetailsView control provides a built-in inserting interface that can be utilized when working with a data source control that supports inserting.</span></span> <span data-ttu-id="903e6-188">Permettent d’ajouter un contrôle DetailsView à cette page au-dessus du GridView qui restituera définitivement son interface insertion, permettant à un utilisateur d’ajouter rapidement une nouvelle catégorie s.</span><span class="sxs-lookup"><span data-stu-id="903e6-188">Let s add a DetailsView control to this page above the GridView that will permanently render its inserting interface, allowing a user to quickly add a new category.</span></span> <span data-ttu-id="903e6-189">Lors de l’ajout d’une nouvelle catégorie dans le contrôle DetailsView, le contrôle GridView situé sous celui-ci actualiser automatiquement et afficher la nouvelle catégorie.</span><span class="sxs-lookup"><span data-stu-id="903e6-189">Upon adding a new category in the DetailsView, the GridView beneath it will automatically refresh and display the new category.</span></span>

<span data-ttu-id="903e6-190">Démarrage en faisant glisser un contrôle DetailsView à partir de la boîte à outils vers le concepteur ci-dessus le GridView, en définissant son `ID` propriété `NewCategory` et effacement du `Height` et `Width` des valeurs de propriété.</span><span class="sxs-lookup"><span data-stu-id="903e6-190">Start by dragging a DetailsView from the Toolbox onto the Designer above the GridView, setting its `ID` property to `NewCategory` and clearing out the `Height` and `Width` property values.</span></span> <span data-ttu-id="903e6-191">À partir de la balise active de s DetailsView, liez-le à l’objet existant `CategoriesDataSource` puis cochez la case à cocher Activer l’insertion.</span><span class="sxs-lookup"><span data-stu-id="903e6-191">From the DetailsView s smart tag, bind it to the existing `CategoriesDataSource` and then check the Enable Inserting checkbox.</span></span>


<span data-ttu-id="903e6-192">[![Lier le contrôle DetailsView le CategoriesDataSource et activer l’insertion](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-192">[![Bind the DetailsView to the CategoriesDataSource and Enable Inserting](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image6.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.png)</span></span>

<span data-ttu-id="903e6-193">**Figure 6**: lier le contrôle DetailsView à la `CategoriesDataSource` et activer l’insertion ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-193">**Figure 6**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image12.png))</span></span>


<span data-ttu-id="903e6-194">Pour définitivement restituer le contrôle DetailsView dans son interface insertion, définissez son `DefaultMode` propriété `Insert`.</span><span class="sxs-lookup"><span data-stu-id="903e6-194">To permanently render the DetailsView in its inserting interface, set its `DefaultMode` property to `Insert`.</span></span>

<span data-ttu-id="903e6-195">Notez que le contrôle DetailsView a cinq BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, et `BrochurePath` bien que le `CategoryID` BoundField n’est pas rendu dans l’interface d’insertion, car son `InsertVisible` propriété est définie sur `False`.</span><span class="sxs-lookup"><span data-stu-id="903e6-195">Note that the DetailsView has five BoundFields `CategoryID`, `CategoryName`, `Description`, `NumberOfProducts`, and `BrochurePath` although the `CategoryID` BoundField is not rendered in the inserting interface because its `InsertVisible` property is set to `False`.</span></span> <span data-ttu-id="903e6-196">Ces BoundFields existe, car ils sont les colonnes retournées par la `GetCategories()` méthode, c’est ce que ObjectDataSource appelle pour récupérer ses données.</span><span class="sxs-lookup"><span data-stu-id="903e6-196">These BoundFields exists because they are the columns returned by the `GetCategories()` method, which is what the ObjectDataSource invokes to retrieve its data.</span></span> <span data-ttu-id="903e6-197">Pour insérer, toutefois, nous n t et souhaitez vous permettent de spécifier une valeur pour `NumberOfProducts`.</span><span class="sxs-lookup"><span data-stu-id="903e6-197">For inserting, however, we don t want to let the user specify a value for `NumberOfProducts`.</span></span> <span data-ttu-id="903e6-198">En outre, nous devons les autoriser à télécharger une image pour la nouvelle catégorie ainsi que de télécharger un fichier PDF de brochure.</span><span class="sxs-lookup"><span data-stu-id="903e6-198">Moreover, we need to allow them to upload a picture for the new category as well as upload a PDF for the brochure.</span></span>

<span data-ttu-id="903e6-199">Supprimer le `NumberOfProducts` BoundField à partir du DetailsView totalement et la mise à jour la `HeaderText` propriétés de la `CategoryName` et `BrochurePath` BoundFields à la catégorie et Brochure, respectivement.</span><span class="sxs-lookup"><span data-stu-id="903e6-199">Remove the `NumberOfProducts` BoundField from the DetailsView altogether and then update the `HeaderText` properties of the `CategoryName` and `BrochurePath` BoundFields to Category and Brochure, respectively.</span></span> <span data-ttu-id="903e6-200">Ensuite, convertissez le `BrochurePath` BoundField en TemplateField et ajouter un nouveau TemplateField pour l’image, en donnant à cette nouvelle TemplateField un `HeaderText` valeur de l’image.</span><span class="sxs-lookup"><span data-stu-id="903e6-200">Next, convert the `BrochurePath` BoundField into a TemplateField and add a new TemplateField for the picture, giving this new TemplateField a `HeaderText` value of Picture.</span></span> <span data-ttu-id="903e6-201">Déplacer le `Picture` TemplateField afin qu’il soit entre le `BrochurePath` TemplateField et CommandField.</span><span class="sxs-lookup"><span data-stu-id="903e6-201">Move the `Picture` TemplateField so that it is between the `BrochurePath` TemplateField and CommandField.</span></span>


![Lier le contrôle DetailsView le CategoriesDataSource et activer l’insertion](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image7.gif)

<span data-ttu-id="903e6-203">**Figure 7**: lier le contrôle DetailsView à la `CategoriesDataSource` et activer l’insertion</span><span class="sxs-lookup"><span data-stu-id="903e6-203">**Figure 7**: Bind the DetailsView to the `CategoriesDataSource` and Enable Inserting</span></span>


<span data-ttu-id="903e6-204">Si vous avez converti le `BrochurePath` le TemplateField de BoundField en TemplateField via la boîte de dialogue Modifier les champs, inclut un `ItemTemplate`, `EditItemTemplate`, et `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="903e6-204">If you converted the `BrochurePath` BoundField into a TemplateField through the Edit Fields dialog box, the TemplateField includes an `ItemTemplate`, `EditItemTemplate`, and `InsertItemTemplate`.</span></span> <span data-ttu-id="903e6-205">Uniquement les `InsertItemTemplate` est nécessaire, toutefois, par conséquent, n’hésitez pas à supprimer les deux autres modèles.</span><span class="sxs-lookup"><span data-stu-id="903e6-205">Only the `InsertItemTemplate` is needed, however, so feel free to remove the other two templates.</span></span> <span data-ttu-id="903e6-206">À ce stade, votre syntaxe déclarative de DetailsView s doit se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="903e6-206">At this point your DetailsView s declarative syntax should look like the following:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample4.aspx)]

## <a name="adding-fileupload-controls-for-the-brochure-and-picture-fields"></a><span data-ttu-id="903e6-207">Ajout de contrôles FileUpload pour les brochures et les champs d’image</span><span class="sxs-lookup"><span data-stu-id="903e6-207">Adding FileUpload Controls for the Brochure and Picture Fields</span></span>

<span data-ttu-id="903e6-208">Actuellement, le `BrochurePath` TemplateField s `InsertItemTemplate` contient une zone de texte, tandis que le `Picture` TemplateField ne contient-elle pas tous les modèles.</span><span class="sxs-lookup"><span data-stu-id="903e6-208">Presently, the `BrochurePath` TemplateField s `InsertItemTemplate` contains a TextBox, while the `Picture` TemplateField does not contain any templates.</span></span> <span data-ttu-id="903e6-209">Nous devons mettre à jour de ces deux s TemplateField `InsertItemTemplate` pour utiliser des contrôles FileUpload.</span><span class="sxs-lookup"><span data-stu-id="903e6-209">We need to update these two TemplateField s `InsertItemTemplate` s to use FileUpload controls.</span></span>

<span data-ttu-id="903e6-210">Dans la balise active de s DetailsView, choisissez l’option Modifier les modèles, puis sélectionnez le `BrochurePath` TemplateField s `InsertItemTemplate` dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="903e6-210">From the DetailsView s smart tag, choose the Edit Templates option and then select the `BrochurePath` TemplateField s `InsertItemTemplate` from the drop-down list.</span></span> <span data-ttu-id="903e6-211">Supprimer la zone de texte et faites glisser un contrôle FileUpload à partir de la boîte à outils, dans le modèle.</span><span class="sxs-lookup"><span data-stu-id="903e6-211">Remove the TextBox and then drag a FileUpload control from the Toolbox into the template.</span></span> <span data-ttu-id="903e6-212">Définir le contrôle FileUpload s `ID` à `BrochureUpload`.</span><span class="sxs-lookup"><span data-stu-id="903e6-212">Set the FileUpload control s `ID` to `BrochureUpload`.</span></span> <span data-ttu-id="903e6-213">De même, ajoutez un contrôle FileUpload à la `Picture` TemplateField s `InsertItemTemplate`.</span><span class="sxs-lookup"><span data-stu-id="903e6-213">Similarly, add a FileUpload control to the `Picture` TemplateField s `InsertItemTemplate`.</span></span> <span data-ttu-id="903e6-214">Définissez ce contrôle FileUpload s `ID` à `PictureUpload`.</span><span class="sxs-lookup"><span data-stu-id="903e6-214">Set this FileUpload control s `ID` to `PictureUpload`.</span></span>


<span data-ttu-id="903e6-215">[![Ajouter un contrôle FileUpload à l’élément InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-215">[![Add a FileUpload Control to the InsertItemTemplate](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image8.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image13.png)</span></span>

<span data-ttu-id="903e6-216">**Figure 8**: ajouter un contrôle FileUpload à la `InsertItemTemplate` ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-216">**Figure 8**: Add a FileUpload Control to the `InsertItemTemplate` ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image14.png))</span></span>


<span data-ttu-id="903e6-217">Après avoir apporté ces ajouts, la syntaxe déclarative de deux TemplateField s sera :</span><span class="sxs-lookup"><span data-stu-id="903e6-217">After making these additions, the two TemplateField s declarative syntax will be:</span></span>


[!code-aspx[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample5.aspx)]

<span data-ttu-id="903e6-218">Lorsqu’un utilisateur ajoute une nouvelle catégorie, vous souhaitez vous assurer que les brochures et image sont du type de fichier correct.</span><span class="sxs-lookup"><span data-stu-id="903e6-218">When a user adds a new category, we want to ensure that the brochure and picture are of the correct file type.</span></span> <span data-ttu-id="903e6-219">Pour la brochure, l’utilisateur doit fournir un fichier PDF.</span><span class="sxs-lookup"><span data-stu-id="903e6-219">For the brochure, the user must supply a PDF.</span></span> <span data-ttu-id="903e6-220">Pour l’image, nous devons l’utilisateur de télécharger un fichier image, mais nous autoriser *tout* de l’image fichier ou uniquement les fichiers d’image d’un type particulier, tel que GIF ou jpg ?</span><span class="sxs-lookup"><span data-stu-id="903e6-220">For the picture, we need the user to upload an image file, but do we allow *any* image file or only image files of a particular type, such as GIFs or JPGs?</span></span> <span data-ttu-id="903e6-221">Afin de permettre les différents types de fichiers, d nous devons étendre la `Categories` pour y inclure une colonne qui indique le type de fichier afin que ce type peut être envoyé au client via `Response.ContentType` dans `DisplayCategoryPicture.aspx`.</span><span class="sxs-lookup"><span data-stu-id="903e6-221">In order to allow for different file types, we d need to extend the `Categories` schema to include a column that captures the file type so that this type can be sent to the client through `Response.ContentType` in `DisplayCategoryPicture.aspx`.</span></span> <span data-ttu-id="903e6-222">Étant donné que nous ne pas avoir une telle colonne, il serait préférable de restreindre les utilisateurs à uniquement en fournissant un type de fichier image spécifique.</span><span class="sxs-lookup"><span data-stu-id="903e6-222">Since we don t have such a column, it would be prudent to restrict users to only providing a specific image file type.</span></span> <span data-ttu-id="903e6-223">Le `Categories` images existantes de la table s sont des bitmaps, mais jpg est un format de fichier le plus approprié pour les images pris en charge sur le web.</span><span class="sxs-lookup"><span data-stu-id="903e6-223">The `Categories` table s existing images are bitmaps, but JPGs are a more appropriate file format for images served over the web.</span></span>

<span data-ttu-id="903e6-224">Si un utilisateur télécharge un type de fichier incorrect, nous devons annuler l’insertion et d’afficher un message indiquant le problème.</span><span class="sxs-lookup"><span data-stu-id="903e6-224">If a user uploads an incorrect file type, we need to cancel the insert and display a message indicating the problem.</span></span> <span data-ttu-id="903e6-225">Ajouter un contrôle Web Label sous le contrôle DetailsView.</span><span class="sxs-lookup"><span data-stu-id="903e6-225">Add a Label Web control beneath the DetailsView.</span></span> <span data-ttu-id="903e6-226">Définir son `ID` propriété `UploadWarning`, désactivez les son `Text` propriété, la valeur la `CssClass` propriété à avertissement et le `Visible` et `EnableViewState` propriétés à `False`.</span><span class="sxs-lookup"><span data-stu-id="903e6-226">Set its `ID` property to `UploadWarning`, clear out its `Text` property, set the `CssClass` property to Warning, and the `Visible` and `EnableViewState` properties to `False`.</span></span> <span data-ttu-id="903e6-227">Le `Warning` classe CSS est définie dans `Styles.css` et restitue le texte dans une police de grande taille, rouge, italique, gras.</span><span class="sxs-lookup"><span data-stu-id="903e6-227">The `Warning` CSS class is defined in `Styles.css` and renders the text in a large, red, italicized, bold font.</span></span>

> [!NOTE]
> <span data-ttu-id="903e6-228">Dans l’idéal, le `CategoryName` et `Description` BoundFields est convertie en TemplateField et leurs interfaces insertion personnalisées.</span><span class="sxs-lookup"><span data-stu-id="903e6-228">Ideally, the `CategoryName` and `Description` BoundFields would be converted to TemplateFields and their inserting interfaces customized.</span></span> <span data-ttu-id="903e6-229">Le `Description` insertion d’interface, par exemple, serait probablement être mieux adapté à une zone de texte multiligne.</span><span class="sxs-lookup"><span data-stu-id="903e6-229">The `Description` inserting interface, for example, would likely be better suited through a multi-line textbox.</span></span> <span data-ttu-id="903e6-230">Et puisque le `CategoryName` colonne n’accepte pas les `NULL` valeurs, un contrôle RequiredFieldValidator doit être ajouté pour vous assurer de l’utilisateur fournit une valeur pour le nouveau nom de catégorie s.</span><span class="sxs-lookup"><span data-stu-id="903e6-230">And since the `CategoryName` column does not accept `NULL` values, a RequiredFieldValidator should be added to ensure the user provides a value for the new category s name.</span></span> <span data-ttu-id="903e6-231">Ces étapes sont conservées comme un exercice pour le lecteur.</span><span class="sxs-lookup"><span data-stu-id="903e6-231">These steps are left as an exercise to the reader.</span></span> <span data-ttu-id="903e6-232">Faire référence à [personnalisation de l’Interface de Modification de données](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) pour des explications approfondies sur ce qui étend les interfaces de modification de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-232">Refer back to [Customizing the Data Modification Interface](../editing-inserting-and-deleting-data/customizing-the-data-modification-interface-vb.md) for an in-depth look at augmenting the data modification interfaces.</span></span>


## <a name="step-6-saving-the-uploaded-brochure-to-the-web-server-s-file-system"></a><span data-ttu-id="903e6-233">Étape 6 : L’enregistrement de la Brochure téléchargée dans le système de fichiers Web Server s</span><span class="sxs-lookup"><span data-stu-id="903e6-233">Step 6: Saving the Uploaded Brochure to the Web Server s File System</span></span>

<span data-ttu-id="903e6-234">Lorsque l’utilisateur entre les valeurs pour une nouvelle catégorie et clique sur le bouton d’insertion, une publication (postback) se produit et le flux de travail insertion se déroule.</span><span class="sxs-lookup"><span data-stu-id="903e6-234">When the user enters the values for a new category and clicks the Insert button, a postback occurs and the inserting workflow unfolds.</span></span> <span data-ttu-id="903e6-235">Tout d’abord, le contrôle DetailsView s [ `ItemInserting` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) se déclenche.</span><span class="sxs-lookup"><span data-stu-id="903e6-235">First, the DetailsView s [`ItemInserting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserting.aspx) fires.</span></span> <span data-ttu-id="903e6-236">Ensuite, le s ObjectDataSource `Insert()` méthode est appelée, ce qui aboutit à un nouvel enregistrement est ajouté à la `Categories` table.</span><span class="sxs-lookup"><span data-stu-id="903e6-236">Next, the ObjectDataSource s `Insert()` method is invoked, which results in a new record being added to the `Categories` table.</span></span> <span data-ttu-id="903e6-237">Après cela, le contrôle DetailsView s [ `ItemInserted` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) se déclenche.</span><span class="sxs-lookup"><span data-stu-id="903e6-237">After that, the DetailsView s [`ItemInserted` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.detailsview.iteminserted.aspx) fires.</span></span>

<span data-ttu-id="903e6-238">Avant du s ObjectDataSource `Insert()` méthode est appelée, nous devons d’abord vous assurer que les types de fichiers appropriées ont été téléchargés par l’utilisateur et puis enregistrez la brochure PDF dans le système de fichiers de serveur s web.</span><span class="sxs-lookup"><span data-stu-id="903e6-238">Before the ObjectDataSource s `Insert()` method is invoked, we must first ensure that the appropriate file types were uploaded by the user and then save the brochure PDF to the web server s file system.</span></span> <span data-ttu-id="903e6-239">Créer un gestionnaire d’événements pour le contrôle DetailsView s `ItemInserting` événement et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="903e6-239">Create an event handler for the DetailsView s `ItemInserting` event and add the following code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample6.vb)]

<span data-ttu-id="903e6-240">Le Gestionnaire d’événements démarre en référençant la `BrochureUpload` contrôle FileUpload à partir des modèles s DetailsView.</span><span class="sxs-lookup"><span data-stu-id="903e6-240">The event handler starts by referencing the `BrochureUpload` FileUpload control from the DetailsView s templates.</span></span> <span data-ttu-id="903e6-241">Ensuite, si une brochure a été téléchargée, l’extension de s du fichier téléchargé est examinée.</span><span class="sxs-lookup"><span data-stu-id="903e6-241">Then, if a brochure has been uploaded, the uploaded file s extension is examined.</span></span> <span data-ttu-id="903e6-242">Si l’extension n’est pas. PDF, puis un message d’avertissement s’affiche, l’insertion est annulée et l’exécution du Gestionnaire d’événements se termine.</span><span class="sxs-lookup"><span data-stu-id="903e6-242">If the extension is not .PDF, then a warning is displayed, the insert is cancelled, and the execution of the event handler ends.</span></span>

> [!NOTE]
> <span data-ttu-id="903e6-243">Partie de confiance sur l’extension de s du fichier téléchargé n’est pas une technique sûr pour garantir que le fichier téléchargé est un document PDF.</span><span class="sxs-lookup"><span data-stu-id="903e6-243">Relying on the uploaded file s extension is not a sure-fire technique for ensuring that the uploaded file is a PDF document.</span></span> <span data-ttu-id="903e6-244">L’utilisateur peut avoir un document PDF valide avec l’extension `.Brochure`, ou pourrait ont pris un document non PDF et donné un `.pdf` extension.</span><span class="sxs-lookup"><span data-stu-id="903e6-244">The user could have a valid PDF document with the extension `.Brochure`, or could have taken a non-PDF document and given it a `.pdf` extension.</span></span> <span data-ttu-id="903e6-245">Le contenu binaire du fichier s doit être examinée par programme afin de conclure le plus le type de fichier.</span><span class="sxs-lookup"><span data-stu-id="903e6-245">The file s binary content would need to be programmatically examined in order to more conclusively verify the file type.</span></span> <span data-ttu-id="903e6-246">Ces approches approfondies, cependant, sont souvent excessifs ; la vérification de l’extension est suffisante pour la plupart des scénarios.</span><span class="sxs-lookup"><span data-stu-id="903e6-246">Such thorough approaches, though, are often overkill; checking the extension is sufficient for most scenarios.</span></span>


<span data-ttu-id="903e6-247">Comme indiqué dans le [téléchargement de fichiers](uploading-files-vb.md) didacticiel, soyez prudent lors de l’enregistrement de fichiers au système de fichiers pour ce téléchargement d’un seul utilisateur s ne sont pas remplacés s d’un autre.</span><span class="sxs-lookup"><span data-stu-id="903e6-247">As discussed in the [Uploading Files](uploading-files-vb.md) tutorial, care must be taken when saving files to the file system so that one user s upload does not overwrite another s.</span></span> <span data-ttu-id="903e6-248">Pour ce didacticiel, nous va tenter d’utiliser le même nom que le fichier téléchargé.</span><span class="sxs-lookup"><span data-stu-id="903e6-248">For this tutorial we will attempt to use the same name as the uploaded file.</span></span> <span data-ttu-id="903e6-249">S’il en existe déjà un fichier dans le `~/Brochures` répertoire portant ce même nom de fichier, toutefois, nous allons ajouter un nombre à la fin jusqu'à ce qu’un nom unique est trouvé.</span><span class="sxs-lookup"><span data-stu-id="903e6-249">If there already exists a file in the `~/Brochures` directory with that same file name, however, we'll append a number at the end until a unique name is found.</span></span> <span data-ttu-id="903e6-250">Par exemple, si l’utilisateur télécharge un fichier brochure nommé `Meats.pdf`, mais il existe déjà un fichier nommé `Meats.pdf` dans les `~/Brochures` dossier, nous allons modifier le nom de fichier enregistré pour `Meats-1.pdf`.</span><span class="sxs-lookup"><span data-stu-id="903e6-250">For example, if the user uploads a brochure file named `Meats.pdf`, but there is already a file named `Meats.pdf` in the `~/Brochures` folder, we'll change the saved file name to `Meats-1.pdf`.</span></span> <span data-ttu-id="903e6-251">Si qui existe, nous essaierons de `Meats-2.pdf`, et ainsi de suite jusqu'à ce qu’un nom de fichier unique est trouvé.</span><span class="sxs-lookup"><span data-stu-id="903e6-251">If that exists, we'll try `Meats-2.pdf`, and so on, until a unique file name is found.</span></span>

<span data-ttu-id="903e6-252">Le code suivant utilise la [ `File.Exists(path)` méthode](https://msdn.microsoft.com/library/system.io.file.exists.aspx) pour déterminer si un fichier existe déjà avec le nom de fichier spécifié.</span><span class="sxs-lookup"><span data-stu-id="903e6-252">The following code uses the [`File.Exists(path)` method](https://msdn.microsoft.com/library/system.io.file.exists.aspx) to determine if a file already exists with the specified file name.</span></span> <span data-ttu-id="903e6-253">Dans ce cas, il continue d’essayer des nouveaux noms de fichiers de brochure jusqu'à ce qu’aucun conflit n’est trouvée.</span><span class="sxs-lookup"><span data-stu-id="903e6-253">If so, it continues to try new file names for the brochure until no conflict is found.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample7.vb)]

<span data-ttu-id="903e6-254">Une fois qu’un nom de fichier valide a été trouvé, le fichier doit être enregistré dans le système de fichiers et les opérations de mappage ObjectDataSource `brochurePath``InsertParameter` valeur doit être mis à jour afin que ce nom de fichier est écrit dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-254">Once a valid file name has been found, the file needs to be saved to the file system and the ObjectDataSource s `brochurePath``InsertParameter` value needs to be updated so that this file name is written to the database.</span></span> <span data-ttu-id="903e6-255">Comme nous l’avons vu dans la *téléchargement de fichiers* (didacticiel), le fichier peut être enregistré à l’aide du contrôle FileUpload s `SaveAs(path)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="903e6-255">As we saw back in the *Uploading Files* tutorial, the file can be saved using the FileUpload control s `SaveAs(path)` method.</span></span> <span data-ttu-id="903e6-256">Pour mettre à jour le s ObjectDataSource `brochurePath` paramètre, utilisez le `e.Values` collection.</span><span class="sxs-lookup"><span data-stu-id="903e6-256">To update the ObjectDataSource s `brochurePath` parameter, use the `e.Values` collection.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample8.vb)]

## <a name="step-7-saving-the-uploaded-picture-to-the-database"></a><span data-ttu-id="903e6-257">Étape 7 : L’enregistrement de l’image téléchargée dans la base de données</span><span class="sxs-lookup"><span data-stu-id="903e6-257">Step 7: Saving the Uploaded Picture to the Database</span></span>

<span data-ttu-id="903e6-258">Pour stocker l’image téléchargée dans le nouveau `Categories` enregistrements, nous avons besoin affecter le contenu binaire téléchargé au s ObjectDataSource `picture` paramètre dans le DetailsView s `ItemInserting` événement.</span><span class="sxs-lookup"><span data-stu-id="903e6-258">To store the uploaded picture in the new `Categories` record, we need to assign the uploaded binary content to the ObjectDataSource s `picture` parameter in the DetailsView s `ItemInserting` event.</span></span> <span data-ttu-id="903e6-259">Toutefois, avant de devoir effectuer, nous devons d’abord vous assurer que l’image téléchargée est JPG et pas un autre type d’image.</span><span class="sxs-lookup"><span data-stu-id="903e6-259">Before we make this assignment, however, we need to first make sure that the uploaded picture is a JPG and not some other image type.</span></span> <span data-ttu-id="903e6-260">Dans l’étape 6, permettent d’utiliser l’extension de fichier image téléchargé s afin de déterminer son type s.</span><span class="sxs-lookup"><span data-stu-id="903e6-260">As in Step 6, let s use the uploaded picture s file extension to ascertain its type.</span></span>

<span data-ttu-id="903e6-261">Alors que le `Categories` table permet `NULL` les valeurs pour la `Picture` colonne, toutes les catégories actuellement aient une image.</span><span class="sxs-lookup"><span data-stu-id="903e6-261">While the `Categories` table allows `NULL` values for the `Picture` column, all categories currently have a picture.</span></span> <span data-ttu-id="903e6-262">Permettent de s forcer l’utilisateur à fournir une image lors de l’ajout d’une nouvelle catégorie via cette page.</span><span class="sxs-lookup"><span data-stu-id="903e6-262">Let s force the user to provide a picture when adding a new category through this page.</span></span> <span data-ttu-id="903e6-263">Le code suivant vérifie qu’une image a été téléchargée et qu’il possède une extension appropriée.</span><span class="sxs-lookup"><span data-stu-id="903e6-263">The following code checks to ensure that a picture has been uploaded and that it has an appropriate extension.</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample9.vb)]

<span data-ttu-id="903e6-264">Ce code doit être placé *avant* le code de l’étape 6 afin que s’il existe un problème avec le téléchargement de l’image, le Gestionnaire d’événements va se terminer avant que le fichier brochure est enregistré dans le système de fichiers.</span><span class="sxs-lookup"><span data-stu-id="903e6-264">This code should be placed *before* the code from Step 6 so that if there is a problem with the picture upload, the event handler will terminate before the brochure file is saved to the file system.</span></span>

<span data-ttu-id="903e6-265">En supposant qu’un fichier approprié a été téléchargé, affecter le contenu binaire téléchargé à la valeur du paramètre s image avec la ligne de code suivante :</span><span class="sxs-lookup"><span data-stu-id="903e6-265">Assuming that an appropriate file has been uploaded, assign the uploaded binary content to the picture parameter s value with the following line of code:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample10.vb)]

## <a name="the-completeiteminsertingevent-handler"></a><span data-ttu-id="903e6-266">Le texte complet`ItemInserting`Gestionnaire d’événements</span><span class="sxs-lookup"><span data-stu-id="903e6-266">The Complete`ItemInserting`Event Handler</span></span>

<span data-ttu-id="903e6-267">Par souci d’exhaustivité, voici les `ItemInserting` Gestionnaire d’événements dans son intégralité :</span><span class="sxs-lookup"><span data-stu-id="903e6-267">For completeness, here is the `ItemInserting` event handler in its entirety:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample11.vb)]

## <a name="step-8-fixing-thedisplaycategorypictureaspxpage"></a><span data-ttu-id="903e6-268">Étape 8 : Corrigé le`DisplayCategoryPicture.aspx`Page</span><span class="sxs-lookup"><span data-stu-id="903e6-268">Step 8: Fixing the`DisplayCategoryPicture.aspx`Page</span></span>

<span data-ttu-id="903e6-269">S permettent de prendre quelques instants pour tester l’interface d’insertion et `ItemInserting` Gestionnaire d’événements qui a été créé au cours des quelques étapes.</span><span class="sxs-lookup"><span data-stu-id="903e6-269">Let s take a moment to test out the inserting interface and `ItemInserting` event handler that was created over the last few steps.</span></span> <span data-ttu-id="903e6-270">Visitez le `UploadInDetailsView.aspx` page via un navigateur et de la tentative d’ajout d’une collection, mais omettez l’image, ou spécifiez une image non-JPG ou une brochure non PDF.</span><span class="sxs-lookup"><span data-stu-id="903e6-270">Visit the `UploadInDetailsView.aspx` page through a browser and attempt to add a category, but omit the picture, or specify a non-JPG picture or a non-PDF brochure.</span></span> <span data-ttu-id="903e6-271">Dans tous ces cas, un message d’erreur s’affiche et le flux de travail d’insertion est annulée.</span><span class="sxs-lookup"><span data-stu-id="903e6-271">In any of these cases, an error message will be displayed and the insert workflow cancelled.</span></span>


<span data-ttu-id="903e6-272">[![Un Message d’avertissement est affiché si un Type de fichier non valide est téléchargé](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-272">[![A Warning Message is Displayed If an Invalid File Type is Uploaded](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image9.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image15.png)</span></span>

<span data-ttu-id="903e6-273">**Figure 9**: un Message d’avertissement est affiché si un Type de fichier non valide est téléchargé ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-273">**Figure 9**: A Warning Message is Displayed If an Invalid File Type is Uploaded ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image16.png))</span></span>


<span data-ttu-id="903e6-274">Après avoir vérifié que la page requiert une image à télécharger que t gagné / acceptent les fichiers non PDF non-JPG, ajouter une nouvelle catégorie avec une image JPG valide, si vous laissez le champ Brochure vide.</span><span class="sxs-lookup"><span data-stu-id="903e6-274">Once you have verified that the page requires a picture to be uploaded and won t accept non-PDF or non-JPG files, add a new category with a valid JPG picture, leaving the Brochure field empty.</span></span> <span data-ttu-id="903e6-275">Après avoir cliqué sur le bouton d’insertion, la page est publiée et un nouvel enregistrement sera ajouté à la `Categories` table avec le contenu binaire de l’image téléchargée s stockées directement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-275">After clicking the Insert button, the page will postback and a new record will be added to the `Categories` table with the uploaded image s binary contents stored directly in the database.</span></span> <span data-ttu-id="903e6-276">Le contrôle GridView est mis à jour et affiche une ligne pour la catégorie qui vient d’être ajoutée, mais, comme le montre la Figure 10, la nouvelle image de s catégorie n’est pas rendue correctement.</span><span class="sxs-lookup"><span data-stu-id="903e6-276">The GridView is updated and shows a row for the newly added category, but, as Figure 10 shows, the new category s picture is not rendered correctly.</span></span>


<span data-ttu-id="903e6-277">[![La nouvelle catégorie s Qu'image n’est pas affichée.](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-277">[![The New Category s Picture is not Displayed](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image10.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image17.png)</span></span>

<span data-ttu-id="903e6-278">**La figure 10**: s de la nouvelle catégorie image n’est pas affiché ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-278">**Figure 10**: The New Category s Picture is not Displayed ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image18.png))</span></span>


<span data-ttu-id="903e6-279">La raison pour laquelle la nouvelle image n’est pas affichée est, car le `DisplayCategoryPicture.aspx` page qui retourne une image de la catégorie spécifiée s est configurée pour traiter les bitmaps qui ont un en-tête OLE.</span><span class="sxs-lookup"><span data-stu-id="903e6-279">The reason the new picture is not displayed is because the `DisplayCategoryPicture.aspx` page that returns a specified category s picture is configured to process bitmaps that have an OLE header.</span></span> <span data-ttu-id="903e6-280">Cet en-tête 78 octets est supprimé de la `Picture` contenu binaire de la colonne s avant leur envoi au client.</span><span class="sxs-lookup"><span data-stu-id="903e6-280">This 78 byte header is stripped from the `Picture` column s binary contents before they are sent back to the client.</span></span> <span data-ttu-id="903e6-281">Mais le fichier JPG que simplement chargé pour la nouvelle catégorie n’a pas de cet en-tête OLE ; Par conséquent, les octets valides, nécessaires sont supprimés à partir des données binaires image s.</span><span class="sxs-lookup"><span data-stu-id="903e6-281">But the JPG file we just uploaded for the new category does not have this OLE header; therefore, valid, necessary bytes are being removed from the image s binary data.</span></span>

<span data-ttu-id="903e6-282">Dans la mesure où il existe désormais deux bitmaps avec en-têtes OLE et jpg dans le `Categories` table, nous devons mettre à jour `DisplayCategoryPicture.aspx` pour qu’il ne l’en-tête OLE de suppression pour les catégories de huit d’origine et que vous ignore cette suppression pour les enregistrements de catégorie plus récente.</span><span class="sxs-lookup"><span data-stu-id="903e6-282">Since there are now both bitmaps with OLE headers and JPGs in the `Categories` table, we need to update `DisplayCategoryPicture.aspx` so that it does the OLE header stripping for the original eight categories and bypasses this stripping for the newer category records.</span></span> <span data-ttu-id="903e6-283">Dans notre étape suivante du didacticiel, nous allons examiner comment mettre à jour une image d’enregistrement s existante, et nous allons mettre à jour toutes les images de catégorie ancien afin qu’ils soient jpg.</span><span class="sxs-lookup"><span data-stu-id="903e6-283">In our next tutorial we'll examine how to update an existing record s image, and we'll update all of the old category pictures so that they are JPGs.</span></span> <span data-ttu-id="903e6-284">Pour l’instant, cependant, utilisez le code suivant dans `DisplayCategoryPicture.aspx` pour supprimer les en-têtes OLE uniquement pour ces huit catégories d’origine :</span><span class="sxs-lookup"><span data-stu-id="903e6-284">For now, though, use the following code in `DisplayCategoryPicture.aspx` to strip the OLE headers only for those original eight categories:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample12.vb)]

<span data-ttu-id="903e6-285">Avec cette modification, l’image JPG est désormais rendu correctement dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="903e6-285">With this change, the JPG image is now rendered correctly in the GridView.</span></span>


<span data-ttu-id="903e6-286">[![Les Images JPG de nouvelles catégories sont correctement rendus](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="903e6-286">[![The JPG Images for New Categories are Correctly Rendered](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image11.gif)](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image19.png)</span></span>

<span data-ttu-id="903e6-287">**Figure 11**: les Images JPG de nouvelles catégories sont rendus correctement ([cliquez pour afficher l’image en taille réelle](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="903e6-287">**Figure 11**: The JPG Images for New Categories are Correctly Rendered ([Click to view full-size image](including-a-file-upload-option-when-adding-a-new-record-vb/_static/image20.png))</span></span>


## <a name="step-9-deleting-the-brochure-in-the-face-of-an-exception"></a><span data-ttu-id="903e6-288">Étape 9 : Suppression de la Brochure en cas de défaillance d’Exception</span><span class="sxs-lookup"><span data-stu-id="903e6-288">Step 9: Deleting the Brochure in the Face of an Exception</span></span>

<span data-ttu-id="903e6-289">Un des défis de stocker des données binaires sur le système de fichiers web server s est qu’elle introduit une déconnexion entre le modèle de données et ses données binaires.</span><span class="sxs-lookup"><span data-stu-id="903e6-289">One of the challenges of storing binary data on the web server s file system is that it introduces a disconnect between the data model and its binary data.</span></span> <span data-ttu-id="903e6-290">Par conséquent, chaque fois qu’un enregistrement est supprimé, les données binaires correspondantes sur le système de fichiers doivent également être supprimées.</span><span class="sxs-lookup"><span data-stu-id="903e6-290">Therefore, whenever a record is deleted, the corresponding binary data on the file system must also be removed.</span></span> <span data-ttu-id="903e6-291">Cela peut entrent en jeu lors de l’insertion, également.</span><span class="sxs-lookup"><span data-stu-id="903e6-291">This can come into play when inserting, as well.</span></span> <span data-ttu-id="903e6-292">Considérez le scénario suivant : un utilisateur ajoute une nouvelle catégorie, en spécifiant une image valide et une brochure.</span><span class="sxs-lookup"><span data-stu-id="903e6-292">Consider the following scenario: a user adds a new category, specifying a valid picture and brochure.</span></span> <span data-ttu-id="903e6-293">En cliquant sur le bouton Insérer, d’une publication (postback) se produit et le contrôle DetailsView s `ItemInserting` se déclenche l’événement, l’enregistrement de la brochure dans le système de fichiers de serveur s web.</span><span class="sxs-lookup"><span data-stu-id="903e6-293">Upon clicking the Insert button, a postback occurs and the DetailsView s `ItemInserting` event fires, saving the brochure to the web server s file system.</span></span> <span data-ttu-id="903e6-294">Ensuite, le s ObjectDataSource `Insert()` méthode est appelée, qui appelle la `CategoriesBLL` classe s `InsertWithPicture` (méthode), qui appelle la `CategoriesTableAdapter` s `InsertWithPicture` (méthode).</span><span class="sxs-lookup"><span data-stu-id="903e6-294">Next, the ObjectDataSource s `Insert()` method is invoked, which calls the `CategoriesBLL` class s `InsertWithPicture` method, which calls the `CategoriesTableAdapter` s `InsertWithPicture` method.</span></span>

<span data-ttu-id="903e6-295">Maintenant, que se passe-t-il si la base de données est hors connexion, ou s’il existe une erreur dans la `INSERT` instruction SQL ?</span><span class="sxs-lookup"><span data-stu-id="903e6-295">Now, what happens if the database is offline, or if there is an error in the `INSERT` SQL statement?</span></span> <span data-ttu-id="903e6-296">Clairement l’insertion échoue, donc aucune nouvelle ligne de catégorie n’est ajoutée à la base de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-296">Clearly the INSERT will fail, so no new category row will be added to the database.</span></span> <span data-ttu-id="903e6-297">Mais nous avons toujours le fichier téléchargé brochure posé sur le système de fichiers web server s !</span><span class="sxs-lookup"><span data-stu-id="903e6-297">But we still have the uploaded brochure file sitting on the web server s file system!</span></span> <span data-ttu-id="903e6-298">Ce fichier doit être supprimé en cas d’une exception pendant l’insertion du flux de travail.</span><span class="sxs-lookup"><span data-stu-id="903e6-298">This file needs to be deleted in the face of an exception during the inserting workflow.</span></span>

<span data-ttu-id="903e6-299">Comme indiqué précédemment dans le [BLL - gestion et des Exceptions au niveau de la couche DAL dans une Page ASP.NET](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) (didacticiel), lorsqu’une exception est levée à partir de la profondeur de l’architecture, il est propagée dans à travers les différentes couches.</span><span class="sxs-lookup"><span data-stu-id="903e6-299">As discussed previously in the [Handling BLL- and DAL-Level Exceptions in an ASP.NET Page](../editing-inserting-and-deleting-data/handling-bll-and-dal-level-exceptions-in-an-asp-net-page-vb.md) tutorial, when an exception is thrown from within the depths of the architecture it is bubbled up through the various layers.</span></span> <span data-ttu-id="903e6-300">Dans la couche présentation, nous pouvons déterminer si une exception s’est produite à partir de la s DetailsView `ItemInserted` événement.</span><span class="sxs-lookup"><span data-stu-id="903e6-300">At the Presentation Layer, we can determine if an exception has occurred from the DetailsView s `ItemInserted` event.</span></span> <span data-ttu-id="903e6-301">Ce gestionnaire d’événements fournit également les valeurs de mappage ObjectDataSource `InsertParameters`.</span><span class="sxs-lookup"><span data-stu-id="903e6-301">This event handler also provides the values of the ObjectDataSource s `InsertParameters`.</span></span> <span data-ttu-id="903e6-302">Par conséquent, nous pouvons créer un gestionnaire d’événements pour le `ItemInserted` événements vérifie si une exception s’est produite et, dans ce cas, supprime le fichier spécifié par le s ObjectDataSource `brochurePath` paramètre :</span><span class="sxs-lookup"><span data-stu-id="903e6-302">Therefore, we can create an event handler for the `ItemInserted` event that checks if there was an exception and, if so, deletes the file specified by the ObjectDataSource s `brochurePath` parameter:</span></span>


[!code-vb[Main](including-a-file-upload-option-when-adding-a-new-record-vb/samples/sample13.vb)]

## <a name="summary"></a><span data-ttu-id="903e6-303">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="903e6-303">Summary</span></span>

<span data-ttu-id="903e6-304">Il existe un nombre d’étapes qui doivent être effectuées pour fournir une interface basée sur le web pour ajouter des enregistrements qui incluent des données binaires.</span><span class="sxs-lookup"><span data-stu-id="903e6-304">There are a number of steps that must be performed in order to provide a web-based interface for adding records that include binary data.</span></span> <span data-ttu-id="903e6-305">Si les données binaires sont stockées directement dans la base de données, sans doute que vous devez mettre à jour de l’architecture, ajout de méthodes spécifiques pour gérer le cas où les données binaires sont insérées.</span><span class="sxs-lookup"><span data-stu-id="903e6-305">If the binary data is being stored directly into the database, chances are you'll need to update the architecture, adding specific methods to handle the case where binary data is being inserted.</span></span> <span data-ttu-id="903e6-306">Une fois que l’architecture a été mis à jour, l’étape suivante crée l’interface d’insertion, ce qui peut être effectué à l’aide d’un contrôle DetailsView qui a été personnalisé afin d’inclure un contrôle FileUpload pour chaque champ de données binaires.</span><span class="sxs-lookup"><span data-stu-id="903e6-306">Once the architecture has been updated, the next step is creating the inserting interface, which can be accomplished using a DetailsView that has been customized to include a FileUpload control for each binary data field.</span></span> <span data-ttu-id="903e6-307">Les données transmises peuvent être enregistrées dans le système de fichiers de serveur s web ou assignées à un paramètre de source de données dans le contrôle DetailsView s `ItemInserting` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="903e6-307">The uploaded data can then be saved to the web server s file system or assigned to a data source parameter in the DetailsView s `ItemInserting` event handler.</span></span>

<span data-ttu-id="903e6-308">L’enregistrement des données binaires dans le système de fichiers requiert plus de planification que l’enregistrement des données directement dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="903e6-308">Saving binary data to the file system requires more planning than saving data directly into the database.</span></span> <span data-ttu-id="903e6-309">Un schéma d’affectation de noms doit être choisi afin d’éviter un seul téléchargement utilisateur s remplaçant s d’un autre.</span><span class="sxs-lookup"><span data-stu-id="903e6-309">A naming scheme must be chosen in order to avoid one user s upload overwriting another s.</span></span> <span data-ttu-id="903e6-310">En outre, des étapes supplémentaires requises pour supprimer le fichier téléchargé si l’insertion de la base de données échoue.</span><span class="sxs-lookup"><span data-stu-id="903e6-310">Also, extra steps must be taken to delete the uploaded file if the database insert fails.</span></span>

<span data-ttu-id="903e6-311">Nous disposons désormais la possibilité d’ajouter de nouvelles catégories dans le système avec une brochure et image, mais nous ve restant à examiner comment mettre à jour de la catégorie s binaire données existantes ou supprimer correctement les données binaires pour une catégorie supprimée.</span><span class="sxs-lookup"><span data-stu-id="903e6-311">We now have the ability to add new categories to the system with a brochure and picture, but we ve yet to look at how to update an existing category s binary data or how to correctly remove the binary data for a deleted category.</span></span> <span data-ttu-id="903e6-312">Nous étudierons ces deux rubriques dans l’étape suivante du didacticiel.</span><span class="sxs-lookup"><span data-stu-id="903e6-312">We'll explore these two topics in the next tutorial.</span></span>

<span data-ttu-id="903e6-313">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="903e6-313">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="903e6-314">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="903e6-314">About the Author</span></span>

<span data-ttu-id="903e6-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept manuels ASP/ASP.NET et créateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="903e6-315">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="903e6-316">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="903e6-316">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="903e6-317">Son dernier ouvrage est [ *SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="903e6-317">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="903e6-318">Il peut être atteint à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou via son blog, qui se trouvent à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="903e6-318">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="903e6-319">Remerciements</span><span class="sxs-lookup"><span data-stu-id="903e6-319">Special Thanks To</span></span>

<span data-ttu-id="903e6-320">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="903e6-320">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="903e6-321">Les réviseurs tête pour ce didacticiel ont été Dave Gardner Teresa Murphy et Bernadette Leigh.</span><span class="sxs-lookup"><span data-stu-id="903e6-321">Lead reviewers for this tutorial were Dave Gardner, Teresa Murphy, and Bernadette Leigh.</span></span> <span data-ttu-id="903e6-322">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="903e6-322">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="903e6-323">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="903e6-323">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="903e6-324">[Précédent](displaying-binary-data-in-the-data-web-controls-vb.md)
> [Suivant](updating-and-deleting-existing-binary-data-vb.md)</span><span class="sxs-lookup"><span data-stu-id="903e6-324">[Previous](displaying-binary-data-in-the-data-web-controls-vb.md)
[Next](updating-and-deleting-existing-binary-data-vb.md)</span></span>
