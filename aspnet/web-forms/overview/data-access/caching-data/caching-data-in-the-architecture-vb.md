---
uid: web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
title: La mise en cache des données dans l’Architecture (VB) | Documents Microsoft
author: rick-anderson
description: Dans le didacticiel précédent, nous avons appris comment appliquer la mise en cache au niveau de la couche de présentation. Dans ce didacticiel, nous apprendre comment tirer parti de nos architectu superposé...
ms.author: aspnetcontent
manager: wpickett
ms.date: 05/30/2007
ms.topic: article
ms.assetid: 5e189dd7-f4f9-4f28-9b3a-6cb7d392e9c7
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/caching-data/caching-data-in-the-architecture-vb
msc.type: authoredcontent
ms.openlocfilehash: 08f83c129d589859723249becb818386bfff19bf
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
<a name="caching-data-in-the-architecture-vb"></a><span data-ttu-id="f710d-104">La mise en cache des données dans l’Architecture (VB)</span><span class="sxs-lookup"><span data-stu-id="f710d-104">Caching Data in the Architecture (VB)</span></span>
====================
<span data-ttu-id="f710d-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="f710d-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="f710d-106">[Télécharger l’exemple d’application](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) ou [télécharger le PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="f710d-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_59_VB.exe) or [Download PDF](caching-data-in-the-architecture-vb/_static/datatutorial59vb1.pdf)</span></span>

> <span data-ttu-id="f710d-107">Dans le didacticiel précédent, nous avons appris comment appliquer la mise en cache au niveau de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="f710d-107">In the previous tutorial we learned how to apply caching at the Presentation Layer.</span></span> <span data-ttu-id="f710d-108">Dans ce didacticiel vous apprendre comment tirer parti de notre architecture multiniveau en cache des données à la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="f710d-108">In this tutorial we learn how to take advantage of our layered architecture to cache data at the Business Logic Layer.</span></span> <span data-ttu-id="f710d-109">Pour cela, nous étendre l’architecture pour inclure une couche de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-109">We do this by extending the architecture to include a Caching Layer.</span></span>


## <a name="introduction"></a><span data-ttu-id="f710d-110">Introduction</span><span class="sxs-lookup"><span data-stu-id="f710d-110">Introduction</span></span>

<span data-ttu-id="f710d-111">Comme nous l’avons vu dans le didacticiel précédent, la mise en cache les données de s ObjectDataSource est aussi simple que la définition des deux propriétés.</span><span class="sxs-lookup"><span data-stu-id="f710d-111">As we saw in the preceding tutorial, caching the ObjectDataSource s data is as simple as setting a couple of properties.</span></span> <span data-ttu-id="f710d-112">Malheureusement, ObjectDataSource s’applique à la mise en cache au niveau de la couche de présentation, qui associe étroitement les stratégies de mise en cache avec la page ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="f710d-112">Unfortunately, the ObjectDataSource applies caching at the Presentation Layer, which tightly couples the caching policies with the ASP.NET page.</span></span> <span data-ttu-id="f710d-113">Une des raisons pour la création d’une architecture multiniveau consiste à autoriser ces couplages être rompu.</span><span class="sxs-lookup"><span data-stu-id="f710d-113">One of the reasons for creating a layered architecture is to allow such couplings to be broken.</span></span> <span data-ttu-id="f710d-114">La couche de logique métier, dissocie par exemple, la logique métier à partir des pages ASP.NET, tandis que la couche d’accès aux données dissocie les détails d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="f710d-114">The Business Logic Layer, for instance, decouples the business logic from the ASP.NET pages, while the Data Access Layer decouples the data access details.</span></span> <span data-ttu-id="f710d-115">Cette séparation des détails d’accès logique et les données métier est recommandée, en partie, car elle rend le système plus lisible et plus facile à gérer, plus souple pour modifier.</span><span class="sxs-lookup"><span data-stu-id="f710d-115">This decoupling of business logic and data access details is preferred, in part, because it makes the system more readable, more maintainable, and more flexible to change.</span></span> <span data-ttu-id="f710d-116">Il permet également de connaissance de domaine et de la répartition du travail d’un développeur travaille sur la couche de présentation ne t doit être familiarisé avec les détails de s de base de données pour effectuer son travail.</span><span class="sxs-lookup"><span data-stu-id="f710d-116">It also allows for domain knowledge and division of labor a developer working on the Presentation Layer doesn t need to be familiar with the database s details in order to do her job.</span></span> <span data-ttu-id="f710d-117">La stratégie de mise en cache à partir de la couche de présentation de découplage offre des avantages similaires.</span><span class="sxs-lookup"><span data-stu-id="f710d-117">Decoupling the caching policy from the Presentation Layer offers similar benefits.</span></span>

<span data-ttu-id="f710d-118">Dans ce didacticiel, nous sera augmenter notre architecture pour inclure un *mise en cache de couche* (ou CL en abrégé) qui fait appel à notre stratégie de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-118">In this tutorial we will augment our architecture to include a *Caching Layer* (or CL for short) that employs our caching policy.</span></span> <span data-ttu-id="f710d-119">La couche de mise en cache inclut un `ProductsCL` classe qui fournit l’accès aux informations sur les produits avec des méthodes, telles que `GetProducts()`, `GetProductsByCategoryID(categoryID)`, et ainsi de suite, que, lorsqu’elle est appelée, sera première tentative pour récupérer les données à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-119">The Caching Layer will include a `ProductsCL` class that provides access to product information with methods like `GetProducts()`, `GetProductsByCategoryID(categoryID)`, and so forth, that, when invoked, will first attempt to retrieve the data from the cache.</span></span> <span data-ttu-id="f710d-120">Si le cache est vide, ces méthodes appellent approprié `ProductsBLL` méthode dans la couche BLL, qui à son tour obtenez les données à partir de la couche DAL.</span><span class="sxs-lookup"><span data-stu-id="f710d-120">If the cache is empty, these methods will invoke the appropriate `ProductsBLL` method in the BLL, which would in turn get the data from the DAL.</span></span> <span data-ttu-id="f710d-121">Le `ProductsCL` méthodes mettre en cache les données extraites de la couche BLL avant de le renvoyer.</span><span class="sxs-lookup"><span data-stu-id="f710d-121">The `ProductsCL` methods cache the data retrieved from the BLL before returning it.</span></span>

<span data-ttu-id="f710d-122">Comme le montre la Figure 1, la CL réside entre la présentation et les couches de logique métier.</span><span class="sxs-lookup"><span data-stu-id="f710d-122">As Figure 1 shows, the CL resides between the Presentation and Business Logic Layers.</span></span>


![La couche de mise en cache (CL) est une autre couche de notre Architecture](caching-data-in-the-architecture-vb/_static/image1.png)

<span data-ttu-id="f710d-124">**Figure 1**: la mise en cache de couche (CL) est une autre couche de notre Architecture</span><span class="sxs-lookup"><span data-stu-id="f710d-124">**Figure 1**: The Caching Layer (CL) is Another Layer in Our Architecture</span></span>


## <a name="step-1-creating-the-caching-layer-classes"></a><span data-ttu-id="f710d-125">Étape 1 : Création des Classes de couche mise en cache</span><span class="sxs-lookup"><span data-stu-id="f710d-125">Step 1: Creating the Caching Layer Classes</span></span>

<span data-ttu-id="f710d-126">Dans ce didacticiel, nous allons créer une CL très simple avec une seule classe `ProductsCL` qui a uniquement quelques méthodes.</span><span class="sxs-lookup"><span data-stu-id="f710d-126">In this tutorial we will create a very simple CL with a single class `ProductsCL` that has only a handful of methods.</span></span> <span data-ttu-id="f710d-127">Création d’une couche de mise en cache complète pour l’application entière nécessiterait la création `CategoriesCL`, `EmployeesCL`, et `SuppliersCL` classes et en fournissant une méthode dans ces classes de mise en cache de couche pour chaque méthode de l’accès ou la modification des données dans la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="f710d-127">Building a complete Caching Layer for the entire application would require creating `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes, and providing a method in these Caching Layer classes for each data access or modification method in the BLL.</span></span> <span data-ttu-id="f710d-128">Comme avec la couche BLL et la couche DAL, la couche de mise en cache doit idéalement être implémentée comme un projet de bibliothèque de classes distinct ; Toutefois, nous allons implémenter en tant que classe dans le `App_Code` dossier.</span><span class="sxs-lookup"><span data-stu-id="f710d-128">As with the BLL and DAL, the Caching Layer should ideally be implemented as a separate Class Library project; however, we will implement it as a class in the `App_Code` folder.</span></span>

<span data-ttu-id="f710d-129">Pour davantage de classes distinct correctement la CL à partir des classes de la couche DAL et la couche BLL, s permettent de créer un nouveau sous-dossier dans le `App_Code` dossier.</span><span class="sxs-lookup"><span data-stu-id="f710d-129">To more cleanly separate the CL classes from the DAL and BLL classes, let s create a new subfolder in the `App_Code` folder.</span></span> <span data-ttu-id="f710d-130">Avec le bouton droit sur le `App_Code` dossier dans l’Explorateur de solutions, choisissez un nouveau dossier et nommez le nouveau dossier `CL`.</span><span class="sxs-lookup"><span data-stu-id="f710d-130">Right-click on the `App_Code` folder in the Solution Explorer, choose New Folder, and name the new folder `CL`.</span></span> <span data-ttu-id="f710d-131">Après avoir créé ce dossier, ajoutez à ce dernier une nouvelle classe nommée `ProductsCL.vb`.</span><span class="sxs-lookup"><span data-stu-id="f710d-131">After creating this folder, add to it a new class named `ProductsCL.vb`.</span></span>


![Ajouter un nouveau dossier nommé CL et une classe nommée ProductsCL.vb](caching-data-in-the-architecture-vb/_static/image2.png)

<span data-ttu-id="f710d-133">**Figure 2**: ajouter un nouveau dossier nommé `CL` et une classe nommée `ProductsCL.vb`</span><span class="sxs-lookup"><span data-stu-id="f710d-133">**Figure 2**: Add a New Folder Named `CL` and a Class Named `ProductsCL.vb`</span></span>


<span data-ttu-id="f710d-134">Le `ProductsCL` classe doit inclure le même ensemble de méthodes d’accès et de modification de données comme dans sa classe correspondante de la couche de logique métier (`ProductsBLL`).</span><span class="sxs-lookup"><span data-stu-id="f710d-134">The `ProductsCL` class should include the same set of data access and modification methods as found in its corresponding Business Logic Layer class (`ProductsBLL`).</span></span> <span data-ttu-id="f710d-135">Plutôt que de créer toutes ces méthodes, s permettent simplement build quelques ici pour avoir une idée pour les modèles utilisés par la CL.</span><span class="sxs-lookup"><span data-stu-id="f710d-135">Rather than creating all of these methods, let s just build a couple here to get a feel for the patterns used by the CL.</span></span> <span data-ttu-id="f710d-136">En particulier, nous allons ajouter le `GetProducts()` et `GetProductsByCategoryID(categoryID)` méthodes à l’étape 3 et une `UpdateProduct` de surcharge à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="f710d-136">In particular, we'll add the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods in Step 3 and an `UpdateProduct` overload in Step 4.</span></span> <span data-ttu-id="f710d-137">Vous pouvez ajouter les autres `ProductsCL` méthodes et `CategoriesCL`, `EmployeesCL`, et `SuppliersCL` classes à votre convenance.</span><span class="sxs-lookup"><span data-stu-id="f710d-137">You can add the remaining `ProductsCL` methods and `CategoriesCL`, `EmployeesCL`, and `SuppliersCL` classes at your leisure.</span></span>

## <a name="step-2-reading-and-writing-to-the-data-cache"></a><span data-ttu-id="f710d-138">Étape 2 : Lire et écrire dans le Cache de données</span><span class="sxs-lookup"><span data-stu-id="f710d-138">Step 2: Reading and Writing to the Data Cache</span></span>

<span data-ttu-id="f710d-139">ObjectDataSource fonctionnalité explorée en interne dans le didacticiel précédent de la mise en cache utilise le cache de données ASP.NET pour stocker les données extraites de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="f710d-139">The ObjectDataSource caching feature explored in the preceding tutorial internally uses the ASP.NET data cache to store the data retrieved from the BLL.</span></span> <span data-ttu-id="f710d-140">Le cache de données est également accessibles par programme à partir de classes de code-behind de pages ASP.NET ou des classes dans l’architecture s d’application web.</span><span class="sxs-lookup"><span data-stu-id="f710d-140">The data cache can also be accessed programmatically from ASP.NET pages code-behind classes or from the classes in the web application s architecture.</span></span> <span data-ttu-id="f710d-141">Pour lire et écrire dans le cache de données à partir de la classe code-behind s de pages ASP.NET, utilisez le modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="f710d-141">To read and write to the data cache from an ASP.NET page s code-behind class, use the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample1.vb)]

<span data-ttu-id="f710d-142">Le [ `Cache` classe](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [ `Insert` méthode](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) a plusieurs surcharges.</span><span class="sxs-lookup"><span data-stu-id="f710d-142">The [`Cache` class](https://msdn.microsoft.com/library/system.web.caching.cache.aspx) s [`Insert` method](https://msdn.microsoft.com/library/system.web.caching.cache.insert.aspx) has a number of overloads.</span></span> <span data-ttu-id="f710d-143">`Cache("key") = value` et `Cache.Insert(key, value)` sont synonymes et à la fois ajoutent un élément au cache à l’aide de la clé spécifiée sans une expiration définie.</span><span class="sxs-lookup"><span data-stu-id="f710d-143">`Cache("key") = value` and `Cache.Insert(key, value)` are synonymous and both add an item to the cache using the specified key without a defined expiry.</span></span> <span data-ttu-id="f710d-144">En règle générale, vous souhaitez spécifier un délai d’expiration lors de l’ajout d’un élément dans le cache, sous la forme d’une dépendance, une expiration basée sur le temps ou les deux.</span><span class="sxs-lookup"><span data-stu-id="f710d-144">Typically, we want to specify an expiry when adding an item to the cache, either as a dependency, a time-based expiry, or both.</span></span> <span data-ttu-id="f710d-145">Utilisez une des autres `Insert` des surcharges de méthode s pour fournir des informations d’expiration en fonction de dépendance ou de temps.</span><span class="sxs-lookup"><span data-stu-id="f710d-145">Use one of the other `Insert` method s overloads to provide dependency- or time-based expiry information.</span></span>

<span data-ttu-id="f710d-146">La couche de mise en cache les méthodes s doivent d’abord vérifier si les données demandées seront dans le cache et, dans ce cas, retournez à partir de là.</span><span class="sxs-lookup"><span data-stu-id="f710d-146">The Caching Layer s methods need to first check if the requested data is in the cache and, if so, return it from there.</span></span> <span data-ttu-id="f710d-147">Si les données demandées ne sont pas dans le cache, la méthode appropriée de la couche BLL doit être appelé.</span><span class="sxs-lookup"><span data-stu-id="f710d-147">If the requested data is not in the cache, the appropriate BLL method needs to be invoked.</span></span> <span data-ttu-id="f710d-148">Sa valeur de retour doit être mis en cache et puis renvoyé, comme l’illustre le diagramme de séquence suivant.</span><span class="sxs-lookup"><span data-stu-id="f710d-148">Its return value should be cached and then returned, as the following sequence diagram illustrates.</span></span>


![Les méthodes de s mise en cache de couche retournent des données à partir du Cache si elle s disponible](caching-data-in-the-architecture-vb/_static/image3.png)

<span data-ttu-id="f710d-150">**Figure 3**: méthodes s de la couche de mise en cache de retournent des données à partir du Cache si elle s disponible</span><span class="sxs-lookup"><span data-stu-id="f710d-150">**Figure 3**: The Caching Layer s Methods Return Data from the Cache if it s Available</span></span>


<span data-ttu-id="f710d-151">La séquence présentée dans la Figure 3 est effectuée dans les classes CL à l’aide du modèle suivant :</span><span class="sxs-lookup"><span data-stu-id="f710d-151">The sequence depicted in Figure 3 is accomplished in the CL classes using the following pattern:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample2.vb)]

<span data-ttu-id="f710d-152">Ici, *Type* est le type de données stockées dans le cache `Northwind.ProductsDataTable`, par exemple *clé* est la clé qui identifie de façon unique l’élément de cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-152">Here, *Type* is the type of data being stored in the cache `Northwind.ProductsDataTable`, for example while *key* is the key that uniquely identifies the cache item.</span></span> <span data-ttu-id="f710d-153">Si l’élément avec l’objet *clé* n’est pas dans le cache, alors *instance* sera `Nothing` et les données sont récupérées à partir de la méthode appropriée de la couche BLL et ajoutées au cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-153">If the item with the specified *key* is not in the cache, then *instance* will be `Nothing` and the data will be retrieved from the appropriate BLL method and added to the cache.</span></span> <span data-ttu-id="f710d-154">Au moment `Return instance` est atteinte, *instance* contient une référence aux données, soit à partir du cache ou extraites à partir de la couche BLL.</span><span class="sxs-lookup"><span data-stu-id="f710d-154">By the time `Return instance` is reached, *instance* contains a reference to the data, either from the cache or pulled from the BLL.</span></span>

<span data-ttu-id="f710d-155">Veillez à utiliser le modèle ci-dessus lorsque l’accès aux données à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-155">Be sure to use the above pattern when accessing data from the cache.</span></span> <span data-ttu-id="f710d-156">Le modèle suivant, qui, à première vue, recherche équivalent, contient une légère différence qui présente une condition de concurrence.</span><span class="sxs-lookup"><span data-stu-id="f710d-156">The following pattern, which, at first glance, looks equivalent, contains a subtle difference that introduces a race condition.</span></span> <span data-ttu-id="f710d-157">Conditions de concurrence sont difficiles à déboguer, car elles se révèlent sporadique et sont difficiles à reproduire.</span><span class="sxs-lookup"><span data-stu-id="f710d-157">Race conditions are difficult to debug because they reveal themselves sporadically and are difficult to reproduce.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample3.vb)]

<span data-ttu-id="f710d-158">La différence dans ce deuxième, extrait de code incorrect est qui plutôt que de stocker une référence à l’élément mis en cache dans une variable locale, le cache de données est accessible directement dans l’instruction conditionnelle *et* dans le `Return`.</span><span class="sxs-lookup"><span data-stu-id="f710d-158">The difference in this second, incorrect code snippet is that rather than storing a reference to the cached item in a local variable, the data cache is accessed directly in the conditional statement *and* in the `Return`.</span></span> <span data-ttu-id="f710d-159">Imaginez que lorsque ce code est atteinte, `Cache("key")` n’est pas `Nothing`, mais avant que le `Return` instruction est atteint, le système supprime *clé* à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-159">Imagine that when this code is reached, `Cache("key")` is not `Nothing`, but before the `Return` statement is reached, the system evicts *key* from the cache.</span></span> <span data-ttu-id="f710d-160">Dans ce cas rares, le code retournera `Nothing` au lieu d’un objet du type attendu.</span><span class="sxs-lookup"><span data-stu-id="f710d-160">In this rare case, the code will return `Nothing` rather than an object of the expected type.</span></span>

> [!NOTE]
> <span data-ttu-id="f710d-161">Le cache de données est thread-safe, vous n’avez pas besoin de synchroniser l’accès de thread pour simples lectures ou écritures.</span><span class="sxs-lookup"><span data-stu-id="f710d-161">The data cache is thread-safe, so you don't need to synchronize thread access for simple reads or writes.</span></span> <span data-ttu-id="f710d-162">Toutefois, si vous devez effectuer plusieurs opérations sur les données dans le cache qui doivent être atomiques, vous êtes responsable de l’implémentation d’un verrou ou un autre mécanisme pour garantir la sécurité des threads.</span><span class="sxs-lookup"><span data-stu-id="f710d-162">However, if you need to perform multiple operations on data in the cache that need to be atomic, you are responsible for implementing a lock or some other mechanism to ensure thread safety.</span></span> <span data-ttu-id="f710d-163">Consultez [synchroniser l’accès au Cache ASP.NET](http://www.ddj.com/184406369) pour plus d’informations.</span><span class="sxs-lookup"><span data-stu-id="f710d-163">See [Synchronizing Access to the ASP.NET Cache](http://www.ddj.com/184406369) for more information.</span></span>


<span data-ttu-id="f710d-164">Un élément peut être supprimé par programme à partir du cache de données à l’aide de la [ `Remove` méthode](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) comme suit :</span><span class="sxs-lookup"><span data-stu-id="f710d-164">An item can be programmatically evicted from the data cache using the [`Remove` method](https://msdn.microsoft.com/library/system.web.caching.cache.remove.aspx) like so:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample4.vb)]

## <a name="step-3-returning-product-information-from-theproductsclclass"></a><span data-ttu-id="f710d-165">Étape 3 : Retour d’informations de produit à partir de la`ProductsCL`classe</span><span class="sxs-lookup"><span data-stu-id="f710d-165">Step 3: Returning Product Information from the`ProductsCL`Class</span></span>

<span data-ttu-id="f710d-166">Pour ce didacticiel permettre s implémenter deux méthodes pour retourner des informations de produit à partir de la `ProductsCL` classe : `GetProducts()` et `GetProductsByCategoryID(categoryID)`.</span><span class="sxs-lookup"><span data-stu-id="f710d-166">For this tutorial let s implement two methods for returning product information from the `ProductsCL` class: `GetProducts()` and `GetProductsByCategoryID(categoryID)`.</span></span> <span data-ttu-id="f710d-167">LIKE avec le `ProductsBL` classe dans la couche de logique métier, le `GetProducts()` méthode dans la CL retourne des informations sur tous les produits comme un `Northwind.ProductsDataTable` objet, tandis que `GetProductsByCategoryID(categoryID)` retourne tous les produits à partir d’une catégorie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="f710d-167">Like with the `ProductsBL` class in the Business Logic Layer, the `GetProducts()` method in the CL returns information about all of the products as a `Northwind.ProductsDataTable` object, while `GetProductsByCategoryID(categoryID)` returns all of the products from a specified category.</span></span>

<span data-ttu-id="f710d-168">Le code suivant montre une partie des méthodes de la `ProductsCL` classe :</span><span class="sxs-lookup"><span data-stu-id="f710d-168">The following code shows a portion of the methods in the `ProductsCL` class:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample5.vb)]

<span data-ttu-id="f710d-169">Tout d’abord, notez le `DataObject` et `DataObjectMethodAttribute` attributs appliqués à la classe et les méthodes.</span><span class="sxs-lookup"><span data-stu-id="f710d-169">First, note the `DataObject` and `DataObjectMethodAttribute` attributes applied to the class and methods.</span></span> <span data-ttu-id="f710d-170">Ces attributs fournissent des informations à l’Assistant s ObjectDataSource, indiquant que les classes et méthodes doivent apparaître dans les étapes de l’Assistant s.</span><span class="sxs-lookup"><span data-stu-id="f710d-170">These attributes provide information to the ObjectDataSource s wizard, indicating what classes and methods should appear in the wizard s steps.</span></span> <span data-ttu-id="f710d-171">Étant donné que les classes de CL et méthodes seront accessible à partir d’un ObjectDataSource dans la couche présentation, j’ai ajouté ces attributs pour améliorer l’expérience au moment du design.</span><span class="sxs-lookup"><span data-stu-id="f710d-171">Since the CL classes and methods will be accessed from an ObjectDataSource in the Presentation Layer, I added these attributes to enhance the design-time experience.</span></span> <span data-ttu-id="f710d-172">Faire référence à la [création d’une couche de logique métier](../introduction/creating-a-business-logic-layer-vb.md) didacticiel pour obtenir une description plus approfondie sur ces attributs et leurs effets.</span><span class="sxs-lookup"><span data-stu-id="f710d-172">Refer back to the [Creating a Business Logic Layer](../introduction/creating-a-business-logic-layer-vb.md) tutorial for a more thorough description on these attributes and their effects.</span></span>

<span data-ttu-id="f710d-173">Dans le `GetProducts()` et `GetProductsByCategoryID(categoryID)` les méthodes, les données retournées à partir de la `GetCacheItem(key)` méthode est affectée à une variable locale.</span><span class="sxs-lookup"><span data-stu-id="f710d-173">In the `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods, the data returned from the `GetCacheItem(key)` method is assigned to a local variable.</span></span> <span data-ttu-id="f710d-174">Le `GetCacheItem(key)` (méthode), ce qui nous examinerons dans quelques instants, retourne un élément particulier du cache selon la *clé*.</span><span class="sxs-lookup"><span data-stu-id="f710d-174">The `GetCacheItem(key)` method, which we'll examine shortly, returns a particular item from the cache based on the specified *key*.</span></span> <span data-ttu-id="f710d-175">Si aucune donnée n’est trouvée dans le cache, il est récupéré de le `ProductsBLL` méthode de classe, puis ajouté au cache à l’aide de la `AddCacheItem(key, value)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="f710d-175">If no such data is found in cache, it is retrieved from the corresponding `ProductsBLL` class method and then added to the cache using the `AddCacheItem(key, value)` method.</span></span>

<span data-ttu-id="f710d-176">Le `GetCacheItem(key)` et `AddCacheItem(key, value)` méthodes d’interface avec le cache de données, la lecture et l’écriture des valeurs, respectivement.</span><span class="sxs-lookup"><span data-stu-id="f710d-176">The `GetCacheItem(key)` and `AddCacheItem(key, value)` methods interface with the data cache, reading and writing values, respectively.</span></span> <span data-ttu-id="f710d-177">Le `GetCacheItem(key)` méthode est la plus simple des deux.</span><span class="sxs-lookup"><span data-stu-id="f710d-177">The `GetCacheItem(key)` method is the simpler of the two.</span></span> <span data-ttu-id="f710d-178">Elle retourne simplement la valeur de la classe de Cache passé dans le *clé*:</span><span class="sxs-lookup"><span data-stu-id="f710d-178">It simply returns the value from the Cache class using the passed-in *key*:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample6.vb)]

<span data-ttu-id="f710d-179">`GetCacheItem(key)` n’utilise pas *clé* valeur fournie, mais les appels le `GetCacheKey(key)` (méthode), qui retourne le *clé* avec ProductsCache - préfixe.</span><span class="sxs-lookup"><span data-stu-id="f710d-179">`GetCacheItem(key)` does not use *key* value as supplied, but instead calls the `GetCacheKey(key)` method, which returns the *key* prepended with ProductsCache-.</span></span> <span data-ttu-id="f710d-180">Le `MasterCacheKeyArray`, qui contient la chaîne ProductsCache, est également utilisé par le `AddCacheItem(key, value)` (méthode), comme nous allons bientôt.</span><span class="sxs-lookup"><span data-stu-id="f710d-180">The `MasterCacheKeyArray`, which holds the string ProductsCache, is also used by the `AddCacheItem(key, value)` method, as we'll see momentarily.</span></span>

<span data-ttu-id="f710d-181">À partir d’une classe code-behind de pages ASP.NET, le cache de données est accessible à l’aide de la `Page` classe s [ `Cache` propriété](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx)et permet une syntaxe telle que `Cache("key") = value`, comme indiqué dans l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="f710d-181">From an ASP.NET page s code-behind class, the data cache can be accessed using the `Page` class s [`Cache` property](https://msdn.microsoft.com/library/system.web.ui.page.cache.aspx), and allows for syntax like `Cache("key") = value`, as discussed in Step 2.</span></span> <span data-ttu-id="f710d-182">À partir d’une classe au sein de l’architecture, le cache de données est accessible à l’aide `HttpRuntime.Cache` ou `HttpContext.Current.Cache`.</span><span class="sxs-lookup"><span data-stu-id="f710d-182">From a class within the architecture, the data cache can be accessed using either `HttpRuntime.Cache` or `HttpContext.Current.Cache`.</span></span> <span data-ttu-id="f710d-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)d’entrée de blog [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) note l’avantage légèrement les performances à l’aide de `HttpRuntime` au lieu de `HttpContext.Current`; par conséquent, `ProductsCL` utilise `HttpRuntime`.</span><span class="sxs-lookup"><span data-stu-id="f710d-183">[Peter Johnson](https://weblogs.asp.net/pjohnson/default.aspx)'s blog entry [HttpRuntime.Cache vs. HttpContext.Current.Cache](https://weblogs.asp.net/pjohnson/httpruntime-cache-vs-httpcontext-current-cache) notes the slight performance advantage in using `HttpRuntime` instead of `HttpContext.Current`; consequently, `ProductsCL` uses `HttpRuntime`.</span></span>

> [!NOTE]
> <span data-ttu-id="f710d-184">Si votre architecture est implémentée à l’aide de projets de bibliothèque de classes, vous devez ajouter une référence à la `System.Web` assembly afin d’utiliser le [ `HttpRuntime` ](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) et [ `HttpContext` ](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span><span class="sxs-lookup"><span data-stu-id="f710d-184">If your architecture is implemented using Class Library projects then you will need to add a reference to the `System.Web` assembly in order to use the [`HttpRuntime`](https://msdn.microsoft.com/library/system.web.httpruntime.aspx) and [`HttpContext`](https://msdn.microsoft.com/library/system.web.httpcontext.aspx) classes.</span></span>


<span data-ttu-id="f710d-185">Si l’élément est introuvable dans le cache, le `ProductsCL` méthodes de la classe s obtenir les données de la couche BLL et l’ajouter au cache en utilisant le `AddCacheItem(key, value)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="f710d-185">If the item is not found in the cache, the `ProductsCL` class s methods get the data from the BLL and add it to the cache using the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="f710d-186">Pour ajouter *valeur* au cache, nous pouvons utiliser le code suivant, qui utilise une expiration de 60 secondes :</span><span class="sxs-lookup"><span data-stu-id="f710d-186">To add *value* to the cache we could use the following code, which uses a 60 second time expiry:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample7.vb)]

<span data-ttu-id="f710d-187">`DateTime.Now.AddSeconds(CacheDuration)` Spécifie l’expiration temporels 60 secondes dans le futures while [ `System.Web.Caching.Cache.NoSlidingExpiration` ](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indique il s sans date d’expiration décalée.</span><span class="sxs-lookup"><span data-stu-id="f710d-187">`DateTime.Now.AddSeconds(CacheDuration)` specifies the time-based expiry 60 seconds in the future while [`System.Web.Caching.Cache.NoSlidingExpiration`](https://msdn.microsoft.com/library/system.web.caching.cache.noslidingexpiration(vs.80).aspx) indicates that there s no sliding expiration.</span></span> <span data-ttu-id="f710d-188">Lorsque ce `Insert` surcharge de méthode a des paramètres pour les deux absolu d’entrée et défilante d’expiration, vous pouvez fournir uniquement l’un des deux.</span><span class="sxs-lookup"><span data-stu-id="f710d-188">While this `Insert` method overload has input parameters for both an absolute and sliding expiry, you can only provide one of the two.</span></span> <span data-ttu-id="f710d-189">Si vous tentez de spécifier une heure absolue et un intervalle de temps, le `Insert` méthode lève un `ArgumentException` exception.</span><span class="sxs-lookup"><span data-stu-id="f710d-189">If you attempt to specify both an absolute time and a time span, the `Insert` method will throw an `ArgumentException` exception.</span></span>

> [!NOTE]
> <span data-ttu-id="f710d-190">Cette implémentation de la `AddCacheItem(key, value)` méthode présente actuellement des défauts.</span><span class="sxs-lookup"><span data-stu-id="f710d-190">This implementation of the `AddCacheItem(key, value)` method currently has some shortcomings.</span></span> <span data-ttu-id="f710d-191">Nous allons résoudre et contourner ces problèmes à l’étape 4.</span><span class="sxs-lookup"><span data-stu-id="f710d-191">We'll address and overcome these issues in Step 4.</span></span>


## <a name="step-4-invalidating-the-cache-when-the-data-is-modified-through-the-architecture"></a><span data-ttu-id="f710d-192">Étape 4 : Invalider les données du Cache lorsque l’est modifiée par le biais de l’Architecture</span><span class="sxs-lookup"><span data-stu-id="f710d-192">Step 4: Invalidating the Cache When the Data is Modified Through the Architecture</span></span>

<span data-ttu-id="f710d-193">En même temps que les méthodes de récupération de données, la couche de mise en cache doit fournir les mêmes méthodes que la couche BLL pour l’insertion, mise à jour et suppression de données.</span><span class="sxs-lookup"><span data-stu-id="f710d-193">Along with data retrieval methods, the Caching Layer needs to provide the same methods as the BLL for inserting, updating, and deleting data.</span></span> <span data-ttu-id="f710d-194">Les méthodes de modification de données CL s ne modifient pas les données mises en cache, mais plutôt appeler la méthode de modification de données correspondante BLL s et puis invalident le cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-194">The CL s data modification methods do not modify the cached data, but rather call the BLL s corresponding data modification method and then invalidate the cache.</span></span> <span data-ttu-id="f710d-195">Comme nous l’avons vu dans le didacticiel précédent, il s’agit du même comportement que ObjectDataSource s’applique lorsque ses fonctionnalités de mise en cache sont activées et son `Insert`, `Update`, ou `Delete` les méthodes sont appelées.</span><span class="sxs-lookup"><span data-stu-id="f710d-195">As we saw in the preceding tutorial, this is the same behavior that the ObjectDataSource applies when its caching features are enabled and its `Insert`, `Update`, or `Delete` methods are invoked.</span></span>

<span data-ttu-id="f710d-196">Les éléments suivants `UpdateProduct` surcharge illustre comment implémenter les méthodes de modification de données dans le CL :</span><span class="sxs-lookup"><span data-stu-id="f710d-196">The following `UpdateProduct` overload illustrates how to implement the data modification methods in the CL:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample8.vb)]

<span data-ttu-id="f710d-197">La modification des données appropriées méthode de la couche de logique métier est appelée, mais avant que sa réponse est retournée que nous avons besoin invalider le cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-197">The appropriate data modification Business Logic Layer method is invoked, but before its response is returned we need to invalidate the cache.</span></span> <span data-ttu-id="f710d-198">Malheureusement, invalider le cache n’est pas simple, car le `ProductsCL` classe s `GetProducts()` et `GetProductsByCategoryID(categoryID)` méthodes chacun ajoutent des éléments au cache avec des clés différentes et le `GetProductsByCategoryID(categoryID)` méthode ajoute un élément de cache différent pour chaque unique *categoryID*.</span><span class="sxs-lookup"><span data-stu-id="f710d-198">Unfortunately, invalidating the cache is not straightforward because the `ProductsCL` class s `GetProducts()` and `GetProductsByCategoryID(categoryID)` methods each add items to the cache with different keys, and the `GetProductsByCategoryID(categoryID)` method adds a different cache item for each unique *categoryID*.</span></span>

<span data-ttu-id="f710d-199">Lors de l’invalidation du cache, nous devons supprimer *tous les* des éléments qui peuvent avoir été ajoutées par la `ProductsCL` classe.</span><span class="sxs-lookup"><span data-stu-id="f710d-199">When invalidating the cache, we need to remove *all* of the items that may have been added by the `ProductsCL` class.</span></span> <span data-ttu-id="f710d-200">Cela peut être accompli en associant un *la dépendance de cache* avec chaque élément ajouté au cache dans le `AddCacheItem(key, value)` (méthode).</span><span class="sxs-lookup"><span data-stu-id="f710d-200">This can be accomplished by associating a *cache dependency* with the each item added to the cache in the `AddCacheItem(key, value)` method.</span></span> <span data-ttu-id="f710d-201">En règle générale, une dépendance de cache peut être un autre élément dans le cache, un fichier sur le système de fichiers ou des données à partir d’une base de données Microsoft SQL Server.</span><span class="sxs-lookup"><span data-stu-id="f710d-201">In general, a cache dependency can be another item in the cache, a file on the file system, or data from a Microsoft SQL Server database.</span></span> <span data-ttu-id="f710d-202">Lorsque la dépendance est modifié ou supprimé du cache, les éléments de cache associées sont automatiquement supprimés du cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-202">When the dependency changes or is removed from the cache, the cache items it is associated with are automatically evicted from the cache.</span></span> <span data-ttu-id="f710d-203">Pour ce didacticiel, nous voulons créer un élément supplémentaire dans le cache qui sert d’une dépendance de cache pour tous les éléments ajoutés via la `ProductsCL` classe.</span><span class="sxs-lookup"><span data-stu-id="f710d-203">For this tutorial, we want to create an additional item in the cache that serves as a cache dependency for all items added through the `ProductsCL` class.</span></span> <span data-ttu-id="f710d-204">De cette façon, tous ces éléments peuvent être supprimée à partir du cache en supprimant simplement la dépendance de cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-204">That way, all of these items can be removed from the cache by simply removing the cache dependency.</span></span>

<span data-ttu-id="f710d-205">Mise à jour s permettent la `AddCacheItem(key, value)` méthode afin que chaque élément ajouté au cache via cette méthode est associée à une dépendance de cache unique :</span><span class="sxs-lookup"><span data-stu-id="f710d-205">Let s update the `AddCacheItem(key, value)` method so that each item added to the cache through this method is associated with a single cache dependency:</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample9.vb)]

<span data-ttu-id="f710d-206">`MasterCacheKeyArray` est un tableau de chaînes qui contienne une valeur unique, ProductsCache.</span><span class="sxs-lookup"><span data-stu-id="f710d-206">`MasterCacheKeyArray` is a string array that holds a single value, ProductsCache.</span></span> <span data-ttu-id="f710d-207">Tout d’abord, un élément de cache est ajouté au cache et affecté la date et heure actuelles.</span><span class="sxs-lookup"><span data-stu-id="f710d-207">First, a cache item is added to the cache and assigned the current date and time.</span></span> <span data-ttu-id="f710d-208">Si l’élément de cache existe déjà, il est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="f710d-208">If the cache item already exists, it is updated.</span></span> <span data-ttu-id="f710d-209">Ensuite, une dépendance de cache est créée.</span><span class="sxs-lookup"><span data-stu-id="f710d-209">Next, a cache dependency is created.</span></span> <span data-ttu-id="f710d-210">Le [ `CacheDependency` classe](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) constructeur de s a plusieurs surcharges, mais celui qui est utilisé ici attend deux `String` entrées de tableau.</span><span class="sxs-lookup"><span data-stu-id="f710d-210">The [`CacheDependency` class](https://msdn.microsoft.com/library/system.web.caching.cachedependency(VS.80).aspx) s constructor has a number of overloads, but the one being used in here expects two `String` array inputs.</span></span> <span data-ttu-id="f710d-211">Le premier élément spécifie l’ensemble de fichiers à utiliser en tant que dépendances.</span><span class="sxs-lookup"><span data-stu-id="f710d-211">The first one specifies the set of files to be used as dependencies.</span></span> <span data-ttu-id="f710d-212">Étant donné que nous n souhaite pas utiliser toutes les dépendances de fichiers, une valeur de `Nothing` est utilisé pour le premier paramètre d’entrée.</span><span class="sxs-lookup"><span data-stu-id="f710d-212">Since we don t want to use any file-based dependencies, a value of `Nothing` is used for the first input parameter.</span></span> <span data-ttu-id="f710d-213">Le deuxième paramètre d’entrée spécifie le jeu de clés de cache à utiliser en tant que dépendances.</span><span class="sxs-lookup"><span data-stu-id="f710d-213">The second input parameter specifies the set of cache keys to use as dependencies.</span></span> <span data-ttu-id="f710d-214">Ici, nous spécifions notre dépendance unique, `MasterCacheKeyArray`.</span><span class="sxs-lookup"><span data-stu-id="f710d-214">Here we specify our single dependency, `MasterCacheKeyArray`.</span></span> <span data-ttu-id="f710d-215">Le `CacheDependency` est ensuite passé à la `Insert` (méthode).</span><span class="sxs-lookup"><span data-stu-id="f710d-215">The `CacheDependency` is then passed into the `Insert` method.</span></span>

<span data-ttu-id="f710d-216">Avec cette modification à `AddCacheItem(key, value)`, invaliding le cache est aussi simple que la suppression de la dépendance.</span><span class="sxs-lookup"><span data-stu-id="f710d-216">With this modification to `AddCacheItem(key, value)`, invaliding the cache is as simple as removing the dependency.</span></span>


[!code-vb[Main](caching-data-in-the-architecture-vb/samples/sample10.vb)]

## <a name="step-5-calling-the-caching-layer-from-the-presentation-layer"></a><span data-ttu-id="f710d-217">Étape 5 : Appel de la couche de mise en cache à partir de la couche de présentation</span><span class="sxs-lookup"><span data-stu-id="f710d-217">Step 5: Calling the Caching Layer from the Presentation Layer</span></span>

<span data-ttu-id="f710d-218">La mise en cache de couche s classes et des méthodes peuvent servir à manipuler les données en utilisant les techniques nous avons examiné dans l’ensemble de ces didacticiels.</span><span class="sxs-lookup"><span data-stu-id="f710d-218">The Caching Layer s classes and methods can be used to work with data using the techniques we ve examined throughout these tutorials.</span></span> <span data-ttu-id="f710d-219">Pour illustrer l’utilisation des données mises en cache, enregistrez vos modifications dans le `ProductsCL` de classe, puis ouvrez le `FromTheArchitecture.aspx` page dans le `Caching` dossier et ajouter un contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="f710d-219">To illustrate working with cached data, save your changes to the `ProductsCL` class and then open the `FromTheArchitecture.aspx` page in the `Caching` folder and add a GridView.</span></span> <span data-ttu-id="f710d-220">À partir de la balise active de s GridView, créez un nouveau ObjectDataSource.</span><span class="sxs-lookup"><span data-stu-id="f710d-220">From the GridView s smart tag, create a new ObjectDataSource.</span></span> <span data-ttu-id="f710d-221">Dans l’Assistant s première étape, vous devez voir le `ProductsCL` classe en tant qu’une des options dans la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="f710d-221">In the wizard s first step you should see the `ProductsCL` class as one of the options from the drop-down list.</span></span>


<span data-ttu-id="f710d-222">[![La classe ProductsCL est incluse dans la liste de déroulante d’objet métier](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="f710d-222">[![The ProductsCL Class is Included in the Business Object Drop-Down List](caching-data-in-the-architecture-vb/_static/image5.png)](caching-data-in-the-architecture-vb/_static/image4.png)</span></span>

<span data-ttu-id="f710d-223">**Figure 4**: le `ProductsCL` classe est incluse dans la liste de déroulante d’objet métier ([cliquez pour afficher l’image en taille réelle](caching-data-in-the-architecture-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="f710d-223">**Figure 4**: The `ProductsCL` Class is Included in the Business Object Drop-Down List ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image6.png))</span></span>


<span data-ttu-id="f710d-224">Après avoir sélectionné `ProductsCL`, cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="f710d-224">After selecting `ProductsCL`, click Next.</span></span> <span data-ttu-id="f710d-225">La liste déroulante dans l’onglet sélection a deux éléments - `GetProducts()` et `GetProductsByCategoryID(categoryID)` et l’onglet mise à jour est le seul `UpdateProduct` de surcharge.</span><span class="sxs-lookup"><span data-stu-id="f710d-225">The drop-down list in the SELECT tab has two items - `GetProducts()` and `GetProductsByCategoryID(categoryID)` and the UPDATE tab has the sole `UpdateProduct` overload.</span></span> <span data-ttu-id="f710d-226">Choisissez le `GetProducts()` méthode à partir de l’onglet Sélection et la `UpdateProducts` méthode à partir de l’onglet mettre à jour et cliquez sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="f710d-226">Choose the `GetProducts()` method from the SELECT tab and the `UpdateProducts` method from the UPDATE tab and click Finish.</span></span>


<span data-ttu-id="f710d-227">[![Les méthodes de la classe ProductsCL s sont répertoriées dans les listes déroulantes](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="f710d-227">[![The ProductsCL Class s Methods are Listed in the Drop-Down Lists](caching-data-in-the-architecture-vb/_static/image8.png)](caching-data-in-the-architecture-vb/_static/image7.png)</span></span>

<span data-ttu-id="f710d-228">**Figure 5**: le `ProductsCL` méthodes de la classe s sont répertoriées dans la liste déroulante répertorie ([cliquez pour afficher l’image en taille réelle](caching-data-in-the-architecture-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="f710d-228">**Figure 5**: The `ProductsCL` Class s Methods are Listed in the Drop-Down Lists ([Click to view full-size image](caching-data-in-the-architecture-vb/_static/image9.png))</span></span>


<span data-ttu-id="f710d-229">Après la fin de l’Assistant, Visual Studio définit les opérations de mappage ObjectDataSource `OldValuesParameterFormatString` propriété `original_{0}` et ajoutez les champs appropriés pour le contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="f710d-229">After completing the wizard, Visual Studio will set the ObjectDataSource s `OldValuesParameterFormatString` property to `original_{0}` and add the appropriate fields to the GridView.</span></span> <span data-ttu-id="f710d-230">Modifier la `OldValuesParameterFormatString` propriété à sa valeur par défaut, `{0}`et configurer le contrôle GridView pour prendre en charge la pagination, de tri et de modification.</span><span class="sxs-lookup"><span data-stu-id="f710d-230">Change the `OldValuesParameterFormatString` property back to its default value, `{0}`, and configure the GridView to support paging, sorting, and editing.</span></span> <span data-ttu-id="f710d-231">Étant donné que le `UploadProducts` surcharge utilisée par la CL accepte uniquement le nom de produit modifié s et les prix, limiter le GridView afin que seuls ces champs sont modifiables.</span><span class="sxs-lookup"><span data-stu-id="f710d-231">Since the `UploadProducts` overload used by the CL accepts only the edited product s name and price, limit the GridView so that only these fields are editable.</span></span>

<span data-ttu-id="f710d-232">Dans le didacticiel précédent, nous avons défini un GridView pour inclure des champs pour le `ProductName`, `CategoryName`, et `UnitPrice` champs.</span><span class="sxs-lookup"><span data-stu-id="f710d-232">In the preceding tutorial we defined a GridView to include fields for the `ProductName`, `CategoryName`, and `UnitPrice` fields.</span></span> <span data-ttu-id="f710d-233">N’hésitez pas à répliquer cette mise en forme et la structure, auquel cas le s GridView et ObjectDataSource déclaratif balisage doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="f710d-233">Feel free to replicate this formatting and structure, in which case your GridView and ObjectDataSource s declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](caching-data-in-the-architecture-vb/samples/sample11.aspx)]

<span data-ttu-id="f710d-234">À ce stade, nous avons une page qui utilise la couche de mise en cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-234">At this point we have a page that uses the Caching Layer.</span></span> <span data-ttu-id="f710d-235">Pour afficher le cache en action, définissez les points d’arrêt le `ProductsCL` classe s `GetProducts()` et `UpdateProduct` méthodes.</span><span class="sxs-lookup"><span data-stu-id="f710d-235">To see the cache in action, set breakpoints in the `ProductsCL` class s `GetProducts()` and `UpdateProduct` methods.</span></span> <span data-ttu-id="f710d-236">Visitez la page dans un navigateur et le parcourir le code lors du tri et la pagination pour afficher les données extraites à partir du cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-236">Visit the page in a browser and step through the code when sorting and paging in order to see the data pulled from the cache.</span></span> <span data-ttu-id="f710d-237">Mettre à jour un enregistrement, puis notez que le cache est invalidé et, par conséquent, il est récupéré à partir de la couche BLL lorsque les données sont reliées au GridView.</span><span class="sxs-lookup"><span data-stu-id="f710d-237">Then update a record and note that the cache is invalidated and, consequently, it is retrieved from the BLL when the data is rebound to the GridView.</span></span>

> [!NOTE]
> <span data-ttu-id="f710d-238">La couche de mise en cache fourni dans le téléchargement de cet article n’est pas terminée.</span><span class="sxs-lookup"><span data-stu-id="f710d-238">The Caching Layer provided in the download accompanying this article is not complete.</span></span> <span data-ttu-id="f710d-239">Il contient uniquement une classe, `ProductsCL`, lequel sports uniquement un certain nombre de méthodes.</span><span class="sxs-lookup"><span data-stu-id="f710d-239">It contains only one class, `ProductsCL`, which only sports a handful of methods.</span></span> <span data-ttu-id="f710d-240">En outre, une seule page ASP.NET utilise la CL (`~/Caching/FromTheArchitecture.aspx`) tous les autres toujours faire référence à la couche BLL directement.</span><span class="sxs-lookup"><span data-stu-id="f710d-240">Moreover, only a single ASP.NET page uses the CL (`~/Caching/FromTheArchitecture.aspx`) all others still reference the BLL directly.</span></span> <span data-ttu-id="f710d-241">Si vous prévoyez d’utiliser un CL dans votre application, tous les appels à partir de la couche de présentation doivent atteindre CL, ce qui exige que les classes de s CL et méthodes couvert ces classes et méthodes dans la couche BLL actuellement utilisée par la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="f710d-241">If you plan on using a CL in your application, all calls from the Presentation Layer should go to the CL, which would require that the CL s classes and methods covered those classes and methods in the BLL currently used by the Presentation Layer.</span></span>


## <a name="summary"></a><span data-ttu-id="f710d-242">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="f710d-242">Summary</span></span>

<span data-ttu-id="f710d-243">Pendant la mise en cache peut être appliqué à la couche de présentation avec ASP.NET 2.0 s SqlDataSource et contrôles ObjectDataSource, dans l’idéal, la mise en cache de responsabilités est déléguée à une couche distincte de l’architecture.</span><span class="sxs-lookup"><span data-stu-id="f710d-243">While caching can be applied at the Presentation Layer with ASP.NET 2.0 s SqlDataSource and ObjectDataSource controls, ideally caching responsibilities would be delegated to a separate layer in the architecture.</span></span> <span data-ttu-id="f710d-244">Dans ce didacticiel, nous avons créé une couche de mise en cache qui réside entre la couche de présentation et la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="f710d-244">In this tutorial we created a Caching Layer that resides between the Presentation Layer and the Business Logic Layer.</span></span> <span data-ttu-id="f710d-245">La couche de mise en cache doit fournir le même ensemble de classes et méthodes qui existent dans la couche BLL, sont appelées à partir de la couche de présentation.</span><span class="sxs-lookup"><span data-stu-id="f710d-245">The Caching Layer needs to provide the same set of classes and methods that exist in the BLL and are called from the Presentation Layer.</span></span>

<span data-ttu-id="f710d-246">Les exemples de mise en cache de couche nous explorés dans cette section et les didacticiels précédents préviennent *chargement réactif*.</span><span class="sxs-lookup"><span data-stu-id="f710d-246">The Caching Layer examples we explored in this and the preceding tutorials exhibited *reactive loading*.</span></span> <span data-ttu-id="f710d-247">Avec le chargement de réactif, les données sont chargées dans le cache uniquement lorsqu’une demande de données et que les données sont manquantes dans le cache.</span><span class="sxs-lookup"><span data-stu-id="f710d-247">With reactive loading, the data is loaded into the cache only when a request for the data is made and that data is missing from the cache.</span></span> <span data-ttu-id="f710d-248">Données peuvent également être *chargés de façon proactive* dans le cache, une technique qui charge les données dans le cache avant qu’il est réellement nécessaire.</span><span class="sxs-lookup"><span data-stu-id="f710d-248">Data can also be *proactively loaded* into the cache, a technique that loads the data into the cache before it is actually needed.</span></span> <span data-ttu-id="f710d-249">Dans l’étape suivante du didacticiel, nous allons voir un exemple de chargement proactive lorsque nous expliquons comment stocker des valeurs statiques dans le cache au démarrage de l’application.</span><span class="sxs-lookup"><span data-stu-id="f710d-249">In the next tutorial we'll see an example of proactive loading when we look at how to store static values into the cache at application startup.</span></span>

<span data-ttu-id="f710d-250">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="f710d-250">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="f710d-251">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="f710d-251">About the Author</span></span>

<span data-ttu-id="f710d-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept manuels ASP/ASP.NET et créateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="f710d-252">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="f710d-253">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="f710d-253">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="f710d-254">Son dernier ouvrage est [ *SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="f710d-254">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="f710d-255">Il peut être atteint à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou via son blog, qui se trouvent à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="f710d-255">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="f710d-256">Remerciements</span><span class="sxs-lookup"><span data-stu-id="f710d-256">Special Thanks To</span></span>

<span data-ttu-id="f710d-257">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="f710d-257">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="f710d-258">Entraîner un réviseur pour ce didacticiel a été Teresa Murphy.</span><span class="sxs-lookup"><span data-stu-id="f710d-258">Lead reviewer for this tutorial was Teresa Murphy.</span></span> <span data-ttu-id="f710d-259">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="f710d-259">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="f710d-260">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="f710d-260">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="f710d-261">[Précédent](caching-data-with-the-objectdatasource-vb.md)
> [Suivant](caching-data-at-application-startup-vb.md)</span><span class="sxs-lookup"><span data-stu-id="f710d-261">[Previous](caching-data-with-the-objectdatasource-vb.md)
[Next](caching-data-at-application-startup-vb.md)</span></span>
