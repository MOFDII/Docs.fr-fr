---
uid: web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
title: À l’aide de requêtes paramétrables avec le SqlDataSource (VB) | Documents Microsoft
author: rick-anderson
description: Dans ce didacticiel, nous continuer la présentation du contrôle SqlDataSource et apprendre à définir des requêtes paramétrables. Les paramètres peuvent être spécifiés à la fois decla...
ms.author: aspnetcontent
manager: wpickett
ms.date: 02/20/2007
ms.topic: article
ms.assetid: e322f34c-83b7-41ea-ab65-ab1e0bdcc609
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/data-access/accessing-the-database-directly-from-an-aspnet-page/using-parameterized-queries-with-the-sqldatasource-vb
msc.type: authoredcontent
ms.openlocfilehash: a7442ef3bebb2742cc36d695914b745aa2dfa721
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
ms.locfileid: "30878137"
---
<a name="using-parameterized-queries-with-the-sqldatasource-vb"></a><span data-ttu-id="257a3-104">À l’aide de requêtes paramétrables avec le SqlDataSource (VB)</span><span class="sxs-lookup"><span data-stu-id="257a3-104">Using Parameterized Queries with the SqlDataSource (VB)</span></span>
====================
<span data-ttu-id="257a3-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="257a3-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="257a3-106">[Télécharger l’exemple d’application](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) ou [télécharger le PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span><span class="sxs-lookup"><span data-stu-id="257a3-106">[Download Sample App](http://download.microsoft.com/download/4/a/7/4a7a3b18-d80e-4014-8e53-a6a2427f0d93/ASPNET_Data_Tutorial_48_VB.exe) or [Download PDF](using-parameterized-queries-with-the-sqldatasource-vb/_static/datatutorial48vb1.pdf)</span></span>

> <span data-ttu-id="257a3-107">Dans ce didacticiel, nous continuer la présentation du contrôle SqlDataSource et apprendre à définir des requêtes paramétrables.</span><span class="sxs-lookup"><span data-stu-id="257a3-107">In this tutorial, we continue our look at the SqlDataSource control and learn how to define parameterized queries.</span></span> <span data-ttu-id="257a3-108">Les paramètres peuvent être spécifiés à la fois de façon déclarative et par programme et peuvent être extraites d’un nombre d’emplacements tels que la chaîne de requête, de Session état, autres contrôles et bien plus encore.</span><span class="sxs-lookup"><span data-stu-id="257a3-108">The parameters can be specified both declaratively and programmatically, and can be pulled from a number of locations such as the querystring, Session state, other controls, and more.</span></span>


## <a name="introduction"></a><span data-ttu-id="257a3-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="257a3-109">Introduction</span></span>

<span data-ttu-id="257a3-110">Dans le didacticiel précédent, nous avons vu comment utiliser le contrôle SqlDataSource pour récupérer des données directement à partir d’une base de données.</span><span class="sxs-lookup"><span data-stu-id="257a3-110">In the previous tutorial we saw how to use the SqlDataSource control to retrieve data directly from a database.</span></span> <span data-ttu-id="257a3-111">À l’aide de l’Assistant Configurer la Source de données, nous pouvons choisir la base de données, puis soit : choisir les colonnes à retourner à partir d’une table ou vue ; Entrez une instruction SQL personnalisée ; ou utilisez une procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="257a3-111">Using the Configure Data Source wizard, we could choose the database and then either: pick the columns to return from a table or view; enter a custom SQL statement; or use a stored procedure.</span></span> <span data-ttu-id="257a3-112">Si, en sélectionnant les colonnes à partir d’une table ou une vue ou en entrant une instruction SQL personnalisée, le SqlDataSource contrôle s `SelectCommand` est affectée à l’instruction SQL ad hoc obtenue `SELECT` instruction et il est-ce `SELECT` instruction est exécutée lorsque le SqlDataSource s `Select()` méthode est appelée (automatiquement ou par programme à partir d’un contrôle Web de données).</span><span class="sxs-lookup"><span data-stu-id="257a3-112">Whether selecting columns from a table or view or entering a custom SQL statement, the SqlDataSource control s `SelectCommand` property is assigned the resulting ad-hoc SQL `SELECT` statement and it is this `SELECT` statement that is executed when the SqlDataSource s `Select()` method is invoked (either programmatically or automatically from a data Web control).</span></span>

<span data-ttu-id="257a3-113">L’instruction SQL `SELECT` instructions utilisées dans les démonstrations didacticiel s précédent n’offraient pas `WHERE` clauses.</span><span class="sxs-lookup"><span data-stu-id="257a3-113">The SQL `SELECT` statements used in the previous tutorial s demos lacked `WHERE` clauses.</span></span> <span data-ttu-id="257a3-114">Dans un `SELECT` instruction, le `WHERE` clause peut être utilisée pour limiter les résultats retournés.</span><span class="sxs-lookup"><span data-stu-id="257a3-114">In a `SELECT` statement, the `WHERE` clause can be used to limit the results returned.</span></span> <span data-ttu-id="257a3-115">Par exemple, pour afficher les noms de produits d’évaluation des coûts plus de 50,00 $, nous pouvons utiliser la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="257a3-115">For example, to display the names of products costing more than $50.00, we could use the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample1.sql)]

<span data-ttu-id="257a3-116">En règle générale, les valeurs utilisées dans un `WHERE` clause sont déterminer par une source externe, comme une valeur de chaîne de requête, une variable de session ou des entrées utilisateur à partir d’un contrôle Web dans la page.</span><span class="sxs-lookup"><span data-stu-id="257a3-116">Typically, the values used in a `WHERE` clause are determine by some external source, such as a querystring value, a session variable, or user input from a Web control on the page.</span></span> <span data-ttu-id="257a3-117">Dans l’idéal, ces entrées sont spécifiées à l’aide de *paramètres*.</span><span class="sxs-lookup"><span data-stu-id="257a3-117">Ideally, such inputs are specified through the use of *parameters*.</span></span> <span data-ttu-id="257a3-118">Avec Microsoft SQL Server, les paramètres sont indiqués à l’aide de `@parameterName`, comme dans :</span><span class="sxs-lookup"><span data-stu-id="257a3-118">With Microsoft SQL Server, parameters are denoted using `@parameterName`, as in:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample2.sql)]

<span data-ttu-id="257a3-119">Prend en charge les requêtes paramétrables, à la fois pour le SqlDataSource `SELECT` instructions et `INSERT`, `UPDATE`, et `DELETE` instructions.</span><span class="sxs-lookup"><span data-stu-id="257a3-119">The SqlDataSource supports parameterized queries, both for `SELECT` statements and `INSERT`, `UPDATE`, and `DELETE` statements.</span></span> <span data-ttu-id="257a3-120">En outre, les valeurs de paramètre peuvent être automatiquement extraites à partir de diverses sources de la chaîne de requête, l’état de session, les contrôles sur la page et ainsi de suite ou peuvent être affectées par programme.</span><span class="sxs-lookup"><span data-stu-id="257a3-120">Moreover, the parameter values can be automatically pulled from a variety of sources the querystring, session state, controls on the page, and so on or can be assigned programmatically.</span></span> <span data-ttu-id="257a3-121">Dans ce didacticiel, nous verrons comment définir des requêtes paramétrables comment pour spécifier le paramètre des valeurs de façon déclarative et par programme.</span><span class="sxs-lookup"><span data-stu-id="257a3-121">In this tutorial, we'll see how to define parameterized queries as well as how to specify the parameter values both declaratively and programmatically.</span></span>

> [!NOTE]
> <span data-ttu-id="257a3-122">Dans le didacticiel précédent, nous avons comparé ObjectDataSource qui a été notre outil de choix sur les 46 tout d’abord didacticiels avec le SqlDataSource, en indiquant leurs similitudes conceptuels.</span><span class="sxs-lookup"><span data-stu-id="257a3-122">In the previous tutorial we compared the ObjectDataSource which has been our tool of choice over the first 46 tutorials with the SqlDataSource, noting their conceptual similarities.</span></span> <span data-ttu-id="257a3-123">Ces similitudes s’étendent aussi à des paramètres.</span><span class="sxs-lookup"><span data-stu-id="257a3-123">These similarities also extend to parameters.</span></span> <span data-ttu-id="257a3-124">Les paramètres de s ObjectDataSource mappées aux paramètres d’entrée pour les méthodes dans la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="257a3-124">The ObjectDataSource s parameters mapped to the input parameters for the methods in the Business Logic Layer.</span></span> <span data-ttu-id="257a3-125">Avec le SqlDataSource, les paramètres sont définis directement dans la requête SQL.</span><span class="sxs-lookup"><span data-stu-id="257a3-125">With the SqlDataSource, the parameters are defined directly within the SQL query.</span></span> <span data-ttu-id="257a3-126">Les deux contrôles ont des collections de paramètres pour leurs `Select()`, `Insert()`, `Update()`, et `Delete()` des méthodes et les deux peuvent avoir ces valeurs de paramètre remplis à partir de sources prédéfinis (valeurs de chaîne de requête, les variables de session, etc. ) ou attribués par programme.</span><span class="sxs-lookup"><span data-stu-id="257a3-126">Both controls have collections of parameters for their `Select()`, `Insert()`, `Update()`, and `Delete()` methods, and both can have these parameter values populated from pre-defined sources (querystring values, session variables, and so on) or assigned programmatically.</span></span>


## <a name="creating-a-parameterized-query"></a><span data-ttu-id="257a3-127">Création d'une requête paramétrée</span><span class="sxs-lookup"><span data-stu-id="257a3-127">Creating a Parameterized Query</span></span>

<span data-ttu-id="257a3-128">L’Assistant Configurer la Source de données de SqlDataSource contrôle s offre trois outils différents pour la définition de la commande à exécuter pour récupérer les enregistrements de base de données :</span><span class="sxs-lookup"><span data-stu-id="257a3-128">The SqlDataSource control s Configure Data Source wizard offers three avenues for defining the command to execute to retrieve database records:</span></span>

- <span data-ttu-id="257a3-129">En choisissant les colonnes à partir d’une table ou une vue,</span><span class="sxs-lookup"><span data-stu-id="257a3-129">By picking the columns from an existing table or view,</span></span>
- <span data-ttu-id="257a3-130">En entrant une instruction SQL personnalisée, ou</span><span class="sxs-lookup"><span data-stu-id="257a3-130">By entering a custom SQL statement, or</span></span>
- <span data-ttu-id="257a3-131">En choisissant une procédure stockée</span><span class="sxs-lookup"><span data-stu-id="257a3-131">By choosing a stored procedure</span></span>

<span data-ttu-id="257a3-132">Lors de la sélection des colonnes d’une table existante ou d’affichage, les paramètres de la `WHERE` clause doit être spécifiée via l’ajout de `WHERE` boîte de dialogue Clause.</span><span class="sxs-lookup"><span data-stu-id="257a3-132">When picking columns from an existing table or view, the parameters for the `WHERE` clause must be specified through the Add `WHERE` Clause dialog box.</span></span> <span data-ttu-id="257a3-133">Lorsque vous créez une instruction SQL personnalisée, toutefois, vous pouvez entrer les paramètres directement dans le `WHERE` clause (à l’aide de `@parameterName` pour indiquer chaque paramètre).</span><span class="sxs-lookup"><span data-stu-id="257a3-133">When creating a custom SQL statement, however, you can enter the parameters directly into the `WHERE` clause (using `@parameterName` to denote each parameter).</span></span> <span data-ttu-id="257a3-134">A [procédure stockée](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) se compose d’une ou plusieurs instructions SQL, et ces instructions peuvent être paramétrées.</span><span class="sxs-lookup"><span data-stu-id="257a3-134">A [stored procedure](http://www.awprofessional.com/articles/article.asp?p=25288&amp;rl=1) consists of one or more SQL statements, and these statements can be parameterized.</span></span> <span data-ttu-id="257a3-135">Les paramètres utilisés dans les instructions SQL, toutefois, doivent être passés dans en tant que paramètres d’entrée à la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="257a3-135">The parameters used in the SQL statements, however, must be passed in as input parameters to the stored procedure.</span></span>

<span data-ttu-id="257a3-136">Étant donné que la création d’une requête paramétrable dépend de la s SqlDataSource `SelectCommand` est spécifié, laissez s un coup de œil aux trois approches.</span><span class="sxs-lookup"><span data-stu-id="257a3-136">Since creating a parameterized query depends on how the SqlDataSource s `SelectCommand` is specified, let s take a look at all three approaches.</span></span> <span data-ttu-id="257a3-137">Pour commencer, ouvrez le `ParameterizedQueries.aspx` page dans le `SqlDataSource` dossier, faites glisser un contrôle SqlDataSource à partir de la boîte à outils vers le concepteur et définir son `ID` à `Products25BucksAndUnderDataSource`.</span><span class="sxs-lookup"><span data-stu-id="257a3-137">To get started, open the `ParameterizedQueries.aspx` page in the `SqlDataSource` folder, drag a SqlDataSource control from the Toolbox onto the Designer, and set its `ID` to `Products25BucksAndUnderDataSource`.</span></span> <span data-ttu-id="257a3-138">Ensuite, cliquez sur le lien configurer la Source de données à partir de la balise active de contrôle s.</span><span class="sxs-lookup"><span data-stu-id="257a3-138">Next, click the Configure Data Source link from the control s smart tag.</span></span> <span data-ttu-id="257a3-139">Sélectionnez la base de données à utiliser (`NORTHWINDConnectionString`) et cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="257a3-139">Select the database to use (`NORTHWINDConnectionString`) and click Next.</span></span>

## <a name="step-1-adding-awhereclause-when-picking-the-columns-from-a-table-or-view"></a><span data-ttu-id="257a3-140">Étape 1 : Ajout d’un`WHERE`Clause lors de la sélection des colonnes à partir d’une Table ou une vue</span><span class="sxs-lookup"><span data-stu-id="257a3-140">Step 1: Adding a`WHERE`Clause When Picking the Columns from a Table or View</span></span>

<span data-ttu-id="257a3-141">Lorsque vous sélectionnez les données à retourner à partir de la base de données avec le contrôle SqlDataSource, l’Assistant Configurer la Source de données permet simplement de sélectionner les colonnes à retourner à partir d’une table existante ou afficher (voir Figure 1).</span><span class="sxs-lookup"><span data-stu-id="257a3-141">When selecting the data to return from the database with the SqlDataSource control, the Configure Data Source wizard allows us to simply pick the columns to return from an existing table or view (see Figure 1).</span></span> <span data-ttu-id="257a3-142">Crée alors automatiquement SQL `SELECT` instruction, qui est envoyé à la base de données lorsque le s SqlDataSource `Select()` méthode est appelée.</span><span class="sxs-lookup"><span data-stu-id="257a3-142">Doing so automatically builds up a SQL `SELECT` statement, which is what is sent to the database when the SqlDataSource s `Select()` method is invoked.</span></span> <span data-ttu-id="257a3-143">Comme nous l’avons fait dans le didacticiel précédent, sélectionnez la table Products dans la liste déroulante et vérifiez la `ProductID`, `ProductName`, et `UnitPrice` colonnes.</span><span class="sxs-lookup"><span data-stu-id="257a3-143">As we did in the previous tutorial, select the Products table from the drop-down list and check the `ProductID`, `ProductName`, and `UnitPrice` columns.</span></span>


<span data-ttu-id="257a3-144">[![Choisir les colonnes à retourner à partir d’une Table ou une vue](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-144">[![Pick the Columns to Return from a Table or View](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image1.png)</span></span>

<span data-ttu-id="257a3-145">**Figure 1**: choisir les colonnes à retourner à partir d’une Table ou vue ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-145">**Figure 1**: Pick the Columns to Return from a Table or View ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.png))</span></span>


<span data-ttu-id="257a3-146">Pour inclure un `WHERE` clause dans la `SELECT` instruction, cliquez sur le `WHERE` bouton qui affiche l’ajouter `WHERE` Clause boîte de dialogue (Figure 2).</span><span class="sxs-lookup"><span data-stu-id="257a3-146">To include a `WHERE` clause in the `SELECT` statement, click the `WHERE` button, which brings up the Add `WHERE` Clause dialog box (see Figure 2).</span></span> <span data-ttu-id="257a3-147">Pour ajouter un paramètre pour limiter les résultats retournés par le `SELECT` de requête, commencez par choisir la colonne à filtrer les données.</span><span class="sxs-lookup"><span data-stu-id="257a3-147">To add a parameter to limit the results returned by the `SELECT` query, first choose the column to filter the data by.</span></span> <span data-ttu-id="257a3-148">Ensuite, choisissez l’opérateur à utiliser pour le filtrage (=, &lt;, &lt;=, &gt;, et ainsi de suite).</span><span class="sxs-lookup"><span data-stu-id="257a3-148">Next, choose the operator to use for filtering (=, &lt;, &lt;=, &gt;, and so on).</span></span> <span data-ttu-id="257a3-149">Enfin, choisissez la source de la valeur du paramètre s, telles que de l’état de session ou de la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="257a3-149">Finally, choose the source of the parameter s value, such as from the querystring or session state.</span></span> <span data-ttu-id="257a3-150">Après avoir configuré le paramètre, cliquez sur le bouton Ajouter pour l’inclure dans le `SELECT` requête.</span><span class="sxs-lookup"><span data-stu-id="257a3-150">After configuring the parameter, click the Add button to include it in the `SELECT` query.</span></span>

<span data-ttu-id="257a3-151">Pour cet exemple, s permettent de retourner uniquement les résultats où les `UnitPrice` valeur est inférieure ou égale à 25,00 $.</span><span class="sxs-lookup"><span data-stu-id="257a3-151">For this example, let s only return those results where the `UnitPrice` value is less than or equal to $25.00.</span></span> <span data-ttu-id="257a3-152">Par conséquent, choisissez `UnitPrice` à partir de la liste déroulante des colonnes et &lt;= à partir de la liste déroulante opérateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-152">Therefore, pick `UnitPrice` from the Column drop-down list and &lt;= from the Operator drop-down list.</span></span> <span data-ttu-id="257a3-153">Lorsque vous utilisez une valeur de paramètre codée en dur (par exemple, $25,00) ou si la valeur du paramètre doit être spécifié par programme, sélectionnez aucun dans la liste déroulante de Source.</span><span class="sxs-lookup"><span data-stu-id="257a3-153">When using a hard-coded parameter value (such as $25.00) or if the parameter value is to be specified programmatically, select None from the Source drop-down list.</span></span> <span data-ttu-id="257a3-154">Ensuite, entrez la valeur de paramètre codée en dur dans la zone de texte valeur 25,00 et terminer le processus en cliquant sur le bouton Ajouter.</span><span class="sxs-lookup"><span data-stu-id="257a3-154">Next, enter the hard-coded parameter value in the Value textbox 25.00 and complete the process by clicking the Add button.</span></span>


<span data-ttu-id="257a3-155">[![Limiter les résultats retournés à partir de l’ajouter WHERE Clause boîte de dialogue](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-155">[![Limit the Results Returned from the Add WHERE Clause Dialog Box](using-parameterized-queries-with-the-sqldatasource-vb/_static/image2.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.png)</span></span>

<span data-ttu-id="257a3-156">**Figure 2**: limiter les résultats retournés à partir de l’ajout de `WHERE` boîte de dialogue Clause ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-156">**Figure 2**: Limit the Results Returned from the Add `WHERE` Clause Dialog Box ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.png))</span></span>


<span data-ttu-id="257a3-157">Après avoir ajouté le paramètre, cliquez sur OK pour revenir à l’Assistant Configurer la Source de données.</span><span class="sxs-lookup"><span data-stu-id="257a3-157">After adding the parameter, click OK to return to the Configure Data Source wizard.</span></span> <span data-ttu-id="257a3-158">Le `SELECT` instruction au bas de l’Assistant doit désormais inclure une `WHERE` clause avec un paramètre nommé `@UnitPrice`:</span><span class="sxs-lookup"><span data-stu-id="257a3-158">The `SELECT` statement at the bottom of the wizard should now include a `WHERE` clause with a parameter named `@UnitPrice`:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample3.sql)]

> [!NOTE]
> <span data-ttu-id="257a3-159">Si vous spécifiez plusieurs conditions dans le `WHERE` clause à partir de l’ajout de `WHERE` boîte de dialogue de Clause, l’Assistant les joint avec la `AND` opérateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-159">If you specify multiple conditions in the `WHERE` clause from the Add `WHERE` Clause dialog box, the wizard joins them with the `AND` operator.</span></span> <span data-ttu-id="257a3-160">Si vous avez besoin d’inclure un `OR` dans le `WHERE` clause (comme `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`), vous avez à générer la `SELECT` instruction via l’écran d’instruction SQL personnalisée.</span><span class="sxs-lookup"><span data-stu-id="257a3-160">If you need to include an `OR` in the `WHERE` clause (such as `WHERE UnitPrice <= @UnitPrice OR Discontinued = 1`) then you have to build the `SELECT` statement through the custom SQL statement screen.</span></span>


<span data-ttu-id="257a3-161">Terminer la configuration le SqlDataSource (cliquez sur Suivant, puis terminer), puis analysez le balisage déclaratif de SqlDataSource s.</span><span class="sxs-lookup"><span data-stu-id="257a3-161">Complete configuring the SqlDataSource (click Next, then Finish) and then inspect the SqlDataSource s declarative markup.</span></span> <span data-ttu-id="257a3-162">Le balisage inclut désormais un `<SelectParameters>` collection, qui définit les sources pour les paramètres de la `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="257a3-162">The markup now includes a `<SelectParameters>` collection, which spells out the sources for the parameters in the `SelectCommand`.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample4.aspx)]

<span data-ttu-id="257a3-163">Lorsque le SqlDataSource s `Select()` méthode est appelée, le `UnitPrice` (25,00) la valeur du paramètre est appliquée à la `@UnitPrice` paramètre dans le `SelectCommand` avant d’être envoyés à la base de données.</span><span class="sxs-lookup"><span data-stu-id="257a3-163">When the SqlDataSource s `Select()` method is invoked, the `UnitPrice` parameter value (25.00) is applied to the `@UnitPrice` parameter in the `SelectCommand` before being sent to the database.</span></span> <span data-ttu-id="257a3-164">Il en résulte que seuls ces produits inférieur ou égal à $25,00 sont retournées à partir de la `Products` table.</span><span class="sxs-lookup"><span data-stu-id="257a3-164">The net result is that only those products less than or equal to $25.00 are returned from the `Products` table.</span></span> <span data-ttu-id="257a3-165">Pour confirmer cela, pour ajouter un contrôle GridView à la page, la lier à cette source de données et affichez la page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-165">To confirm this, add a GridView to the page, bind it to this data source, and then view the page through a browser.</span></span> <span data-ttu-id="257a3-166">Vous devez uniquement voir ces produits répertoriés inférieur ou égal à $25,00, comme la Figure 3 confirme.</span><span class="sxs-lookup"><span data-stu-id="257a3-166">You should only see those products listed that are less than or equal to $25.00, as Figure 3 confirms.</span></span>


<span data-ttu-id="257a3-167">[![Uniquement les produits inférieur ou égal à $25,00 sont affichés.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-167">[![Only Those Products Less Than or Equal to $25.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image3.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.png)</span></span>

<span data-ttu-id="257a3-168">**Figure 3**: uniquement les produits inférieur ou égal à $25,00 sont affichés ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-168">**Figure 3**: Only Those Products Less Than or Equal to $25.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.png))</span></span>


## <a name="step-2-adding-parameters-to-a-custom-sql-statement"></a><span data-ttu-id="257a3-169">Étape 2 : Ajout de paramètres à une instruction SQL personnalisée</span><span class="sxs-lookup"><span data-stu-id="257a3-169">Step 2: Adding Parameters to a Custom SQL Statement</span></span>

<span data-ttu-id="257a3-170">Lors de l’ajout d’une instruction SQL personnalisée, vous pouvez entrer le `WHERE` clause explicitement ou spécifier une valeur dans la cellule de filtre du Générateur de requêtes.</span><span class="sxs-lookup"><span data-stu-id="257a3-170">When adding a custom SQL statement you can enter the `WHERE` clause explicitly or specify a value in the Filter cell of the Query Builder.</span></span> <span data-ttu-id="257a3-171">Pour illustrer cela, permettent d’afficher uniquement les produits dans un GridView dont le prix est inférieur à un certain seuil s.</span><span class="sxs-lookup"><span data-stu-id="257a3-171">To demonstrate this, let s display just those products in a GridView whose prices are less than a certain threshold.</span></span> <span data-ttu-id="257a3-172">Commencez par ajouter une zone de texte pour le `ParameterizedQueries.aspx` page pour obtenir cette valeur de seuil de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-172">Start by adding a TextBox to the `ParameterizedQueries.aspx` page to collect this threshold value from the user.</span></span> <span data-ttu-id="257a3-173">Définir la zone de texte s `ID` propriété `MaxPrice`.</span><span class="sxs-lookup"><span data-stu-id="257a3-173">Set the TextBox s `ID` property to `MaxPrice`.</span></span> <span data-ttu-id="257a3-174">Ajouter un contrôle bouton et définissez ses `Text` propriété pour afficher les correspondances.</span><span class="sxs-lookup"><span data-stu-id="257a3-174">Add a Button Web control and set its `Text` property to Display Matching Products .</span></span>

<span data-ttu-id="257a3-175">Ensuite, faites glisser un GridView sur la page et choisissez sa balise active pour créer un nouveau SqlDataSource nommé `ProductsFilteredByPriceDataSource`.</span><span class="sxs-lookup"><span data-stu-id="257a3-175">Next, drag a GridView onto the page and from its smart tag choose to create a new SqlDataSource named `ProductsFilteredByPriceDataSource`.</span></span> <span data-ttu-id="257a3-176">À partir de l’Assistant Configurer la Source de données, passez à la spécifier une instruction SQL personnalisée ou l’écran de la procédure stockée (voir Figure 4) et entrez la requête suivante :</span><span class="sxs-lookup"><span data-stu-id="257a3-176">From the Configure Data Source wizard, proceed to the Specify a custom SQL statement or stored procedure screen (see Figure 4) and enter the following query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample5.sql)]

<span data-ttu-id="257a3-177">Après avoir entré la requête (manuellement ou via le Générateur de requêtes), cliquez sur Suivant.</span><span class="sxs-lookup"><span data-stu-id="257a3-177">After entering the query (either manually or through the Query Builder), click Next.</span></span>


<span data-ttu-id="257a3-178">[![Retourner uniquement les produits inférieure ou égale à une valeur de paramètre](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-178">[![Return Only Those Products Less Than or Equal to a Parameter Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image4.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.png)</span></span>

<span data-ttu-id="257a3-179">**Figure 4**: retourner uniquement les produits inférieur ou égal à une valeur de paramètre ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-179">**Figure 4**: Return Only Those Products Less Than or Equal to a Parameter Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.png))</span></span>


<span data-ttu-id="257a3-180">Étant donné que la requête inclut des paramètres, l’écran suivant de l’Assistant nous invite pour la source des valeurs de paramètres.</span><span class="sxs-lookup"><span data-stu-id="257a3-180">Since the query includes parameters, the next screen in the wizard prompts us for the source of the parameters values.</span></span> <span data-ttu-id="257a3-181">Choisissez le contrôle de la liste de liste déroulante de source de paramètre et `MaxPrice` (le contrôle de zone de texte s `ID` valeur) à partir de la liste déroulante ControlID.</span><span class="sxs-lookup"><span data-stu-id="257a3-181">Choose Control from the Parameter source drop-down list and `MaxPrice` (the TextBox control s `ID` value) from the ControlID drop-down list.</span></span> <span data-ttu-id="257a3-182">Vous pouvez également entrer une valeur par défaut facultative à utiliser dans le cas où l’utilisateur n’a pas entré n’importe quel texte dans le `MaxPrice` zone de texte.</span><span class="sxs-lookup"><span data-stu-id="257a3-182">You can also enter an optional default value to use in the case where the user has not entered any text into the `MaxPrice` TextBox.</span></span> <span data-ttu-id="257a3-183">Pour l’instant, n’entrez pas de valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="257a3-183">For the time being, do not enter a default value.</span></span>


<span data-ttu-id="257a3-184">[![La propriété Text de s MaxPrice TextBox est utilisé comme Source du paramètre](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-184">[![The MaxPrice TextBox s Text Property is Used as the Parameter Source](using-parameterized-queries-with-the-sqldatasource-vb/_static/image5.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.png)</span></span>

<span data-ttu-id="257a3-185">**Figure 5**: le `MaxPrice` s de la zone de texte `Text` propriété est utilisée comme Source de paramètre ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-185">**Figure 5**: The `MaxPrice` TextBox s `Text` Property is Used as the Parameter Source ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.png))</span></span>


<span data-ttu-id="257a3-186">Terminez l’Assistant de configurer la Source de données en cliquant sur Suivant, puis sur Terminer.</span><span class="sxs-lookup"><span data-stu-id="257a3-186">Complete the Configure Data Source wizard by clicking Next, then Finish.</span></span> <span data-ttu-id="257a3-187">Le balisage déclaratif pour le GridView, une zone de texte, un bouton et un SqlDataSource suit :</span><span class="sxs-lookup"><span data-stu-id="257a3-187">The declarative markup for the GridView, TextBox, Button, and SqlDataSource follows:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample6.aspx)]

<span data-ttu-id="257a3-188">Notez que le paramètre dans le s SqlDataSource `<SelectParameters>` section est un `ControlParameter`, qui inclut des propriétés supplémentaires telles que `ControlID` et `PropertyName`.</span><span class="sxs-lookup"><span data-stu-id="257a3-188">Note that the parameter within the SqlDataSource s `<SelectParameters>` section is a `ControlParameter`, which includes additional properties like `ControlID` and `PropertyName`.</span></span> <span data-ttu-id="257a3-189">Lorsque le SqlDataSource s `Select()` méthode est appelée, le `ControlParameter` extrait la valeur de la propriété de contrôle Web spécifiée et l’affecte au paramètre correspondant dans le `SelectCommand`.</span><span class="sxs-lookup"><span data-stu-id="257a3-189">When the SqlDataSource s `Select()` method is invoked, the `ControlParameter` grabs the value from the specified Web control property and assigns it to the corresponding parameter in the `SelectCommand`.</span></span> <span data-ttu-id="257a3-190">Dans cet exemple, le `MaxPrice` s Text (propriété) est utilisé comme le `@MaxPrice` la valeur du paramètre.</span><span class="sxs-lookup"><span data-stu-id="257a3-190">In this example, the `MaxPrice` s Text property is used as the `@MaxPrice` parameter value.</span></span>

<span data-ttu-id="257a3-191">Prenez une minute pour afficher cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-191">Take a minute to view this page through a browser.</span></span> <span data-ttu-id="257a3-192">Lors de la première visite la page ou chaque fois que le `MaxPrice` zone de texte ne dispose pas d’une valeur sans enregistrements sont affichés dans le GridView.</span><span class="sxs-lookup"><span data-stu-id="257a3-192">When first visiting the page or whenever the `MaxPrice` TextBox lacks a value no records are displayed in the GridView.</span></span>


<span data-ttu-id="257a3-193">[![Aucun enregistrement n’est Qu'affiché lorsque le MaxPrice zone de texte est vide](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-193">[![No Records are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image6.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.png)</span></span>

<span data-ttu-id="257a3-194">**Figure 6**: aucun enregistrement sont affichés lorsque le `MaxPrice` zone de texte est vide ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-194">**Figure 6**: No Records are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.png))</span></span>


<span data-ttu-id="257a3-195">La raison pour laquelle aucun produit n’est affichés est car, par défaut, une chaîne vide pour une valeur de paramètre est convertie en une base de données `NULL` valeur.</span><span class="sxs-lookup"><span data-stu-id="257a3-195">The reason no products are shown is because, by default, an empty string for a parameter value is converted into a database `NULL` value.</span></span> <span data-ttu-id="257a3-196">Depuis la comparaison de `[UnitPrice] <= NULL` a toujours la valeur False, ne renvoie aucun résultat.</span><span class="sxs-lookup"><span data-stu-id="257a3-196">Since the comparison of `[UnitPrice] <= NULL` always evaluates as False, no results are returned.</span></span>

<span data-ttu-id="257a3-197">Entrer une valeur dans la zone de texte, comme 5,00, puis cliquez sur le bouton Afficher les correspondances.</span><span class="sxs-lookup"><span data-stu-id="257a3-197">Enter a value into the textbox, like 5.00, and click the Display Matching Products button.</span></span> <span data-ttu-id="257a3-198">Lors de la publication, le SqlDataSource informe que le GridView qu’une de ses sources de paramètre a été modifié.</span><span class="sxs-lookup"><span data-stu-id="257a3-198">On postback, the SqlDataSource informs the GridView that one of its parameter sources has changed.</span></span> <span data-ttu-id="257a3-199">Par conséquent, le contrôle GridView relie pour le SqlDataSource, affichage de ces produits inférieur ou égal à 5,00 $.</span><span class="sxs-lookup"><span data-stu-id="257a3-199">Consequently, the GridView rebinds to the SqlDataSource, displaying those products less than or equal to $5.00.</span></span>


<span data-ttu-id="257a3-200">[![Produits inférieur ou égal à 5,00 $ sont affichés.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-200">[![Products Less Than or Equal to $5.00 are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image7.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.png)</span></span>

<span data-ttu-id="257a3-201">**Figure 7**: produits inférieur ou égal à 5,00 $ sont affichés ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-201">**Figure 7**: Products Less Than or Equal to $5.00 are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.png))</span></span>


## <a name="initially-displaying-all-products"></a><span data-ttu-id="257a3-202">Affichage initial de tous les produits</span><span class="sxs-lookup"><span data-stu-id="257a3-202">Initially Displaying All Products</span></span>

<span data-ttu-id="257a3-203">Au lieu de n’afficher aucun produit lors du premier chargement de la page, nous pouvons souhaiter afficher *tous les* produits.</span><span class="sxs-lookup"><span data-stu-id="257a3-203">Rather than displaying no products when the page is first loaded, we may want to display *all* products.</span></span> <span data-ttu-id="257a3-204">Pour répertorier tous les produits à chaque fois que le `MaxPrice` zone de texte est vide consiste à définir la valeur par défaut de s paramètre à une valeur extrêmement élevée, comme 1000000, étant donné qu’il s improbable que Northwind Traders effectue jamais inventaire dont le prix unitaire dépasse 1 000 000 USD.</span><span class="sxs-lookup"><span data-stu-id="257a3-204">One way to list all products whenever the `MaxPrice` TextBox is empty is to set the parameter s default value to some insanely high value, like 1000000, since it s unlikely that Northwind Traders will ever have inventory whose unit price exceeds $1,000,000.</span></span> <span data-ttu-id="257a3-205">Toutefois, cette approche imprévoyance et peut ne pas fonctionne dans d’autres situations.</span><span class="sxs-lookup"><span data-stu-id="257a3-205">However, this approach is shortsighted and might not work in other situations.</span></span>

<span data-ttu-id="257a3-206">Dans les didacticiels précédents - [paramètres déclaratifs](../basic-reporting/declarative-parameters-vb.md) et [filtrage de maître/détail avec un DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) nous étions confrontés à un problème similaire.</span><span class="sxs-lookup"><span data-stu-id="257a3-206">In previous tutorials - [Declarative Parameters](../basic-reporting/declarative-parameters-vb.md) and [Master/Detail Filtering With a DropDownList](../masterdetail/master-detail-filtering-with-a-dropdownlist-vb.md) we were faced with a similar problem.</span></span> <span data-ttu-id="257a3-207">Notre solution il était à placer cette logique dans la couche de logique métier.</span><span class="sxs-lookup"><span data-stu-id="257a3-207">Our solution there was to put this logic in the Business Logic Layer.</span></span> <span data-ttu-id="257a3-208">Plus précisément, la couche BLL examiné la valeur entrante et, si elle a été `NULL` ou certains réservés valeur, l’appel a été routé vers la méthode de la couche DAL que tous les enregistrements retournés.</span><span class="sxs-lookup"><span data-stu-id="257a3-208">Specifically, the BLL examined the incoming value and, if it was `NULL` or some reserved value, the call was routed to the DAL method that returned all records.</span></span> <span data-ttu-id="257a3-209">Si la valeur entrante a une valeur de filtrage normale, un appel à la méthode de la couche DAL qui a exécuté une instruction SQL qui a utilisé un paramétrable `WHERE` clause avec la valeur fournie.</span><span class="sxs-lookup"><span data-stu-id="257a3-209">If the incoming value was a normal filtering value, a call was made to the DAL method that executed a SQL statement that used a parameterized `WHERE` clause with the supplied value.</span></span>

<span data-ttu-id="257a3-210">Malheureusement, nous contourner l’architecture lorsque vous utilisez le SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="257a3-210">Unfortunately, we bypass the architecture when using the SqlDataSource.</span></span> <span data-ttu-id="257a3-211">Au lieu de cela, nous avons besoin personnaliser l’instruction SQL pour récupérer intelligemment tous les enregistrements si le `@MaximumPrice` paramètre est `NULL` ou une valeur réservée.</span><span class="sxs-lookup"><span data-stu-id="257a3-211">Instead, we need to customize the SQL statement to intelligently grab all records if the `@MaximumPrice` parameter is `NULL` or some reserved value.</span></span> <span data-ttu-id="257a3-212">Dans cet exercice, permettent de s l’avez ainsi que se le `@MaximumPrice` paramètre est égal à `-1.0`, puis *tous les* les enregistrements doivent être retournées (`-1.0` fonctionne comme une valeur réservée, car aucun produit ne peut avoir une valeur négative `UnitPrice`valeur).</span><span class="sxs-lookup"><span data-stu-id="257a3-212">For this exercise, let s have it so that if the `@MaximumPrice` parameter is equal to `-1.0`, then *all* of the records are to be returned (`-1.0` works as a reserved value since no product can have a negative `UnitPrice` value).</span></span> <span data-ttu-id="257a3-213">Pour ce faire, nous pouvons utiliser l’instruction SQL suivante :</span><span class="sxs-lookup"><span data-stu-id="257a3-213">To accomplish this we can use the following SQL statement:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample7.sql)]

<span data-ttu-id="257a3-214">Cela `WHERE` clause retourne *tous les* enregistre si la `@MaximumPrice` paramètre est égal à `-1.0`.</span><span class="sxs-lookup"><span data-stu-id="257a3-214">This `WHERE` clause returns *all* records if the `@MaximumPrice` parameter equals `-1.0`.</span></span> <span data-ttu-id="257a3-215">Si la valeur du paramètre n’est pas `-1.0`, uniquement les produits dont `UnitPrice` est inférieure ou égale à la `@MaximumPrice` la valeur du paramètre sont retournés.</span><span class="sxs-lookup"><span data-stu-id="257a3-215">If the parameter value is not `-1.0`, only those products whose `UnitPrice` is less than or equal to the `@MaximumPrice` parameter value are returned.</span></span> <span data-ttu-id="257a3-216">En définissant la valeur par défaut de la `@MaximumPrice` paramètre `-1.0`, sur le premier chargement de page (ou chaque fois que le `MaxPrice` zone de texte est vide), `@MaximumPrice` aura une valeur de `-1.0` et tous les produits seront affiche.</span><span class="sxs-lookup"><span data-stu-id="257a3-216">By setting the default value of the `@MaximumPrice` parameter to `-1.0`, on the first page load (or whenever the `MaxPrice` TextBox is empty), `@MaximumPrice` will have a value of `-1.0` and all products will be displayed.</span></span>


<span data-ttu-id="257a3-217">[![Maintenant tous les produits sont affichés lorsque le MaxPrice zone de texte est vide](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-217">[![Now All Products are Displayed When the MaxPrice TextBox is Empty](using-parameterized-queries-with-the-sqldatasource-vb/_static/image8.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.png)</span></span>

<span data-ttu-id="257a3-218">**Figure 8**: désormais tous les produits sont affichés lorsque le `MaxPrice` zone de texte est vide ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-218">**Figure 8**: Now All Products are Displayed When the `MaxPrice` TextBox is Empty ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image16.png))</span></span>


<span data-ttu-id="257a3-219">Il existe quelques inconvénients à noter avec cette approche.</span><span class="sxs-lookup"><span data-stu-id="257a3-219">There are a couple of caveats to note with this approach.</span></span> <span data-ttu-id="257a3-220">Tout d’abord, sachez que le type de données de paramètre s est déduit par cette utilisation s dans la requête SQL.</span><span class="sxs-lookup"><span data-stu-id="257a3-220">First, realize that the parameter s data type is inferred by it s usage in the SQL query.</span></span> <span data-ttu-id="257a3-221">Si vous modifiez le `WHERE` clause de `@MaximumPrice = -1.0` à `@MaximumPrice = -1`, le runtime traite le paramètre en tant qu’entier.</span><span class="sxs-lookup"><span data-stu-id="257a3-221">If you change the `WHERE` clause from `@MaximumPrice = -1.0` to `@MaximumPrice = -1`, the runtime treats the parameter as an integer.</span></span> <span data-ttu-id="257a3-222">Si vous tentez ensuite d’affecter le `MaxPrice` zone de texte avec une valeur décimale (comme 5,00), une erreur se produit, car elle ne peut pas convertir 5,00 en un entier.</span><span class="sxs-lookup"><span data-stu-id="257a3-222">If you then attempt to assign the `MaxPrice` TextBox to a decimal value (like 5.00 ), an error will occur because it cannot convert 5.00 to an integer.</span></span> <span data-ttu-id="257a3-223">Pour résoudre ce problème, soit vous assurer que vous utilisez `@MaximumPrice = -1.0` dans les `WHERE` clause ou, mieux encore, définissez la `ControlParameter` objet s `Type` propriété en nombre décimal.</span><span class="sxs-lookup"><span data-stu-id="257a3-223">To remedy this, either make sure that you use `@MaximumPrice = -1.0` in the `WHERE` clause or, better yet, set the `ControlParameter` object s `Type` property to Decimal .</span></span>

<span data-ttu-id="257a3-224">Deuxièmement, en ajoutant le `OR @MaximumPrice = -1.0` à la `WHERE` clause, le moteur de requête ne peut pas utiliser un index sur `UnitPrice` (en supposant qu’il existe), ce qui entraîne une analyse de table.</span><span class="sxs-lookup"><span data-stu-id="257a3-224">Secondly, by adding the `OR @MaximumPrice = -1.0` to the `WHERE` clause, the query engine cannot use an index on `UnitPrice` (assuming one exists), thereby resulting in a table scan.</span></span> <span data-ttu-id="257a3-225">Cela peut affecter les performances s’il existe un nombre suffisant d’enregistrements dans la `Products` table.</span><span class="sxs-lookup"><span data-stu-id="257a3-225">This can impact performance if there are a sufficiently large number of records in the `Products` table.</span></span> <span data-ttu-id="257a3-226">Une meilleure approche serait de passer de cette logique à une procédure stockée où un `IF` instruction soit effectue un `SELECT` de requête à partir de la `Products` table sans un `WHERE` clause lorsque tous les enregistrements doivent être retournés ou une dont `WHERE` clause contient uniquement le `UnitPrice` critères, afin qu’un index peut être utilisé.</span><span class="sxs-lookup"><span data-stu-id="257a3-226">A better approach would be to move this logic to a stored procedure where an `IF` statement would either perform a `SELECT` query from the `Products` table without a `WHERE` clause when all records need to be returned or one whose `WHERE` clause contains just the `UnitPrice` criteria, so that an index can be used.</span></span>

## <a name="step-3-creating-and-using-parameterized-stored-procedures"></a><span data-ttu-id="257a3-227">Étape 3 : Création et l’utilisation des procédures stockées paramétrées</span><span class="sxs-lookup"><span data-stu-id="257a3-227">Step 3: Creating and Using Parameterized Stored Procedures</span></span>

<span data-ttu-id="257a3-228">Les procédures stockées peuvent inclure un ensemble de paramètres d’entrée qui peut ensuite être utilisé dans les instructions SQL définies dans la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="257a3-228">Stored procedures can include a set of input parameters that can then be used in the SQL statement(s) defined within the stored procedure.</span></span> <span data-ttu-id="257a3-229">Lorsque vous configurez le SqlDataSource pour utiliser une procédure stockée qui accepte des paramètres d’entrée, ces valeurs de paramètre peuvent être spécifiés à l’aide des mêmes techniques comme avec les instructions SQL ad hoc.</span><span class="sxs-lookup"><span data-stu-id="257a3-229">When configuring the SqlDataSource to use a stored procedure that accepts input parameters, these parameter values can be specified using the same techniques as with ad-hoc SQL statements.</span></span>

<span data-ttu-id="257a3-230">Pour illustrer l’utilisation de procédures stockées dans le SqlDataSource, s permettent de créer une nouvelle procédure stockée dans la base de données Northwind nommé `GetProductsByCategory`, qui accepte un paramètre nommé `@CategoryID` et retourne toutes les colonnes des produits dont `CategoryID` la colonne correspond `@CategoryID`.</span><span class="sxs-lookup"><span data-stu-id="257a3-230">To illustrate using stored procedures in the SqlDataSource, let s create a new stored procedure in the Northwind database named `GetProductsByCategory`, which accepts a parameter named `@CategoryID` and returns all of the columns of the products whose `CategoryID` column matches `@CategoryID`.</span></span> <span data-ttu-id="257a3-231">Pour créer une procédure stockée, accédez à l’Explorateur de serveurs et explorez le `NORTHWND.MDF` base de données.</span><span class="sxs-lookup"><span data-stu-id="257a3-231">To create a stored procedure, go to the Server Explorer and drill down into the `NORTHWND.MDF` database.</span></span> <span data-ttu-id="257a3-232">(Si vous ne pas afficher l’Explorateur de serveurs, mettez-le en sélectionnant le menu Affichage, puis en sélectionnant l’option de l’Explorateur de serveurs.)</span><span class="sxs-lookup"><span data-stu-id="257a3-232">(If you don t see the Server Explorer, bring it up by going to the View menu and selecting the Server Explorer option.)</span></span>

<span data-ttu-id="257a3-233">À partir de la `NORTHWND.MDF` de base de données, avec le bouton droit sur le dossier Stored Procedures, sélectionnez Ajouter une nouvelle procédure stockée et entrez la syntaxe suivante :</span><span class="sxs-lookup"><span data-stu-id="257a3-233">From the `NORTHWND.MDF` database, right-click on the Stored Procedures folder, choose Add New Stored Procedure, and enter the following syntax:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample8.sql)]

<span data-ttu-id="257a3-234">Cliquez sur l’icône Enregistrer (ou Ctrl + S) pour enregistrer la procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="257a3-234">Click the Save icon (or Ctrl+S) to save the stored procedure.</span></span> <span data-ttu-id="257a3-235">Vous pouvez tester la procédure stockée par dessus à partir du dossier de procédures stockées et choisissez Exécuter.</span><span class="sxs-lookup"><span data-stu-id="257a3-235">You can test the stored procedure by right-clicking it from the Stored Procedures folder and choosing Execute.</span></span> <span data-ttu-id="257a3-236">Vous serez invité pour les paramètres de procédure stockée s (`@CategoryID`, dans cette instance), après les résultats seront affichés dans la fenêtre Sortie.</span><span class="sxs-lookup"><span data-stu-id="257a3-236">This will prompt you for the stored procedure s parameters (`@CategoryID`, in this instance), after which the results will be displayed in the Output window.</span></span>


<span data-ttu-id="257a3-237">[![Le GetProductsByCategory procédure lorsqu’elle est exécutée une @CategoryID 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-237">[![The GetProductsByCategory Stored Procedure when Executed with a @CategoryID of 1](using-parameterized-queries-with-the-sqldatasource-vb/_static/image9.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image17.png)</span></span>

<span data-ttu-id="257a3-238">**Figure 9**: le `GetProductsByCategory` la procédure stockée lorsqu’elle est exécutée une `@CategoryID` 1 ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-238">**Figure 9**: The `GetProductsByCategory` Stored Procedure when Executed with a `@CategoryID` of 1 ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image18.png))</span></span>


<span data-ttu-id="257a3-239">Permettent d’utiliser cette procédure stockée pour afficher tous les produits dans la catégorie des boissons dans un GridView s.</span><span class="sxs-lookup"><span data-stu-id="257a3-239">Let s use this stored procedure to display all products in the Beverages category in a GridView.</span></span> <span data-ttu-id="257a3-240">Ajouter un nouveau GridView à la page et la lier à un nouveau SqlDataSource nommé `BeverageProductsDataSource`.</span><span class="sxs-lookup"><span data-stu-id="257a3-240">Add a new GridView to the page and bind it to a new SqlDataSource named `BeverageProductsDataSource`.</span></span> <span data-ttu-id="257a3-241">Continuer pour spécifier une instruction SQL personnalisée ou l’écran de la procédure stockée, sélectionnez la case de procédure stockée et choisir la `GetProductsByCategory` procédure stockée à partir de la liste déroulante.</span><span class="sxs-lookup"><span data-stu-id="257a3-241">Continue to the Specify a custom SQL statement or stored procedure screen, select the Stored procedure radio button, and pick the `GetProductsByCategory` stored procedure from the drop-down list.</span></span>


<span data-ttu-id="257a3-242">[![Sélectionnez le GetProductsByCategory procédure stockée à partir de la liste déroulante](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-242">[![Select the GetProductsByCategory Stored Procedure from the Drop-Down List](using-parameterized-queries-with-the-sqldatasource-vb/_static/image10.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image19.png)</span></span>

<span data-ttu-id="257a3-243">**La figure 10**: sélectionnez le `GetProductsByCategory` la procédure stockée dans la liste déroulante ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-243">**Figure 10**: Select the `GetProductsByCategory` Stored Procedure from the Drop-Down List ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image20.png))</span></span>


<span data-ttu-id="257a3-244">Étant donné que la procédure stockée accepte un paramètre d’entrée (`@CategoryID`), en cliquant sur suivant vous êtes invité à spécifier la source de cette valeur du paramètre s.</span><span class="sxs-lookup"><span data-stu-id="257a3-244">Since the stored procedure accepts an input parameter (`@CategoryID`), clicking Next prompts us to specify the source for this parameter s value.</span></span> <span data-ttu-id="257a3-245">Les boissons `CategoryID` est 1, par conséquent, conservez la liste déroulante de source paramètre None et entrez 1 dans la zone de texte DefaultValue.</span><span class="sxs-lookup"><span data-stu-id="257a3-245">The Beverages `CategoryID` is 1, so leave the Parameter source drop-down list at None and enter 1 into the DefaultValue textbox.</span></span>


<span data-ttu-id="257a3-246">[![Utilisez la valeur codée en dur 1 pour retourner les produits dans la catégorie des boissons](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-246">[![Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category](using-parameterized-queries-with-the-sqldatasource-vb/_static/image11.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image21.png)</span></span>

<span data-ttu-id="257a3-247">**Figure 11**: permet de retourner les produits de la catégorie boissons Hard-Coded la valeur 1 ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-247">**Figure 11**: Use a Hard-Coded Value of 1 to Return the Products in the Beverages Category ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image22.png))</span></span>


<span data-ttu-id="257a3-248">Comme dans le balisage déclaratif suivant, lors de l’utilisation d’une procédure stockée, le s SqlDataSource `SelectCommand` est définie sur le nom de la procédure stockée et la [ `SelectCommandType` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) a la valeur `StoredProcedure`, qui indique qui le `SelectCommand` est le nom d’une procédure stockée plutôt que dans une instruction SQL d’ad-hoc.</span><span class="sxs-lookup"><span data-stu-id="257a3-248">As the following declarative markup shows, when using a stored procedure, the SqlDataSource s `SelectCommand` property is set to the name of the stored procedure and the [`SelectCommandType` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.selectcommandtype.aspx) is set to `StoredProcedure`, indicating that the `SelectCommand` is the name of a stored procedure rather than an ad-hoc SQL statement.</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample9.aspx)]

<span data-ttu-id="257a3-249">Tester la page dans un navigateur.</span><span class="sxs-lookup"><span data-stu-id="257a3-249">Test out the page in a browser.</span></span> <span data-ttu-id="257a3-250">Uniquement les produits qui appartiennent à la catégorie boissons sont affichés, bien que *tous les* du produit, les champs sont affichés depuis le `GetProductsByCategory` procédure stockée retourne toutes les colonnes à partir de la `Products` table.</span><span class="sxs-lookup"><span data-stu-id="257a3-250">Only those products that belong to the Beverages category are displayed, although *all* of the product fields are displayed since the `GetProductsByCategory` stored procedure returns all of the columns from the `Products` table.</span></span> <span data-ttu-id="257a3-251">Bien entendu, nous avons limiter ou personnaliser les champs affichés dans le contrôle GridView à partir de la boîte de dialogue Modifier les colonnes GridView.</span><span class="sxs-lookup"><span data-stu-id="257a3-251">We could, of course, limit or customize the fields displayed in the GridView from the GridView s Edit Columns dialog box.</span></span>


<span data-ttu-id="257a3-252">[![Afficher toutes les boissons](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-252">[![All of the Beverages are Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image12.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image23.png)</span></span>

<span data-ttu-id="257a3-253">**Figure 12**: toutes les boissons sont affichés ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-253">**Figure 12**: All of the Beverages are Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image24.png))</span></span>


## <a name="step-4-programmatically-invoking-a-sqldatasource-sselectstatement"></a><span data-ttu-id="257a3-254">Étape 4 : Appeler par programmation un s SqlDataSource`Select()`instruction</span><span class="sxs-lookup"><span data-stu-id="257a3-254">Step 4: Programmatically Invoking a SqlDataSource s`Select()`Statement</span></span>

<span data-ttu-id="257a3-255">Les exemples nous ve rencontrée jusqu'à présent dans le didacticiel précédent et ce didacticiel avoir lié les contrôles SqlDataSource directement à un GridView.</span><span class="sxs-lookup"><span data-stu-id="257a3-255">The examples we ve seen in the previous tutorial and this tutorial so far have bound SqlDataSource controls directly to a GridView.</span></span> <span data-ttu-id="257a3-256">Les données de contrôle s SqlDataSource, toutefois, peuvent être par programmation accessibles et sont énumérées dans le code.</span><span class="sxs-lookup"><span data-stu-id="257a3-256">The SqlDataSource control s data, however, can be programmatically accessed and enumerated in code.</span></span> <span data-ttu-id="257a3-257">Cela peut être particulièrement utile lorsque vous devez interroger des données pour l’inspecter, mais ne pas besoin pour l’afficher.</span><span class="sxs-lookup"><span data-stu-id="257a3-257">This can be particularly useful when you need to query data to inspect it, but don t need to display it.</span></span> <span data-ttu-id="257a3-258">Au lieu de devoir écrire tout le code code ADO.NET pour se connecter à la base de données, spécifiez la commande et récupérer les résultats, vous pouvez laisser le SqlDataSource pour gérer ce code monotones.</span><span class="sxs-lookup"><span data-stu-id="257a3-258">Rather than having to write all of the boilerplate ADO.NET code to connect to the database, specify the command, and retrieve the results, you can let the SqlDataSource handle this monotonous code.</span></span>

<span data-ttu-id="257a3-259">Pour illustrer l’utilisation des s SqlDataSource données par programme, imaginez que votre supérieur vous approche avec une demande de création d’une page web qui affiche le nom d’une catégorie sélectionnée de façon aléatoire et de ses produits associés.</span><span class="sxs-lookup"><span data-stu-id="257a3-259">To illustrate working with the SqlDataSource s data programmatically, imagine that your boss has approached you with a request to create a web page that displays the name of a randomly selected category and its associated products.</span></span> <span data-ttu-id="257a3-260">Autrement dit, lorsqu’un utilisateur visite cette page, vous souhaitez choisir une catégorie à partir de façon aléatoire le `Categories` de table et afficher le nom de catégorie répertorie ensuite les produits appartenant à cette catégorie.</span><span class="sxs-lookup"><span data-stu-id="257a3-260">That is, when a user visits this page, we want to randomly choose a category from the `Categories` table, display the category name, and then list the products belonging to that category.</span></span>

<span data-ttu-id="257a3-261">Pour ce faire, nous devons deux contrôles SqlDataSource celle de saisir une catégorie aléatoire à partir de la `Categories` table et une autre pour obtenir la catégorie de produits de s.</span><span class="sxs-lookup"><span data-stu-id="257a3-261">To accomplish this we need two SqlDataSource controls one to grab a random category from the `Categories` table and another to get the category s products.</span></span> <span data-ttu-id="257a3-262">Nous allons construire le SqlDataSource qui Récupère un enregistrement de catégorie aléatoire dans cette étape. Étape 5 examine créant le SqlDataSource qui Récupère les produits de s catégorie.</span><span class="sxs-lookup"><span data-stu-id="257a3-262">We'll build the SqlDataSource that retrieves a random category record in this step; Step 5 looks at crafting the SqlDataSource that retrieves the category s products.</span></span>

<span data-ttu-id="257a3-263">Commencez par ajouter un SqlDataSource pour `ParameterizedQueries.aspx` et définir son `ID` à `RandomCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="257a3-263">Start by adding a SqlDataSource to `ParameterizedQueries.aspx` and set its `ID` to `RandomCategoryDataSource`.</span></span> <span data-ttu-id="257a3-264">Le configurer afin qu’il utilise la requête SQL suivante :</span><span class="sxs-lookup"><span data-stu-id="257a3-264">Configure it so that it uses the following SQL query:</span></span>


[!code-sql[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample10.sql)]

<span data-ttu-id="257a3-265">`ORDER BY NEWID()` Retourne les enregistrements triés dans un ordre aléatoire (consultez [Using `NEWID()` pour trier les enregistrements de façon aléatoire](http://www.sqlteam.com/item.asp?ItemID=8747)).</span><span class="sxs-lookup"><span data-stu-id="257a3-265">`ORDER BY NEWID()` returns the records sorted in random order (see [Using `NEWID()` to Randomly Sort Records](http://www.sqlteam.com/item.asp?ItemID=8747)).</span></span> <span data-ttu-id="257a3-266">`SELECT TOP 1` Retourne le premier enregistrement du jeu de résultats.</span><span class="sxs-lookup"><span data-stu-id="257a3-266">`SELECT TOP 1` returns the first record from the result set.</span></span> <span data-ttu-id="257a3-267">Rassembler, cette requête renvoie le `CategoryID` et `CategoryName` les valeurs de colonne à partir d’une catégorie unique, sélectionnée aléatoirement.</span><span class="sxs-lookup"><span data-stu-id="257a3-267">Put together, this query returns the `CategoryID` and `CategoryName` column values from a single, randomly selected category.</span></span>

<span data-ttu-id="257a3-268">Pour afficher la catégorie s `CategoryName` valeur, ajoutez un contrôle Web Label à la page, définissez son `ID` propriété `CategoryNameLabel`et d’effacer les son `Text` propriété.</span><span class="sxs-lookup"><span data-stu-id="257a3-268">To display the category s `CategoryName` value, add a Label Web control to the page, set its `ID` property to `CategoryNameLabel`, and clear out its `Text` property.</span></span> <span data-ttu-id="257a3-269">Pour récupérer par programme les données à partir d’un contrôle SqlDataSource, nous devons appeler son `Select()` (méthode).</span><span class="sxs-lookup"><span data-stu-id="257a3-269">To programmatically retrieve the data from a SqlDataSource control, we need to invoke its `Select()` method.</span></span> <span data-ttu-id="257a3-270">Le [ `Select()` méthode](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) attend un seul paramètre d’entrée de type [ `DataSourceSelectArguments` ](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), qui spécifie la façon dont les données doivent être sollicitées avant d’être retourné.</span><span class="sxs-lookup"><span data-stu-id="257a3-270">The [`Select()` method](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.select.aspx) expects a single input parameter of type [`DataSourceSelectArguments`](https://msdn.microsoft.com/library/system.web.ui.datasourceselectarguments.aspx), which specifies how the data should be messaged before being returned.</span></span> <span data-ttu-id="257a3-271">Cela peut inclure des instructions sur le tri et filtrage des données et est utilisé par les données que lors du tri ou la pagination des données à partir d’un contrôle SqlDataSource de contrôles Web.</span><span class="sxs-lookup"><span data-stu-id="257a3-271">This can include instructions on sorting and filtering the data, and is used by the data Web controls when sorting or paging through the data from a SqlDataSource control.</span></span> <span data-ttu-id="257a3-272">Dans notre exemple, cependant, nous ne t besoin les données à modifier avant d’être retourné et par conséquent, passez le `DataSourceSelectArguments.Empty` objet.</span><span class="sxs-lookup"><span data-stu-id="257a3-272">For our example, though, we don t need the data to be modified before being returned, and therefore will pass in the `DataSourceSelectArguments.Empty` object.</span></span>

<span data-ttu-id="257a3-273">Le `Select()` méthode retourne un objet qui implémente `IEnumerable`.</span><span class="sxs-lookup"><span data-stu-id="257a3-273">The `Select()` method returns an object that implements `IEnumerable`.</span></span> <span data-ttu-id="257a3-274">Le type retourné dépend de la valeur du contrôle SqlDataSource s [ `DataSourceMode` propriété](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span><span class="sxs-lookup"><span data-stu-id="257a3-274">The precise type returned depends on the value of the SqlDataSource control s [`DataSourceMode` property](https://msdn.microsoft.com/library/system.web.ui.webcontrols.sqldatasource.datasourcemode.aspx).</span></span> <span data-ttu-id="257a3-275">Comme indiqué dans le didacticiel précédent, cette propriété peut être définie à une valeur `DataSet` ou `DataReader`.</span><span class="sxs-lookup"><span data-stu-id="257a3-275">As discussed in the previous tutorial, this property can be set to a value of either `DataSet` or `DataReader`.</span></span> <span data-ttu-id="257a3-276">Si la valeur `DataSet`, le `Select()` méthode retourne un [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) objet ; si elle est définie `DataReader`, elle retourne un objet qui implémente [ `IDataReader` ](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span><span class="sxs-lookup"><span data-stu-id="257a3-276">If set to `DataSet`, the `Select()` method returns a [DataView](https://msdn.microsoft.com/library/01s96x0z.aspx) object; if set to `DataReader`, it returns an object that implements [`IDataReader`](https://msdn.microsoft.com/library/system.data.idatareader.aspx).</span></span> <span data-ttu-id="257a3-277">Étant donné que la `RandomCategoryDataSource` SqlDataSource a son `DataSourceMode` propriété `DataSet` (la valeur par défaut), nous travaillerons avec un objet DataView.</span><span class="sxs-lookup"><span data-stu-id="257a3-277">Since the `RandomCategoryDataSource` SqlDataSource has its `DataSourceMode` property set to `DataSet` (the default), we will be working with a DataView object.</span></span>

<span data-ttu-id="257a3-278">Le code suivant illustre comment récupérer les enregistrements à partir de la `RandomCategoryDataSource` SqlDataSource comme un DataView, ainsi que comment lire le `CategoryName` valeur de la colonne à partir de la première ligne de DataView :</span><span class="sxs-lookup"><span data-stu-id="257a3-278">The following code illustrates how to retrieve the records from the `RandomCategoryDataSource` SqlDataSource as a DataView as well as how to read the `CategoryName` column value from the first DataView row:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample11.vb)]

<span data-ttu-id="257a3-279">`randomCategoryView(0)` Retourne le premier `DataRowView` du DataView.</span><span class="sxs-lookup"><span data-stu-id="257a3-279">`randomCategoryView(0)` returns the first `DataRowView` in the DataView.</span></span> <span data-ttu-id="257a3-280">`randomCategoryView(0)("CategoryName")` Retourne la valeur de la `CategoryName` colonne dans cette première ligne.</span><span class="sxs-lookup"><span data-stu-id="257a3-280">`randomCategoryView(0)("CategoryName")` returns the value of the `CategoryName` column in this first row.</span></span> <span data-ttu-id="257a3-281">Notez que le DataView est faiblement typé.</span><span class="sxs-lookup"><span data-stu-id="257a3-281">Note that the DataView is loosely-typed.</span></span> <span data-ttu-id="257a3-282">Pour faire référence à une valeur de colonne, il faut passer le nom de la colonne sous forme de chaîne (nom de catégorie, dans ce cas).</span><span class="sxs-lookup"><span data-stu-id="257a3-282">To reference a particular column value we need to pass in the name of the column as a string ( CategoryName, in this case).</span></span> <span data-ttu-id="257a3-283">Figure 13 illustre le message affiché dans le `CategoryNameLabel` lors de l’affichage de la page.</span><span class="sxs-lookup"><span data-stu-id="257a3-283">Figure 13 shows the message displayed in the `CategoryNameLabel` when viewing the page.</span></span> <span data-ttu-id="257a3-284">Bien entendu, le nom de catégorie réel affiché est sélectionné aléatoirement par le `RandomCategoryDataSource` SqlDataSource sur chaque visite sur la page (y compris les publications (postback)).</span><span class="sxs-lookup"><span data-stu-id="257a3-284">Of course, the actual category name displayed is randomly selected by the `RandomCategoryDataSource` SqlDataSource on each visit to the page (including postbacks).</span></span>


<span data-ttu-id="257a3-285">[![Le s sélectionnée aléatoirement de catégorie que nom s’affiche.](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-285">[![The Randomly Selected Category s Name is Displayed](using-parameterized-queries-with-the-sqldatasource-vb/_static/image13.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image25.png)</span></span>

<span data-ttu-id="257a3-286">**Figure 13**: s de la catégorie aléatoirement sélectionné nom est affiché ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-286">**Figure 13**: The Randomly Selected Category s Name is Displayed ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image26.png))</span></span>


> [!NOTE]
> <span data-ttu-id="257a3-287">Si le SqlDataSource contrôle s `DataSourceMode` propriété avait été définie sur `DataReader`, la valeur de retour à partir de la `Select()` méthode aurait dû être converti en `IDataReader`.</span><span class="sxs-lookup"><span data-stu-id="257a3-287">If the SqlDataSource control s `DataSourceMode` property had been set to `DataReader`, the return value from the `Select()` method would have needed to be cast to `IDataReader`.</span></span> <span data-ttu-id="257a3-288">Pour lire le `CategoryName` valeur de la colonne à partir de la première ligne, nous d utiliser le code :</span><span class="sxs-lookup"><span data-stu-id="257a3-288">To read the `CategoryName` column value from the first row, we d use code like:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample12.vb)]

<span data-ttu-id="257a3-289">Avec le SqlDataSource sélectionnant de façon aléatoire une catégorie, nous re prêt à ajouter le contrôle GridView qui répertorie les produits de la catégorie s.</span><span class="sxs-lookup"><span data-stu-id="257a3-289">With the SqlDataSource randomly selecting a category, we re ready to add the GridView that lists the category s products.</span></span>

> [!NOTE]
> <span data-ttu-id="257a3-290">Au lieu d’utiliser un contrôle Web Label pour afficher le nom de la catégorie s, nous pourrions avoir ajouté un FormView ou DetailsView à la page, la liaison pour le SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="257a3-290">Rather than using a Label Web control to display the category s name, we could have added a FormView or DetailsView to the page, binding it to the SqlDataSource.</span></span> <span data-ttu-id="257a3-291">À l’aide de l’étiquette, toutefois, nous a permis de découvrir comment appeler par programme la s SqlDataSource `Select()` instruction et utiliser ses données résultantes dans le code.</span><span class="sxs-lookup"><span data-stu-id="257a3-291">Using the Label, however, allowed us to explore how to programmatically invoke the SqlDataSource s `Select()` statement and work with its resulting data in code.</span></span>


## <a name="step-5-assigning-parameter-values-programmatically"></a><span data-ttu-id="257a3-292">Étape 5 : Affecter des valeurs de paramètre par programmation</span><span class="sxs-lookup"><span data-stu-id="257a3-292">Step 5: Assigning Parameter Values Programmatically</span></span>

<span data-ttu-id="257a3-293">Tous les exemples nous ve rencontrée jusqu'à présent dans ce didacticiel ont utilisé une valeur de paramètre codée en dur ou celui effectuée à partir d’une des sources de paramètres prédéfinis (une valeur de chaîne de requête, un contrôle Web dans la page et ainsi de suite).</span><span class="sxs-lookup"><span data-stu-id="257a3-293">All of the examples we ve seen so far in this tutorial have used either a hard-coded parameter value or one taken from one of the pre-defined parameter sources (a querystring value, a Web control on the page, and so on).</span></span> <span data-ttu-id="257a3-294">Toutefois, les paramètres de s contrôle SqlDataSource peuvent également être définis par programme.</span><span class="sxs-lookup"><span data-stu-id="257a3-294">However, the SqlDataSource control s parameters can also be set programmatically.</span></span> <span data-ttu-id="257a3-295">Pour terminer de notre exemple, nous avons besoin d’un SqlDataSource qui retourne tous les produits appartenant à une catégorie spécifiée.</span><span class="sxs-lookup"><span data-stu-id="257a3-295">To complete our current example, we need a SqlDataSource that returns all of the products belonging to a specified category.</span></span> <span data-ttu-id="257a3-296">Cette SqlDataSource aura un `CategoryID` paramètre dont la valeur doit être définie en fonction de la `CategoryID` valeur de la colonne retournée par la `RandomCategoryDataSource` SqlDataSource dans le `Page_Load` Gestionnaire d’événements.</span><span class="sxs-lookup"><span data-stu-id="257a3-296">This SqlDataSource will have a `CategoryID` parameter whose value needs to be set based on the `CategoryID` column value returned by the `RandomCategoryDataSource` SqlDataSource in the `Page_Load` event handler.</span></span>

<span data-ttu-id="257a3-297">Commencez par ajouter un contrôle GridView à la page et la lier à un nouveau SqlDataSource nommé `ProductsByCategoryDataSource`.</span><span class="sxs-lookup"><span data-stu-id="257a3-297">Start by adding a GridView to the page and bind it to a new SqlDataSource named `ProductsByCategoryDataSource`.</span></span> <span data-ttu-id="257a3-298">Comme nous l’avons fait à l’étape 3, configurer le SqlDataSource afin qu’il appelle le `GetProductsByCategory` procédure stockée.</span><span class="sxs-lookup"><span data-stu-id="257a3-298">Much like we did in Step 3, configure the SqlDataSource so that it invokes the `GetProductsByCategory` stored procedure.</span></span> <span data-ttu-id="257a3-299">Conservez le paramètre source liste déroulante None, mais n’entrez pas de valeur par défaut, comme nous allons définir par programmation la valeur par défaut.</span><span class="sxs-lookup"><span data-stu-id="257a3-299">Leave the Parameter source drop-down list set to None, but do not enter a default value, as we will set this default value programmatically.</span></span>


<span data-ttu-id="257a3-300">[![Ne spécifiez pas une Source de paramètre ou la valeur par défaut](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-300">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image14.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image27.png)</span></span>

<span data-ttu-id="257a3-301">**La figure 14**: ne spécifiez pas une Source de paramètre ou la valeur par défaut ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-301">**Figure 14**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image28.png))</span></span>


<span data-ttu-id="257a3-302">Après avoir terminé l’Assistant SqlDataSource, le balisage déclaratif qui en résulte doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="257a3-302">After completing the SqlDataSource wizard, the resulting declarative markup should look similar to the following:</span></span>


[!code-aspx[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample13.aspx)]

<span data-ttu-id="257a3-303">Nous pouvons attribuer le `DefaultValue` de la `CategoryID` paramètre par programmation dans le `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="257a3-303">We can assign the `DefaultValue` of the `CategoryID` parameter programmatically in the `Page_Load` event handler:</span></span>


[!code-vb[Main](using-parameterized-queries-with-the-sqldatasource-vb/samples/sample14.vb)]

<span data-ttu-id="257a3-304">Avec cet ajout, la page contient un GridView qui affiche les produits de la catégorie sélectionnée aléatoirement.</span><span class="sxs-lookup"><span data-stu-id="257a3-304">With this addition, the page includes a GridView that shows the products associated with the randomly selected category.</span></span>


<span data-ttu-id="257a3-305">[![Ne spécifiez pas une Source de paramètre ou la valeur par défaut](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span><span class="sxs-lookup"><span data-stu-id="257a3-305">[![Do Not Specify a Parameter Source or Default Value](using-parameterized-queries-with-the-sqldatasource-vb/_static/image15.gif)](using-parameterized-queries-with-the-sqldatasource-vb/_static/image29.png)</span></span>

<span data-ttu-id="257a3-306">**Figure 15**: ne spécifiez pas une Source de paramètre ou la valeur par défaut ([cliquez pour afficher l’image en taille réelle](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="257a3-306">**Figure 15**: Do Not Specify a Parameter Source or Default Value ([Click to view full-size image](using-parameterized-queries-with-the-sqldatasource-vb/_static/image30.png))</span></span>


## <a name="summary"></a><span data-ttu-id="257a3-307">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="257a3-307">Summary</span></span>

<span data-ttu-id="257a3-308">Le SqlDataSource permet aux développeurs de page définir des requêtes paramétrables, dont les valeurs de paramètre peuvent être codée en dur, extraites de sources de paramètres prédéfinis ou attribués par programme.</span><span class="sxs-lookup"><span data-stu-id="257a3-308">The SqlDataSource enables page developers to define parameterized queries whose parameter values can be hard-coded, pulled from pre-defined parameter sources, or assigned programmatically.</span></span> <span data-ttu-id="257a3-309">Dans ce didacticiel, nous avons vu comment créer une requête paramétrable à partir de l’Assistant Configurer la Source de données pour les requêtes SQL ad hoc et procédures stockées.</span><span class="sxs-lookup"><span data-stu-id="257a3-309">In this tutorial we saw how to craft a parameterized query from the Configure Data Source wizard for both ad-hoc SQL queries and stored procedures.</span></span> <span data-ttu-id="257a3-310">Nous avons également à l’utilisation de sources de paramètre codée en dur, un contrôle Web comme source de paramètre et par programme en spécifiant la valeur du paramètre.</span><span class="sxs-lookup"><span data-stu-id="257a3-310">We also looked at using hard-coded parameter sources, a Web control as a parameter source, and programmatically specifying the parameter value.</span></span>

<span data-ttu-id="257a3-311">Comme avec ObjectDataSource, le SqlDataSource fournit également des fonctionnalités pour modifier ses données sous-jacentes.</span><span class="sxs-lookup"><span data-stu-id="257a3-311">Like with the ObjectDataSource, the SqlDataSource also provides capabilities to modify its underlying data.</span></span> <span data-ttu-id="257a3-312">Dans l’étape suivante du didacticiel, nous allons étudier comment définir `INSERT`, `UPDATE`, et `DELETE` instructions avec le SqlDataSource.</span><span class="sxs-lookup"><span data-stu-id="257a3-312">In the next tutorial we'll look at how to define `INSERT`, `UPDATE`, and `DELETE` statements with the SqlDataSource.</span></span> <span data-ttu-id="257a3-313">Une fois ces instructions ont été ajoutées, que nous pouvons utiliser la fonction intégrée insertion, de modification et de suppression de fonctionnalités inhérentes aux contrôles GridView, DetailsView et FormView.</span><span class="sxs-lookup"><span data-stu-id="257a3-313">Once these statements have been added, we can utilize the built-in inserting, editing, and deleting features inherent to the GridView, DetailsView, and FormView controls.</span></span>

<span data-ttu-id="257a3-314">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="257a3-314">Happy Programming!</span></span>

## <a name="about-the-author"></a><span data-ttu-id="257a3-315">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="257a3-315">About the Author</span></span>

<span data-ttu-id="257a3-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), auteur de sept manuels ASP/ASP.NET et créateur de [4GuysFromRolla.com](http://www.4guysfromrolla.com), travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="257a3-316">[Scott Mitchell](http://www.4guysfromrolla.com/ScottMitchell.shtml), author of seven ASP/ASP.NET books and founder of [4GuysFromRolla.com](http://www.4guysfromrolla.com), has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="257a3-317">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="257a3-317">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="257a3-318">Son dernier ouvrage est [ *SAM animer vous-même ASP.NET 2.0 des dernières 24 heures*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span><span class="sxs-lookup"><span data-stu-id="257a3-318">His latest book is [*Sams Teach Yourself ASP.NET 2.0 in 24 Hours*](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco).</span></span> <span data-ttu-id="257a3-319">Il peut être atteint à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) ou via son blog, qui se trouvent à [ http://ScottOnWriting.NET ](http://ScottOnWriting.NET).</span><span class="sxs-lookup"><span data-stu-id="257a3-319">He can be reached at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com) or via his blog, which can be found at [http://ScottOnWriting.NET](http://ScottOnWriting.NET).</span></span>

## <a name="special-thanks-to"></a><span data-ttu-id="257a3-320">Remerciements</span><span class="sxs-lookup"><span data-stu-id="257a3-320">Special Thanks To</span></span>

<span data-ttu-id="257a3-321">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="257a3-321">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="257a3-322">Les réviseurs tête pour ce didacticiel ont Scott Clyde, Randell Schmidt et Ken Pespisa.</span><span class="sxs-lookup"><span data-stu-id="257a3-322">Lead reviewers for this tutorial were Scott Clyde, Randell Schmidt, and Ken Pespisa.</span></span> <span data-ttu-id="257a3-323">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="257a3-323">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="257a3-324">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span><span class="sxs-lookup"><span data-stu-id="257a3-324">If so, drop me a line at [mitchell@4GuysFromRolla.com.](mailto:mitchell@4GuysFromRolla.com)</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="257a3-325">[Précédent](querying-data-with-the-sqldatasource-control-vb.md)
> [Suivant](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span><span class="sxs-lookup"><span data-stu-id="257a3-325">[Previous](querying-data-with-the-sqldatasource-control-vb.md)
[Next](inserting-updating-and-deleting-data-with-the-sqldatasource-vb.md)</span></span>
