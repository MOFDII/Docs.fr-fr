---
uid: web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
title: "Utilisation de méthodes asynchrones dans ASP.NET 4.5 | Documents Microsoft"
author: Rick-Anderson
description: "Ce didacticiel, vous allez apprendre les principes fondamentaux de la création d’une application Web Forms ASP.NET asynchrone à l’aide de Visual Studio Express 2012 pour le Web, qui est gratuit..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 06/06/2012
ms.topic: article
ms.assetid: a585c9a2-7c8e-478b-9706-90f3739c50d1
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/performance-and-caching/using-asynchronous-methods-in-aspnet-45
msc.type: authoredcontent
ms.openlocfilehash: d3eb588aad592605a8e368d1af6e62ece34b79d0
ms.sourcegitcommit: 016f4d58663bcd442930227022de23fb3abee0b3
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 02/12/2018
---
<a name="using-asynchronous-methods-in-aspnet-45"></a><span data-ttu-id="0e42a-103">Utilisation de méthodes asynchrones dans ASP.NET 4.5</span><span class="sxs-lookup"><span data-stu-id="0e42a-103">Using Asynchronous Methods in ASP.NET 4.5</span></span>
====================
<span data-ttu-id="0e42a-104">Par [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="0e42a-104">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="0e42a-105">Ce didacticiel, vous allez apprendre les principes fondamentaux de la création d’une application Web Forms ASP.NET asynchrone en utilisant [Visual Studio Express 2012 pour Web](https://www.microsoft.com/visualstudio/11), qui est une version gratuite de Microsoft Visual Studio.</span><span class="sxs-lookup"><span data-stu-id="0e42a-105">This tutorial will teach you the basics of building an asynchronous ASP.NET Web Forms application using [Visual Studio Express 2012 for Web](https://www.microsoft.com/visualstudio/11), which is a free version of Microsoft Visual Studio.</span></span> <span data-ttu-id="0e42a-106">Vous pouvez également utiliser [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span><span class="sxs-lookup"><span data-stu-id="0e42a-106">You can also use [Visual Studio 2012](https://www.microsoft.com/visualstudio/11).</span></span> <span data-ttu-id="0e42a-107">Les sections suivantes sont incluses dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="0e42a-107">The following sections are included in this tutorial.</span></span>
> 
> - [<span data-ttu-id="0e42a-108">Comment les demandes sont traitées par le Pool de threads</span><span class="sxs-lookup"><span data-stu-id="0e42a-108">How Requests Are Processed by the Thread Pool</span></span>](#HowRequestsProcessedByTP)
> - [<span data-ttu-id="0e42a-109">Choix de méthodes synchrones ou asynchrones</span><span class="sxs-lookup"><span data-stu-id="0e42a-109">Choosing Synchronous or Asynchronous Methods</span></span>](#ChoosingSyncVasync)
> - [<span data-ttu-id="0e42a-110">L’exemple d’Application</span><span class="sxs-lookup"><span data-stu-id="0e42a-110">The Sample Application</span></span>](#SampleApp)
> - [<span data-ttu-id="0e42a-111">La Page synchrone trucs</span><span class="sxs-lookup"><span data-stu-id="0e42a-111">The Gizmos Synchronous Page</span></span>](#GizmosSynch)
> - [<span data-ttu-id="0e42a-112">Création d’une Page trucs asynchrone</span><span class="sxs-lookup"><span data-stu-id="0e42a-112">Creating an Asynchronous Gizmos Page</span></span>](#CreatingAsynchGizmos)
> - [<span data-ttu-id="0e42a-113">Exécution de plusieurs opérations en parallèle</span><span class="sxs-lookup"><span data-stu-id="0e42a-113">Performing Multiple Operations in Parallel</span></span>](#Parallel)
> - [<span data-ttu-id="0e42a-114">À l’aide d’un jeton d’annulation</span><span class="sxs-lookup"><span data-stu-id="0e42a-114">Using a Cancellation Token</span></span>](#CancelToken)
> - [<span data-ttu-id="0e42a-115">Configuration du serveur pour les appels de Service Web élevé d’accès concurrentiel/haute latence</span><span class="sxs-lookup"><span data-stu-id="0e42a-115">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>](#ServerConfig)
> 
> <span data-ttu-id="0e42a-116">Un exemple complet est fourni pour ce didacticiel</span><span class="sxs-lookup"><span data-stu-id="0e42a-116">A complete sample is provided for this tutorial at</span></span>  
>  <span data-ttu-id="0e42a-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) sur la [GitHub](https://github.com/) site.</span><span class="sxs-lookup"><span data-stu-id="0e42a-117">[https://github.com/RickAndMSFT/Async-ASP.NET/](https://github.com/RickAndMSFT/Async-ASP.NET/) on the [GitHub](https://github.com/) site.</span></span>


<span data-ttu-id="0e42a-118">Les Pages Web ASP.NET 4.5 en combinaison [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) vous pouvez inscrire des méthodes asynchrones qui retournent un objet de type [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="0e42a-118">ASP.NET 4.5 Web Pages in combination [.NET 4.5](https://msdn.microsoft.com/library/w0x726c2(VS.110).aspx) enables you to register asynchronous methods that return an object of type [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="0e42a-119">Le .NET Framework 4 a introduit un concept de programmation asynchrone appelé une [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) et ASP.NET 4.5 prend en charge [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span><span class="sxs-lookup"><span data-stu-id="0e42a-119">The .NET Framework 4 introduced an asynchronous programming concept referred to as a [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) and ASP.NET 4.5 supports [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx).</span></span> <span data-ttu-id="0e42a-120">Les tâches sont représentées par le **tâche** type et les types associés dans le [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) espace de noms.</span><span class="sxs-lookup"><span data-stu-id="0e42a-120">Tasks are represented by the **Task** type and related types in the [System.Threading.Tasks](https://msdn.microsoft.com/library/system.threading.tasks.aspx) namespace.</span></span> <span data-ttu-id="0e42a-121">Le .NET Framework 4.5 s’appuie sur cette prise en charge asynchrone avec le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés qui facilitent l’utilisation des [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) beaucoup moins complexes que le précédent des objets méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-121">The .NET Framework 4.5 builds on this asynchronous support with the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords that make working with [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) objects much less complex than previous asynchronous approaches.</span></span> <span data-ttu-id="0e42a-122">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (mot clé) est un raccourci syntaxique pour indiquer une partie du code d’attente de façon asynchrone sur un autre fragment de code.</span><span class="sxs-lookup"><span data-stu-id="0e42a-122">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword is syntactical shorthand for indicating that a piece of code should asynchronously wait on some other piece of code.</span></span> <span data-ttu-id="0e42a-123">Le [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mot clé représente un indicateur que vous pouvez utiliser pour marquer des méthodes comme méthodes asynchrones basées sur des tâches.</span><span class="sxs-lookup"><span data-stu-id="0e42a-123">The [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword represents a hint that you can use to mark methods as task-based asynchronous methods.</span></span> <span data-ttu-id="0e42a-124">La combinaison de **await**, **async**et le **tâche** objet rend beaucoup plus facile d’écrire du code asynchrone dans .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="0e42a-124">The combination of **await**, **async**, and the **Task** object makes it much easier for you to write asynchronous code in .NET 4.5.</span></span> <span data-ttu-id="0e42a-125">Le nouveau modèle pour les méthodes asynchrones est appelé le *modèle asynchrone basé sur des tâches* (**appuyez sur**).</span><span class="sxs-lookup"><span data-stu-id="0e42a-125">The new model for asynchronous methods is called the *Task-based Asynchronous Pattern* (**TAP**).</span></span> <span data-ttu-id="0e42a-126">Ce didacticiel suppose que vous être familiarisé avec la programmation asynchrone à l’aide [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms.</span><span class="sxs-lookup"><span data-stu-id="0e42a-126">This tutorial assumes you have some familiarity with asynchronous programing using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace.</span></span>

<span data-ttu-id="0e42a-127">Pour plus d’informations sur l’utilisation [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms, consultez les références suivantes.</span><span class="sxs-lookup"><span data-stu-id="0e42a-127">For more information on the using [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the following references.</span></span>

- [<span data-ttu-id="0e42a-128">Livre blanc : Le comportement asynchrone dans .NET</span><span class="sxs-lookup"><span data-stu-id="0e42a-128">Whitepaper: Asynchrony in .NET</span></span>](https://go.microsoft.com/fwlink/?LinkId=204844)
- [<span data-ttu-id="0e42a-129">Forum aux questions d’asynchrones / d’attente</span><span class="sxs-lookup"><span data-stu-id="0e42a-129">Async/Await FAQ</span></span>](https://blogs.msdn.com/b/pfxteam/archive/2012/04/12/10293335.aspx)
- [<span data-ttu-id="0e42a-130">Programmation asynchrone Visual Studio</span><span class="sxs-lookup"><span data-stu-id="0e42a-130">Visual Studio Asynchronous Programming</span></span>](https://msdn.microsoft.com/vstudio/gg316360)

## <a id="HowRequestsProcessedByTP"></a><span data-ttu-id="0e42a-131">Comment les demandes sont traitées par le Pool de threads</span><span class="sxs-lookup"><span data-stu-id="0e42a-131">How Requests Are Processed by the Thread Pool</span></span>

<span data-ttu-id="0e42a-132">Sur le serveur web, le .NET Framework gère un pool de threads utilisés pour traiter les demandes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0e42a-132">On the web server, the .NET Framework maintains a pool of threads that are used to service ASP.NET requests.</span></span> <span data-ttu-id="0e42a-133">Lorsqu’une demande arrive, un thread du pool est distribué pour traiter cette demande.</span><span class="sxs-lookup"><span data-stu-id="0e42a-133">When a request arrives, a thread from the pool is dispatched to process that request.</span></span> <span data-ttu-id="0e42a-134">Si la demande est traitée de façon synchrone, le thread qui traite la requête est occupé lors de la demande est en cours de traitement et de thread ne peut pas répondre à une autre demande.</span><span class="sxs-lookup"><span data-stu-id="0e42a-134">If the request is processed synchronously, the thread that processes the request is busy while the request is being processed, and that thread cannot service another request.</span></span>   
  
<span data-ttu-id="0e42a-135">Cela est peut-être pas un problème, car le pool de threads peut être établie assez grand pour contenir le nombre de threads occupé.</span><span class="sxs-lookup"><span data-stu-id="0e42a-135">This might not be a problem, because the thread pool can be made large enough to accommodate many busy threads.</span></span> <span data-ttu-id="0e42a-136">Toutefois, le nombre de threads dans le pool de threads est limité (la valeur maximale pour le .NET 4.5 par défaut est 5 000).</span><span class="sxs-lookup"><span data-stu-id="0e42a-136">However, the number of threads in the thread pool is limited (the default maximum for .NET 4.5 is 5,000).</span></span> <span data-ttu-id="0e42a-137">Dans les grandes applications avec la concurrence élevé de requêtes longues, tous les threads disponibles peuvent être occupés.</span><span class="sxs-lookup"><span data-stu-id="0e42a-137">In large applications with high concurrency of long-running requests, all available threads might be busy.</span></span> <span data-ttu-id="0e42a-138">Il s’agit en tant que privation de thread.</span><span class="sxs-lookup"><span data-stu-id="0e42a-138">This condition is known as thread starvation.</span></span> <span data-ttu-id="0e42a-139">Lorsque cette condition est atteinte, le serveur web les files d’attente de demandes.</span><span class="sxs-lookup"><span data-stu-id="0e42a-139">When this condition is reached, the web server queues requests.</span></span> <span data-ttu-id="0e42a-140">Si la file d’attente de la demande est plein, le serveur web rejette les requêtes avec l’état HTTP 503 (serveur encombré).</span><span class="sxs-lookup"><span data-stu-id="0e42a-140">If the request queue becomes full, the web server rejects requests with an HTTP 503 status (Server Too Busy).</span></span> <span data-ttu-id="0e42a-141">Le pool de threads CLR présente des limitations sur les injections nouveau thread.</span><span class="sxs-lookup"><span data-stu-id="0e42a-141">The CLR thread pool has limitations on new thread injections.</span></span> <span data-ttu-id="0e42a-142">Si l’accès simultané est rafale (autrement dit, votre site web peut subitement obtenir un grand nombre de demandes) et tous les threads de demande disponibles sont occupés en raison d’appels du serveur principal avec une latence élevée, le taux d’injection de thread limité peut rendre votre application répond lentement.</span><span class="sxs-lookup"><span data-stu-id="0e42a-142">If concurrency is bursty (that is, your web site can suddenly get a large number of requests) and all available request threads are busy because of backend calls with high latency, the limited thread injection rate can make your application respond very poorly.</span></span> <span data-ttu-id="0e42a-143">En outre, chaque nouveau thread ajouté au pool de threads a surcharge (par exemple, 1 Mo de mémoire de la pile).</span><span class="sxs-lookup"><span data-stu-id="0e42a-143">Additionally, each new thread added to the thread pool has overhead (such as 1 MB of stack memory).</span></span> <span data-ttu-id="0e42a-144">Une application web à l’aide des méthodes synchrones aux appels de service une latence élevée, où le pool de threads a atteint la valeur par défaut de .NET 4.5 maximal de 5 000 threads consomme environ 5 Go plus de mémoire qu’une application capable du service de la même demande à l’aide de méthodes asynchrones et threads seulement 50.</span><span class="sxs-lookup"><span data-stu-id="0e42a-144">A web application using synchronous methods to service high latency calls where the thread pool grows to the .NET 4.5 default maximum of 5, 000 threads would consume approximately 5 GB more memory than an application able the service the same requests using asynchronous methods and only 50 threads.</span></span> <span data-ttu-id="0e42a-145">Lorsque vous effectuez un travail asynchrone, vous n’utilisez pas toujours un thread.</span><span class="sxs-lookup"><span data-stu-id="0e42a-145">When you're doing asynchronous work, you're not always using a thread.</span></span> <span data-ttu-id="0e42a-146">Par exemple, lorsque vous faites une demande de service web asynchrone, ASP.NET ne l’utiliserez pas les threads entre les **async** appel de méthode et la **await**.</span><span class="sxs-lookup"><span data-stu-id="0e42a-146">For example, when you make an asynchronous web service request, ASP.NET will not be using any threads between the **async** method call and the **await**.</span></span> <span data-ttu-id="0e42a-147">À l’aide du pool de threads pour traiter les demandes avec une latence élevée peut entraîner une grande quantité de mémoire et un faible taux d’utilisation du matériel du serveur.</span><span class="sxs-lookup"><span data-stu-id="0e42a-147">Using the thread pool to service requests with high latency can lead to a large memory footprint and poor utilization of the server hardware.</span></span>

## <a name="processing-asynchronous-requests"></a><span data-ttu-id="0e42a-148">Traitement des requêtes asynchrones</span><span class="sxs-lookup"><span data-stu-id="0e42a-148">Processing Asynchronous Requests</span></span>

<span data-ttu-id="0e42a-149">Dans les applications web voir un grand nombre de demandes simultanées au démarrage ou a une charge de rafale (où concurrence augmente soudainement), qui effectue les appels de service web asynchrone augmentera la réactivité de votre application.</span><span class="sxs-lookup"><span data-stu-id="0e42a-149">In web applications that see a large number of concurrent requests at start-up or has a bursty load (where concurrency increases suddenly), making web service calls asynchronous will increase the responsiveness of your application.</span></span> <span data-ttu-id="0e42a-150">Une demande asynchrone la même durée de traitement qu’une requête synchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-150">An asynchronous request takes the same amount of time to process as a synchronous request.</span></span> <span data-ttu-id="0e42a-151">Par exemple, si une demande appelle un service web qui nécessite deux secondes, la requête prend deux secondes qu’elle soit exécutée de façon synchrone ou asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-151">For example, if a request makes a web service call that requires two seconds to complete, the request takes two seconds whether it is performed synchronously or asynchronously.</span></span> <span data-ttu-id="0e42a-152">Toutefois, lors d’un appel asynchrone, un thread n’est pas bloqué de répondre à d’autres demandes en attendant que la première requête.</span><span class="sxs-lookup"><span data-stu-id="0e42a-152">However, during an asynchronous call, a thread is not blocked from responding to other requests while it waits for the first request to complete.</span></span> <span data-ttu-id="0e42a-153">Par conséquent, des requêtes asynchrones empêchent la croissance de demande files d’attente et le thread de pool lorsqu’il existe de nombreuses demandes simultanées qui appellent des opérations de longue.</span><span class="sxs-lookup"><span data-stu-id="0e42a-153">Therefore, asynchronous requests prevent request queuing and thread pool growth when there are many concurrent requests that invoke long-running operations.</span></span>

## <a id="ChoosingSyncVasync"></a><span data-ttu-id="0e42a-154">Choix de méthodes synchrones ou asynchrones</span><span class="sxs-lookup"><span data-stu-id="0e42a-154">Choosing Synchronous or Asynchronous Methods</span></span>

<span data-ttu-id="0e42a-155">Cette section répertorie des indications sur quand utiliser les méthodes synchrones ou asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-155">This section lists guidelines for when to use synchronous or asynchronous Methods.</span></span> <span data-ttu-id="0e42a-156">Il s’agit que de directives ; examiner chaque application individuellement pour déterminer si les méthodes asynchrones améliorer les performances.</span><span class="sxs-lookup"><span data-stu-id="0e42a-156">These are just guidelines; examine each application individually to determine whether asynchronous methods help with performance.</span></span>

<span data-ttu-id="0e42a-157">En général, utilisez les méthodes synchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="0e42a-157">In general, use synchronous methods for the following conditions:</span></span>

- <span data-ttu-id="0e42a-158">Les opérations sont simples ou exécution courte.</span><span class="sxs-lookup"><span data-stu-id="0e42a-158">The operations are simple or short-running.</span></span>
- <span data-ttu-id="0e42a-159">Simplicité est plus importante que l’efficacité.</span><span class="sxs-lookup"><span data-stu-id="0e42a-159">Simplicity is more important than efficiency.</span></span>
- <span data-ttu-id="0e42a-160">Les opérations sont essentiellement des opérations UC plutôt que des opérations qui impliquent des étendues disque ou la charge réseau.</span><span class="sxs-lookup"><span data-stu-id="0e42a-160">The operations are primarily CPU operations instead of operations that involve extensive disk or network overhead.</span></span> <span data-ttu-id="0e42a-161">À l’aide des méthodes asynchrones sur les opérations liées au processeur ne présente aucun avantage et entraîne davantage de surcharge.</span><span class="sxs-lookup"><span data-stu-id="0e42a-161">Using asynchronous methods on CPU-bound operations provides no benefits and results in more overhead.</span></span>

 <span data-ttu-id="0e42a-162">En règle générale, utilisez les méthodes asynchrones pour les conditions suivantes :</span><span class="sxs-lookup"><span data-stu-id="0e42a-162">In general, use asynchronous methods for the following conditions:</span></span>

- <span data-ttu-id="0e42a-163">Vous appelez les services qui peuvent être utilisés par le biais des méthodes asynchrones, et à l’aide de .NET 4.5 ou version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="0e42a-163">You're calling services that can be consumed through asynchronous methods, and you're using .NET 4.5 or higher.</span></span>
- <span data-ttu-id="0e42a-164">Les opérations sont liées au réseau ou aux e/S-et non le processeur.</span><span class="sxs-lookup"><span data-stu-id="0e42a-164">The operations are network-bound or I/O-bound instead of CPU-bound.</span></span>
- <span data-ttu-id="0e42a-165">Le parallélisme est plus important que la simplicité du code.</span><span class="sxs-lookup"><span data-stu-id="0e42a-165">Parallelism is more important than simplicity of code.</span></span>
- <span data-ttu-id="0e42a-166">Vous souhaitez fournir un mécanisme qui permet aux utilisateurs d’annuler une demande d’exécution longue.</span><span class="sxs-lookup"><span data-stu-id="0e42a-166">You want to provide a mechanism that lets users cancel a long-running request.</span></span>
- <span data-ttu-id="0e42a-167">Lorsque l’avantage de commutation de threads out pondère le coût du commutateur de contexte.</span><span class="sxs-lookup"><span data-stu-id="0e42a-167">When the benefit of switching threads out weights the cost of the context switch.</span></span> <span data-ttu-id="0e42a-168">En règle générale, vous devez effectuer une méthode asynchrone si la méthode synchrone bloque le thread de requête ASP.NET pendant cette opération aucun travail.</span><span class="sxs-lookup"><span data-stu-id="0e42a-168">In general, you should make a method asynchronous if the synchronous method blocks the ASP.NET request thread while doing no work.</span></span> <span data-ttu-id="0e42a-169">En effectuant l’appel asynchrone, le thread de requête ASP.NET n’est pas bloqué en attendant que la demande de service web effectuer aucun travail.</span><span class="sxs-lookup"><span data-stu-id="0e42a-169">By making the call asynchronous, the ASP.NET request thread is not blocked doing no work while it waits for the web service request to complete.</span></span>
- <span data-ttu-id="0e42a-170">Les tests montrent que les opérations bloquantes forment un goulet d’étranglement des performances de site et qu’IIS peut traiter plus de requêtes à l’aide des méthodes asynchrones pour ces appels bloquants.</span><span class="sxs-lookup"><span data-stu-id="0e42a-170">Testing shows that the blocking operations are a bottleneck in site performance and that IIS can service more requests by using asynchronous methods for these blocking calls.</span></span>

 <span data-ttu-id="0e42a-171">L’exemple téléchargeable indique comment utiliser efficacement les méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-171">The downloadable sample shows how to use asynchronous methods effectively.</span></span> <span data-ttu-id="0e42a-172">L’exemple fourni a été conçu pour fournir une démonstration simple de la programmation asynchrone dans ASP.NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="0e42a-172">The sample provided was designed to provide a simple demonstration of asynchronous programming in ASP.NET 4.5.</span></span> <span data-ttu-id="0e42a-173">L’exemple n’est pas destiné à être une architecture de référence pour la programmation asynchrone dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="0e42a-173">The sample is not intended to be a reference architecture for asynchronous programming in ASP.NET.</span></span> <span data-ttu-id="0e42a-174">L’exemple de programme appelle [API Web ASP.NET](../../../web-api/index.md) méthodes qui appellent à leur tour [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler des appels de service web d’exécution longue.</span><span class="sxs-lookup"><span data-stu-id="0e42a-174">The sample program calls [ASP.NET Web API](../../../web-api/index.md) methods which in turn call [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate long-running web service calls.</span></span> <span data-ttu-id="0e42a-175">La plupart des applications de production n’affichent pas ces avantages exceptionnels en utilisant les méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-175">Most production applications will not show such obvious benefits to using asynchronous Methods.</span></span>   
  
<span data-ttu-id="0e42a-176">Peu d’applications nécessitent toutes les méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-176">Few applications require all methods to be asynchronous.</span></span> <span data-ttu-id="0e42a-177">Souvent, la conversion de quelques méthodes synchrones en méthodes asynchrones offre le meilleur rapport performances / travail requis.</span><span class="sxs-lookup"><span data-stu-id="0e42a-177">Often, converting a few synchronous methods to asynchronous methods provides the best efficiency increase for the amount of work required.</span></span>

## <a id="SampleApp"></a><span data-ttu-id="0e42a-178">L’exemple d’Application</span><span class="sxs-lookup"><span data-stu-id="0e42a-178">The Sample Application</span></span>

<span data-ttu-id="0e42a-179">Vous pouvez télécharger l’exemple d’application à partir de [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) sur la [GitHub](https://github.com/) site.</span><span class="sxs-lookup"><span data-stu-id="0e42a-179">You can download the sample application from [https://github.com/RickAndMSFT/Async-ASP.NET](https://github.com/RickAndMSFT/Async-ASP.NET) on the [GitHub](https://github.com/) site.</span></span> <span data-ttu-id="0e42a-180">Le référentiel se compose de trois projets :</span><span class="sxs-lookup"><span data-stu-id="0e42a-180">The repository consists of three projects:</span></span>

- <span data-ttu-id="0e42a-181">*WebAppAsync*: projet de l’ASP.NET Web Forms qui utilise l’API Web **WebAPIpwg** service.</span><span class="sxs-lookup"><span data-stu-id="0e42a-181">*WebAppAsync*: The ASP.NET Web Forms project that consumes the Web API **WebAPIpwg** service.</span></span> <span data-ttu-id="0e42a-182">La plupart du code pour ce didacticiel est de ce projet.</span><span class="sxs-lookup"><span data-stu-id="0e42a-182">Most of the code for this tutorial is from the this project.</span></span>
- <span data-ttu-id="0e42a-183">*WebAPIpgw*: projet de l’API Web ASP.NET MVC 4 qui implémente le `Products, Gizmos and Widgets` contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-183">*WebAPIpgw*: The ASP.NET MVC 4 Web API project that implements the `Products, Gizmos and Widgets` controllers.</span></span> <span data-ttu-id="0e42a-184">Il fournit les données pour le *WebAppAsync* projet et le *Mvc4Async* projet.</span><span class="sxs-lookup"><span data-stu-id="0e42a-184">It provides the data for the *WebAppAsync* project and the *Mvc4Async* project.</span></span>
- <span data-ttu-id="0e42a-185">*Mvc4Async*: ASP.NET MVC 4 le projet qui contient le code utilisé dans un autre didacticiel.</span><span class="sxs-lookup"><span data-stu-id="0e42a-185">*Mvc4Async*: The ASP.NET MVC 4 project that contains the code used in another tutorial.</span></span> <span data-ttu-id="0e42a-186">Il passe des appels d’API Web à la **WebAPIpwg** service.</span><span class="sxs-lookup"><span data-stu-id="0e42a-186">It makes Web API calls to the **WebAPIpwg** service.</span></span>

## <a id="GizmosSynch"></a><span data-ttu-id="0e42a-187">La Page synchrone trucs</span><span class="sxs-lookup"><span data-stu-id="0e42a-187">The Gizmos Synchronous Page</span></span>

 <span data-ttu-id="0e42a-188">Le code suivant illustre la `Page_Load` méthode synchrone qui est utilisé pour afficher la liste des trucs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-188">The following code shows the `Page_Load` synchronous method that is used to display a list of gizmos.</span></span> <span data-ttu-id="0e42a-189">(Pour cet article, un gizmo est un appareil mécanique fictif.)</span><span class="sxs-lookup"><span data-stu-id="0e42a-189">(For this article, a gizmo is a fictional mechanical device.)</span></span> 

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample1.cs)]

<span data-ttu-id="0e42a-190">Le code suivant illustre la `GetGizmos` méthode du service gizmo.</span><span class="sxs-lookup"><span data-stu-id="0e42a-190">The following code shows the `GetGizmos` method of the gizmo service.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample2.cs)]

<span data-ttu-id="0e42a-191">Le `GizmoService GetGizmos` méthode passe un URI à un service HTTP de l’API Web ASP.NET qui retourne une liste de données des trucs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-191">The `GizmoService GetGizmos` method passes a URI to an ASP.NET Web API HTTP service which returns a list of gizmos data.</span></span> <span data-ttu-id="0e42a-192">Le *WebAPIpgw* projet contient l’implémentation de l’API Web `gizmos, widget` et `product` contrôleurs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-192">The *WebAPIpgw* project contains the implementation of the Web API `gizmos, widget` and `product` controllers.</span></span>  
<span data-ttu-id="0e42a-193">L’illustration suivante montre la page trucs à partir de l’exemple de projet.</span><span class="sxs-lookup"><span data-stu-id="0e42a-193">The following image shows the gizmos page from the sample project.</span></span>

![Gizmos](using-asynchronous-methods-in-aspnet-45/_static/image1.png)

## <a id="CreatingAsynchGizmos"></a><span data-ttu-id="0e42a-195">Création d’une Page trucs asynchrone</span><span class="sxs-lookup"><span data-stu-id="0e42a-195">Creating an Asynchronous Gizmos Page</span></span>

<span data-ttu-id="0e42a-196">L’exemple utilise le nouveau [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) et [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (disponible dans .NET 4.5 et Visual Studio 2012) de mots clés pour permettre au compilateur d’être chargée de gérer les transformations complexes nécessaires pour programmation asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-196">The sample uses the new [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) and [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keywords (available in .NET 4.5 and Visual Studio 2012) to let the compiler be responsible for maintaining the complicated transformations necessary for asynchronous programming.</span></span> <span data-ttu-id="0e42a-197">Le compilateur vous permet d’écrire du code à l’aide de que constructions de flux de contrôle synchrone de # et le compilateur applique automatiquement les transformations nécessaires pour utiliser les rappels afin d’éviter le blocage des threads.</span><span class="sxs-lookup"><span data-stu-id="0e42a-197">The compiler lets you write code using the C#'s synchronous control flow constructs and the compiler automatically applies the transformations necessary to use callbacks in order to avoid blocking threads.</span></span>

<span data-ttu-id="0e42a-198">Les pages ASP.NET asynchrones doivent inclure le [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive avec la `Async` attribut défini sur « true ».</span><span class="sxs-lookup"><span data-stu-id="0e42a-198">ASP.NET asynchronous pages must include the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true".</span></span> <span data-ttu-id="0e42a-199">Le code suivant illustre la [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive avec la `Async` attribut défini sur « true » pour le *GizmosAsync.aspx* page.</span><span class="sxs-lookup"><span data-stu-id="0e42a-199">The following code shows the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive with the `Async` attribute set to "true" for the *GizmosAsync.aspx* page.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample3.aspx?highlight=1)]

<span data-ttu-id="0e42a-200">Le code suivant illustre la `Gizmos` synchrone `Page_Load` (méthode) et le `GizmosAsync` page asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-200">The following code shows the `Gizmos` synchronous `Page_Load` method and the `GizmosAsync` asynchronous page.</span></span> <span data-ttu-id="0e42a-201">Si votre navigateur prend en charge la [HTML 5 &lt;marquer&gt; élément](http://www.w3.org/wiki/HTML/Elements/mark), vous verrez les modifications dans `GizmosAsync` en surbrillance jaune.</span><span class="sxs-lookup"><span data-stu-id="0e42a-201">If your browser supports the [HTML 5 &lt;mark&gt; element](http://www.w3.org/wiki/HTML/Elements/mark), you'll see the changes in `GizmosAsync` in yellow highlight.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample4.cs)]

<span data-ttu-id="0e42a-202">La version asynchrone :</span><span class="sxs-lookup"><span data-stu-id="0e42a-202">The asynchronous version:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample5.cs?highlight=3,6-7,9,11)]

 <span data-ttu-id="0e42a-203">Les modifications suivantes ont été appliquées pour permettre la `GizmosAsync` page être asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-203">The following changes were applied to allow the `GizmosAsync` page be asynchronous.</span></span>

- <span data-ttu-id="0e42a-204">Le [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive doit avoir le `Async` attribut défini sur « true ».</span><span class="sxs-lookup"><span data-stu-id="0e42a-204">The [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive must have the `Async` attribute set to "true".</span></span>
- <span data-ttu-id="0e42a-205">Le `RegisterAsyncTask` méthode est utilisée pour enregistrer une tâche asynchrone qui contient le code qui s’exécute de façon asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-205">The `RegisterAsyncTask` method is used to register an asynchronous task containing the code which runs asynchronously.</span></span>
- <span data-ttu-id="0e42a-206">La nouvelle `GetGizmosSvcAsync` méthode est marquée avec la [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) (mot clé), qui indique au compilateur pour générer des rappels pour les parties du corps et pour créer automatiquement un `Task` qui est retourné.</span><span class="sxs-lookup"><span data-stu-id="0e42a-206">The new `GetGizmosSvcAsync` method is marked with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, which tells the compiler to generate callbacks for parts of the body and to automatically create a `Task` that is returned.</span></span>
- <span data-ttu-id="0e42a-207">&quot;Async&quot; a été ajouté au nom de méthode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-207">&quot;Async&quot; was appended to the asynchronous method name.</span></span> <span data-ttu-id="0e42a-208">Ajoutez « Async » n’est pas obligatoire, mais est la convention lors de l’écriture de méthodes asynchrones.</span><span class="sxs-lookup"><span data-stu-id="0e42a-208">Appending "Async" is not required but is the convention when writing asynchronous methods.</span></span>
- <span data-ttu-id="0e42a-209">Le type de retour de la nouvelle `GetGizmosSvcAsync` méthode est `Task`.</span><span class="sxs-lookup"><span data-stu-id="0e42a-209">The return type of the new `GetGizmosSvcAsync` method is `Task`.</span></span> <span data-ttu-id="0e42a-210">Le type de retour de `Task` représente le travail en cours ainsi que les appelants de la méthode avec un descripteur via lequel attendre la fin de l’opération asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-210">The return type of `Task` represents ongoing work and provides callers of the method with a handle through which to wait for the asynchronous operation's completion.</span></span>
- <span data-ttu-id="0e42a-211">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (mot clé) a été appliqué à l’appel du service web.</span><span class="sxs-lookup"><span data-stu-id="0e42a-211">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the web service call.</span></span>
- <span data-ttu-id="0e42a-212">L’API de service web asynchrone a été appelée (`GetGizmosAsync`).</span><span class="sxs-lookup"><span data-stu-id="0e42a-212">The asynchronous web service API was called (`GetGizmosAsync`).</span></span>

<span data-ttu-id="0e42a-213">À l’intérieur de la `GetGizmosSvcAsync` une autre méthode asynchrone, de corps de méthode `GetGizmosAsync` est appelée.</span><span class="sxs-lookup"><span data-stu-id="0e42a-213">Inside of the `GetGizmosSvcAsync` method body another asynchronous method, `GetGizmosAsync` is called.</span></span> <span data-ttu-id="0e42a-214">`GetGizmosAsync`retourne immédiatement un `Task<List<Gizmo>>` qui s’achève par la suite lorsque les données sont disponibles.</span><span class="sxs-lookup"><span data-stu-id="0e42a-214">`GetGizmosAsync` immediately returns a `Task<List<Gizmo>>` that will eventually complete when the data is available.</span></span> <span data-ttu-id="0e42a-215">Étant donné que vous ne souhaitez pas effectuer d’autres opérations jusqu'à ce que vous disposez des données gizmo, le code attend la tâche (à l’aide de la **await** mot clé).</span><span class="sxs-lookup"><span data-stu-id="0e42a-215">Because you don't want to do anything else until you have the gizmo data, the code awaits the task (using the **await** keyword).</span></span> <span data-ttu-id="0e42a-216">Vous pouvez utiliser la **await** mot clé uniquement dans les méthodes annotées avec le **async** (mot clé).</span><span class="sxs-lookup"><span data-stu-id="0e42a-216">You can use the **await** keyword only in methods annotated with the **async** keyword.</span></span>

<span data-ttu-id="0e42a-217">Le **await** (mot clé) ne bloque pas le thread jusqu'à ce que la tâche est terminée.</span><span class="sxs-lookup"><span data-stu-id="0e42a-217">The **await** keyword does not block the thread until the task is complete.</span></span> <span data-ttu-id="0e42a-218">Il inscrit le reste de la méthode comme un rappel de la tâche et retourne immédiatement.</span><span class="sxs-lookup"><span data-stu-id="0e42a-218">It signs up the rest of the method as a callback on the task, and immediately returns.</span></span> <span data-ttu-id="0e42a-219">Lorsque la tâche attendue se termine par la suite, il appellera ce rappel et ainsi reprendre l’exécution de la droite de la méthode où il s’est arrêté.</span><span class="sxs-lookup"><span data-stu-id="0e42a-219">When the awaited task eventually completes, it will invoke that callback and thus resume the execution of the method right where it left off.</span></span> <span data-ttu-id="0e42a-220">Pour plus d’informations sur l’utilisation de la [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) et [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) mots clés et les [tâche](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) espace de noms, consultez le [async références](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span><span class="sxs-lookup"><span data-stu-id="0e42a-220">For more information on using the [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) and [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keywords and the [Task](https://msdn.microsoft.com/library/system.threading.tasks.task.aspx) namespace, see the [async references](https://docs.microsoft.com/dotnet/csharp/language-reference/keywords/async).</span></span>

<span data-ttu-id="0e42a-221">Le code suivant illustre la `GetGizmos` et `GetGizmosAsync` méthodes.</span><span class="sxs-lookup"><span data-stu-id="0e42a-221">The following code shows the `GetGizmos` and `GetGizmosAsync` methods.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample6.cs)]

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample7.cs?highlight=1,4-8)]

 <span data-ttu-id="0e42a-222">Les modifications asynchrones sont semblables à celles apportées à la **GizmosAsync** ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="0e42a-222">The asynchronous changes are similar to those made to the **GizmosAsync** above.</span></span> 

- <span data-ttu-id="0e42a-223">La signature de méthode a été annotée avec le [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) (mot clé), le type de retour a été remplacé par `Task<List<Gizmo>>`, et *Async* a été ajouté au nom de la méthode.</span><span class="sxs-lookup"><span data-stu-id="0e42a-223">The method signature was annotated with the [async](https://msdn.microsoft.com/library/hh156513(VS.110).aspx) keyword, the return type was changed to `Task<List<Gizmo>>`, and *Async* was appended to the method name.</span></span>
- <span data-ttu-id="0e42a-224">Asynchrone [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) classe est utilisée au lieu de synchrones [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) classe.</span><span class="sxs-lookup"><span data-stu-id="0e42a-224">The asynchronous [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx) class is used instead of the synchronous [WebClient](https://msdn.microsoft.com/library/system.net.webclient.aspx) class.</span></span>
- <span data-ttu-id="0e42a-225">Le [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) (mot clé) a été appliquée à la [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) méthode asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-225">The [await](https://msdn.microsoft.com/library/hh156528(VS.110).aspx) keyword was applied to the [HttpClient](https://msdn.microsoft.com/library/system.net.http.httpclient(VS.110).aspx)[GetAsync](https://msdn.microsoft.com/library/hh158944(VS.110).aspx) asynchronous method.</span></span>

<span data-ttu-id="0e42a-226">L’illustration suivante montre la vue gizmo asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-226">The following image shows the asynchronous gizmo view.</span></span>

![async](using-asynchronous-methods-in-aspnet-45/_static/image2.png)

<span data-ttu-id="0e42a-228">La présentation de navigateurs des données trucs est identique à la vue créée par l’appel synchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-228">The browsers presentation of the gizmos data is identical to the view created by the synchronous call.</span></span> <span data-ttu-id="0e42a-229">La seule différence est que la version asynchrone peut être plus performant charges sont élevées.</span><span class="sxs-lookup"><span data-stu-id="0e42a-229">The only difference is the asynchronous version may be more performant under heavy loads.</span></span>

## <a name="registerasynctask-notes"></a><span data-ttu-id="0e42a-230">Notes de RegisterAsyncTask</span><span class="sxs-lookup"><span data-stu-id="0e42a-230">RegisterAsyncTask Notes</span></span>

<span data-ttu-id="0e42a-231">Méthodes rattachée avec `RegisterAsyncTask` s’exécute immédiatement après [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span><span class="sxs-lookup"><span data-stu-id="0e42a-231">Methods hooked up with `RegisterAsyncTask` will run immediately after [PreRender](https://msdn.microsoft.com/library/ms178472.aspx).</span></span> <span data-ttu-id="0e42a-232">Vous pouvez également utiliser les événements de page void async directement, comme indiqué dans le code suivant :</span><span class="sxs-lookup"><span data-stu-id="0e42a-232">You can also use async void page events directly, as shown in the following code:</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample8.cs)]

<span data-ttu-id="0e42a-233">L’inconvénient événements void async est que les développeurs n’a plus un contrôle total sur quand les exécuter.</span><span class="sxs-lookup"><span data-stu-id="0e42a-233">The downside to async void events is that developers no longer has full control over when events execute.</span></span> <span data-ttu-id="0e42a-234">Par exemple, si les deux une .aspx et qu’une. Master définir `Page_Load` événements et un ou deux d'entre elles sont asynchrones, l’ordre d’exécution ne peut pas être garanti.</span><span class="sxs-lookup"><span data-stu-id="0e42a-234">For example, if both an .aspx and a .Master define `Page_Load` events and one or both of them are asynchronous, the order of execution can't be guaranteed.</span></span> <span data-ttu-id="0e42a-235">L’ordre pour les gestionnaires d’événements non indeterminiate (tel que `async void Button_Click` ) s’applique.</span><span class="sxs-lookup"><span data-stu-id="0e42a-235">The same indeterminiate order for non event handlers (such as `async void Button_Click` ) applies.</span></span> <span data-ttu-id="0e42a-236">Pour la plupart des développeurs, cela devrait être acceptable, mais celles qui ont besoin d’un contrôle total sur l’ordre d’exécution doivent uniquement utiliser des API comme `RegisterAsyncTask` qui utilisent des méthodes qui retournent un objet de tâche.</span><span class="sxs-lookup"><span data-stu-id="0e42a-236">For most developers this should be acceptable, but those who require full control over the order of execution should only use APIs like `RegisterAsyncTask` that consume methods which return a Task object.</span></span>

## <a id="Parallel"></a><span data-ttu-id="0e42a-237">Exécution de plusieurs opérations en parallèle</span><span class="sxs-lookup"><span data-stu-id="0e42a-237">Performing Multiple Operations in Parallel</span></span>

<span data-ttu-id="0e42a-238">Méthodes asynchrones ont un avantage significatif sur les méthodes synchrones lorsqu’une action doit exécuter plusieurs opérations indépendantes.</span><span class="sxs-lookup"><span data-stu-id="0e42a-238">Asynchronous Methods have a significant advantage over synchronous methods when an action must perform several independent operations.</span></span> <span data-ttu-id="0e42a-239">Dans l’exemple fourni, la page synchrone *PWG.aspx*(pour les produits, les Widgets et trucs) affiche les résultats de trois appels de service web pour obtenir une liste de produits, les widgets et trucs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-239">In the sample provided, the synchronous page *PWG.aspx*(for Products, Widgets and Gizmos) displays the results of three web service calls to get a list of products, widgets, and gizmos.</span></span> <span data-ttu-id="0e42a-240">Le [API Web ASP.NET](../../../web-api/index.md) projet qui fournit ces services utilise [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) pour simuler les temps de latence ou un réseau lent appelle.</span><span class="sxs-lookup"><span data-stu-id="0e42a-240">The [ASP.NET Web API](../../../web-api/index.md) project that provides these services uses [Task.Delay](https://msdn.microsoft.com/library/hh139096(VS.110).aspx) to simulate latency or slow network calls.</span></span> <span data-ttu-id="0e42a-241">Lorsque le délai est défini à 500 millisecondes, asynchrone *PWGasync.aspx* page prend un peu plus de 500 millisecondes pour effectuer tout en synchrones `PWG` version adopte 1 500 millisecondes.</span><span class="sxs-lookup"><span data-stu-id="0e42a-241">When the delay is set to 500 milliseconds, the asynchronous *PWGasync.aspx* page takes a little over 500 milliseconds to complete while the synchronous `PWG` version takes over 1,500 milliseconds.</span></span> <span data-ttu-id="0e42a-242">Synchrones *PWG.aspx* page est indiquée dans le code suivant.</span><span class="sxs-lookup"><span data-stu-id="0e42a-242">The synchronous *PWG.aspx* page is shown in the following code.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample9.cs)]

<span data-ttu-id="0e42a-243">Asynchrone `PWGasync` code-behind est indiqué ci-dessous.</span><span class="sxs-lookup"><span data-stu-id="0e42a-243">The asynchronous `PWGasync` code behind is shown below.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample10.cs?highlight=5,11,21)]

<span data-ttu-id="0e42a-244">L’illustration suivante montre la vue retournée par asynchrone *PWGasync.aspx* page.</span><span class="sxs-lookup"><span data-stu-id="0e42a-244">The following image shows the view returned from the asynchronous *PWGasync.aspx* page.</span></span>

![](using-asynchronous-methods-in-aspnet-45/_static/image3.png)

## <a id="CancelToken"></a><span data-ttu-id="0e42a-245">À l’aide d’un jeton d’annulation</span><span class="sxs-lookup"><span data-stu-id="0e42a-245">Using a Cancellation Token</span></span>

<span data-ttu-id="0e42a-246">Retour de méthodes asynchrones `Task`sont annulable, c'est-à-dire qu’ils prennent une [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) paramètre lorsqu’elle est fournie avec le `AsyncTimeout` attribut de la [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) la directive.</span><span class="sxs-lookup"><span data-stu-id="0e42a-246">Asynchronous Methods returning `Task`are cancelable, that is they take a [CancellationToken](https://msdn.microsoft.com/library/system.threading.cancellationtoken(VS.110).aspx) parameter when one is provided with the `AsyncTimeout` attribute of the [Page](https://msdn.microsoft.com/library/ydy4x04a.aspx) directive.</span></span> <span data-ttu-id="0e42a-247">Le code suivant illustre la *GizmosCancelAsync.aspx* page avec un délai d’expiration de la seconde.</span><span class="sxs-lookup"><span data-stu-id="0e42a-247">The following code shows the *GizmosCancelAsync.aspx* page with a timeout of on second.</span></span>

[!code-aspx[Main](using-asynchronous-methods-in-aspnet-45/samples/sample11.aspx?highlight=1)]

<span data-ttu-id="0e42a-248">Le code suivant illustre la *GizmosCancelAsync.aspx.cs* fichier.</span><span class="sxs-lookup"><span data-stu-id="0e42a-248">The following code shows the *GizmosCancelAsync.aspx.cs* file.</span></span>

[!code-csharp[Main](using-asynchronous-methods-in-aspnet-45/samples/sample12.cs?highlight=6,9)]

<span data-ttu-id="0e42a-249">Dans l’exemple d’application fourni, en sélectionnant le *GizmosCancelAsync* lien appelle le *GizmosCancelAsync.aspx* page et montre comment l’annulation (par expiration) de l’appel asynchrone.</span><span class="sxs-lookup"><span data-stu-id="0e42a-249">In the sample application provided, selecting the *GizmosCancelAsync* link calls the *GizmosCancelAsync.aspx* page and demonstrates the cancelation (by timing out) of the asynchronous call.</span></span> <span data-ttu-id="0e42a-250">Étant donné que le délai d’attente se trouve dans une plage aléatoire, vous devrez peut-être actualiser la page à deux reprises pour obtenir le message d’erreur de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="0e42a-250">Because the delay time is within a random range, you might need to refresh the page a couple times to get the time out error message.</span></span>

## <a id="ServerConfig"></a><span data-ttu-id="0e42a-251">Configuration du serveur pour les appels de Service Web élevé d’accès concurrentiel/haute latence</span><span class="sxs-lookup"><span data-stu-id="0e42a-251">Server Configuration for High Concurrency/High Latency Web Service Calls</span></span>

<span data-ttu-id="0e42a-252">Pour profiter des avantages d’une application web asynchrone, vous devrez peut-être apporter des modifications à la configuration du serveur par défaut.</span><span class="sxs-lookup"><span data-stu-id="0e42a-252">To realize the benefits of an asynchronous web application, you might need to make some changes to the default server configuration.</span></span> <span data-ttu-id="0e42a-253">Gardez les éléments suivants à l’esprit lors de la configuration et test de votre application web asynchrone de contrainte.</span><span class="sxs-lookup"><span data-stu-id="0e42a-253">Keep the following in mind when configuring and stress testing your asynchronous web application.</span></span>

- <span data-ttu-id="0e42a-254">Windows 7, Windows Vista, Windows 8 et tous les systèmes d’exploitation de client Windows avoir un maximum de 10 requêtes simultanées.</span><span class="sxs-lookup"><span data-stu-id="0e42a-254">Windows 7, Windows Vista, Window 8, and all Windows client operating systems have a maximum of 10 concurrent requests.</span></span> <span data-ttu-id="0e42a-255">Vous aurez besoin d’un système d’exploitation Windows pour tirer parti des avantages de méthodes asynchrones sous charge élevée.</span><span class="sxs-lookup"><span data-stu-id="0e42a-255">You'll need a Windows Server operating system to see the benefits of asynchronous methods under high load.</span></span>
- <span data-ttu-id="0e42a-256">Inscrire le .NET 4.5 avec IIS à partir d’une invite de commandes avec élévation de privilèges à l’aide de la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="0e42a-256">Register .NET 4.5 with IIS from an elevated command prompt using the following command:</span></span>  
 <span data-ttu-id="0e42a-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span><span class="sxs-lookup"><span data-stu-id="0e42a-257">%windir%\Microsoft.NET\Framework64 \v4.0.30319\aspnet\_regiis -i</span></span>  
 <span data-ttu-id="0e42a-258">Consultez [outil d’inscription IIS ASP.NET (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span><span class="sxs-lookup"><span data-stu-id="0e42a-258">See    [ASP.NET IIS Registration Tool (Aspnet\_regiis.exe)](https://msdn.microsoft.com/library/k6h9cz8h.aspx)</span></span>
- <span data-ttu-id="0e42a-259">Vous devrez peut-être augmenter la [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) limite de file d’attente à partir de la valeur par défaut de 1 000 à 5 000.</span><span class="sxs-lookup"><span data-stu-id="0e42a-259">You might need to increase the [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) queue limit from the default value of 1,000 to 5,000.</span></span> <span data-ttu-id="0e42a-260">Si le paramètre est trop faible, vous pouvez voir [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) rejeter les demandes avec l’état HTTP 503.</span><span class="sxs-lookup"><span data-stu-id="0e42a-260">If the setting is too low, you may see [HTTP.sys](https://www.iis.net/learn/get-started/introduction-to-iis/introduction-to-iis-architecture) reject requests with a HTTP 503 status.</span></span> <span data-ttu-id="0e42a-261">Pour modifier la limite de la file d’attente HTTP.sys :</span><span class="sxs-lookup"><span data-stu-id="0e42a-261">To change the HTTP.sys queue limit:</span></span>

    - <span data-ttu-id="0e42a-262">Ouvrez le Gestionnaire des services Internet et accédez au volet de Pools d’applications.</span><span class="sxs-lookup"><span data-stu-id="0e42a-262">Open IIS manager and navigate to the Application Pools pane.</span></span>
    - <span data-ttu-id="0e42a-263">Cliquez avec le bouton droit sur le pool d’applications cible et sélectionnez **paramètres avancés**.</span><span class="sxs-lookup"><span data-stu-id="0e42a-263">Right click on the target application pool and select **Advanced Settings**.</span></span>  
        <span data-ttu-id="0e42a-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="0e42a-264">![advanced](using-asynchronous-methods-in-aspnet-45/_static/image4.png)</span></span>
    - <span data-ttu-id="0e42a-265">Dans le **paramètres avancés** boîte de dialogue, *longueur de file d’attente* à partir de 1 000 à 5 000.</span><span class="sxs-lookup"><span data-stu-id="0e42a-265">In the **Advanced Settings** dialog box, change *Queue Length* from 1,000 to 5,000.</span></span>  
        <span data-ttu-id="0e42a-266">![Longueur de file d’attente](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span><span class="sxs-lookup"><span data-stu-id="0e42a-266">![Queue length](using-asynchronous-methods-in-aspnet-45/_static/image5.png)</span></span>  
  
 <span data-ttu-id="0e42a-267">Notez dans les images ci-dessus, le .NET framework est répertorié en tant que version 4.0, même si le pool d’applications à l’aide de .NET 4.5.</span><span class="sxs-lookup"><span data-stu-id="0e42a-267">Note in the images above, the .NET framework is listed as v4.0, even though the application pool is using .NET 4.5.</span></span> <span data-ttu-id="0e42a-268">Pour comprendre cette différence, consultez les rubriques suivantes :</span><span class="sxs-lookup"><span data-stu-id="0e42a-268">To understand this discrepancy, see the following:</span></span>

        - [.NET Versioning and Multi-Targeting - .NET 4.5 is an in-place upgrade to .NET 4.0](http://www.hanselman.com/blog/NETVersioningAndMultiTargetingNET45IsAnInplaceUpgradeToNET40.aspx)
        - [How to set an IIS Application or AppPool to use ASP.NET 3.5 rather than 2.0](http://www.hanselman.com/blog/HowToSetAnIISApplicationOrAppPoolToUseASPNET35RatherThan20.aspx)
        - [.NET Framework Versions and Dependencies](https://msdn.microsoft.com/library/bb822049(VS.110).aspx)
- <span data-ttu-id="0e42a-269">Si votre application est à l’aide des services web ou de noms System.NET pour communiquer avec un service principal via HTTP vous devrez peut-être augmenter la [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) élément.</span><span class="sxs-lookup"><span data-stu-id="0e42a-269">If your application is using web services or System.NET to communicate with a backend over HTTP you may need to increase the [connectionManagement/maxconnection](https://msdn.microsoft.com/library/fb6y0fyc(VS.110).aspx) element.</span></span> <span data-ttu-id="0e42a-270">Pour les applications ASP.NET, il est limité par la fonctionnalité de configuration automatique à 12 fois le nombre de processeurs.</span><span class="sxs-lookup"><span data-stu-id="0e42a-270">For ASP.NET applications, this is limited by the autoConfig feature to 12 times the number of CPUs.</span></span> <span data-ttu-id="0e42a-271">Cela signifie que sur une procédure quadruple, vous pouvez avoir au maximum 12 \* 4 = 48 connexions simultanées à un point de terminaison IP.</span><span class="sxs-lookup"><span data-stu-id="0e42a-271">That means that on a quad-proc, you can have at most 12 \* 4 = 48 concurrent connections to an IP end point.</span></span> <span data-ttu-id="0e42a-272">Étant donné que cela est lié à [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), le moyen le plus simple d’augmenter `maxconnection` dans ASP.NET application consiste à définir [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) par programmation dans l’à partir de `Application_Start` méthode dans le *global.asax* fichier.</span><span class="sxs-lookup"><span data-stu-id="0e42a-272">Because this is tied to [autoConfig](https://msdn.microsoft.com/library/7w2sway1(VS.110).aspx), the easiest way to increase `maxconnection` in an ASP.NET application is to set [System.Net.ServicePointManager.DefaultConnectionLimit](https://msdn.microsoft.com/library/system.net.servicepointmanager.defaultconnectionlimit(VS.110).aspx) programmatically in the from `Application_Start` method in the *global.asax* file.</span></span> <span data-ttu-id="0e42a-273">Consultez l’exemple à télécharger pour obtenir un exemple.</span><span class="sxs-lookup"><span data-stu-id="0e42a-273">See the sample download for an example.</span></span>
- <span data-ttu-id="0e42a-274">Dans .NET 4.5, la valeur par défaut de 5000 pour [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) devraient être appropriées.</span><span class="sxs-lookup"><span data-stu-id="0e42a-274">In .NET 4.5, the default of 5000 for [MaxConcurrentRequestsPerCPU](https://blogs.msdn.com/tmarq/archive/2007/07/21/asp-net-thread-usage-on-iis-7-0-and-6-0.aspx) should be fine.</span></span>

## <a name="contributors"></a><span data-ttu-id="0e42a-275">Contributors</span><span class="sxs-lookup"><span data-stu-id="0e42a-275">Contributors</span></span>

- [<span data-ttu-id="0e42a-276">Levi Broderick</span><span class="sxs-lookup"><span data-stu-id="0e42a-276">Levi Broderick</span></span>](http://stackoverflow.com/users/59641/levi)
- [<span data-ttu-id="0e42a-277">Tom Dykstra</span><span class="sxs-lookup"><span data-stu-id="0e42a-277">Tom Dykstra</span></span>](http://www.bing.com/search?q=site%3Aasp.net+%22Tom+Dykstra%22+-forums.asp.net&amp;qs=n&amp;form=QBRE&amp;pq=site%3Aasp.net+%22tom+dykstra%22+-forums.asp.net&amp;sc=8-42&amp;sp=-1&amp;sk=)
- [<span data-ttu-id="0e42a-278">Brad Wilson.</span><span class="sxs-lookup"><span data-stu-id="0e42a-278">Brad Wilson</span></span>](http://bradwilson.typepad.com/)
- [<span data-ttu-id="0e42a-279">HongMei Ge</span><span class="sxs-lookup"><span data-stu-id="0e42a-279">HongMei Ge</span></span>](https://blogs.msdn.com/b/hongmeig/)
