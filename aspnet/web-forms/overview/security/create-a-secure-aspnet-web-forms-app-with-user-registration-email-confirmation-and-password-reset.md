---
uid: web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
title: "Créer une application Web Forms ASP.NET sécurisée avec l’inscription des utilisateurs, envoyer par courrier électronique de confirmation et le mot de passe de la réinitialisation (c#) | Documents Microsoft"
author: Erikre
description: "Ce didacticiel vous montre comment créer une application Web Forms ASP.NET avec l’inscription utilisateur, de confirmation par courrier électronique et de mot de passe réinitialisé à l’aide du membre d’identité ASP.NET..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 10/02/2014
ms.topic: article
ms.assetid: 0a8d6044-5fab-4213-82d6-5618d5601358
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/security/create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: ed39295ed1bcaa924336a1faf52049e291abeadb
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2018
---
<a name="create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset-c"></a><span data-ttu-id="8b6ea-103">Créer une application Web Forms ASP.NET sécurisée avec l’inscription des utilisateurs, envoyer par courrier électronique de confirmation et le mot de passe de la réinitialisation (c#)</span><span class="sxs-lookup"><span data-stu-id="8b6ea-103">Create a secure ASP.NET Web Forms app with user registration, email confirmation and password reset (C#)</span></span>
====================
<span data-ttu-id="8b6ea-104">Par [Erik Reitan](https://github.com/Erikre)</span><span class="sxs-lookup"><span data-stu-id="8b6ea-104">by [Erik Reitan](https://github.com/Erikre)</span></span>

> <span data-ttu-id="8b6ea-105">Ce didacticiel vous montre comment créer une application Web Forms ASP.NET avec l’inscription des utilisateurs, de confirmation par courrier électronique et de mot de passe réinitialisé à l’aide du système d’appartenance ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-105">This tutorial shows you how to build an ASP.NET Web Forms app with user registration, email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="8b6ea-106">Ce didacticiel est basé sur de Rick Anderson [didacticiel MVC](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-106">This tutorial was based on Rick Anderson's [MVC tutorial](../../../mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset.md).</span></span>


## <a name="introduction"></a><span data-ttu-id="8b6ea-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="8b6ea-107">Introduction</span></span>

<span data-ttu-id="8b6ea-108">Ce didacticiel vous guide à travers les étapes requises pour créer une application Web Forms ASP.NET à l’aide de Visual Studio et ASP.NET 4.5 pour créer une application Web Forms sécurisée avec l’enregistrement de l’utilisateur, par courrier électronique de confirmation et le mot de passe de la réinitialisation.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-108">This tutorial guides you through the steps required to create an ASP.NET Web Forms application using Visual Studio and ASP.NET 4.5 to create a secure Web Forms app with user registration, email confirmation and password reset.</span></span>

### <a name="tutorial-tasks-and-information"></a><span data-ttu-id="8b6ea-109">Tâches de didacticiel et les informations sur :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-109">Tutorial Tasks and Information:</span></span>

- [<span data-ttu-id="8b6ea-110">Créer un site ASP.NET Web Forms application</span><span class="sxs-lookup"><span data-stu-id="8b6ea-110">Create an ASP.NET Web Forms app</span></span>](#createWebForms)
- [<span data-ttu-id="8b6ea-111">Raccorder SendGrid</span><span class="sxs-lookup"><span data-stu-id="8b6ea-111">Hook Up SendGrid</span></span>](#SG)
- [<span data-ttu-id="8b6ea-112">Exigez une Confirmation par courrier électronique avant de journal dans</span><span class="sxs-lookup"><span data-stu-id="8b6ea-112">Require Email Confirmation Before Log In</span></span>](#require)
- [<span data-ttu-id="8b6ea-113">Réinitialisation et la récupération de mot de passe</span><span class="sxs-lookup"><span data-stu-id="8b6ea-113">Password Recovery and Reset</span></span>](#reset)
- [<span data-ttu-id="8b6ea-114">Renvoyer le lien de Confirmation par courrier électronique</span><span class="sxs-lookup"><span data-stu-id="8b6ea-114">Resend Email Confirmation Link</span></span>](#rsend)
- [<span data-ttu-id="8b6ea-115">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="8b6ea-115">Troubleshooting the App</span></span>](#dbg)
- [<span data-ttu-id="8b6ea-116">Ressources supplémentaires pour MSBuild</span><span class="sxs-lookup"><span data-stu-id="8b6ea-116">Additional Resources</span></span>](#addRes)

<a id="createWebForms"></a>
## <a name="create-an-aspnet-web-forms-app"></a><span data-ttu-id="8b6ea-117">Créer une application de formulaires Web ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8b6ea-117">Create an ASP.NET Web Forms App</span></span>

<span data-ttu-id="8b6ea-118">Commencez par installer et exécuter [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-118">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="8b6ea-119">Installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure ainsi.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-119">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher as well.</span></span>

> [!NOTE]
> <span data-ttu-id="8b6ea-120">Avertissement : Vous devez installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure pour effectuer ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-120">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="8b6ea-121">Créer un projet (**fichier**  - &gt; **nouveau projet**) et sélectionnez le **Application Web ASP.NET** modèle et la plus récente du .NET Framework version à partir de la **nouveau projet** boîte de dialogue.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-121">Create a new project (**File** -&gt; **New Project**) and select the **ASP.NET Web Application** template and the latest .NET Framework version from the **New Project** dialog box.</span></span>
2. <span data-ttu-id="8b6ea-122">À partir de la **nouveau projet ASP.NET** boîte de dialogue, sélectionnez le **Web Forms** modèle.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-122">From the **New ASP.NET Project** dialog box, select the **Web Forms** template.</span></span> <span data-ttu-id="8b6ea-123">Laissez l’authentification par défaut en tant que **comptes d’utilisateur individuels**.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-123">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="8b6ea-124">Si vous souhaitez héberger l’application dans Azure, laissez le **hôte dans le cloud** case est cochée.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-124">If you'd like to host the app in Azure, leave the **Host in the cloud** check box checked.</span></span>   
 <span data-ttu-id="8b6ea-125">Ensuite, cliquez sur **OK** pour créer le projet.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-125">Then, click **OK** to create the new project.</span></span>  
    <span data-ttu-id="8b6ea-126">![Boîte de dialogue Nouveau projet ASP.NET](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="8b6ea-126">![New ASP.NET Project dialog box](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image1.png)</span></span>
3. <span data-ttu-id="8b6ea-127">Activer Secure Sockets Layer (SSL) pour le projet.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-127">Enable Secure Sockets Layer (SSL) for the project.</span></span> <span data-ttu-id="8b6ea-128">Suivez les étapes disponibles dans le **activer SSL pour le projet** section de la [prise en main de la série de didacticiels Web Forms](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-128">Follow the steps available in the **Enable SSL for the Project** section of the [Getting Started with Web Forms tutorial series](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms).</span></span>
4. <span data-ttu-id="8b6ea-129">Exécuter l’application, cliquez sur le **inscrire** lier et inscrire un nouvel utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-129">Run the app, click the **Register** link and register a new user.</span></span> <span data-ttu-id="8b6ea-130">À ce stade, la seule validation de l’adresse de messagerie est basée sur le [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribut pour garantir l’adresse de messagerie est bien formée.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-130">At this point, the only validation on the email is based on the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute to ensure the email address is well-formed.</span></span> <span data-ttu-id="8b6ea-131">Vous allez modifier le code pour ajouter l’e-mail de confirmation.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-131">You will modify the code to add email confirmation.</span></span> <span data-ttu-id="8b6ea-132">Fermez la fenêtre du navigateur.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-132">Close the browser window.</span></span>
5. <span data-ttu-id="8b6ea-133">Dans **l’Explorateur de serveurs** de Visual Studio (**vue**  - &gt; **l’Explorateur de serveurs**), accédez à **données\ de données DefaultConnection\Tables\AspNetUsers**avec le bouton droit sur et sélectionnez **ouvrir la définition de la table**.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-133">In **Server Explorer** of Visual Studio (**View** -&gt; **Server Explorer**), navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span> 

    <span data-ttu-id="8b6ea-134">L’illustration suivante montre le `AspNetUsers` schéma de la table :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-134">The following image shows the `AspNetUsers` table schema:</span></span>

    ![Schéma de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="8b6ea-136">Dans **l’Explorateur de serveurs**, avec le bouton droit sur le **AspNetUsers** de table et sélectionnez **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-136">In **Server Explorer**, right-click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
  
    ![Données de la table AspNetUsers](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="8b6ea-138">À ce stade le courrier électronique pour l’utilisateur inscrit n’a pas été confirmé.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-138">At this point the email for the registered user has not been confirmed.</span></span>
7. <span data-ttu-id="8b6ea-139">Cliquez sur la ligne, puis sélectionnez Supprimer pour supprimer l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-139">Click on the row and select delete to delete the user.</span></span> <span data-ttu-id="8b6ea-140">Vous ajoutez de nouveau ce courrier électronique à l’étape suivante et envoyer un message de confirmation à l’adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-140">You'll add this email again in the next step and send a confirmation message to the email address.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="8b6ea-141">E-mail de Confirmation</span><span class="sxs-lookup"><span data-stu-id="8b6ea-141">Email Confirmation</span></span>

<span data-ttu-id="8b6ea-142">Il est recommandé de confirmer l’adresse de messagerie lors de l’inscription d’un nouvel utilisateur pour vérifier qu’ils n’empruntent pas une autre personne (autrement dit, ils n’ont pas inscrit avec par quelqu'un d’autre adresse de messagerie).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-142">It's a best practice to confirm the email during the registration of a new user to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="8b6ea-143">Supposons que vous aviez un forum de discussion, vous pouvez empêcher `"bob@cpandl.com"` lors de l’inscription en tant que `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-143">Suppose you had a discussion forum, you would want to prevent `"bob@cpandl.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="8b6ea-144">Sans la confirmation par courrier électronique, `"joe@contoso.com"` Impossible d’obtenir le courrier indésirable à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-144">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="8b6ea-145">Supposons que Bob accidentellement inscrit en tant que `"bib@cpandl.com"` et vous n’aviez pas remarqué, il ne serait pas en mesure d’utiliser la récupération de mot de passe, car l’application n’a pas son e-mail valable.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-145">Suppose Bob accidently registered as `"bib@cpandl.com"` and hadn't noticed it, he wouldn't be able to use password recovery because the app doesn't have his correct email.</span></span> <span data-ttu-id="8b6ea-146">E-mail de confirmation offre uniquement une protection limitée de robots et ne fournit la protection à partir des expéditeurs déterminés.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-146">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers.</span></span>

<span data-ttu-id="8b6ea-147">En règle générale, vous souhaitez empêcher les nouveaux utilisateurs à partir de la validation des données à votre site Web avant qu’ils ont été confirmées par un courrier électronique, un message texte ou un autre mécanisme.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-147">You generally want to prevent new users from posting any data to your website before they have been confirmed by either email, an SMS text message or another mechanism.</span></span> <span data-ttu-id="8b6ea-148">Dans les sections ci-dessous, nous activer la confirmation de courrier électronique et modifier le code pour empêcher les utilisateurs qui vient d’être inscrits de se connecter jusqu'à ce que leur courrier électronique a été confirmée.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-148">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span> <span data-ttu-id="8b6ea-149">Vous allez utiliser le service de messagerie SendGrid dans ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-149">You'll use the email service SendGrid in this tutorial.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="8b6ea-150">Raccorder SendGrid</span><span class="sxs-lookup"><span data-stu-id="8b6ea-150">Hook up SendGrid</span></span>

<span data-ttu-id="8b6ea-151">Bien que ce didacticiel montre uniquement comment ajouter la notification par courrier électronique via [SendGrid](http://sendgrid.com/), vous pouvez envoyer un e-mail à l’aide de SMTP et autres mécanismes (consultez [des ressources supplémentaires](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-151">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="8b6ea-152">Dans Visual Studio, ouvrez le **Package Manager Console** (**outils**  - &gt; **le Gestionnaire de Package NuGet**  - &gt; **Package Manager Console**) et entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-152">In Visual Studio, open the **Package Manager Console** (**Tools** -&gt; **NuGet Package Manger** -&gt; **Package Manager Console**), and enter the following command:</span></span>  
    `Install-Package SendGrid`
2. <span data-ttu-id="8b6ea-153">Accédez à la [page d’inscription Azure SendGrid](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) et l’inscrire pour un compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-153">Go to the [Azure SendGrid sign-up page](https://azure.microsoft.com/gallery/store/sendgrid/sendgrid-azure/) and register for free SendGrid account.</span></span> <span data-ttu-id="8b6ea-154">Vous pouvez également ouvrir un compte de SendGrid libre directement sur [site de SendGrid](http://www.sendgrid.com).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-154">You can also sign-up for a free SendGrid account directly on [SendGrid's site](http://www.sendgrid.com).</span></span>
3. <span data-ttu-id="8b6ea-155">À partir de **l’Explorateur de solutions** ouvrir le *IdentityConfig.cs* de fichiers dans le *application\_Démarrer* dossier et ajoutez le code suivant est mis en surbrillance en jaune pour le `EmailService` classe permettant de configurer **SendGrid**:</span><span class="sxs-lookup"><span data-stu-id="8b6ea-155">From **Solution Explorer** open the *IdentityConfig.cs* file in the *App\_Start* folder and add the following code highlighted in yellow to the `EmailService` class to configure **SendGrid**:</span></span>

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample1.cs?highlight=3,5,8-37)]
4. <span data-ttu-id="8b6ea-156">En outre, ajoutez le code suivant `using` instructions au début de la *IdentityConfig.cs* fichier :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-156">Also, add the following `using` statements to the beginning of the *IdentityConfig.cs* file:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample2.cs?highlight=1-4)]
5. <span data-ttu-id="8b6ea-157">Pour simplifier cet exemple, vous allez stocker les valeurs de compte de service de messagerie dans le `appSettings` section de la *web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-157">To keep this sample simple, you'll store the email service account values in the `appSettings` section of the *web.config* file.</span></span> <span data-ttu-id="8b6ea-158">Ajoutez le code XML suivant, mis en surbrillance en jaune pour le *web.config* fichier à la racine de votre projet :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-158">Add the following XML highlighted in yellow to the *web.config* file at the root of your project:</span></span>

    [!code-xml[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample3.xml?highlight=2-5)]

    > [!WARNING]
    > <span data-ttu-id="8b6ea-159">Sécurité - magasin jamais des données sensibles dans votre code source.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-159">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="8b6ea-160">Dans cet exemple, le compte et les informations d’identification sont stockées dans le **appSetting** section de la *Web.config* fichier.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-160">In this example, the account and credentials are stored in the **appSetting** section of the *Web.config* file.</span></span> <span data-ttu-id="8b6ea-161">Sur Azure, vous pouvez stocker en toute sécurité des ces valeurs sur le  **[configurer](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)**  onglet dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-161">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="8b6ea-162">Pour plus d’informations, consultez rubrique de Rick Anderson [meilleures pratiques pour le déploiement des mots de passe et autres données sensibles sur ASP.NET et Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-162">For related information see Rick Anderson's topic titled [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](https://go.microsoft.com/fwlink/?LinkId=513141).</span></span>
6. <span data-ttu-id="8b6ea-163">Ajoutez les valeurs de service de messagerie afin de refléter les valeurs de l’authentification SendGrid (nom d’utilisateur et mot de passe) pour que vous puissiez réussie envoyer par courrier électronique à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-163">Add the email service values to reflect your SendGrid authentication values (User Name and Password) so that you can successful send email from your app.</span></span> <span data-ttu-id="8b6ea-164">Veillez à utiliser le nom de votre compte SendGrid plutôt que l’adresse de messagerie que vous avez fourni SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-164">Be sure to use your SendGrid account name rather than the email address you provided SendGrid.</span></span>

### <a name="enable-email-confirmation"></a><span data-ttu-id="8b6ea-165">Activer la Confirmation de courrier électronique</span><span class="sxs-lookup"><span data-stu-id="8b6ea-165">Enable Email Confirmation</span></span>

 <span data-ttu-id="8b6ea-166">Pour activer la confirmation par courrier électronique, vous allez modifier le code d’enregistrement à l’aide de la procédure suivante.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-166">To enable email confirmation, you'll modify the registration code using the following steps.</span></span>  
 

1. <span data-ttu-id="8b6ea-167">Dans le *compte* dossier, ouvrez le *Register.aspx.cs* code-behind et mettre à jour le `CreateUser_Click` méthode pour activer les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-167">In the *Account* folder, open the *Register.aspx.cs* code-behind and update the `CreateUser_Click` method to enable the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample4.cs?highlight=9-11)]
2. <span data-ttu-id="8b6ea-168">Dans **l’Explorateur de solutions**, avec le bouton droit *Default.aspx* et sélectionnez **définir comme Page de démarrage**.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-168">In **Solution Explorer**, right-click *Default.aspx* and select **Set As Start Page**.</span></span>
3. <span data-ttu-id="8b6ea-169">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="8b6ea-169">Run the app by pressing **F5.**</span></span> <span data-ttu-id="8b6ea-170">Une fois la page s’affiche, cliquez sur le **inscrire** lien pour afficher la page d’inscription.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-170">After the page is displayed, click the **Register** link to display the Register page.</span></span>
4. <span data-ttu-id="8b6ea-171">Entrez votre adresse électronique et un mot de passe, puis cliquez sur le **inscrire** bouton pour envoyer un message électronique via SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-171">Enter your email and password, then click the **Register** button to send an email message via SendGrid.</span></span>  
 <span data-ttu-id="8b6ea-172">L’état actuel de votre projet et le code permet à l’utilisateur pour se connecter une fois qu’elles terminent le formulaire d’inscription, même si elles n’ont pas confirmé son compte.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-172">The current state of your project and code will allow the user to log in once they complete the registration form, even though they haven't confirmed their account.</span></span>
5. <span data-ttu-id="8b6ea-173">Vérifiez votre compte de messagerie, puis cliquez sur le lien pour confirmer votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-173">Check your email account and click on the link to confirm your email.</span></span>  
 <span data-ttu-id="8b6ea-174">Une fois que vous envoyez le formulaire d’inscription, vous serez connecté.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-174">Once you submit the registration form, you will be logged in.</span></span>  
    ![Exemple de site Web - connecté](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/_static/image4.png)

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="8b6ea-176">Exigez une Confirmation par courrier électronique avant de journal dans</span><span class="sxs-lookup"><span data-stu-id="8b6ea-176">Require Email Confirmation Before Log In</span></span>

<span data-ttu-id="8b6ea-177">Bien que vous avez confirmé le compte de messagerie, à ce stade vous serez inutile de cliquer sur le lien contenu dans le message de vérification pour être complètement signé dans.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-177">Although you have confirmed the email account, at this point you would not need to click on the link contained in the verification email to be fully signed-in.</span></span> <span data-ttu-id="8b6ea-178">Dans la section suivante, vous allez modifier le code nécessitant de nouveaux utilisateurs pour qu’un message électronique de confirmation avant d’être enregistrées (authentifié).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-178">In the following section, you will modify the code requiring new users to have a confirmed email before they are logged in (authenticated).</span></span>

1. <span data-ttu-id="8b6ea-179">Dans **l’Explorateur de solutions** de Visual Studio, mettre à jour le `CreateUser_Click` événement dans le *Register.aspx.cs* code-behind contenu dans le *comptes* dossier avec le modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-179">In **Solution Explorer** of Visual Studio, update the `CreateUser_Click` event in the *Register.aspx.cs* code-behind contained in the *Accounts* folder with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample5.cs?highlight=13-14,17-21)]
2. <span data-ttu-id="8b6ea-180">Mise à jour la `LogIn` méthode dans le *Login.aspx.cs* code-behind avec les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-180">Update the `LogIn` method in the *Login.aspx.cs* code-behind with the following highlighted changes:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample6.cs?highlight=9-19,45-46)]

### <a name="run-the-application"></a><span data-ttu-id="8b6ea-181">Exécution de l'application</span><span class="sxs-lookup"><span data-stu-id="8b6ea-181">Run the Application</span></span>

 <span data-ttu-id="8b6ea-182">Maintenant que vous avez implémenté le code pour vérifier si l’adresse de messagerie d’un utilisateur a été confirmé, vous pouvez vérifier les fonctionnalités sur les deux le **inscrire** et **connexion** pages.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-182">Now that you have implemented the code to check whether a user's email address has been confirmed, you can check the functionality on both the **Register** and **Login** pages.</span></span> 

1. <span data-ttu-id="8b6ea-183">Supprimez tous les comptes dans le **AspNetUsers** table qui contient l’alias de messagerie électronique que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-183">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
2. <span data-ttu-id="8b6ea-184">Exécutez l’application (**F5**) et vérifiez que vous ne pouvez pas inscrire en tant qu’utilisateur jusqu'à ce que vous avez confirmé votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-184">Run the app (**F5**) and verify you cannot register as a user until you have confirmed your email address.</span></span>
3. <span data-ttu-id="8b6ea-185">Avant de confirmer votre nouveau compte via le message électronique qui a été envoyé uniquement, tentent de se connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-185">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="8b6ea-186">Vous verrez que vous ne parvenez pas à se connecter et que vous devez posséder un compte de messagerie confirmée.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-186">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span>
4. <span data-ttu-id="8b6ea-187">Après avoir confirmé votre adresse de messagerie, connectez-vous à l’application.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-187">Once you confirm your email address, log in to the app.</span></span>

<a id="reset"></a>
## <a name="password-recovery-and-reset"></a><span data-ttu-id="8b6ea-188">Réinitialisation et la récupération de mot de passe</span><span class="sxs-lookup"><span data-stu-id="8b6ea-188">Password Recovery and Reset</span></span>

1. <span data-ttu-id="8b6ea-189">Dans Visual Studio, supprimez les caractères de commentaire de la `Forgot` méthode dans le *Forgot.aspx.cs* code-behind contenu dans le *compte* dossier, afin que la méthode apparaît comme suit :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-189">In Visual Studio, remove the comment characters from the `Forgot` method in the *Forgot.aspx.cs* code-behind contained in the *Account* folder, so that the method appears as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample7.cs?highlight=16-18)]
2. <span data-ttu-id="8b6ea-190">Ouvrez le *Login.aspx* page.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-190">Open the *Login.aspx* page.</span></span> <span data-ttu-id="8b6ea-191">Remplacez le balisage à la fin de la **loginForm** section comme indiqué ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-191">Replace the markup near the end of the **loginForm** section as highlighted below:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample8.aspx?highlight=52-53)]
3. <span data-ttu-id="8b6ea-192">Ouvrez le *Login.aspx.cs* code-behind et supprimez les commentaires de la ligne suivante de code mis en surbrillance en jaune à partir de la `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-192">Open the *Login.aspx.cs* code-behind and uncomment the following line of code highlighted in yellow from the `Page_Load` event handler:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample9.cs?highlight=5)]
4. <span data-ttu-id="8b6ea-193">Exécutez l’application en appuyant sur **F5.**</span><span class="sxs-lookup"><span data-stu-id="8b6ea-193">Run the app by pressing **F5.**</span></span> <span data-ttu-id="8b6ea-194">Une fois la page s’affiche, cliquez sur le **connecter** lien.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-194">After the page is displayed, click the **Log in** link.</span></span>
5. <span data-ttu-id="8b6ea-195">Cliquez sur le **votre mot de passe oublié ?** lien pour afficher le **mot de passe oublié** page.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-195">Click the **Forgot your password?** link to display the **Forgot Password** page.</span></span>
6. <span data-ttu-id="8b6ea-196">Entrez votre adresse de messagerie, cliquez sur le **Submit** bouton pour envoyer un courrier électronique à votre adresse de ce qui vous permet de réinitialiser votre mot de passe.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-196">Enter your email address and click the **Submit** button to send an email to your address which will allow you to reset your password.</span></span>   
 <span data-ttu-id="8b6ea-197">Vérifiez votre compte de messagerie et cliquez sur le lien pour afficher le **réinitialiser le mot de passe** page.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-197">Check your email account and click on the link to display the **Reset Password** page.</span></span>
7. <span data-ttu-id="8b6ea-198">Sur le **réinitialiser le mot de passe** , entrez votre messagerie, le mot de passe et le mot de passe confirmé.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-198">On the **Reset Password** page, enter your email, password, and confirmed password.</span></span> <span data-ttu-id="8b6ea-199">Ensuite, appuyez sur la **réinitialiser** bouton.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-199">Then, press the **Reset** button.</span></span>  
 <span data-ttu-id="8b6ea-200">Quand vous réinitialisez votre mot de passe, le **mot de passe modifié** page s’affiche.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-200">When you successfully reset your password, the **Password Changed** page will be displayed.</span></span> <span data-ttu-id="8b6ea-201">Vous pouvez désormais vous connecter avec votre nouveau mot de passe.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-201">Now you can log in with your new password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="8b6ea-202">Renvoyer le lien de Confirmation par courrier électronique</span><span class="sxs-lookup"><span data-stu-id="8b6ea-202">Resend Email Confirmation Link</span></span>

<span data-ttu-id="8b6ea-203">Une fois qu’un utilisateur crée un nouveau compte local, elles sont envoyées par courrier électronique un lien de confirmation qu’ils doivent utiliser avant de se connecter.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-203">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="8b6ea-204">Si l’utilisateur accidentellement supprime le message de confirmation, ou le message électronique n’arrive jamais, ils doivent le lien de confirmation envoyé à nouveau.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-204">If the user accidently deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="8b6ea-205">Les modifications de code suivants montrent comment activer cette option.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-205">The following code changes show how to enable this.</span></span>

1. <span data-ttu-id="8b6ea-206">Dans Visual Studio, ouvrez le **Login.aspx.cs** code-behind et ajoutez le Gestionnaire d’événements suivant après le `LogIn` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-206">In Visual Studio, open the **Login.aspx.cs** code-behind and add the following event handler after the `LogIn` event handler:</span></span>   

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample10.cs)]
2. <span data-ttu-id="8b6ea-207">Modifier la `LogIn` Gestionnaire d’événements dans le *Login.aspx.cs* code-behind en modifiant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-207">Modify the `LogIn` event handler in the *Login.aspx.cs* code-behind by changing the code highlighted in yellow as follows:</span></span> 

    [!code-csharp[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample11.cs?highlight=15-17)]
3. <span data-ttu-id="8b6ea-208">Mise à jour la *Login.aspx* page en ajoutant le code mis en surbrillance en jaune comme suit :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-208">Update the *Login.aspx* page by adding the code highlighted in yellow as follows:</span></span> 

    [!code-aspx[Main](create-a-secure-aspnet-web-forms-app-with-user-registration-email-confirmation-and-password-reset/samples/sample12.aspx?highlight=45-46)]
4. <span data-ttu-id="8b6ea-209">Supprimez tous les comptes dans le **AspNetUsers** table qui contient l’alias de messagerie électronique que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-209">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test.</span></span>
5. <span data-ttu-id="8b6ea-210">Exécutez l’application (**F5**) et inscrire votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-210">Run the app (**F5**) and register your email address.</span></span>
6. <span data-ttu-id="8b6ea-211">Avant de confirmer votre nouveau compte via le message électronique qui a été envoyé uniquement, tentent de se connecter avec le nouveau compte.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-211">Before confirming your new account via the email that was just sent, attempt to log in with the new account.</span></span>  
 <span data-ttu-id="8b6ea-212">Vous verrez que vous ne parvenez pas à se connecter et que vous devez posséder un compte de messagerie confirmée.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-212">You'll see that you are unable to log in and that you must have a confirmed email account.</span></span> <span data-ttu-id="8b6ea-213">En outre, vous pouvez désormais renvoyer un message de confirmation à votre compte de messagerie.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-213">In addition, you can now resend a confirmation message to your email account.</span></span>
7. <span data-ttu-id="8b6ea-214">Entrez votre adresse de messagerie et le mot de passe, puis appuyez sur la **renvoyer de confirmation** bouton.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-214">Enter your email address and password, then press the **Resend confirmation** button.</span></span>
8. <span data-ttu-id="8b6ea-215">Après avoir confirmé votre adresse de messagerie basée sur le message électronique qui vient d’être envoyé, connectez-vous à l’application.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-215">Once you confirm your email address based on the newly sent email message, log in to the app.</span></span>

<a id="dbg"></a>
## <a name="troubleshooting-the-app"></a><span data-ttu-id="8b6ea-216">Résolution des problèmes de l’application</span><span class="sxs-lookup"><span data-stu-id="8b6ea-216">Troubleshooting the App</span></span>

<span data-ttu-id="8b6ea-217">Si vous ne recevez pas un message électronique contenant le lien pour vérifier vos informations d’identification :</span><span class="sxs-lookup"><span data-stu-id="8b6ea-217">If you don't receive an email containing the link to verify your credentials:</span></span>

- <span data-ttu-id="8b6ea-218">Vérifiez votre dossier courrier indésirable ou le courrier indésirable.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-218">Check your junk or spam folder.</span></span>
- <span data-ttu-id="8b6ea-219">Connectez-vous à votre compte SendGrid, puis cliquez sur le [lien de l’activité de messagerie](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="8b6ea-219">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>
- <span data-ttu-id="8b6ea-220">Être certain que vous avez utilisé le nom de votre compte d’utilisateur SendGrid comme un *Web.config* valeur plutôt que votre adresse de messagerie du compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="8b6ea-220">Be certain you used your SendGrid user account name as a *Web.config* value rather than your SendGrid account email address.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="8b6ea-221">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="8b6ea-221">Additional Resources</span></span>

- [<span data-ttu-id="8b6ea-222">Des liens vers ASP.NET Identity recommandé de ressources</span><span class="sxs-lookup"><span data-stu-id="8b6ea-222">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- [<span data-ttu-id="8b6ea-223">Confirmation du compte et la récupération de mot de passe avec l’identité de ASP.NET</span><span class="sxs-lookup"><span data-stu-id="8b6ea-223">Account Confirmation and Password Recovery with ASP.NET Identity</span></span>](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md)
- [<span data-ttu-id="8b6ea-224">Série de didacticiels ASP.NET Web Forms - ajouter un fournisseur d’OAuth 2.0</span><span class="sxs-lookup"><span data-stu-id="8b6ea-224">ASP.NET Web Forms tutorial series - Add an OAuth 2.0 Provider</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#OAuthWebForms)
- [<span data-ttu-id="8b6ea-225">Déployer une application de formulaires Web ASP.NET sécurisées avec l’appartenance, OAuth et base de données SQL dans Azure App Service</span><span class="sxs-lookup"><span data-stu-id="8b6ea-225">Deploy a Secure ASP.NET Web Forms App with Membership, OAuth, and SQL Database to Azure App Service</span></span>](https://azure.microsoft.com/documentation/articles/web-sites-dotnet-deploy-aspnet-webforms-app-membership-oauth-sql-database/)
- [<span data-ttu-id="8b6ea-226">Série de didacticiels Web Forms ASP.NET - activer SSL pour le projet</span><span class="sxs-lookup"><span data-stu-id="8b6ea-226">ASP.NET Web Forms tutorial series - Enable SSL for the Project</span></span>](../getting-started/getting-started-with-aspnet-45-web-forms/checkout-and-payment-with-paypal.md#SSLWebForms)
