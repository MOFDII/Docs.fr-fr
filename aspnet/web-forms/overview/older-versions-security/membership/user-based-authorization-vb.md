---
uid: web-forms/overview/older-versions-security/membership/user-based-authorization-vb
title: Autorisation basée sur l’utilisateur (VB) | Documents Microsoft
author: rick-anderson
description: Dans ce didacticiel, nous allons examiner la limitation de l’accès aux pages et en limitant les fonctionnalités au niveau de la page par le biais de diverses techniques.
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/18/2008
ms.topic: article
ms.assetid: bc937e9d-5c14-4fc4-aec7-440da924dd18
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/membership/user-based-authorization-vb
msc.type: authoredcontent
ms.openlocfilehash: 4073f349c7965a89b39a4b1b672f0e84fc96f287
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/10/2018
ms.locfileid: "30891943"
---
<a name="user-based-authorization-vb"></a><span data-ttu-id="e2c07-103">Autorisation basée sur l’utilisateur (VB)</span><span class="sxs-lookup"><span data-stu-id="e2c07-103">User-Based Authorization (VB)</span></span>
====================
<span data-ttu-id="e2c07-104">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="e2c07-104">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="e2c07-105">[Télécharger le Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) ou [télécharger le PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span><span class="sxs-lookup"><span data-stu-id="e2c07-105">[Download Code](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/ASPNET_Security_Tutorial_07_VB.zip) or [Download PDF](http://download.microsoft.com/download/3/f/5/3f5a8605-c526-4b34-b3fd-a34167117633/aspnet_tutorial07_UserAuth_vb.pdf)</span></span>

> <span data-ttu-id="e2c07-106">Dans ce didacticiel, nous allons examiner la limitation de l’accès aux pages et en limitant les fonctionnalités au niveau de la page par le biais de diverses techniques.</span><span class="sxs-lookup"><span data-stu-id="e2c07-106">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span>


## <a name="introduction"></a><span data-ttu-id="e2c07-107">Introduction</span><span class="sxs-lookup"><span data-stu-id="e2c07-107">Introduction</span></span>

<span data-ttu-id="e2c07-108">La plupart des applications web qui offrent des comptes d’utilisateur de le faire dans la partie de restreindre certains visiteurs d’accéder à certaines pages du site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-108">Most web applications that offer user accounts do so in part to restrict certain visitors from accessing certain pages within the site.</span></span> <span data-ttu-id="e2c07-109">Dans les sites messageboard plus en ligne, par exemple, tous les utilisateurs - anonymes ou authentifiés - sont en mesure d’afficher les publications de la messageboard, mais seuls les utilisateurs authentifiés peuvent visiter la page web pour créer une nouvelle publication.</span><span class="sxs-lookup"><span data-stu-id="e2c07-109">In most online messageboard sites, for example, all users - anonymous and authenticated - are able to view the messageboard's posts, but only authenticated users can visit the web page to create a new post.</span></span> <span data-ttu-id="e2c07-110">Et il peut y avoir des pages d’administration qui sont uniquement accessibles à un utilisateur particulier (ou un ensemble particulier d’utilisateurs).</span><span class="sxs-lookup"><span data-stu-id="e2c07-110">And there may be administrative pages that are only accessible to a particular user (or a particular set of users).</span></span> <span data-ttu-id="e2c07-111">En outre, les fonctionnalités au niveau de la page peuvent être différent sur une base par utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-111">Moreover, page-level functionality can differ on a user-by-user basis.</span></span> <span data-ttu-id="e2c07-112">Lorsque vous affichez une liste des publications, les utilisateurs authentifiés sont affichés une interface d’évaluation de chaque publication, tandis que cette interface n’est pas disponible pour les visiteurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-112">When viewing a list of posts, authenticated users are shown an interface for rating each post, whereas this interface is not available to anonymous visitors.</span></span>

<span data-ttu-id="e2c07-113">ASP.NET rend facile de définir des règles d’autorisation basées sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-113">ASP.NET makes it easy to define user-based authorization rules.</span></span> <span data-ttu-id="e2c07-114">Avec juste un peu de balisage dans `Web.config`, des pages web spécifiques ou des répertoires entiers peuvent être verrouillés afin qu’ils soient uniquement accessibles à un sous-ensemble spécifié d’utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-114">With just a bit of markup in `Web.config`, specific web pages or entire directories can be locked down so that they are only accessible to a specified subset of users.</span></span> <span data-ttu-id="e2c07-115">Les fonctionnalités au niveau des pages peuvent être activées ou désactivés en fonction de l’utilisateur actuellement connecté par des moyens déclaratives et par programmation.</span><span class="sxs-lookup"><span data-stu-id="e2c07-115">Page-level functionality can be turned on or off based on the currently logged in user through programmatic and declarative means.</span></span>

<span data-ttu-id="e2c07-116">Dans ce didacticiel, nous allons examiner la limitation de l’accès aux pages et en limitant les fonctionnalités au niveau de la page par le biais de diverses techniques.</span><span class="sxs-lookup"><span data-stu-id="e2c07-116">In this tutorial we will look at limiting access to pages and restricting page-level functionality through a variety of techniques.</span></span> <span data-ttu-id="e2c07-117">C’est parti !</span><span class="sxs-lookup"><span data-stu-id="e2c07-117">Let's get started!</span></span>

## <a name="a-look-at-the-url-authorization-workflow"></a><span data-ttu-id="e2c07-118">Examiner le flux de travail d’autorisation URL</span><span class="sxs-lookup"><span data-stu-id="e2c07-118">A Look at the URL Authorization Workflow</span></span>

<span data-ttu-id="e2c07-119">Comme indiqué dans le [ *une vue d’ensemble de l’authentification par formulaire* ](../introduction/an-overview-of-forms-authentication-vb.md) (didacticiel), lorsque le runtime ASP.NET traite une demande pour une ressource ASP.NET la demande déclenche un nombre d’événements pendant son cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="e2c07-119">As discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, when the ASP.NET runtime processes a request for an ASP.NET resource the request raises a number of events during its lifecycle.</span></span> <span data-ttu-id="e2c07-120">*Les Modules HTTP* sont des classes managées dont le code est exécuté en réponse à un événement spécifique dans le cycle de vie de demande.</span><span class="sxs-lookup"><span data-stu-id="e2c07-120">*HTTP Modules* are managed classes whose code is executed in response to a particular event in the request lifecycle.</span></span> <span data-ttu-id="e2c07-121">ASP.NET est fourni avec un nombre de Modules HTTP qui effectuent des tâches essentielles en arrière-plan.</span><span class="sxs-lookup"><span data-stu-id="e2c07-121">ASP.NET ships with a number of HTTP Modules that perform essential tasks behind the scenes.</span></span>

<span data-ttu-id="e2c07-122">Un tel HTTP Module est [ `FormsAuthenticationModule` ](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span><span class="sxs-lookup"><span data-stu-id="e2c07-122">One such HTTP Module is [`FormsAuthenticationModule`](https://msdn.microsoft.com/library/system.web.security.formsauthenticationmodule.aspx).</span></span> <span data-ttu-id="e2c07-123">Comme indiqué dans les didacticiels précédents, la fonction principale de la `FormsAuthenticationModule` consiste à déterminer l’identité de la requête actuelle.</span><span class="sxs-lookup"><span data-stu-id="e2c07-123">As discussed in previous tutorials, the primary function of the `FormsAuthenticationModule` is to determine the identity of the current request.</span></span> <span data-ttu-id="e2c07-124">Cela s’effectue en inspectant le ticket d’authentification forms, qui est situé dans un cookie ou incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="e2c07-124">This is accomplished by inspecting the forms authentication ticket, which is either located in a cookie or embedded within the URL.</span></span> <span data-ttu-id="e2c07-125">Cette identification se produit pendant la [ `AuthenticateRequest` événement](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span><span class="sxs-lookup"><span data-stu-id="e2c07-125">This identification takes place during the [`AuthenticateRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx).</span></span>

<span data-ttu-id="e2c07-126">Un autre HTTP Module important est le [ `UrlAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), qui est déclenché en réponse à la [ `AuthorizeRequest` événement](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (ce qui se produit après la `AuthenticateRequest` événement).</span><span class="sxs-lookup"><span data-stu-id="e2c07-126">Another important HTTP Module is the [`UrlAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx), which is raised in response to the [`AuthorizeRequest` event](https://msdn.microsoft.com/library/system.web.httpapplication.authorizerequest.aspx) (which happens after the `AuthenticateRequest` event).</span></span> <span data-ttu-id="e2c07-127">Le `UrlAuthorizationModule` examine le balisage de configuration dans `Web.config` pour déterminer si l’identité actuelle a autorité à visiter la page spécifiée.</span><span class="sxs-lookup"><span data-stu-id="e2c07-127">The `UrlAuthorizationModule` examines configuration markup in `Web.config` to determine whether the current identity has authority to visit the specified page.</span></span> <span data-ttu-id="e2c07-128">Ce processus est appelé *l’autorisation d’URL*.</span><span class="sxs-lookup"><span data-stu-id="e2c07-128">This process is referred to as *URL authorization*.</span></span>

<span data-ttu-id="e2c07-129">Nous allons examiner la syntaxe pour les règles de l’autorisation d’URL à l’étape 1, mais tout d’abord nous allons examiner ce qui le `UrlAuthorizationModule` est selon si la demande est autorisée ou non.</span><span class="sxs-lookup"><span data-stu-id="e2c07-129">We'll examine the syntax for the URL authorization rules in Step 1, but first let's look at what the `UrlAuthorizationModule` does depending on whether the request is authorized or not.</span></span> <span data-ttu-id="e2c07-130">Si le `UrlAuthorizationModule` détermine que la demande est autorisée, puis elle ne fait rien et la demande se poursuit jusqu'à son cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="e2c07-130">If the `UrlAuthorizationModule` determines that the request is authorized, then it does nothing, and the request continues through its lifecycle.</span></span> <span data-ttu-id="e2c07-131">Toutefois, si la demande est *pas* autorisé, puis le `UrlAuthorizationModule` abandonne le cycle de vie et fait en sorte que le `Response` objet à retourner un [HTTP 401 non autorisé](http://www.checkupdown.com/status/E401.html) état.</span><span class="sxs-lookup"><span data-stu-id="e2c07-131">However, if the request is *not* authorized, then the `UrlAuthorizationModule` aborts the lifecycle and instructs the `Response` object to return an [HTTP 401 Unauthorized](http://www.checkupdown.com/status/E401.html) status.</span></span> <span data-ttu-id="e2c07-132">Lorsque vous utilisez l’authentification par formulaire cet état HTTP 401 n’est jamais retourné au client, car si le `FormsAuthenticationModule` détecte un HTTP 401 est de l’état modifie un [HTTP de redirection 302](http://www.checkupdown.com/status/E302.html) à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-132">When using forms authentication this HTTP 401 status is never returned to the client because if the `FormsAuthenticationModule` detects an HTTP 401 status is modifies it to an [HTTP 302 Redirect](http://www.checkupdown.com/status/E302.html) to the login page.</span></span>

<span data-ttu-id="e2c07-133">La figure 1 illustre le flux de travail du pipeline ASP.NET, le `FormsAuthenticationModule`et le `UrlAuthorizationModule` lorsqu’une requête non autorisée arrive.</span><span class="sxs-lookup"><span data-stu-id="e2c07-133">Figure 1 illustrates the workflow of the ASP.NET pipeline, the `FormsAuthenticationModule`, and the `UrlAuthorizationModule` when an unauthorized request arrives.</span></span> <span data-ttu-id="e2c07-134">En particulier, la Figure 1 illustre une demande émise par un visiteur anonyme pour `ProtectedPage.aspx`, qui est une page qui refuse l’accès aux utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-134">In particular, Figure 1 shows a request by an anonymous visitor for `ProtectedPage.aspx`, which is a page that denies access to anonymous users.</span></span> <span data-ttu-id="e2c07-135">Étant donné que le visiteur est anonyme, le `UrlAuthorizationModule` interrompt la requête et retourne un état HTTP 401 non autorisé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-135">Since the visitor is anonymous, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="e2c07-136">Le `FormsAuthenticationModule` convertit ensuite l’état 401 une redirection 302 vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-136">The `FormsAuthenticationModule` then converts the 401 status into a 302 Redirect to login page.</span></span> <span data-ttu-id="e2c07-137">Une fois que l’utilisateur est authentifié par la page de connexion, il est redirigé vers `ProtectedPage.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-137">After the user is authenticated via the login page, he is redirected to `ProtectedPage.aspx`.</span></span> <span data-ttu-id="e2c07-138">Cette fois le `FormsAuthenticationModule` identifie l’utilisateur en fonction de son ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="e2c07-138">This time the `FormsAuthenticationModule` identifies the user based on his authentication ticket.</span></span> <span data-ttu-id="e2c07-139">Maintenant que l’utilisateur est authentifié, le `UrlAuthorizationModule` permet l’accès à la page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-139">Now that the visitor is authenticated, the `UrlAuthorizationModule` permits access to the page.</span></span>


<span data-ttu-id="e2c07-140">[![L’authentification par formulaire et le Workflow de l’autorisation d’URL](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-140">[![The Forms Authentication and URL Authorization Workflow](user-based-authorization-vb/_static/image2.png)](user-based-authorization-vb/_static/image1.png)</span></span>

<span data-ttu-id="e2c07-141">**Figure 1**: l’authentification de formulaires et de flux de travail URL d’autorisation ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-141">**Figure 1**: The Forms Authentication and URL Authorization Workflow  ([Click to view full-size image](user-based-authorization-vb/_static/image3.png))</span></span>


<span data-ttu-id="e2c07-142">La figure 1 illustre l’interaction qui se produit lorsqu’un visiteur anonyme tente d’accéder à une ressource qui n’est pas disponible aux utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-142">Figure 1 depicts the interaction that occurs when an anonymous visitor attempts to access a resource that is not available to anonymous users.</span></span> <span data-ttu-id="e2c07-143">Dans ce cas, le visiteur anonyme est redirigé vers la page de connexion avec la page, qu'elle a tenté de visiter spécifié dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="e2c07-143">In such a case, the anonymous visitor is redirected to the login page with the page she attempted to visit specified in the querystring.</span></span> <span data-ttu-id="e2c07-144">Une fois que l’utilisateur se connecte, elle sera automatiquement redirigée vers la ressource, qu'elle a été initialement tentez de consulter.</span><span class="sxs-lookup"><span data-stu-id="e2c07-144">Once the user has successfully logged on, she will be automatically redirected back to the resource she was initially attempting to view.</span></span>

<span data-ttu-id="e2c07-145">Lorsque la demande non autorisée est effectuée par un utilisateur anonyme, ce flux de travail est simple et facile pour le visiteur de comprendre ce qui est arrivé et pourquoi.</span><span class="sxs-lookup"><span data-stu-id="e2c07-145">When the unauthorized request is made by an anonymous user, this workflow is straightforward and is easy for the visitor to understand what has happened and why.</span></span> <span data-ttu-id="e2c07-146">Mais gardez à l’esprit que le `FormsAuthenticationModule` redirige *tout* non autorisé d’utilisateur de la page de connexion, même si la demande est effectuée par un utilisateur authentifié.</span><span class="sxs-lookup"><span data-stu-id="e2c07-146">But keep in mind that the `FormsAuthenticationModule` will redirect *any* unauthorized user to the login page, even if the request is made by an authenticated user.</span></span> <span data-ttu-id="e2c07-147">Cela peut entraîner une expérience utilisateur à confusion si un utilisateur authentifié tente de visiter une page pour laquelle il ne dispose pas d’autorité.</span><span class="sxs-lookup"><span data-stu-id="e2c07-147">This can result in a confusing user experience if an authenticated user attempts to visit a page for which she lacks authority.</span></span>

<span data-ttu-id="e2c07-148">Imaginez que le site Web contenait ses règles d’autorisation de URL configurées telles que la page ASP.NET `OnlyTito.aspx` était accessible uniquement aux Tito.</span><span class="sxs-lookup"><span data-stu-id="e2c07-148">Imagine that our website had its URL authorization rules configured such that the ASP.NET page `OnlyTito.aspx` was accessibly only to Tito.</span></span> <span data-ttu-id="e2c07-149">Maintenant, imaginez que Sam visite le site, ouvre une session, puis tente de visiter `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-149">Now, imagine that Sam visits the site, logs on, and then attempts to visit `OnlyTito.aspx`.</span></span> <span data-ttu-id="e2c07-150">Le `UrlAuthorizationModule` arrêtera le cycle de vie de requête et retourner un état HTTP 401 non autorisé, ce qui le `FormsAuthenticationModule` détectera et puis rediriger Sam vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-150">The `UrlAuthorizationModule` will halt the request lifecycle and return an HTTP 401 Unauthorized status, which the `FormsAuthenticationModule` will detect and then redirect Sam to the login page.</span></span> <span data-ttu-id="e2c07-151">Étant donné que Sam est déjà connecté, cependant, elle demandez peut-être pourquoi elle a été envoyée à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-151">Since Sam has already logged in, though, she may wonder why she has been sent back to the login page.</span></span> <span data-ttu-id="e2c07-152">Elle peut la raison que ses informations d’identification ont été perdues une certaine manière, ou qu’elle entré les informations d’identification non valides.</span><span class="sxs-lookup"><span data-stu-id="e2c07-152">She might reason that her login credentials were lost somehow, or that she entered invalid credentials.</span></span> <span data-ttu-id="e2c07-153">Si Sam entrent à nouveau dans ses informations d’identification à partir de la page de connexion qu’elle sera connectée (nouveau) et redirigée vers `OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-153">If Sam reenters her credentials from the login page she will be logged on (again) and redirected to `OnlyTito.aspx`.</span></span> <span data-ttu-id="e2c07-154">Le `UrlAuthorizationModule` détectera que Sam ne peut pas visitez cette page, et elle s’affichera à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-154">The `UrlAuthorizationModule` will detect that Sam cannot visit this page and she will be returned to the login page.</span></span>

<span data-ttu-id="e2c07-155">La figure 2 illustre ce flux de travail à confusion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-155">Figure 2 depicts this confusing workflow.</span></span>


<span data-ttu-id="e2c07-156">[![Le flux de travail par défaut peut entraîner un Cycle à confusion](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-156">[![The Default Workflow Can Lead to a Confusing Cycle](user-based-authorization-vb/_static/image5.png)](user-based-authorization-vb/_static/image4.png)</span></span>

<span data-ttu-id="e2c07-157">**Figure 2**: le par défaut du flux de travail peut entraîner un Cycle de confusion ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-157">**Figure 2**: The Default Workflow Can Lead to a Confusing Cycle  ([Click to view full-size image](user-based-authorization-vb/_static/image6.png))</span></span>


<span data-ttu-id="e2c07-158">Le workflow illustré dans la Figure 2 peut befuddle rapidement même la plupart des ordinateurs expérimenté visiteur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-158">The workflow illustrated in Figure 2 can quickly befuddle even the most computer savvy visitor.</span></span> <span data-ttu-id="e2c07-159">Nous allons examiner comment éviter cela déroutant cycle à l’étape 2.</span><span class="sxs-lookup"><span data-stu-id="e2c07-159">We will look at ways to prevent this confusing cycle in Step 2.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-160">ASP.NET utilise deux mécanismes pour déterminer si l’utilisateur actuel peut accéder à une page web spécifique : l’autorisation d’URL et l’autorisation de fichier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-160">ASP.NET uses two mechanisms to determine whether the current user can access a particular web page: URL authorization and file authorization.</span></span> <span data-ttu-id="e2c07-161">L’autorisation de fichier est implémentée par le [ `FileAuthorizationModule` ](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), qui détermine l’autorité en consultant les ou les fichiers requis ACL.</span><span class="sxs-lookup"><span data-stu-id="e2c07-161">File authorization is implemented by the [`FileAuthorizationModule`](https://msdn.microsoft.com/library/system.web.security.fileauthorizationmodule.aspx), which determines authority by consulting the requested file(s) ACLs.</span></span> <span data-ttu-id="e2c07-162">L’autorisation de fichier est plus couramment utilisée avec l’authentification Windows, car les ACL sont des autorisations qui s’appliquent aux comptes Windows.</span><span class="sxs-lookup"><span data-stu-id="e2c07-162">File authorization is most commonly used with Windows authentication because ACLs are permissions that apply to Windows accounts.</span></span> <span data-ttu-id="e2c07-163">Lorsque vous utilisez l’authentification par formulaire, toutes les demandes de niveau système système d’exploitation et le fichier sont exécutées par le même compte Windows, quel que soit l’utilisateur visite le site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-163">When using forms authentication, all operating system- and file system-level requests are executed by the same Windows account, regardless of the user visiting the site.</span></span> <span data-ttu-id="e2c07-164">Étant donné que cette série de didacticiels se concentre sur l’authentification par formulaire, nous ne décrivons pas l’autorisation de fichier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-164">Since this tutorial series focuses on forms authentication, we will not be discussing file authorization.</span></span>


### <a name="the-scope-of-url-authorization"></a><span data-ttu-id="e2c07-165">L’étendue d’autorisation d’URL</span><span class="sxs-lookup"><span data-stu-id="e2c07-165">The Scope of URL Authorization</span></span>

<span data-ttu-id="e2c07-166">Le `UrlAuthorizationModule` est du code managé qui fait partie du runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e2c07-166">The `UrlAuthorizationModule` is managed code that is part of the ASP.NET runtime.</span></span> <span data-ttu-id="e2c07-167">Avant la version 7 de Microsoft [Internet Information Services (IIS)](https://www.iis.net/) serveur web, il était une barrière distincte entre le pipeline HTTP de d’IIS et le pipeline du runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e2c07-167">Prior to version 7 of Microsoft's [Internet Information Services (IIS)](https://www.iis.net/) web server, there was a distinct barrier between IIS's HTTP pipeline and the ASP.NET runtime's pipeline.</span></span> <span data-ttu-id="e2c07-168">En résumé, dans IIS 6 et versions antérieures, ASP. De NET `UrlAuthorizationModule` s’exécute uniquement lorsqu’une demande est déléguée à partir de IIS à l’exécution d’ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e2c07-168">In short, in IIS 6 and earlier, ASP.NET's `UrlAuthorizationModule` only executes when a request is delegated from IIS to the ASP.NET runtime.</span></span> <span data-ttu-id="e2c07-169">Par défaut, IIS traite le contenu statique lui-même - telles que des pages HTML et CSS, JavaScript et les fichiers image - et transmet uniquement les demandes pour le runtime ASP.NET lorsqu’une page avec une extension `.aspx`, `.asmx`, ou `.ashx` est demandé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-169">By default, IIS processes static content itself - like HTML pages and CSS, JavaScript, and image files - and only hands off requests to the ASP.NET runtime when a page with an extension of `.aspx`, `.asmx`, or `.ashx` is requested.</span></span>

<span data-ttu-id="e2c07-170">IIS 7, toutefois, permet intégré IIS et ASP.NET pipelines.</span><span class="sxs-lookup"><span data-stu-id="e2c07-170">IIS 7, however, allows for integrated IIS and ASP.NET pipelines.</span></span> <span data-ttu-id="e2c07-171">Avec quelques paramètres de configuration, vous pouvez configurer IIS 7 pour appeler le `UrlAuthorizationModule` pour *tous les* demandes, c'est-à-dire que les règles d’autorisation d’URL peuvent être définies pour les fichiers de n’importe quel type.</span><span class="sxs-lookup"><span data-stu-id="e2c07-171">With a few configuration settings you can setup IIS 7 to invoke the `UrlAuthorizationModule` for *all* requests, meaning that URL authorization rules can be defined for files of any type.</span></span> <span data-ttu-id="e2c07-172">En outre, IIS 7 inclut son propre moteur d’autorisation d’URL.</span><span class="sxs-lookup"><span data-stu-id="e2c07-172">Additionally, IIS 7 includes its own URL authorization engine.</span></span> <span data-ttu-id="e2c07-173">Pour plus d’informations sur l’intégration d’ASP.NET et les fonctionnalités d’autorisation URL native d’IIS 7, consultez [comprendre l’autorisation d’URL IIS7](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span><span class="sxs-lookup"><span data-stu-id="e2c07-173">For more information on ASP.NET integration and IIS 7's native URL authorization functionality, see [Understanding IIS7 URL Authorization](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization).</span></span> <span data-ttu-id="e2c07-174">Pour une plus approfondies sur l’intégration d’ASP.NET et IIS 7, ils récupèrent une copie du livre de Shahram Khosravi *Professionnel IIS 7 et ASP.NET intégré programmation* (ISBN : 978-0470152539).</span><span class="sxs-lookup"><span data-stu-id="e2c07-174">For a more in-depth look at ASP.NET and IIS 7 integration, pick up a copy of Shahram Khosravi's book, *Professional IIS 7 and ASP.NET Integrated Programming* (ISBN: 978-0470152539).</span></span>

<span data-ttu-id="e2c07-175">En résumé, dans les versions antérieures d’IIS 7, règles d’autorisation d’URL sont appliquées uniquement aux ressources gérées par le runtime ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e2c07-175">In a nutshell, in versions prior to IIS 7, URL authorization rules are only applied to resources handled by the ASP.NET runtime.</span></span> <span data-ttu-id="e2c07-176">Mais avec IIS 7, il est possible d’utiliser native fonctionnalité de l’autorisation d’URL d’IIS ou intégrer ASP. De NET `UrlAuthorizationModule` dans le pipeline HTTP d’IIS ainsi étendre cette fonctionnalité pour toutes les demandes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-176">But with IIS 7 it is possible to use IIS's native URL authorization feature or to integrate ASP.NET's `UrlAuthorizationModule` into IIS's HTTP pipeline, thereby extending this functionality to all requests.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-177">Il existe des différences subtiles néanmoins importantes dans la manière dont ASP. Du NET `UrlAuthorizationModule` et la fonctionnalité de l’autorisation d’URL IIS 7 traiter les règles d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="e2c07-177">There are some subtle yet important differences in how ASP.NET's `UrlAuthorizationModule` and IIS 7's URL authorization feature process the authorization rules.</span></span> <span data-ttu-id="e2c07-178">Ce didacticiel n’examine pas les fonctionnalités d’autorisation d’URL IIS 7 ou les différences dans la façon dont il analyse les règles d’autorisation par rapport à la `UrlAuthorizationModule`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-178">This tutorial does not examine IIS 7's URL authorization functionality or the differences in how it parses authorization rules compared to the `UrlAuthorizationModule`.</span></span> <span data-ttu-id="e2c07-179">Pour plus d’informations sur ces sujets, reportez-vous à la documentation de IIS 7 sur MSDN ou à [www.iis.net](https://www.iis.net/).</span><span class="sxs-lookup"><span data-stu-id="e2c07-179">For more information on these topics, refer to the IIS 7 documentation on MSDN or at [www.iis.net](https://www.iis.net/).</span></span>


## <a name="step-1-defining-url-authorization-rules-inwebconfig"></a><span data-ttu-id="e2c07-180">Étape 1 : Définir des règles d’autorisation d’URL dans`Web.config`</span><span class="sxs-lookup"><span data-stu-id="e2c07-180">Step 1: Defining URL Authorization Rules in`Web.config`</span></span>

<span data-ttu-id="e2c07-181">Le `UrlAuthorizationModule` détermine s’il faut accorder ou refuser l’accès à une ressource demandée pour une identité particulière en fonction des règles d’autorisation URL définis dans la configuration de l’application.</span><span class="sxs-lookup"><span data-stu-id="e2c07-181">The `UrlAuthorizationModule` determines whether to grant or deny access to a requested resource for a particular identity based on the URL authorization rules defined in the application's configuration.</span></span> <span data-ttu-id="e2c07-182">Les règles d’autorisation sont précisés dans le [ `<authorization>` élément](https://msdn.microsoft.com/library/8d82143t.aspx) sous la forme de `<allow>` et `<deny>` des éléments enfants.</span><span class="sxs-lookup"><span data-stu-id="e2c07-182">The authorization rules are spelled out in the [`<authorization>` element](https://msdn.microsoft.com/library/8d82143t.aspx) in the form of `<allow>` and `<deny>` child elements.</span></span> <span data-ttu-id="e2c07-183">Chaque `<allow>` et `<deny>` élément enfant peut spécifier :</span><span class="sxs-lookup"><span data-stu-id="e2c07-183">Each `<allow>` and `<deny>` child element can specify:</span></span>

- <span data-ttu-id="e2c07-184">Un utilisateur particulier</span><span class="sxs-lookup"><span data-stu-id="e2c07-184">A particular user</span></span>
- <span data-ttu-id="e2c07-185">Une liste délimitée par des virgules des utilisateurs</span><span class="sxs-lookup"><span data-stu-id="e2c07-185">A comma-delimited list of users</span></span>
- <span data-ttu-id="e2c07-186">Tous les utilisateurs anonymes, représentées par un point d’interrogation ( ?)</span><span class="sxs-lookup"><span data-stu-id="e2c07-186">All anonymous users, denoted by a question mark (?)</span></span>
- <span data-ttu-id="e2c07-187">Tous les utilisateurs, signalés par un astérisque (\*)</span><span class="sxs-lookup"><span data-stu-id="e2c07-187">All users, denoted by an asterisk (\*)</span></span>

<span data-ttu-id="e2c07-188">Le balisage suivant illustre comment utiliser les règles d’autorisation d’URL pour autoriser les utilisateurs Tito et Scott et refuser tous les autres :</span><span class="sxs-lookup"><span data-stu-id="e2c07-188">The following markup illustrates how to use the URL authorization rules to allow users Tito and Scott and deny all others:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample1.xml)]

<span data-ttu-id="e2c07-189">Le `<allow>` élément définit ce que les utilisateurs sont autorisés - Tito et Scott - tandis que le `<deny>` élément qui fait en sorte que *tous les* refusé aux utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-189">The `<allow>` element defines what users are permitted - Tito and Scott - while the `<deny>` element instructs that *all* users are denied.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-190">Le `<allow>` et `<deny>` éléments peuvent également spécifier des règles d’autorisation pour les rôles.</span><span class="sxs-lookup"><span data-stu-id="e2c07-190">The `<allow>` and `<deny>` elements can also specify authorization rules for roles.</span></span> <span data-ttu-id="e2c07-191">Nous allons examiner l’autorisation basée sur les rôles dans un didacticiel futures.</span><span class="sxs-lookup"><span data-stu-id="e2c07-191">We will examine role-based authorization in a future tutorial.</span></span>


<span data-ttu-id="e2c07-192">Le paramètre suivant accorde l’accès à une autre personne que Sam (y compris les visiteurs anonymes) :</span><span class="sxs-lookup"><span data-stu-id="e2c07-192">The following setting grants access to anyone other than Sam (including anonymous visitors):</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample2.xml)]

<span data-ttu-id="e2c07-193">Pour autoriser uniquement les utilisateurs authentifiés, utilisez la configuration suivante, qui refuse l’accès à tous les utilisateurs anonymes :</span><span class="sxs-lookup"><span data-stu-id="e2c07-193">To allow only authenticated users, use the following configuration, which denies access to all anonymous users:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample3.xml)]

<span data-ttu-id="e2c07-194">Les règles d’autorisation sont définis dans le `<system.web>` élément `Web.config` et s’appliquent à toutes les ressources dans l’application web ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="e2c07-194">The authorization rules are defined within the `<system.web>` element in `Web.config` and apply to all of the ASP.NET resources in the web application.</span></span> <span data-ttu-id="e2c07-195">Souvent, une application possède des règles d’autorisation différentes pour différentes sections.</span><span class="sxs-lookup"><span data-stu-id="e2c07-195">Oftentimes, an application has different authorization rules for different sections.</span></span> <span data-ttu-id="e2c07-196">Par exemple, sur un site de commerce électronique, tous les visiteurs peuvent consulter les produits, consultez les évaluations de produits, le catalogue de recherche et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="e2c07-196">For example, at an eCommerce site, all visitors may peruse the products, see product reviews, search the catalog, and so on.</span></span> <span data-ttu-id="e2c07-197">Toutefois, seuls les utilisateurs authentifiés peuvent atteindre la récupération ou les pages pour gérer l’historique de l’envoi.</span><span class="sxs-lookup"><span data-stu-id="e2c07-197">However, only authenticated users may reach the checkout or the pages to manage one's shipping history.</span></span> <span data-ttu-id="e2c07-198">En outre, il peut y avoir des portions du site qui sont uniquement accessibles par sélectionner les utilisateurs, telles que les administrateurs de site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-198">Moreover, there may be portions of the site that are only accessible by select users, such as site administrators.</span></span>

<span data-ttu-id="e2c07-199">ASP.NET rend facile de définir des règles d’autorisation différentes pour différents fichiers et dossiers sur le site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-199">ASP.NET makes it easy to define different authorization rules for different files and folders in the site.</span></span> <span data-ttu-id="e2c07-200">Les règles d’autorisation spécifiés dans le dossier racine `Web.config` fichier s’appliquent à toutes les ressources ASP.NET dans le site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-200">The authorization rules specified in the root folder's `Web.config` file apply to all ASP.NET resources in the site.</span></span> <span data-ttu-id="e2c07-201">Toutefois, ces paramètres d’autorisation par défaut peuvent être substitués pour un dossier spécifique en ajoutant un `Web.config` avec un `<authorization>` section.</span><span class="sxs-lookup"><span data-stu-id="e2c07-201">However, these default authorization settings can be overridden for a particular folder by adding a `Web.config` with an `<authorization>` section.</span></span>

<span data-ttu-id="e2c07-202">Nous allons mettre à jour notre site Web afin que seuls les utilisateurs authentifiés peuvent visiter les pages ASP.NET dans le `Membership` dossier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-202">Let's update our website so that only authenticated users can visit the ASP.NET pages in the `Membership` folder.</span></span> <span data-ttu-id="e2c07-203">Pour cela nous devons ajouter une `Web.config` le fichier le `Membership` dossier et définissez ses paramètres d’autorisation Refuser à des utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-203">To accomplish this we need to add a `Web.config` file to the `Membership` folder and set its authorization settings to deny anonymous users.</span></span> <span data-ttu-id="e2c07-204">Cliquez sur le `Membership` dossier dans l’Explorateur de solutions, choisissez le menu Ajouter un nouvel élément dans le menu contextuel, ajoutez un nouveau fichier de Configuration Web nommé `Web.config`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-204">Right-click the `Membership` folder in the Solution Explorer, choose the Add New Item menu from the context menu, and add a new Web Configuration File named `Web.config`.</span></span>


<span data-ttu-id="e2c07-205">[![Ajouter un fichier Web.config dans le dossier de l’appartenance](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-205">[![Add a Web.config File to the Membership Folder](user-based-authorization-vb/_static/image8.png)](user-based-authorization-vb/_static/image7.png)</span></span>

<span data-ttu-id="e2c07-206">**Figure 3**: ajouter un `Web.config` de fichiers à la `Membership` dossier ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-206">**Figure 3**: Add a `Web.config` File to the `Membership` Folder  ([Click to view full-size image](user-based-authorization-vb/_static/image9.png))</span></span>


<span data-ttu-id="e2c07-207">À ce stade votre projet doit contenir deux `Web.config` fichiers : un dans le répertoire racine et l’autre dans le `Membership` dossier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-207">At this point your project should contain two `Web.config` files: one in the root directory and one in the `Membership` folder.</span></span>


<span data-ttu-id="e2c07-208">[![Votre Application doit maintenant contenir deux fichiers Web.config](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-208">[![Your Application Should Now Contain Two Web.config Files](user-based-authorization-vb/_static/image11.png)](user-based-authorization-vb/_static/image10.png)</span></span>

<span data-ttu-id="e2c07-209">**Figure 4**: votre Application doit maintenant contenir deux `Web.config` fichiers ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-209">**Figure 4**: Your Application Should Now Contain Two `Web.config` Files  ([Click to view full-size image](user-based-authorization-vb/_static/image12.png))</span></span>


<span data-ttu-id="e2c07-210">Mettre à jour le fichier de configuration dans le `Membership` dossier afin qu’il interdit l’accès aux utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-210">Update the configuration file in the `Membership` folder so that it prohibits access to anonymous users.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample4.xml)]

<span data-ttu-id="e2c07-211">C’est tout cela !</span><span class="sxs-lookup"><span data-stu-id="e2c07-211">That's all there is to it!</span></span>

<span data-ttu-id="e2c07-212">Pour tester cette modification, visitez la page d’accueil dans un navigateur et vérifiez que vous êtes connecté. Étant donné que le comportement par défaut d’une application ASP.NET consiste à autoriser tous les visiteurs, et étant donné que nous n’avez pas apporter de modifications d’autorisation à la racine du `Web.config` fichier, nous sommes en mesure de consulter les fichiers dans le répertoire racine en tant qu’un visiteur anonyme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-212">To test out this change, visit the homepage in a browser and make sure you are logged out. Since the default behavior of an ASP.NET application is to allow all visitors, and since we didn't make any authorization modifications to the root directory's `Web.config` file, we are able to visit the files in the root directory as an anonymous visitor.</span></span>

<span data-ttu-id="e2c07-213">Cliquez sur le lien de création de comptes d’utilisateur trouvé dans la colonne de gauche.</span><span class="sxs-lookup"><span data-stu-id="e2c07-213">Click on the Creating User Accounts link found in the left column.</span></span> <span data-ttu-id="e2c07-214">Vous accéderez à la `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-214">This will take you to the `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="e2c07-215">Étant donné que la `Web.config` de fichiers dans le `Membership` dossier définit des règles d’autorisation pour interdire l’accès anonyme, la `UrlAuthorizationModule` interrompt la requête et retourne un état HTTP 401 non autorisé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-215">Since the `Web.config` file in the `Membership` folder defines authorization rules to prohibit anonymous access, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="e2c07-216">Le `FormsAuthenticationModule` modifie cet aspect à un état de redirection 302, nous envoyer à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-216">The `FormsAuthenticationModule` modifies this to a 302 Redirect status, sending us to the login page.</span></span> <span data-ttu-id="e2c07-217">Notez que la page nous étions tente d’accéder à (`CreatingUserAccounts.aspx`) est passée à la page de connexion via le `ReturnUrl` paramètre querystring.</span><span class="sxs-lookup"><span data-stu-id="e2c07-217">Note that the page we were attempting to access (`CreatingUserAccounts.aspx`) is passed to the login page via the `ReturnUrl` querystring parameter.</span></span>


<span data-ttu-id="e2c07-218">[![Depuis l’URL d’autorisation règles interdire l’accès anonyme, nous allons redirigés vers la Page de connexion](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-218">[![Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page](user-based-authorization-vb/_static/image14.png)](user-based-authorization-vb/_static/image13.png)</span></span>

<span data-ttu-id="e2c07-219">**Figure 5**: étant donné que l’autorisation d’URL règles interdire l’accès anonyme, nous allons redirigés vers la Page de connexion ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-219">**Figure 5**: Since the URL Authorization Rules Prohibit Anonymous Access, We are Redirected to the Login Page  ([Click to view full-size image](user-based-authorization-vb/_static/image15.png))</span></span>


<span data-ttu-id="e2c07-220">Lors de la connexion avec succès, nous allons redirigés vers le `CreatingUserAccounts.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-220">Upon successfully logging in, we are redirected to the `CreatingUserAccounts.aspx` page.</span></span> <span data-ttu-id="e2c07-221">Cette fois le `UrlAuthorizationModule` permet l’accès à la page, car nous ne sont plus anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-221">This time the `UrlAuthorizationModule` permits access to the page because we are no longer anonymous.</span></span>

### <a name="applying-url-authorization-rules-to-a-specific-location"></a><span data-ttu-id="e2c07-222">Application des règles d’autorisation d’URL à un emplacement spécifique</span><span class="sxs-lookup"><span data-stu-id="e2c07-222">Applying URL Authorization Rules to a Specific Location</span></span>

<span data-ttu-id="e2c07-223">Les paramètres d’autorisation définis dans le `<system.web>` section de `Web.config` s’appliquent à toutes les ressources ASP.NET dans ce répertoire et ses sous-répertoires (jusqu'à ce que sinon substituée par un autre `Web.config` fichier).</span><span class="sxs-lookup"><span data-stu-id="e2c07-223">The authorization settings defined in the `<system.web>` section of `Web.config` apply to all of the ASP.NET resources in that directory and its subdirectories (until otherwise overridden by another `Web.config` file).</span></span> <span data-ttu-id="e2c07-224">Cependant, dans certains cas, nous voulons que toutes les ressources ASP.NET dans un répertoire ayant une configuration d’autorisation spécifique à l’exception d’une ou deux pages spécifiques.</span><span class="sxs-lookup"><span data-stu-id="e2c07-224">In some cases, though, we may want all ASP.NET resources in a given directory to have a particular authorization configuration except for one or two specific pages.</span></span> <span data-ttu-id="e2c07-225">Cela peut être obtenue en ajoutant un `<location>` élément `Web.config`, qu’il pointe vers le fichier dont les règles d’autorisation sont différents et définir ses règles d’autorisation unique dans celui-ci.</span><span class="sxs-lookup"><span data-stu-id="e2c07-225">This can be achieved by adding a `<location>` element in `Web.config`, pointing it to the file whose authorization rules differ, and defining its unique authorization rules therein.</span></span>

<span data-ttu-id="e2c07-226">Pour illustrer l’utilisation de la `<location>` élément remplacent les paramètres de configuration pour une ressource spécifique, nous allons personnaliser les paramètres d’autorisation afin que seuls Tito peut visiter `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-226">To illustrate using the `<location>` element to override the configuration settings for a specific resource, let's customize the authorization settings so that only Tito can visit `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="e2c07-227">Pour ce faire, ajoutez un `<location>` élément à la `Membership` du dossier `Web.config` de fichiers et de mettre à jour de son balisage afin qu’il ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e2c07-227">To accomplish this, add a `<location>` element to the `Membership` folder's `Web.config` file and update its markup so that it looks like the following:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample5.xml)]

<span data-ttu-id="e2c07-228">Le `<authorization>` élément `<system.web>` définit les règles d’autorisation URL par défaut pour les ressources ASP.NET dans le `Membership` dossier et ses sous-dossiers.</span><span class="sxs-lookup"><span data-stu-id="e2c07-228">The `<authorization>` element in `<system.web>` defines the default URL authorization rules for ASP.NET resources in the `Membership` folder and its subfolders.</span></span> <span data-ttu-id="e2c07-229">Le `<location>` élément permet de remplacer ces règles pour une ressource particulière.</span><span class="sxs-lookup"><span data-stu-id="e2c07-229">The `<location>` element allows us to override these rules for a particular resource.</span></span> <span data-ttu-id="e2c07-230">Dans le balisage ci-dessus le `<location>` références de l’élément le `CreatingUserAccounts.aspx` page et spécifie son autorisation règles telle que Tito, mais refuser tout le monde.</span><span class="sxs-lookup"><span data-stu-id="e2c07-230">In the above markup the `<location>` element references the `CreatingUserAccounts.aspx` page and specifies its authorization rules such as to allow Tito, but deny everyone else.</span></span>

<span data-ttu-id="e2c07-231">Pour tester cette modification d’autorisation, démarrez en visitant le site Web en tant qu’utilisateur anonyme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-231">To test out this authorization change, start by visiting the website as an anonymous user.</span></span> <span data-ttu-id="e2c07-232">Si vous essayez de visiter une page dans le `Membership` dossier, tel que `UserBasedAuthorization.aspx`, le `UrlAuthorizationModule` refuse la demande et vous allez être redirigé vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-232">If you attempt to visit any page in the `Membership` folder, such as `UserBasedAuthorization.aspx`, the `UrlAuthorizationModule` will deny the request and you will be redirected to the login page.</span></span> <span data-ttu-id="e2c07-233">Une fois connecté, comme par exemple, Scott, vous pouvez visiter n’importe quelle page dans le `Membership` dossier *sauf* pour `CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-233">After logging in as, say, Scott, you can visit any page in the `Membership` folder *except* for `CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="e2c07-234">Tentative de visiter `CreatingUserAccounts.aspx` connecté en tant que tout le monde mais Tito entraîne une tentative d’accès non autorisé, vous rediriger vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-234">Attempting to visit `CreatingUserAccounts.aspx` logged on as anyone but Tito will result in an unauthorized access attempt, redirecting you back to the login page.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-235">Le `<location>` doit apparaître en dehors de la configuration du `<system.web>` élément.</span><span class="sxs-lookup"><span data-stu-id="e2c07-235">The `<location>` element must appear outside of the configuration's `<system.web>` element.</span></span> <span data-ttu-id="e2c07-236">Vous devez recourir à un `<location>` élément pour chaque ressource dont vous souhaitez remplacer les paramètres d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="e2c07-236">You need to use a separate `<location>` element for each resource whose authorization settings you want to override.</span></span>


### <a name="a-look-at-how-theurlauthorizationmoduleuses-the-authorization-rules-to-grant-or-deny-access"></a><span data-ttu-id="e2c07-237">Regardez comment la`UrlAuthorizationModule`utilise les règles d’autorisation pour accorder ou refuser l’accès</span><span class="sxs-lookup"><span data-stu-id="e2c07-237">A Look at How the`UrlAuthorizationModule`Uses the Authorization Rules to Grant or Deny Access</span></span>

<span data-ttu-id="e2c07-238">Le `UrlAuthorizationModule` détermine si pour autoriser une identité particulière d’une URL particulière en analysant l’autorisation d’URL des règles à la fois, en commençant à partir du premier et l’utilisation de sa manière vers le bas.</span><span class="sxs-lookup"><span data-stu-id="e2c07-238">The `UrlAuthorizationModule` determines whether to authorize a particular identity for a particular URL by analyzing the URL authorization rules one at a time, starting from the first one and working its way down.</span></span> <span data-ttu-id="e2c07-239">Dès qu’une correspondance est trouvée, l’utilisateur est accordé ou refusé, selon que la correspondance a été trouvée dans un `<allow>` ou `<deny>` élément.</span><span class="sxs-lookup"><span data-stu-id="e2c07-239">As soon as a match is found, the user is granted or denied access, depending on if the match was found in an `<allow>` or `<deny>` element.</span></span> <span data-ttu-id="e2c07-240"><strong>Si aucune correspondance n’est trouvée, l’utilisateur est autorisé à accéder.</strong></span><span class="sxs-lookup"><span data-stu-id="e2c07-240"><strong>If no match is found, the user is granted access.</strong></span></span> <span data-ttu-id="e2c07-241">Par conséquent, si vous souhaitez restreindre l’accès, il est impératif d’utiliser un `<deny>` élément comme dernier élément dans la configuration de l’autorisation d’URL.</span><span class="sxs-lookup"><span data-stu-id="e2c07-241">Consequently, if you want to restrict access, it is imperative that you use a `<deny>` element as the last element in the URL authorization configuration.</span></span> <span data-ttu-id="e2c07-242"><strong>Si vous omettez un</strong><strong>`<deny>`</strong><strong>élément, tous les utilisateurs auront accès.</strong></span><span class="sxs-lookup"><span data-stu-id="e2c07-242"><strong>If you omit a</strong><strong>`<deny>`</strong><strong>element, all users will be granted access.</strong></span></span>

<span data-ttu-id="e2c07-243">Pour mieux comprendre le processus utilisé par le `UrlAuthorizationModule` pour déterminer l’autorité, prenons l’exemple de règles d’autorisation d’URL, nous avons étudié plus haut dans cette étape.</span><span class="sxs-lookup"><span data-stu-id="e2c07-243">To better understand the process used by the `UrlAuthorizationModule` to determine authority, consider the example URL authorization rules we looked at earlier in this step.</span></span> <span data-ttu-id="e2c07-244">La première règle est un `<allow>` élément qui permet d’accéder à Tito et Scott.</span><span class="sxs-lookup"><span data-stu-id="e2c07-244">The first rule is an `<allow>` element that allows access to Tito and Scott.</span></span> <span data-ttu-id="e2c07-245">Les règles des deuxième est un `<deny>` élément qui refuse l’accès à tout le monde.</span><span class="sxs-lookup"><span data-stu-id="e2c07-245">The second rules is a `<deny>` element that denies access to everyone.</span></span> <span data-ttu-id="e2c07-246">Si la visite d’un utilisateur anonyme, le `UrlAuthorizationModule` commence par la demande, est anonyme Scott ou Tito ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-246">If an anonymous user visits, the `UrlAuthorizationModule` starts by asking, Is anonymous either Scott or Tito?</span></span> <span data-ttu-id="e2c07-247">La réponse est évidemment, non, il se poursuit pour la deuxième règle.</span><span class="sxs-lookup"><span data-stu-id="e2c07-247">The answer, obviously, is No, so it proceeds to the second rule.</span></span> <span data-ttu-id="e2c07-248">Est anonyme dans l’ensemble de tout le monde ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-248">Is anonymous in the set of everybody?</span></span> <span data-ttu-id="e2c07-249">Depuis la réponse est Oui, le `<deny>` règle est placée en vigueur et de l’utilisateur est redirigé vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-249">Since the answer here is Yes, the `<deny>` rule is put in effect and the visitor is redirected to the login page.</span></span> <span data-ttu-id="e2c07-250">De même, si la visite de Jisun, le `UrlAuthorizationModule` commence par la demande, est le Jisun Scott ou Tito ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-250">Similarly, if Jisun is visiting, the `UrlAuthorizationModule` starts by asking, Is Jisun either Scott or Tito?</span></span> <span data-ttu-id="e2c07-251">Dans la mesure où elle n’est pas, la `UrlAuthorizationModule` passe à la deuxième question, est de Jisun dans l’ensemble de tout le monde ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-251">Since she is not, the `UrlAuthorizationModule` proceeds to the second question, Is Jisun in the set of everybody?</span></span> <span data-ttu-id="e2c07-252">Elle est, elle, trop, l’accès est refusée.</span><span class="sxs-lookup"><span data-stu-id="e2c07-252">She is, so she, too, is denied access.</span></span> <span data-ttu-id="e2c07-253">Enfin, si Tito visite, la première question posé par la `UrlAuthorizationModule` étant une réponse affirmative, Tito est autorisé à accéder.</span><span class="sxs-lookup"><span data-stu-id="e2c07-253">Finally, if Tito visits, the first question posed by the `UrlAuthorizationModule` is an affirmative answer, so Tito is granted access.</span></span>

<span data-ttu-id="e2c07-254">Étant donné que la `UrlAuthorizationModule` processus de l’autorisation de règles à partir du haut vers le bas, l’arrêt à n’importe quel type de correspondance, il est important que les règles les plus spécifiques précéder les moins spécifiques.</span><span class="sxs-lookup"><span data-stu-id="e2c07-254">Since the `UrlAuthorizationModule` processes the authorization rules from the top down, stopping at any match, it is important to have the more specific rules come before the less specific ones.</span></span> <span data-ttu-id="e2c07-255">Autrement dit, pour définir des règles d’autorisation qui interdit pas Jisun et les utilisateurs anonymes, mais autorisent tous les autres utilisateurs authentifiés, vous démarrer avec la règle la plus spécifique - Jisun ayant un effet sur un seul - et alors les règles les moins spécifiques - celles permettant de tous les autres les utilisateurs authentifiés, mais le refus de tous les utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-255">That is, to define authorization rules that forbid Jisun and anonymous users, but allow all other authenticated users, you would start with the most specific rule - the one impacting Jisun - and then proceed to the less specific rules - those allowing all other authenticated users, but denying all anonymous users.</span></span> <span data-ttu-id="e2c07-256">Les règles d’autorisation URL suivants implémente cette stratégie en refus Jisun d’abord, puis en refuser tout utilisateur anonyme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-256">The following URL authorization rules implements this policy by first denying Jisun, and then denying any anonymous user.</span></span> <span data-ttu-id="e2c07-257">Tout utilisateur authentifié que Jisun est autorisé, car aucune de ces `<deny>` instructions correspondra.</span><span class="sxs-lookup"><span data-stu-id="e2c07-257">Any authenticated user other than Jisun will be granted access because neither of these `<deny>` statements will match.</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample6.xml)]

## <a name="step-2-fixing-the-workflow-for-unauthorized-authenticated-users"></a><span data-ttu-id="e2c07-258">Étape 2 : Résolution du flux de travail pour les utilisateurs non autorisés, authentifiées</span><span class="sxs-lookup"><span data-stu-id="e2c07-258">Step 2: Fixing the Workflow for Unauthorized, Authenticated Users</span></span>

<span data-ttu-id="e2c07-259">Comme expliqué précédemment dans ce didacticiel dans le A Examinez la section de Workflow de l’autorisation d’URL, à tout moment une requête non autorisée apparaît, le `UrlAuthorizationModule` interrompt la requête et retourne un état HTTP 401 non autorisé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-259">As we discussed earlier in this tutorial in the A Look at the URL Authorization Workflow section, anytime an unauthorized request transpires, the `UrlAuthorizationModule` aborts the request and returns an HTTP 401 Unauthorized status.</span></span> <span data-ttu-id="e2c07-260">Cet état 401 est modifié par le `FormsAuthenticationModule` dans un 302 rediriger l’état qui envoie à l’utilisateur à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-260">This 401 status is modified by the `FormsAuthenticationModule` into a 302 Redirect status that sends the user to the login page.</span></span> <span data-ttu-id="e2c07-261">Ce flux de travail se produit sur toute demande non autorisée, même si l’utilisateur est authentifié.</span><span class="sxs-lookup"><span data-stu-id="e2c07-261">This workflow occurs on any unauthorized request, even if the user is authenticated.</span></span>

<span data-ttu-id="e2c07-262">Retour d’un utilisateur authentifié à la page de connexion est susceptible de les confondre, car ils ont déjà connecté au système.</span><span class="sxs-lookup"><span data-stu-id="e2c07-262">Returning an authenticated user to the login page is likely to confuse them since they have already logged into the system.</span></span> <span data-ttu-id="e2c07-263">Avec un peu de travail, nous pouvons améliorer ce flux de travail en redirigeant les utilisateurs authentifiés, qui effectuent des demandes non autorisées à une page qui explique qu’ils ont essayé d’accéder à une page à accès restreint.</span><span class="sxs-lookup"><span data-stu-id="e2c07-263">With a little bit of work we can improve this workflow by redirecting authenticated users who make unauthorized requests to a page that explains that they have attempted to access a restricted page.</span></span>

<span data-ttu-id="e2c07-264">Commencez par créer une nouvelle page ASP.NET dans le dossier racine de l’application web nommé `UnauthorizedAccess.aspx`; n’oubliez pas d’associer cette page avec le `Site.master` page maître.</span><span class="sxs-lookup"><span data-stu-id="e2c07-264">Start by creating a new ASP.NET page in the web application's root folder named `UnauthorizedAccess.aspx`; don't forget to associate this page with the `Site.master` master page.</span></span> <span data-ttu-id="e2c07-265">Après la création de cette page, supprimez le contrôle de contenu qui fait référence à la `LoginContent` ContentPlaceHolder afin que la page maître contenu par défaut s’affichera.</span><span class="sxs-lookup"><span data-stu-id="e2c07-265">After creating this page, remove the Content control that references the `LoginContent` ContentPlaceHolder so that the master page's default content will be displayed.</span></span> <span data-ttu-id="e2c07-266">Ensuite, ajoutez un message qui explique la situation, à savoir que l’utilisateur a tenté d’accéder à une ressource protégée.</span><span class="sxs-lookup"><span data-stu-id="e2c07-266">Next, add a message that explains the situation, namely that the user attempted to access a protected resource.</span></span> <span data-ttu-id="e2c07-267">Après avoir ajouté un tel message, le `UnauthorizedAccess.aspx` balisage déclaratif de la page doit ressembler à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="e2c07-267">After adding such a message, the `UnauthorizedAccess.aspx` page's declarative markup should look similar to the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample7.aspx)]

<span data-ttu-id="e2c07-268">Nous devons maintenant modifier le flux de travail afin que si une requête non autorisée est effectuée par un utilisateur authentifié, elles sont envoyées à la `UnauthorizedAccess.aspx` page au lieu de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-268">We now need to alter the workflow so that if an unauthorized request is performed by an authenticated user they are sent to the `UnauthorizedAccess.aspx` page instead of the login page.</span></span> <span data-ttu-id="e2c07-269">La logique qui redirige les demandes non autorisées vers la page de connexion est comprise dans une méthode privée de la `FormsAuthenticationModule` classe, afin que nous ne pouvons pas personnaliser ce comportement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-269">The logic that redirects unauthorized requests to the login page is buried within a private method of the `FormsAuthenticationModule` class, so we cannot customize this behavior.</span></span> <span data-ttu-id="e2c07-270">Ce que nous pouvons faire, toutefois, consiste à ajouter un notre propre logique pour la page de connexion qui redirige l’utilisateur à `UnauthorizedAccess.aspx`, si nécessaire.</span><span class="sxs-lookup"><span data-stu-id="e2c07-270">What we can do, however, is add our own logic to the login page that redirects the user to `UnauthorizedAccess.aspx`, if needed.</span></span>

<span data-ttu-id="e2c07-271">Lorsque le `FormsAuthenticationModule` redirige un visiteur non autorisé à la page de connexion, il ajoute l’URL demandée, non autorisé à la chaîne de requête avec le nom `ReturnUrl`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-271">When the `FormsAuthenticationModule` redirects an unauthorized visitor to the login page it appends the requested, unauthorized URL to the querystring with the name `ReturnUrl`.</span></span> <span data-ttu-id="e2c07-272">Par exemple, si un utilisateur non autorisé a tenté de visiter `OnlyTito.aspx`, le `FormsAuthenticationModule` redirige vers `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-272">For example, if an unauthorized user attempted to visit `OnlyTito.aspx`, the `FormsAuthenticationModule` would redirect them to `Login.aspx?ReturnUrl=OnlyTito.aspx`.</span></span> <span data-ttu-id="e2c07-273">Par conséquent, si la page de connexion a été atteint par un utilisateur authentifié avec une chaîne de requête qui inclut la `ReturnUrl` paramètre, puis nous savoir que cet utilisateur non authentifié a tenté de simplement à visiter une page, elle n’est pas autorisée à afficher.</span><span class="sxs-lookup"><span data-stu-id="e2c07-273">Therefore, if the login page is reached by an authenticated user with a querystring that includes the `ReturnUrl` parameter, then we know that this unauthenticated user just attempted to visit a page she is not authorized to view.</span></span> <span data-ttu-id="e2c07-274">Dans ce cas, nous souhaitons lui permet de rediriger `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-274">In such a case, we want to redirect her to `UnauthorizedAccess.aspx`.</span></span>

<span data-ttu-id="e2c07-275">Pour ce faire, ajoutez le code suivant à la page de connexion `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="e2c07-275">To accomplish this, add the following code to the login page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample8.vb)]

<span data-ttu-id="e2c07-276">Le code ci-dessus redirige les utilisateurs authentifiés, non autorisés au `UnauthorizedAccess.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-276">The above code redirects authenticated, unauthorized users to the `UnauthorizedAccess.aspx` page.</span></span> <span data-ttu-id="e2c07-277">Pour voir cette logique dans action, visitez le site en tant qu’un visiteur anonyme, puis cliquez sur le lien de création de comptes utilisateur dans la colonne de gauche.</span><span class="sxs-lookup"><span data-stu-id="e2c07-277">To see this logic in action, visit the site as an anonymous visitor and click on the Creating User Accounts link in the left column.</span></span> <span data-ttu-id="e2c07-278">Vous accéderez à la `~/Membership/CreatingUserAccounts.aspx` page qui, à l’étape 1, nous avons configuré uniquement autoriser l’accès à Tito.</span><span class="sxs-lookup"><span data-stu-id="e2c07-278">This will take you to the `~/Membership/CreatingUserAccounts.aspx` page, which in Step 1 we configured to only permit access to Tito.</span></span> <span data-ttu-id="e2c07-279">Étant donné que les utilisateurs anonymes sont interdites, le `FormsAuthenticationModule` nous redirige vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-279">Since anonymous users are prohibited, the `FormsAuthenticationModule` redirects us back to the login page.</span></span>

<span data-ttu-id="e2c07-280">À ce stade, nous sont anonymes, de sorte que `Request.IsAuthenticated` retourne `False` et nous ne sommes pas redirigés vers `UnauthorizedAccess.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-280">At this point we are anonymous, so `Request.IsAuthenticated` returns `False` and we are not redirected to `UnauthorizedAccess.aspx`.</span></span> <span data-ttu-id="e2c07-281">Au lieu de cela, la page de connexion s’affiche.</span><span class="sxs-lookup"><span data-stu-id="e2c07-281">Instead, the login page is displayed.</span></span> <span data-ttu-id="e2c07-282">Ouvrez une session en tant qu’utilisateur autre que Tito, telles que Bruce.</span><span class="sxs-lookup"><span data-stu-id="e2c07-282">Log in as a user other than Tito, such as Bruce.</span></span> <span data-ttu-id="e2c07-283">Après avoir entré les informations d’identification appropriées, la page de connexion nous redirige vers `~/Membership/CreatingUserAccounts.aspx`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-283">After entering the appropriate credentials, the login page redirects us back to `~/Membership/CreatingUserAccounts.aspx`.</span></span> <span data-ttu-id="e2c07-284">Toutefois, étant donné que cette page est uniquement accessible aux Tito, nous sont non autorisés pour l’afficher et sont directement retournés à la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-284">However, since this page is only accessible to Tito, we are unauthorized to view it and are promptly returned to the login page.</span></span> <span data-ttu-id="e2c07-285">Cette fois, toutefois, `Request.IsAuthenticated` retourne `True` (et `ReturnUrl` paramètre querystring existe), de sorte que nous sommes redirigés vers le `UnauthorizedAccess.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-285">This time, however, `Request.IsAuthenticated` returns `True` (and the `ReturnUrl` querystring parameter exists), so we are redirected to the `UnauthorizedAccess.aspx` page.</span></span>


<span data-ttu-id="e2c07-286">[![Authentifié, les utilisateurs non autorisés sont redirigées vers UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-286">[![Authenticated, Unauthorized Users are Redirected to UnauthorizedAccess.aspx](user-based-authorization-vb/_static/image17.png)](user-based-authorization-vb/_static/image16.png)</span></span>

<span data-ttu-id="e2c07-287">**Figure 6**: authentifié, les utilisateurs non autorisés sont redirigées vers `UnauthorizedAccess.aspx` ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-287">**Figure 6**: Authenticated, Unauthorized Users are Redirected to `UnauthorizedAccess.aspx` ([Click to view full-size image](user-based-authorization-vb/_static/image18.png))</span></span>


<span data-ttu-id="e2c07-288">Ce flux de travail personnalisé présente une expérience utilisateur plus simple et pratique court-circuit le cycle mentionné dans la Figure 2.</span><span class="sxs-lookup"><span data-stu-id="e2c07-288">This customized workflow presents a more sensible and straightforward user experience by short circuiting the cycle depicted in Figure 2.</span></span>

## <a name="step-3-limiting-functionality-based-on-the-currently-logged-in-user"></a><span data-ttu-id="e2c07-289">Étape 3 : Limitant les fonctionnalités en fonction de l’utilisateur actuellement connecté</span><span class="sxs-lookup"><span data-stu-id="e2c07-289">Step 3: Limiting Functionality Based on the Currently Logged In User</span></span>

<span data-ttu-id="e2c07-290">Autorisation d’URL rend facile de spécifier des règles d’autorisation grossière.</span><span class="sxs-lookup"><span data-stu-id="e2c07-290">URL authorization makes it easy to specify coarse authorization rules.</span></span> <span data-ttu-id="e2c07-291">Comme nous l’avons vu à l’étape 1, avec l’autorisation d’URL nous pouvons succincte les identités sont autorisées et ceux non autorisés à afficher une page spécifique ou toutes les pages dans un dossier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-291">As we saw in Step 1, with URL authorization we can succinctly state what identities are permitted and which ones are denied from viewing a particular page or all pages in a folder.</span></span> <span data-ttu-id="e2c07-292">Toutefois, dans certains scénarios, nous pouvons adopter autoriser tous les utilisateurs à visiter une page, mais limiter les fonctionnalités de la page en fonction de l’utilisateur à visiter.</span><span class="sxs-lookup"><span data-stu-id="e2c07-292">In certain scenarios, however, we may want to allow all users to visit a page, but limit the page's functionality based on the user visiting it.</span></span>

<span data-ttu-id="e2c07-293">Prenons le cas d’un site Web de commerce électronique qui permet des visiteurs authentifiés passer en revue leurs produits.</span><span class="sxs-lookup"><span data-stu-id="e2c07-293">Consider the case of an eCommerce website that allows authenticated visitors to review their products.</span></span> <span data-ttu-id="e2c07-294">Lorsqu’un utilisateur anonyme visite la page d’un produit, ils visualiserez uniquement les informations de produit et la possibilité de laisser une revue pas est données.</span><span class="sxs-lookup"><span data-stu-id="e2c07-294">When an anonymous user visits a product's page, they would see just the product information and would not be given the opportunity to leave a review.</span></span> <span data-ttu-id="e2c07-295">Toutefois, un utilisateur authentifié sur la même page verriez l’interface de révision.</span><span class="sxs-lookup"><span data-stu-id="e2c07-295">However, an authenticated user visiting the same page would see the reviewing interface.</span></span> <span data-ttu-id="e2c07-296">Si l’utilisateur authentifié n’a pas encore consulté ce produit, l’interface leur permettant de soumettre une révision ; dans le cas contraire, il serait les afficher leur révision précédemment soumis.</span><span class="sxs-lookup"><span data-stu-id="e2c07-296">If the authenticated user had not yet reviewed this product, the interface would enable them to submit a review; otherwise it would show them their previously-submitted review.</span></span> <span data-ttu-id="e2c07-297">Pour prendre ce scénario en outre, la page du produit peut afficher des informations supplémentaires et offrent des fonctionnalités étendues pour les utilisateurs qui travaillent pour la société de commerce électronique.</span><span class="sxs-lookup"><span data-stu-id="e2c07-297">To take this scenario a step further, the product page might show additional information and offer extended features for those users that work for the eCommerce company.</span></span> <span data-ttu-id="e2c07-298">Par exemple, la page du produit peut répertorier l’inventaire en stock et incluent des options pour modifier le prix du produit et une description lorsque visité par un employé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-298">For example, the product page might list the inventory in stock and include options to edit the product's price and description when visited by an employee.</span></span>

<span data-ttu-id="e2c07-299">Ces règles d’autorisation de granularité fine peuvent être implémentés de façon déclarative ou par programme (ou via une combinaison des deux).</span><span class="sxs-lookup"><span data-stu-id="e2c07-299">Such fine grain authorization rules can be implemented either declaratively or programmatically (or through some combination of the two).</span></span> <span data-ttu-id="e2c07-300">Dans la section suivante, nous verrons comment implémenter l’autorisation de granularité fine via le contrôle LoginView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-300">In the next section we will see how to implement fine grain authorization via the LoginView control.</span></span> <span data-ttu-id="e2c07-301">Après cela, nous allons examiner les techniques de programmation.</span><span class="sxs-lookup"><span data-stu-id="e2c07-301">Following that, we will explore programmatic techniques.</span></span> <span data-ttu-id="e2c07-302">Avant que nous pouvons examiner d’appliquer des règles d’autorisation de granularité fine, toutefois, nous devez d’abord créer une page dont la fonctionnalité dépend de l’utilisateur à visiter.</span><span class="sxs-lookup"><span data-stu-id="e2c07-302">Before we can look at applying fine grain authorization rules, however, we first need to create a page whose functionality depends on the user visiting it.</span></span>

<span data-ttu-id="e2c07-303">Nous allons créer une page qui répertorie les fichiers dans un répertoire particulier dans un GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-303">Let's create a page that lists the files in a particular directory within a GridView.</span></span> <span data-ttu-id="e2c07-304">En même temps que l’affichage de la liste nom de chaque fichier, de taille et d’autres informations, le contrôle GridView inclut deux colonnes de LinkButton : un intitulé vue et supprimez intitulé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-304">Along with listing each file's name, size, and other information, the GridView will include two columns of LinkButtons: one titled View and one titled Delete.</span></span> <span data-ttu-id="e2c07-305">Si un clic sur le bouton de lien de vue, le contenu du fichier sélectionné s’affichera ; Si l’utilisateur clique sur le bouton de lien Supprimer, le fichier sera supprimé.</span><span class="sxs-lookup"><span data-stu-id="e2c07-305">If the View LinkButton is clicked, the contents of the selected file will be displayed; if the Delete LinkButton is clicked, the file will be deleted.</span></span> <span data-ttu-id="e2c07-306">Nous allons créer initialement cette page de telle sorte que ses fonctionnalités d’affichage et de suppression ne soient disponible pour tous les utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-306">Let's initially create this page such that its view and delete functionality is available to all users.</span></span> <span data-ttu-id="e2c07-307">Dans la les sections de contrôle LoginView et limitant par programme les fonctionnalités que nous allons voir comment activer ou désactiver ces fonctionnalités en fonction de l’utilisateur sur la page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-307">In the Using the LoginView Control and Programmatically Limiting Functionality sections we will see how to enable or disable these features based on the user visiting the page.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-308">Nous sommes sur le point de créer la page ASP.NET utilise un contrôle GridView pour afficher une liste de fichiers.</span><span class="sxs-lookup"><span data-stu-id="e2c07-308">The ASP.NET page we are about to build uses a GridView control to display a list of files.</span></span> <span data-ttu-id="e2c07-309">Depuis ce didacticiel série se concentre sur l’authentification par formulaire, l’autorisation, les comptes d’utilisateurs et rôles, je ne souhaite pas passer trop de temps d’aborder le fonctionnement interne du contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-309">Since this tutorial series focuses on forms authentication, authorization, user accounts, and roles, I do not want to spend too much time discussing the inner workings of the GridView control.</span></span> <span data-ttu-id="e2c07-310">Alors que ce didacticiel fournit des instructions spécifiques pour la configuration de cette page, il ne pas étudier en détail pourquoi certains choix ont été apportées, ou ce qui ont les propriétés particulières d’effet sur la sortie rendue.</span><span class="sxs-lookup"><span data-stu-id="e2c07-310">While this tutorial provides specific step-by-step instructions for setting up this page, it does not delve into the details of why certain choices were made, or what effect particular properties have on the rendered output.</span></span> <span data-ttu-id="e2c07-311">Pour un examen approfondi du contrôle GridView, consultez Mes *[utilisation des données dans ASP.NET 2.0](../../data-access/index.md)* série de didacticiels.</span><span class="sxs-lookup"><span data-stu-id="e2c07-311">For a thorough examination of the GridView control, consult my *[Working with Data in ASP.NET 2.0](../../data-access/index.md)* tutorial series.</span></span>


<span data-ttu-id="e2c07-312">Commencez par ouvrir le `UserBasedAuthorization.aspx` de fichiers dans le `Membership` dossier et l’ajout d’un contrôle GridView à la page nommée `FilesGrid`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-312">Start by opening the `UserBasedAuthorization.aspx` file in the `Membership` folder and adding a GridView control to the page named `FilesGrid`.</span></span> <span data-ttu-id="e2c07-313">À partir de la balise de GridView, cliquez sur le lien Modifier les colonnes pour ouvrir la boîte de dialogue champs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-313">From the GridView's Smart Tag, click the Edit Columns link to launch the Fields dialog box.</span></span> <span data-ttu-id="e2c07-314">À ce stade, désactivez les générer automatiquement des champs dans l’angle inférieur gauche.</span><span class="sxs-lookup"><span data-stu-id="e2c07-314">From here, uncheck the Auto-generate fields checkbox in the lower left corner.</span></span> <span data-ttu-id="e2c07-315">Ensuite, ajoutez un bouton de sélection et deux BoundFields un bouton Supprimer à partir de l’angle supérieur gauche (les boutons Sélectionner et supprimer se trouve dans le type CommandField).</span><span class="sxs-lookup"><span data-stu-id="e2c07-315">Next, add a Select button, a Delete button, and two BoundFields from the upper left corner (the Select and Delete buttons can be found under the CommandField type).</span></span> <span data-ttu-id="e2c07-316">Définir le bouton de sélection `SelectText` à la vue et de la première BoundField `HeaderText` et `DataField` propriétés nom.</span><span class="sxs-lookup"><span data-stu-id="e2c07-316">Set the Select button's `SelectText` property to View and the first BoundField's `HeaderText` and `DataField` properties to Name.</span></span> <span data-ttu-id="e2c07-317">Définir le BoundField deuxième `HeaderText` propriété à la taille en octets, son `DataField` propriété de longueur, son `DataFormatString` propriété {0 : N0} et son `HtmlEncode` propriété sur False.</span><span class="sxs-lookup"><span data-stu-id="e2c07-317">Set the second BoundField's `HeaderText` property to Size in Bytes, its `DataField` property to Length, its `DataFormatString` property to {0:N0} and its `HtmlEncode` property to False.</span></span>

<span data-ttu-id="e2c07-318">Après avoir configuré les colonnes du contrôle de GridView, cliquez sur OK pour fermer la boîte de dialogue champs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-318">After configuring the GridView's columns, click OK to close the Fields dialog box.</span></span> <span data-ttu-id="e2c07-319">À partir de la fenêtre Propriétés, définissez du GridView `DataKeyNames` propriété `FullName`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-319">From the Properties window, set the GridView's `DataKeyNames` property to `FullName`.</span></span> <span data-ttu-id="e2c07-320">À ce stade balisage déclaratif du GridView doit se présenter comme suit :</span><span class="sxs-lookup"><span data-stu-id="e2c07-320">At this point the GridView's declarative markup should look like the following:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample9.aspx)]

<span data-ttu-id="e2c07-321">Avec une balise de GridView créé, nous sommes prêts à écrire le code qui Récupère les fichiers dans un répertoire particulier et les lier au contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-321">With the GridView's markup created, we're ready to write the code that will retrieve the files in a particular directory and bind them to the GridView.</span></span> <span data-ttu-id="e2c07-322">Ajoutez le code suivant à la page `Page_Load` Gestionnaire d’événements :</span><span class="sxs-lookup"><span data-stu-id="e2c07-322">Add the following code to the page's `Page_Load` event handler:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample10.vb)]

<span data-ttu-id="e2c07-323">Le code ci-dessus utilise la [ `DirectoryInfo` classe](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) pour obtenir une liste des fichiers dans le dossier racine de l’application.</span><span class="sxs-lookup"><span data-stu-id="e2c07-323">The above code uses the [`DirectoryInfo` class](https://msdn.microsoft.com/library/system.io.directoryinfo.aspx) to obtain a list of the files in the application's root folder.</span></span> <span data-ttu-id="e2c07-324">Le [ `GetFiles()` méthode](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) retourne tous les fichiers dans le répertoire sous forme de tableau de [ `FileInfo` objets](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), qui est ensuite lié au GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-324">The [`GetFiles()` method](https://msdn.microsoft.com/library/system.io.directoryinfo.getfiles.aspx) returns all of the files in the directory as an array of [`FileInfo` objects](https://msdn.microsoft.com/library/system.io.fileinfo.aspx), which is then bound to the GridView.</span></span> <span data-ttu-id="e2c07-325">Le `FileInfo` objet possède un large éventail de propriétés, telles que `Name`, `Length`, et `IsReadOnly`, entre autres.</span><span class="sxs-lookup"><span data-stu-id="e2c07-325">The `FileInfo` object has an assortment of properties, such as `Name`, `Length`, and `IsReadOnly`, among others.</span></span> <span data-ttu-id="e2c07-326">Comme vous pouvez le voir à partir de son balisage déclaratif, le contrôle GridView affiche simplement la `Name` et `Length` propriétés.</span><span class="sxs-lookup"><span data-stu-id="e2c07-326">As you can see from its declarative markup, the GridView displays just the `Name` and `Length` properties.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-327">Le `DirectoryInfo` et `FileInfo` classes se trouvent dans le [ `System.IO` espace de noms](https://msdn.microsoft.com/library/system.io.aspx).</span><span class="sxs-lookup"><span data-stu-id="e2c07-327">The `DirectoryInfo` and `FileInfo` classes are found in the [`System.IO` namespace](https://msdn.microsoft.com/library/system.io.aspx).</span></span> <span data-ttu-id="e2c07-328">Par conséquent, vous aurez besoin de faire précéder les noms de classe par leurs noms d’espace de noms ou disposer de l’espace de noms importé dans le fichier de classe (via `Imports System.IO`).</span><span class="sxs-lookup"><span data-stu-id="e2c07-328">Therefore, you will either need to preface these class names with their namespace names or have the namespace imported into the class file (via `Imports System.IO`).</span></span>


<span data-ttu-id="e2c07-329">Prenez un moment pour consulter cette page via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-329">Take a moment to visit this page through a browser.</span></span> <span data-ttu-id="e2c07-330">Il affiche la liste des fichiers se trouvant dans le répertoire racine de l’application.</span><span class="sxs-lookup"><span data-stu-id="e2c07-330">It will display the list of files residing in the application's root directory.</span></span> <span data-ttu-id="e2c07-331">Cliquez simplement sur la vue ou de supprimer le LinkButton provoque une publication (postback), mais aucune action ne se produit, car nous avons encore pour créer les gestionnaires d’événements nécessaires.</span><span class="sxs-lookup"><span data-stu-id="e2c07-331">Clicking any of the View or Delete LinkButtons will cause a postback, but no action will occur because we've yet to create the necessary event handlers.</span></span>


<span data-ttu-id="e2c07-332">[![Le contrôle GridView répertorie les fichiers dans le répertoire racine de l’Application Web](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-332">[![The GridView Lists the Files in the Web Application's Root Directory](user-based-authorization-vb/_static/image20.png)](user-based-authorization-vb/_static/image19.png)</span></span>

<span data-ttu-id="e2c07-333">**Figure 7**: le contrôle GridView répertorie les fichiers dans le répertoire racine de l’Application Web ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-333">**Figure 7**: The GridView Lists the Files in the Web Application's Root Directory  ([Click to view full-size image](user-based-authorization-vb/_static/image21.png))</span></span>


<span data-ttu-id="e2c07-334">Nous avons besoin d’un moyen d’afficher le contenu du fichier sélectionné.</span><span class="sxs-lookup"><span data-stu-id="e2c07-334">We need a means to display the contents of the selected file.</span></span> <span data-ttu-id="e2c07-335">Revenez à Visual Studio et ajoutez une zone de texte nommée `FileContents` ci-dessus le GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-335">Return to Visual Studio and add a TextBox named `FileContents` above the GridView.</span></span> <span data-ttu-id="e2c07-336">Définir son `TextMode` propriété `MultiLine` et son `Columns` et `Rows` propriétés à 95 % et 10, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-336">Set its `TextMode` property to `MultiLine` and its `Columns` and `Rows` properties to 95% and 10, respectively.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample11.aspx)]

<span data-ttu-id="e2c07-337">Ensuite, créez un gestionnaire d’événements pour le contrôle du GridView [ `SelectedIndexChanged` événements](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) et ajoutez le code suivant :</span><span class="sxs-lookup"><span data-stu-id="e2c07-337">Next, create an event handler for the GridView's [`SelectedIndexChanged` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.selectedindexchanged.aspx) and add the following code:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample12.vb)]

<span data-ttu-id="e2c07-338">Ce code utilise le contrôle de GridView `SelectedValue` propriété pour déterminer le nom de fichier complet du fichier sélectionné.</span><span class="sxs-lookup"><span data-stu-id="e2c07-338">This code uses the GridView's `SelectedValue` property to determine the full file name of the selected file.</span></span> <span data-ttu-id="e2c07-339">En interne, le `DataKeys` collection est référencée afin d’obtenir le `SelectedValue`, il est impératif que vous définissez de GridView `DataKeyNames` propriété par nom, comme décrit précédemment dans cette étape.</span><span class="sxs-lookup"><span data-stu-id="e2c07-339">Internally, the `DataKeys` collection is referenced in order to obtain the `SelectedValue`, so it is imperative that you set the GridView's `DataKeyNames` property to Name, as described earlier in this step.</span></span> <span data-ttu-id="e2c07-340">Le [ `File` classe](https://msdn.microsoft.com/library/system.io.file.aspx) est utilisé pour lire le contenu du fichier sélectionné dans une chaîne, qui est ensuite assigné à la `FileContents` la zone de texte `Text` propriété, ce qui affiche le contenu du fichier sélectionné dans la page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-340">The [`File` class](https://msdn.microsoft.com/library/system.io.file.aspx) is used to read the selected file's contents into a string, which is then assigned to the `FileContents` TextBox's `Text` property, thereby displaying the contents of the selected file on the page.</span></span>


<span data-ttu-id="e2c07-341">[![Contenu du fichier sélectionné est affiché dans la zone de texte](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-341">[![The Selected File's Contents are Displayed in the TextBox](user-based-authorization-vb/_static/image23.png)](user-based-authorization-vb/_static/image22.png)</span></span>

<span data-ttu-id="e2c07-342">**Figure 8**: contenu du fichier sélectionné est affiché dans la zone de texte ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-342">**Figure 8**: The Selected File's Contents are Displayed in the TextBox  ([Click to view full-size image](user-based-authorization-vb/_static/image24.png))</span></span>


> [!NOTE]
> <span data-ttu-id="e2c07-343">Si vous affichez le contenu d’un fichier qui contient le balisage HTML, puis essayez d’afficher ou supprimer un fichier, vous recevrez un `HttpRequestValidationException` erreur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-343">If you view the contents of a file that contains HTML markup, and then attempt to view or delete a file, you will receive an `HttpRequestValidationException` error.</span></span> <span data-ttu-id="e2c07-344">Cela se produit, car lors de la publication le contenu de la zone de texte est envoyés sur le serveur web.</span><span class="sxs-lookup"><span data-stu-id="e2c07-344">This occurs because on postback the TextBox's contents are sent back to the web server.</span></span> <span data-ttu-id="e2c07-345">Par défaut, ASP.NET déclenche un `HttpRequestValidationException` erreur chaque fois que le contenu de publication (postback) potentiellement dangereux, telles que des balises HTML, est détecté.</span><span class="sxs-lookup"><span data-stu-id="e2c07-345">By default, ASP.NET raises an `HttpRequestValidationException` error whenever potentially dangerous postback content, such as HTML markup, is detected.</span></span> <span data-ttu-id="e2c07-346">Pour désactiver cette erreur ne se produise, désactiver la validation de la demande pour la page en ajoutant `ValidateRequest="false"` à le `@Page` la directive.</span><span class="sxs-lookup"><span data-stu-id="e2c07-346">To disable this error from occurring, turn off request validation for the page by adding `ValidateRequest="false"` to the `@Page` directive.</span></span> <span data-ttu-id="e2c07-347">Pour plus d’informations sur les avantages de la validation de la demande comme ainsi que les précautions, vous devez prendre lorsque la désactivation, lire [Validation de la demande - empêche les attaques de Script](https://asp.net/learn/whitepapers/request-validation/).</span><span class="sxs-lookup"><span data-stu-id="e2c07-347">For more information on the benefits of request validation as well as what precautions you should take when disabling it, read [Request Validation - Preventing Script Attacks](https://asp.net/learn/whitepapers/request-validation/).</span></span>


<span data-ttu-id="e2c07-348">Enfin, ajoutez un gestionnaire d’événements par le code suivant pour le contrôle du GridView [ `RowDeleting` événement](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span><span class="sxs-lookup"><span data-stu-id="e2c07-348">Finally, add an event handler with the following code for the GridView's [`RowDeleting` event](https://msdn.microsoft.com/library/system.web.ui.webcontrols.gridview.rowdeleting.aspx):</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample13.vb)]

<span data-ttu-id="e2c07-349">Le code affiche simplement le nom complet du fichier à supprimer dans le `FileContents` zone de texte *sans* réellement supprimer le fichier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-349">The code simply displays the full name of the file to delete in the `FileContents` TextBox *without* actually deleting the file.</span></span>


<span data-ttu-id="e2c07-350">[![En cliquant sur le bouton de suppression ne supprime pas réellement le fichier](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-350">[![Clicking the Delete Button Does Not Actually Delete the File](user-based-authorization-vb/_static/image26.png)](user-based-authorization-vb/_static/image25.png)</span></span>

<span data-ttu-id="e2c07-351">**Figure 9**: sur la suppression bouton ne supprime ne pas réellement le fichier ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image27.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-351">**Figure 9**: Clicking the Delete Button Does Not Actually Delete the File  ([Click to view full-size image](user-based-authorization-vb/_static/image27.png))</span></span>


<span data-ttu-id="e2c07-352">À l’étape 1, nous avons configuré les règles d’autorisation URL pour interdire aux utilisateurs anonymes à partir de l’affichage des pages dans le `Membership` dossier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-352">In Step 1 we configured the URL authorization rules to prohibit anonymous users from viewing the pages in the `Membership` folder.</span></span> <span data-ttu-id="e2c07-353">Afin de mieux présentent l’authentification de granularité fine, nous allons autoriser les utilisateurs anonymes à visiter le `UserBasedAuthorization.aspx` page, mais avec des fonctionnalités limitées.</span><span class="sxs-lookup"><span data-stu-id="e2c07-353">In order to better exhibit fine grain authentication, let's allow anonymous users to visit the `UserBasedAuthorization.aspx` page, but with limited functionality.</span></span> <span data-ttu-id="e2c07-354">Pour ouvrir cette page accessible par tous les utilisateurs, ajoutez le code suivant `<location>` élément à la `Web.config` de fichiers dans le `Membership` dossier :</span><span class="sxs-lookup"><span data-stu-id="e2c07-354">To open this page up to be accessed by all users, add the following `<location>` element to the `Web.config` file in the `Membership` folder:</span></span>

[!code-xml[Main](user-based-authorization-vb/samples/sample14.xml)]

<span data-ttu-id="e2c07-355">Après avoir ajouté ce `<location>` élément, tester les règles d’autorisation de nouvelles URL en ouvrant une session sur le site.</span><span class="sxs-lookup"><span data-stu-id="e2c07-355">After adding this `<location>` element, test the new URL authorization rules by logging out of the site.</span></span> <span data-ttu-id="e2c07-356">En tant qu’utilisateur anonyme vous devez être autorisées à visiter le `UserBasedAuthorization.aspx` page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-356">As an anonymous user you should be permitted to visit the `UserBasedAuthorization.aspx` page.</span></span>

<span data-ttu-id="e2c07-357">Actuellement, tout utilisateur authentifié ou anonyme peut visiter le `UserBasedAuthorization.aspx` page et d’afficher ou de supprimer des fichiers.</span><span class="sxs-lookup"><span data-stu-id="e2c07-357">Currently, any authenticated or anonymous user can visit the `UserBasedAuthorization.aspx` page and view or delete files.</span></span> <span data-ttu-id="e2c07-358">Nous allons faire en sorte que seuls les utilisateurs authentifiés peuvent afficher le contenu d’un fichier et Tito uniquement peut supprimer un fichier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-358">Let's make it so that only authenticated users can view contents of a file and only Tito can delete a file.</span></span> <span data-ttu-id="e2c07-359">Ces règles de d’autorisation de granularité fine peuvent être appliquées de manière déclarative, par programme ou par une combinaison des deux méthodes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-359">Such fine grain authorization rules can be applied declaratively, programmatically, or through a combination of both methods.</span></span> <span data-ttu-id="e2c07-360">Nous allons utiliser l’approche déclarative pour limiter qui peut afficher le contenu d’un fichier. Nous allons utiliser l’approche programmatique pour limiter les utilisateurs permettre supprimer un fichier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-360">Let's use the declarative approach to limit who can view the contents of a file; we'll use the programmatic approach to limit who can delete a file.</span></span>

### <a name="using-the-loginview-control"></a><span data-ttu-id="e2c07-361">L’utilisation du contrôle LoginView</span><span class="sxs-lookup"><span data-stu-id="e2c07-361">Using the LoginView Control</span></span>

<span data-ttu-id="e2c07-362">Comme nous l’avons vu dans ces didacticiels, le contrôle LoginView est utile pour afficher différentes interfaces pour les utilisateurs authentifiés et anonymes et offre un moyen aisé de masquer des fonctionnalités qui ne sont pas accessibles aux utilisateurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-362">As we've seen in past tutorials, the LoginView control is useful for displaying different interfaces for authenticated and anonymous users, and offers an easy way to hide functionality that is not accessible to anonymous users.</span></span> <span data-ttu-id="e2c07-363">Étant donné que les utilisateurs anonymes ne peuvent pas afficher ou supprimer des fichiers, nous avons besoin afficher uniquement les `FileContents` zone de texte lorsque la page est visitée par un utilisateur authentifié.</span><span class="sxs-lookup"><span data-stu-id="e2c07-363">Since anonymous users cannot view or delete files, we only need to show the `FileContents` TextBox when the page is visited by an authenticated user.</span></span> <span data-ttu-id="e2c07-364">Pour ce faire, ajoutez un contrôle LoginView à la page, nommez-le `LoginViewForFileContentsTextBox`et déplacer le `FileContents` balisage déclaratif de la zone de texte dans le contrôle de LoginView `LoggedInTemplate`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-364">To achieve this, add a LoginView control to the page, name it `LoginViewForFileContentsTextBox`, and move the `FileContents` TextBox's declarative markup into the LoginView control's `LoggedInTemplate`.</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample15.aspx)]

<span data-ttu-id="e2c07-365">Les contrôles Web dans les modèles de la LoginView ne sont plus directement accessibles à partir de la classe code-behind.</span><span class="sxs-lookup"><span data-stu-id="e2c07-365">The Web controls in the LoginView's templates are no longer directly accessible from the code-behind class.</span></span> <span data-ttu-id="e2c07-366">Par exemple, le `FilesGrid` du GridView `SelectedIndexChanged` et `RowDeleting` gestionnaires d’événements font actuellement référencent le `FileContents` telles que le contrôle de zone de texte avec le code :</span><span class="sxs-lookup"><span data-stu-id="e2c07-366">For example, the `FilesGrid` GridView's `SelectedIndexChanged` and `RowDeleting` event handlers currently reference the `FileContents` TextBox control with code like:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample16.aspx)]

<span data-ttu-id="e2c07-367">Toutefois, ce code n’est plus valide.</span><span class="sxs-lookup"><span data-stu-id="e2c07-367">However, this code is no longer valid.</span></span> <span data-ttu-id="e2c07-368">En déplaçant le `FileContents` zone de texte dans le `LoggedInTemplate` la zone de texte ne sont pas accessibles directement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-368">By moving the `FileContents` TextBox into the `LoggedInTemplate` the TextBox cannot be directly accessed.</span></span> <span data-ttu-id="e2c07-369">Au lieu de cela, nous devons utiliser la `FindControl("controlId")` méthode référencer le contrôle par programme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-369">Instead, we must use the `FindControl("controlId")` method to programmatically reference the control.</span></span> <span data-ttu-id="e2c07-370">Mise à jour le `FilesGrid` gestionnaires d’événements pour faire référence à la zone de texte comme suit :</span><span class="sxs-lookup"><span data-stu-id="e2c07-370">Update the `FilesGrid` event handlers to reference the TextBox like so:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample17.vb)]

<span data-ttu-id="e2c07-371">Après le déplacement de la zone de texte pour le LoginView `LoggedInTemplate` et mettre à jour le code de la page à la zone de texte à l’aide de référence du `FindControl("controlId")` de modèle, consultez la page en tant qu’utilisateur anonyme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-371">After moving the TextBox to the LoginView's `LoggedInTemplate` and updating the page's code to reference the TextBox using the `FindControl("controlId")` pattern, visit the page as an anonymous user.</span></span> <span data-ttu-id="e2c07-372">Comme le montre la Figure 10, la `FileContents` zone de texte n’est pas affichée.</span><span class="sxs-lookup"><span data-stu-id="e2c07-372">As Figure 10 shows, the `FileContents` TextBox is not displayed.</span></span> <span data-ttu-id="e2c07-373">Toutefois, la vue LinkButton reste affiché.</span><span class="sxs-lookup"><span data-stu-id="e2c07-373">However, the View LinkButton is still displayed.</span></span>


<span data-ttu-id="e2c07-374">[![Le contrôle LoginView affiche uniquement la zone de texte FileContents pour les utilisateurs authentifiés](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-374">[![The LoginView Control Only Renders the FileContents TextBox for Authenticated Users](user-based-authorization-vb/_static/image29.png)](user-based-authorization-vb/_static/image28.png)</span></span>

<span data-ttu-id="e2c07-375">**La figure 10**: le LoginView contrôle uniquement restitue le `FileContents` zone de texte pour les utilisateurs authentifiés ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image30.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-375">**Figure 10**: The LoginView Control Only Renders the `FileContents` TextBox for Authenticated Users  ([Click to view full-size image](user-based-authorization-vb/_static/image30.png))</span></span>


<span data-ttu-id="e2c07-376">Une pour masquer le bouton d’affichage pour les utilisateurs anonymes consiste à convertir le champ GridView en TemplateField.</span><span class="sxs-lookup"><span data-stu-id="e2c07-376">One way to hide the View button for anonymous users is to convert the GridView field into a TemplateField.</span></span> <span data-ttu-id="e2c07-377">Cette opération génère un modèle qui contient le balisage déclaratif pour le bouton de lien de vue.</span><span class="sxs-lookup"><span data-stu-id="e2c07-377">This will generate a template that contains the declarative markup for the View LinkButton.</span></span> <span data-ttu-id="e2c07-378">Nous pouvons ensuite ajouter un contrôle LoginView au TemplateField et placer le LinkButton au sein de la LoginView `LoggedInTemplate`, ce qui le masquage le bouton d’affichage des visiteurs anonymes.</span><span class="sxs-lookup"><span data-stu-id="e2c07-378">We can then add a LoginView control to the TemplateField and place the LinkButton within the LoginView's `LoggedInTemplate`, thereby hiding the View button from anonymous visitors.</span></span> <span data-ttu-id="e2c07-379">Pour ce faire, cliquez sur le lien Modifier les colonnes à partir de balise du contrôle de GridView active pour lancer la boîte de dialogue champs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-379">To accomplish this, click on the Edit Columns link from the GridView's Smart Tag to launch the Fields dialog box.</span></span> <span data-ttu-id="e2c07-380">Ensuite, sélectionnez le bouton de sélection dans la liste dans l’angle inférieur gauche et puis cliquez sur le convertir ce champ en TemplateField lien.</span><span class="sxs-lookup"><span data-stu-id="e2c07-380">Next, select the Select button from the list in the lower left corner and then click the Convert this field to a TemplateField link.</span></span> <span data-ttu-id="e2c07-381">Cela modifiera le balisage déclaratif du champ à partir de :</span><span class="sxs-lookup"><span data-stu-id="e2c07-381">Doing so will modify the field's declarative markup from:</span></span>

[!code-aspx[Main](user-based-authorization-vb/samples/sample18.aspx)]

 <span data-ttu-id="e2c07-382">À :</span><span class="sxs-lookup"><span data-stu-id="e2c07-382">To:</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample19.aspx)]

 <span data-ttu-id="e2c07-383">À ce stade, nous pouvons ajouter un LoginView pour le TemplateField.</span><span class="sxs-lookup"><span data-stu-id="e2c07-383">At this point, we can add a LoginView to the TemplateField.</span></span> <span data-ttu-id="e2c07-384">Le balisage suivant affiche la vue LinkButton uniquement pour les utilisateurs authentifiés.</span><span class="sxs-lookup"><span data-stu-id="e2c07-384">The following markup displays the View LinkButton only for authenticated users.</span></span> 

[!code-aspx[Main](user-based-authorization-vb/samples/sample20.aspx)]

<span data-ttu-id="e2c07-385">Comme le montre la Figure 11, le résultat final n’est pas que plutôt que la vue colonne est toujours affichée même si la vue LinkButton dans la colonne sont masqués.</span><span class="sxs-lookup"><span data-stu-id="e2c07-385">As Figure 11 shows, the end result is not that pretty as the View column is still displayed even though the View LinkButtons within the column are hidden.</span></span> <span data-ttu-id="e2c07-386">Nous allons examiner comment masquer la colonne entière de GridView (et pas seulement le LinkButton) dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="e2c07-386">We will look at how to hide the entire GridView column (and not just the LinkButton) in the next section.</span></span>


<span data-ttu-id="e2c07-387">[![Le contrôle LoginView masque la vue LinkButton pour les visiteurs anonymes](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-387">[![The LoginView Control Hides the View LinkButtons for Anonymous Visitors](user-based-authorization-vb/_static/image32.png)](user-based-authorization-vb/_static/image31.png)</span></span>

<span data-ttu-id="e2c07-388">**Figure 11**: le contrôle LoginView masque la vue LinkButton pour les visiteurs anonymes ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image33.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-388">**Figure 11**: The LoginView Control Hides the View LinkButtons for Anonymous Visitors  ([Click to view full-size image](user-based-authorization-vb/_static/image33.png))</span></span>


### <a name="programmatically-limiting-functionality"></a><span data-ttu-id="e2c07-389">Limitant les fonctionnalités par programme</span><span class="sxs-lookup"><span data-stu-id="e2c07-389">Programmatically Limiting Functionality</span></span>

<span data-ttu-id="e2c07-390">Dans certains cas, les techniques déclaratives sont insuffisantes pour limitant les fonctionnalités à une page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-390">In some circumstances, declarative techniques are insufficient for limiting functionality to a page.</span></span> <span data-ttu-id="e2c07-391">Par exemple, la disponibilité de certaines fonctionnalités de page peut être dépendante de critères au-delà de si l’utilisateur visite de la page est anonymes ou authentifiés.</span><span class="sxs-lookup"><span data-stu-id="e2c07-391">For example, the availability of certain page functionality may be dependent on criteria beyond whether the user visiting the page is anonymous or authenticated.</span></span> <span data-ttu-id="e2c07-392">Dans ce cas, les différents éléments d’interface utilisateur peuvent être affichés ou masqués moyens par programme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-392">In such cases, the various user interface elements can be displayed or hidden through programmatic means.</span></span>

<span data-ttu-id="e2c07-393">Pour limiter les fonctionnalités par programme, nous devons effectuer deux tâches :</span><span class="sxs-lookup"><span data-stu-id="e2c07-393">In order to limit the functionality programmatically, we need to perform two tasks:</span></span>

1. <span data-ttu-id="e2c07-394">Déterminer si l’utilisateur visite de la page peut accéder à la fonctionnalité, et</span><span class="sxs-lookup"><span data-stu-id="e2c07-394">Determine whether the user visiting the page can access the functionality, and</span></span>
2. <span data-ttu-id="e2c07-395">Modifier par programmation l’interface utilisateur selon si l’utilisateur a accès à la fonctionnalité en question.</span><span class="sxs-lookup"><span data-stu-id="e2c07-395">Programmatically modify the user interface based on whether the user has access to the functionality in question.</span></span>

<span data-ttu-id="e2c07-396">Pour illustrer l’application de ces deux tâches, nous allons autoriser Tito supprimer des fichiers du contrôle GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-396">To demonstrate the application of these two tasks, let's only allow Tito to delete files from the GridView.</span></span> <span data-ttu-id="e2c07-397">Notre première tâche, est ensuite, pour déterminer si elle est Tito sur la page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-397">Our first task, then, is to determine whether it is Tito visiting the page.</span></span> <span data-ttu-id="e2c07-398">Une fois que qui a été déterminé, nous devons masquer (ou afficher) supprimer une colonne de GridView.</span><span class="sxs-lookup"><span data-stu-id="e2c07-398">Once that has been determined, we need to hide (or show) the GridView's Delete column.</span></span> <span data-ttu-id="e2c07-399">Les colonnes du GridView sont accessibles via son `Columns` propriété ; une colonne est affichée uniquement si son `Visible` est définie sur `True` (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="e2c07-399">The GridView's columns are accessible through its `Columns` property; a column is only rendered if its `Visible` property is set to `True` (the default).</span></span>

<span data-ttu-id="e2c07-400">Ajoutez le code suivant à la `Page_Load` Gestionnaire d’événements avant la liaison des données au contrôle GridView :</span><span class="sxs-lookup"><span data-stu-id="e2c07-400">Add the following code to the `Page_Load` event handler prior to binding the data to the GridView:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample21.vb)]

<span data-ttu-id="e2c07-401">Comme expliqué dans la [ *une vue d’ensemble de l’authentification par formulaire* ](../introduction/an-overview-of-forms-authentication-vb.md) didacticiel, `User.Identity.Name` retourne le nom de l’identité.</span><span class="sxs-lookup"><span data-stu-id="e2c07-401">As we discussed in the [*An Overview of Forms Authentication*](../introduction/an-overview-of-forms-authentication-vb.md) tutorial, `User.Identity.Name` returns the identity's name.</span></span> <span data-ttu-id="e2c07-402">Cela correspond au nom d’utilisateur entré dans le contrôle de connexion.</span><span class="sxs-lookup"><span data-stu-id="e2c07-402">This corresponds to the username entered in the Login control.</span></span> <span data-ttu-id="e2c07-403">Si elle est Tito visite de la page, deuxième colonne du GridView `Visible` est définie sur `True`; sinon, elle est définie sur `False`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-403">If it is Tito visiting the page, the GridView's second column's `Visible` property is set to `True`; otherwise, it is set to `False`.</span></span> <span data-ttu-id="e2c07-404">Il en résulte que lorsque quelqu'un d’autre que Tito visite de la page, soit un autre utilisateur authentifié ou un utilisateur anonyme, la colonne de suppression n’est restituée (voir Figure 12) ; Toutefois, lorsque Tito visite de la page, la colonne de suppression est présente (voir la Figure 13).</span><span class="sxs-lookup"><span data-stu-id="e2c07-404">The net result is that when someone other than Tito visits the page, either another authenticated user or an anonymous user, the Delete column is not rendered (see Figure 12); however, when Tito visits the page, the Delete column is present (see Figure 13).</span></span>


<span data-ttu-id="e2c07-405">[![La colonne de supprimer n’est pas rendue lorsque visité par quelqu'un d’autre que Tito (par exemple, Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-405">[![The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)](user-based-authorization-vb/_static/image35.png)](user-based-authorization-vb/_static/image34.png)</span></span>

<span data-ttu-id="e2c07-406">**Figure 12**: la colonne à supprimer est pas rendu lorsque visité par quelqu'un d’autre que Tito (par exemple, Bruce) ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image36.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-406">**Figure 12**: The Delete Column is Not Rendered When Visited By Someone Other Than Tito (Such as Bruce)  ([Click to view full-size image](user-based-authorization-vb/_static/image36.png))</span></span>


<span data-ttu-id="e2c07-407">[![La suppression d’une colonne est rendue pour Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-407">[![The Delete Column is Rendered for Tito](user-based-authorization-vb/_static/image38.png)](user-based-authorization-vb/_static/image37.png)</span></span>

<span data-ttu-id="e2c07-408">**Figure 13**: la colonne à supprimer est rendue pour Tito ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image39.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-408">**Figure 13**: The Delete Column is Rendered for Tito  ([Click to view full-size image](user-based-authorization-vb/_static/image39.png))</span></span>


## <a name="step-4-applying-authorization-rules-to-classes-and-methods"></a><span data-ttu-id="e2c07-409">Étape 4 : Application des règles d’autorisation à des Classes et méthodes</span><span class="sxs-lookup"><span data-stu-id="e2c07-409">Step 4: Applying Authorization Rules to Classes and Methods</span></span>

<span data-ttu-id="e2c07-410">À l’étape 3, nous interdit les utilisateurs anonymes d’afficher du contenu d’un fichier et interdit tous les utilisateurs mais Tito à partir de la suppression de fichiers.</span><span class="sxs-lookup"><span data-stu-id="e2c07-410">In Step 3 we disallowed anonymous users from viewing a file's contents and prohibited all users but Tito from deleting files.</span></span> <span data-ttu-id="e2c07-411">Cela a été accompli en masquant les éléments d’interface utilisateur associé pour les visiteurs non autorisés par le biais des techniques déclaratives et par programme.</span><span class="sxs-lookup"><span data-stu-id="e2c07-411">This was accomplished by hiding the associated user interface elements for unauthorized visitors through declarative and programmatic techniques.</span></span> <span data-ttu-id="e2c07-412">Pour notre exemple, correctement masquer les éléments d’interface utilisateur était simple, mais qu’en est-il des sites plus complexes où il peut y avoir différentes façons d’effectuer les mêmes fonctionnalités ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-412">For our simple example, properly hiding the user interface elements was straightforward, but what about more complex sites where there may be many different ways to perform the same functionality?</span></span> <span data-ttu-id="e2c07-413">Limiter cette fonctionnalité aux utilisateurs non autorisés, que se passe-t-il si nous oubliez pas de masquer ou de désactiver tous les éléments d’interface utilisateur applicable ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-413">In limiting that functionality to unauthorized users, what happens if we forget to hide or disable all of the applicable user interface elements?</span></span>

<span data-ttu-id="e2c07-414">Un moyen simple pour vous assurer qu’une partie spécifique des fonctionnalités ne sont pas accessibles par un utilisateur non autorisé consiste à décorer cette classe ou une méthode avec le [ `PrincipalPermission` attribut](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span><span class="sxs-lookup"><span data-stu-id="e2c07-414">An easy way to ensure that a particular piece of functionality cannot be accessed by an unauthorized user is to decorate that class or method with the [`PrincipalPermission` attribute](https://msdn.microsoft.com/library/system.security.permissions.principalpermissionattribute.aspx).</span></span> <span data-ttu-id="e2c07-415">Lorsque le runtime .NET utilise une classe ou exécute l’une de ses méthodes, il vérifie que le contexte de sécurité actuel est autorisé à utiliser la classe ou d’exécuter la méthode.</span><span class="sxs-lookup"><span data-stu-id="e2c07-415">When the .NET runtime uses a class or executes one of its methods, it checks to ensure that the current security context has permission to use the class or execute the method.</span></span> <span data-ttu-id="e2c07-416">Le `PrincipalPermission` attribut fournit un mécanisme par lequel nous pouvons définir ces règles.</span><span class="sxs-lookup"><span data-stu-id="e2c07-416">The `PrincipalPermission` attribute provides a mechanism through which we can define these rules.</span></span>

<span data-ttu-id="e2c07-417">Nous allons illustrent l’utilisation de la `PrincipalPermission` attribut dans le contrôle de GridView `SelectedIndexChanged` et `RowDeleting` gestionnaires d’événements pour interdire l’exécution par les utilisateurs anonymes et les utilisateurs, hormis Tito, respectivement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-417">Let's demonstrate using the `PrincipalPermission` attribute on the GridView's `SelectedIndexChanged` and `RowDeleting` event handlers to prohibit execution by anonymous users and users other than Tito, respectively.</span></span> <span data-ttu-id="e2c07-418">Il suffit de faire est ajouter l’attribut approprié en haut de chaque définition de fonction :</span><span class="sxs-lookup"><span data-stu-id="e2c07-418">All we need to do is add the appropriate attribute atop each function definition:</span></span>

[!code-vb[Main](user-based-authorization-vb/samples/sample22.vb)]

<span data-ttu-id="e2c07-419">L’attribut pour le `SelectedIndexChanged` détermine de gestionnaire d’événements que seuls les utilisateurs authentifiés peut exécuter le Gestionnaire d’événements, alors que l’attribut sur le `RowDeleting` Gestionnaire d’événements limite l’exécution à Tito.</span><span class="sxs-lookup"><span data-stu-id="e2c07-419">The attribute for the `SelectedIndexChanged` event handler dictates that only authenticated users can execute the event handler, where as the attribute on the `RowDeleting` event handler limits the execution to Tito.</span></span>

> [!NOTE]
> <span data-ttu-id="e2c07-420">Un attribut peut être appliqué à une classe, méthode, propriété ou l’événement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-420">An attribute can be applied to a class, method, property, or event.</span></span> <span data-ttu-id="e2c07-421">Lorsque vous ajoutez un attribut, il doit faire partie de la classe, une méthode, une propriété ou une instruction de déclaration d’événement.</span><span class="sxs-lookup"><span data-stu-id="e2c07-421">When adding an attribute, it must be part of the class, method, property, or event declaration statement.</span></span> <span data-ttu-id="e2c07-422">Étant donné que Visual Basic utilise des sauts de ligne comme séparateurs d’instruction, les attributs doivent apparaître sur la même ligne que la déclaration ou juste au-dessus de lui avec un caractère de continuation de ligne (le caractère de soulignement).</span><span class="sxs-lookup"><span data-stu-id="e2c07-422">Since Visual Basic uses line breaks as statement delimiters, attributes must either appear on the same line as the declaration or directly above it with a line continuation character (the underscore).</span></span> <span data-ttu-id="e2c07-423">Dans l’extrait de code ci-dessus, le caractère de continuation de ligne est utilisé pour placer l’attribut sur une ligne et la déclaration de méthode sur un autre.</span><span class="sxs-lookup"><span data-stu-id="e2c07-423">In the code snippet above, the line continuation character is used to place the attribute on one line and the method declaration on another.</span></span>


<span data-ttu-id="e2c07-424">Si une certaine manière, un utilisateur autre que Tito tente d’exécuter le `RowDeleting` Gestionnaire d’événements ou un utilisateur non authentifié tente d’exécuter le `SelectedIndexChanged` Gestionnaire d’événements, le runtime .NET génère un `SecurityException`.</span><span class="sxs-lookup"><span data-stu-id="e2c07-424">If, somehow, a user other than Tito attempts to execute the `RowDeleting` event handler or a non-authenticated user attempts to execute the `SelectedIndexChanged` event handler, the .NET runtime will raise a `SecurityException`.</span></span>


<span data-ttu-id="e2c07-425">[![Si le contexte de sécurité n’est pas autorisé à exécuter la méthode, une exception SecurityException est levée.](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span><span class="sxs-lookup"><span data-stu-id="e2c07-425">[![If the Security Context is not Authorized to Execute the Method, a SecurityException is Thrown](user-based-authorization-vb/_static/image41.png)](user-based-authorization-vb/_static/image40.png)</span></span>

<span data-ttu-id="e2c07-426">**La figure 14**: si le contexte de sécurité n’est pas autorisé à exécuter la méthode, un `SecurityException` est levée ([cliquez pour afficher l’image en taille réelle](user-based-authorization-vb/_static/image42.png))</span><span class="sxs-lookup"><span data-stu-id="e2c07-426">**Figure 14**: If the Security Context is not Authorized to Execute the Method, a `SecurityException` is Thrown  ([Click to view full-size image](user-based-authorization-vb/_static/image42.png))</span></span>


> [!NOTE]
> <span data-ttu-id="e2c07-427">Pour permettre à plusieurs contextes de sécurité accéder à une classe ou une méthode, décorez la classe ou une méthode avec un `PrincipalPermission` attribut pour chaque contexte de sécurité.</span><span class="sxs-lookup"><span data-stu-id="e2c07-427">To allow multiple security contexts to access a class or method, decorate the class or method with a `PrincipalPermission` attribute for each security context.</span></span> <span data-ttu-id="e2c07-428">Autrement dit, pour autoriser Tito et Bruce d’exécuter le `RowDeleting` Gestionnaire d’événements, ajoutez *deux* `PrincipalPermission` attributs :</span><span class="sxs-lookup"><span data-stu-id="e2c07-428">That is, to allow both Tito and Bruce to execute the `RowDeleting` event handler, add *two* `PrincipalPermission` attributes:</span></span>


[!code-vb[Main](user-based-authorization-vb/samples/sample23.vb)]

<span data-ttu-id="e2c07-429">En plus de pages ASP.NET, de nombreuses applications ont également une architecture qui inclut des différentes couches, telles que la logique métier et les couches d’accès aux données.</span><span class="sxs-lookup"><span data-stu-id="e2c07-429">In addition to ASP.NET pages, many applications also have an architecture that includes various layers, such as Business Logic and Data Access Layers.</span></span> <span data-ttu-id="e2c07-430">Ces couches sont généralement implémentées en tant que bibliothèques de classes et offrent des classes et méthodes permettant d’effectuer des fonctionnalités d’entreprise logique et les données liées.</span><span class="sxs-lookup"><span data-stu-id="e2c07-430">These layers are typically implemented as Class Libraries and offer classes and methods for performing business logic- and data-related functionality.</span></span> <span data-ttu-id="e2c07-431">Le `PrincipalPermission` attribut est utile pour appliquer des règles d’autorisation à ces couches.</span><span class="sxs-lookup"><span data-stu-id="e2c07-431">The `PrincipalPermission` attribute is useful for applying authorization rules to these layers.</span></span>

<span data-ttu-id="e2c07-432">Pour plus d’informations sur l’utilisation de la `PrincipalPermission` attribut pour définir des règles d’autorisation sur les classes et méthodes, reportez-vous à [Scott Guthrie](https://weblogs.asp.net/scottgu/)d’entrée de blog [Ajout de règles d’autorisation à l’entreprise et les couches de données à l’aide de `PrincipalPermissionAttributes` ](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span><span class="sxs-lookup"><span data-stu-id="e2c07-432">For more information on using the `PrincipalPermission` attribute to define authorization rules on classes and methods, refer to [Scott Guthrie](https://weblogs.asp.net/scottgu/)'s blog entry [Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx).</span></span>

## <a name="summary"></a><span data-ttu-id="e2c07-433">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="e2c07-433">Summary</span></span>

<span data-ttu-id="e2c07-434">Dans ce didacticiel, nous avons étudié comment appliquer des règles d’autorisation basées sur l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="e2c07-434">In this tutorial we looked at how to apply user-based authorization rules.</span></span> <span data-ttu-id="e2c07-435">Nous avons commencé par un examen ASP. Structure de NET URL d’autorisation.</span><span class="sxs-lookup"><span data-stu-id="e2c07-435">We started with a look at ASP.NET's URL authorization framework.</span></span> <span data-ttu-id="e2c07-436">Sur chaque demande, le moteur ASP.NET `UrlAuthorizationModule` inspecte les règles de l’autorisation d’URL définis dans la configuration de l’application pour déterminer si l’identité est autorisée à accéder à la ressource demandée.</span><span class="sxs-lookup"><span data-stu-id="e2c07-436">On each request, the ASP.NET engine's `UrlAuthorizationModule` inspects the URL authorization rules defined in the application's configuration to determine whether the identity is authorized to access the requested resource.</span></span> <span data-ttu-id="e2c07-437">En bref, l’autorisation d’URL rend facile de spécifier des règles d’autorisation pour une page spécifique ou pour toutes les pages dans un répertoire particulier.</span><span class="sxs-lookup"><span data-stu-id="e2c07-437">In short, URL authorization makes it easy to specify authorization rules for a specific page or for all pages in a particular directory.</span></span>

<span data-ttu-id="e2c07-438">L’infrastructure de l’autorisation d’URL applique des règles d’autorisation sur une base de page par page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-438">The URL authorization framework applies authorization rules on a page-by-page basis.</span></span> <span data-ttu-id="e2c07-439">Avec autorisation d’URL, soit l’identité du demandeuse est autorisée à accéder à une ressource particulière ou non.</span><span class="sxs-lookup"><span data-stu-id="e2c07-439">With URL authorization, either the requesting identity is authorized to access a particular resource or not.</span></span> <span data-ttu-id="e2c07-440">Beaucoup de scénarios, cependant, appeler pour plusieurs règles d’autorisation de granularité fine.</span><span class="sxs-lookup"><span data-stu-id="e2c07-440">Many scenarios, however, call for more fine grain authorization rules.</span></span> <span data-ttu-id="e2c07-441">Au lieu de la définition qui est autorisé à accéder à une page, nous pouvons vous devez laisser tout le monde à accéder à une page, mais pour afficher des données différentes ou offrent des fonctionnalités différentes en fonction de l’utilisateur sur la page.</span><span class="sxs-lookup"><span data-stu-id="e2c07-441">Rather than defining who is permitted to access a page, we may need to let everyone access a page, but to show different data or offer different functionality depending on the user visiting the page.</span></span> <span data-ttu-id="e2c07-442">Autorisation au niveau de la page implique généralement le masquage des éléments d’interface utilisateur spécifique afin d’empêcher les utilisateurs non autorisés d’accéder aux fonctionnalités interdites.</span><span class="sxs-lookup"><span data-stu-id="e2c07-442">Page-level authorization usually involves hiding specific user interface elements in order to prevent unauthorized users from accessing prohibited functionality.</span></span> <span data-ttu-id="e2c07-443">En outre, il est possible d’utiliser des attributs pour restreindre l’accès aux classes et l’exécution de ses méthodes pour certains utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="e2c07-443">Additionally, it is possible to use attributes to restrict access to classes and execution of its methods for certain users.</span></span>

<span data-ttu-id="e2c07-444">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="e2c07-444">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="e2c07-445">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="e2c07-445">Further Reading</span></span>

<span data-ttu-id="e2c07-446">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="e2c07-446">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="e2c07-447">Ajout de règles d’autorisation à l’entreprise et les couches de données à l’aide `PrincipalPermissionAttributes`</span><span class="sxs-lookup"><span data-stu-id="e2c07-447">Adding Authorization Rules to Business and Data Layers Using `PrincipalPermissionAttributes`</span></span>](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)
- [<span data-ttu-id="e2c07-448">Autorisation ASP.NET</span><span class="sxs-lookup"><span data-stu-id="e2c07-448">ASP.NET Authorization</span></span>](https://msdn.microsoft.com/library/wce3kxhd.aspx)
- [<span data-ttu-id="e2c07-449">Modifications apportées entre la sécurité IIS6 et IIS7</span><span class="sxs-lookup"><span data-stu-id="e2c07-449">Changes Between IIS6 and IIS7 Security</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/Changes-between-IIS6-and-IIS7-Security)
- [<span data-ttu-id="e2c07-450">Configuration des fichiers et sous-répertoires</span><span class="sxs-lookup"><span data-stu-id="e2c07-450">Configuring Specific Files and Subdirectories</span></span>](https://msdn.microsoft.com/library/6hbkh9s7.aspx)
- [<span data-ttu-id="e2c07-451">Limitant les fonctionnalités de Modification de données en fonction de l’utilisateur</span><span class="sxs-lookup"><span data-stu-id="e2c07-451">Limiting Data Modification Functionality Based on the User</span></span>](../../data-access/editing-inserting-and-deleting-data/limiting-data-modification-functionality-based-on-the-user-vb.md)
- [<span data-ttu-id="e2c07-452">Démarrages rapides du contrôle LoginView</span><span class="sxs-lookup"><span data-stu-id="e2c07-452">LoginView Control QuickStarts</span></span>](https://quickstarts.asp.net/QuickStartv20/aspnet/doc/ctrlref/login/loginview.aspx)
- [<span data-ttu-id="e2c07-453">Présentation de l’autorisation d’URL IIS7</span><span class="sxs-lookup"><span data-stu-id="e2c07-453">Understanding IIS7 URL Authorization</span></span>](https://www.iis.net/articles/view.aspx/IIS7/Managing-IIS7/Configuring-Security/URL-Authorization/Understanding-IIS7-URL-Authorization)
- [<span data-ttu-id="e2c07-454">`UrlAuthorizationModule` Documentation technique</span><span class="sxs-lookup"><span data-stu-id="e2c07-454">`UrlAuthorizationModule` Technical Documentation</span></span>](https://msdn.microsoft.com/library/system.web.security.urlauthorizationmodule.aspx)
- [<span data-ttu-id="e2c07-455">Utilisation des données dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="e2c07-455">Working with Data in ASP.NET 2.0</span></span>](../../data-access/index.md)

### <a name="about-the-author"></a><span data-ttu-id="e2c07-456">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="e2c07-456">About the Author</span></span>

<span data-ttu-id="e2c07-457">Scott Mitchell, auteur de plusieurs livres sur ASP/ASP.NET et créateur de 4GuysFromRolla.com, travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="e2c07-457">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="e2c07-458">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="e2c07-458">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="e2c07-459">Son dernier ouvrage est  *[SAM animer vous-même ASP.NET 2.0 des dernières 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="e2c07-459">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="e2c07-460">Scott peut être atteint à [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou via son blog à [ http://ScottOnWriting.NET ](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="e2c07-460">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="e2c07-461">Remerciements</span><span class="sxs-lookup"><span data-stu-id="e2c07-461">Special Thanks To</span></span>

<span data-ttu-id="e2c07-462">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="e2c07-462">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="e2c07-463">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="e2c07-463">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="e2c07-464">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4GuysFromRolla.com).</span><span class="sxs-lookup"><span data-stu-id="e2c07-464">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4GuysFromRolla.com).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="e2c07-465">[Précédent](validating-user-credentials-against-the-membership-user-store-vb.md)
> [Suivant](storing-additional-user-information-vb.md)</span><span class="sxs-lookup"><span data-stu-id="e2c07-465">[Previous](validating-user-credentials-against-the-membership-user-store-vb.md)
[Next](storing-additional-user-information-vb.md)</span></span>
