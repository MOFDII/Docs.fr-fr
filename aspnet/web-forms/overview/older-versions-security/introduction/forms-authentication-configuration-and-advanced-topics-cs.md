---
uid: web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
title: "Rubriques avancées (c#) et Configuration de l’authentification Forms | Documents Microsoft"
author: rick-anderson
description: "Dans ce didacticiel, nous examiner les différents paramètres de l’authentification de formulaires et voir comment les modifier dans l’élément de formulaire. Cela entraîne un détaillées..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 01/14/2008
ms.topic: article
ms.assetid: b9c29865-a34e-48bb-92c0-c443a72cb860
ms.technology: dotnet-webforms
ms.prod: .net-framework
msc.legacyurl: /web-forms/overview/older-versions-security/introduction/forms-authentication-configuration-and-advanced-topics-cs
msc.type: authoredcontent
ms.openlocfilehash: c57722965b510ac4f5cf0c06c7c01c8cea26384f
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2018
---
<a name="forms-authentication-configuration-and-advanced-topics-c"></a><span data-ttu-id="2de60-104">Configuration de l’authentification de formulaires et les rubriques avancées (c#)</span><span class="sxs-lookup"><span data-stu-id="2de60-104">Forms Authentication Configuration and Advanced Topics (C#)</span></span>
====================
<span data-ttu-id="2de60-105">par [Scott Mitchell](https://twitter.com/ScottOnWriting)</span><span class="sxs-lookup"><span data-stu-id="2de60-105">by [Scott Mitchell](https://twitter.com/ScottOnWriting)</span></span>

<span data-ttu-id="2de60-106">[Télécharger le Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) ou [télécharger le PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span><span class="sxs-lookup"><span data-stu-id="2de60-106">[Download Code](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/ASPNET_Security_Tutorial_03_CS.zip) or [Download PDF](http://download.microsoft.com/download/2/F/7/2F705A34-F9DE-4112-BBDE-60098089645E/aspnet_tutorial03_AuthAdvanced_cs.pdf)</span></span>

> <span data-ttu-id="2de60-107">Dans ce didacticiel, nous examiner les différents paramètres de l’authentification de formulaires et voir comment les modifier dans l’élément de formulaire.</span><span class="sxs-lookup"><span data-stu-id="2de60-107">In this tutorial we will examine the various forms authentication settings and see how to modify them through the forms element.</span></span> <span data-ttu-id="2de60-108">Cela entraîne une présentation détaillée de la personnalisation de valeur de délai d’expiration du ticket d’authentification de formulaires, à l’aide d’une page de connexion avec une URL personnalisée (par exemple, SignIn.aspx au lieu de Login.aspx) et les tickets d’authentification par formulaire sans cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-108">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span>


## <a name="introduction"></a><span data-ttu-id="2de60-109">Introduction</span><span class="sxs-lookup"><span data-stu-id="2de60-109">Introduction</span></span>

<span data-ttu-id="2de60-110">Dans le [didacticiel précédent](an-overview-of-forms-authentication-cs.md) , nous avons étudié les étapes nécessaires pour implémenter l’authentification par formulaire dans une application ASP.NET, à partir de la spécification des paramètres de configuration dans le fichier Web.config à la création d’un journal dans la page à l’affichage de différents contenu pour les utilisateurs authentifiés et anonymes.</span><span class="sxs-lookup"><span data-stu-id="2de60-110">In the [previous tutorial](an-overview-of-forms-authentication-cs.md) we looked at the steps necessary for implementing forms authentication in an ASP.NET application, from specifying configuration settings in Web.config to creating a log in page to displaying different content for authenticated and anonymous users.</span></span> <span data-ttu-id="2de60-111">Rappelez-vous que nous avons configuré le site Web pour utiliser l’authentification par formulaire en définissant l’attribut mode de le &lt;authentification&gt; élément aux formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-111">Recall that we configured the website to use forms authentication by setting the mode attribute of the &lt;authentication&gt; element to Forms.</span></span> <span data-ttu-id="2de60-112">Le &lt;authentification&gt; élément peut éventuellement inclure un &lt;forms&gt; élément enfant, par le biais duquel un large éventail de paramètres d’authentification forms peut être spécifié.</span><span class="sxs-lookup"><span data-stu-id="2de60-112">The &lt;authentication&gt; element may optionally include a &lt;forms&gt; child element, through which an assortment of forms authentication settings may be specified.</span></span>

<span data-ttu-id="2de60-113">Dans ce didacticiel nous examiner les différents paramètres de l’authentification de formulaires et voir comment les modifier via le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="2de60-113">In this tutorial we will examine the various forms authentication settings and see how to modify them through the &lt;forms&gt; element.</span></span> <span data-ttu-id="2de60-114">Cela entraîne une présentation détaillée de la personnalisation de valeur de délai d’expiration du ticket d’authentification de formulaires, à l’aide d’une page de connexion avec une URL personnalisée (par exemple, SignIn.aspx au lieu de Login.aspx) et les tickets d’authentification par formulaire sans cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-114">This will entail a detailed look at customizing the forms authentication ticket's timeout value, using a login page with a custom URL (like SignIn.aspx instead of Login.aspx), and cookieless forms authentication tickets.</span></span> <span data-ttu-id="2de60-115">Nous seront également examiner plus en détail de la composition du ticket d’authentification forms et consultez les précautions QU'ASP.NET emprunté pour vous assurer que les données du ticket sont sécurisées à partir d’inspection et de falsification.</span><span class="sxs-lookup"><span data-stu-id="2de60-115">We will also examine the makeup of the forms authentication ticket more closely and see the precautions ASP.NET takes to ensure that the ticket's data is secure from inspection and tampering.</span></span> <span data-ttu-id="2de60-116">Enfin, nous allons étudier comment stocker des données d’utilisateur supplémentaires dans le ticket d’authentification de formulaires et aux données via un objet principal personnalisé.</span><span class="sxs-lookup"><span data-stu-id="2de60-116">Finally, we will look at how to store extra user data in the forms authentication ticket and how to model this data through a custom principal object.</span></span>

## <a name="step-1-examining-the-ltformsgt-configuration-settings"></a><span data-ttu-id="2de60-117">Étape 1 : Examen du &lt;formulaires&gt; paramètres de Configuration</span><span class="sxs-lookup"><span data-stu-id="2de60-117">Step 1: Examining the &lt;forms&gt; Configuration Settings</span></span>

<span data-ttu-id="2de60-118">Le système d’authentification de formulaires dans ASP.NET offre un nombre de paramètres de configuration qui peuvent être personnalisés sur une base de l’application par application.</span><span class="sxs-lookup"><span data-stu-id="2de60-118">The forms authentication system in ASP.NET offers a number of configuration settings that can be customized on an application-by-application basis.</span></span> <span data-ttu-id="2de60-119">Cela inclut les paramètres tels que : la durée de vie de l’authentification de formulaires de ticket ; quel type de protection est appliquée au ticket ; l’authentification sans cookie quelles conditions les tickets sont utilisés ; le chemin d’accès à la page de connexion ; et d’autres informations.</span><span class="sxs-lookup"><span data-stu-id="2de60-119">This includes settings like: the lifetime of the forms authentication ticket; what sort of protection is applied to the ticket; under what conditions cookieless authentication tickets are used; the path to the login page; and other information.</span></span> <span data-ttu-id="2de60-120">Pour modifier les valeurs par défaut, ajoutez un [ &lt;forms&gt; élément](https://msdn.microsoft.com/library/1d3t3c61.aspx) en tant qu’enfant de la [ &lt;authentification&gt; élément](https://msdn.microsoft.com/library/532aee0e.aspx), en spécifiant les propriétés les valeurs que vous souhaitez personnaliser en tant qu’attributs XML comme suit :</span><span class="sxs-lookup"><span data-stu-id="2de60-120">To modify the default values, add a [&lt;forms&gt; element](https://msdn.microsoft.com/library/1d3t3c61.aspx) as a child of the [&lt;authentication&gt; element](https://msdn.microsoft.com/library/532aee0e.aspx), specifying those property values you want to customize as XML attributes like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample1.xml)]

<span data-ttu-id="2de60-121">Le tableau 1 résume les propriétés qui peuvent être personnalisées par le biais du &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="2de60-121">Table 1 summarizes the properties that can be customized through the &lt;forms&gt; element.</span></span> <span data-ttu-id="2de60-122">Étant donné que le fichier Web.config est un fichier XML, les noms d’attribut dans la colonne gauche respectent la casse.</span><span class="sxs-lookup"><span data-stu-id="2de60-122">Since Web.config is an XML file, the attribute names in the left column are case-sensitive.</span></span>

| <span data-ttu-id="2de60-123">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="2de60-123">**Attribute**</span></span> | <span data-ttu-id="2de60-124">**Description**</span><span class="sxs-lookup"><span data-stu-id="2de60-124">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="2de60-125">sans cookie</span><span class="sxs-lookup"><span data-stu-id="2de60-125">cookieless</span></span> | <span data-ttu-id="2de60-126">Cet attribut spécifie les conditions dans lesquelles le ticket d’authentification est stocké dans un cookie et qui est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-126">This attribute specifies under what conditions the authentication ticket is stored in a cookie versus being embedded in the URL.</span></span> <span data-ttu-id="2de60-127">Les valeurs autorisées sont : UseCookies ; UseUri ; Détection automatique ; et UseDeviceProfile (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="2de60-127">Allowable values are: UseCookies; UseUri; AutoDetect; and UseDeviceProfile (the default).</span></span> <span data-ttu-id="2de60-128">Étape 2 examine ce paramètre plus en détail.</span><span class="sxs-lookup"><span data-stu-id="2de60-128">Step 2 examines this setting in more detail.</span></span> |
| <span data-ttu-id="2de60-129">defaultUrl</span><span class="sxs-lookup"><span data-stu-id="2de60-129">defaultUrl</span></span> | <span data-ttu-id="2de60-130">Indique l’URL que les utilisateurs sont redirigés vers après s’être connecté à partir de la page de connexion s’il n’existe aucune valeur RedirectUrl spécifié dans la chaîne de requête.</span><span class="sxs-lookup"><span data-stu-id="2de60-130">Indicates the URL that users are redirected to after signing in from the login page if there is no RedirectUrl value specified in the querystring.</span></span> <span data-ttu-id="2de60-131">La valeur par défaut est default.aspx.</span><span class="sxs-lookup"><span data-stu-id="2de60-131">The default value is default.aspx.</span></span> |
| <span data-ttu-id="2de60-132">de domaine</span><span class="sxs-lookup"><span data-stu-id="2de60-132">domain</span></span> | <span data-ttu-id="2de60-133">Lors de l’utilisation de tickets d’authentification basée sur les cookies, ce paramètre spécifie la valeur du cookie domaine.</span><span class="sxs-lookup"><span data-stu-id="2de60-133">When using cookie-based authentication tickets, this setting specifies the cookie's domain value.</span></span> <span data-ttu-id="2de60-134">La valeur par défaut est une chaîne vide, ce qui entraîne le navigateur à utiliser le domaine à partir duquel il a été délivré (par exemple, www.yourdomain.com).</span><span class="sxs-lookup"><span data-stu-id="2de60-134">The default value is an empty string, which causes the browser to use the domain from which it was issued (such as www.yourdomain.com).</span></span> <span data-ttu-id="2de60-135">Dans ce cas, le cookie sera **pas** envoyer lors de la fabrication des demandes à sous-domaines, telles que admin.yourdomain.com. Si vous souhaitez que le cookie doit être passé à tous les sous-domaines, que vous devez personnaliser l’attribut de domaine la valeur votredomaine.com.</span><span class="sxs-lookup"><span data-stu-id="2de60-135">In this case, the cookie will **not** be sent when making requests to subdomains, such as admin.yourdomain.com. If you want the cookie to be passed to all subdomains you need to customize the domain attribute setting it to yourdomain.com.</span></span> |
| <span data-ttu-id="2de60-136">enableCrossAppRedirects</span><span class="sxs-lookup"><span data-stu-id="2de60-136">enableCrossAppRedirects</span></span> | <span data-ttu-id="2de60-137">Valeur booléenne qui indique si les utilisateurs authentifiés sont mémorisés lorsque redirigés vers des URL dans d’autres applications web sur le même serveur.</span><span class="sxs-lookup"><span data-stu-id="2de60-137">A Boolean value indicating whether authenticated users are remembered when redirected to URLs in other web applications on the same server.</span></span> <span data-ttu-id="2de60-138">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="2de60-138">The default is false.</span></span> |
| <span data-ttu-id="2de60-139">loginUrl</span><span class="sxs-lookup"><span data-stu-id="2de60-139">loginUrl</span></span> | <span data-ttu-id="2de60-140">L’URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="2de60-140">The URL of the login page.</span></span> <span data-ttu-id="2de60-141">La valeur par défaut est login.aspx.</span><span class="sxs-lookup"><span data-stu-id="2de60-141">The default value is login.aspx.</span></span> |
| <span data-ttu-id="2de60-142">name</span><span class="sxs-lookup"><span data-stu-id="2de60-142">name</span></span> | <span data-ttu-id="2de60-143">Lors de l’utilisation de tickets d’authentification basée sur un cookie, le nom du cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-143">When using cookie-based authentication tickets, the name of the cookie.</span></span> <span data-ttu-id="2de60-144">La valeur par défaut est. ASPXAUTH.</span><span class="sxs-lookup"><span data-stu-id="2de60-144">The default is .ASPXAUTH.</span></span> |
| <span data-ttu-id="2de60-145">path</span><span class="sxs-lookup"><span data-stu-id="2de60-145">path</span></span> | <span data-ttu-id="2de60-146">Lors de l’utilisation de tickets d’authentification basée sur les cookies, ce paramètre spécifie attribut de chemin d’accès du cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-146">When using cookie-based authentication tickets, this setting specifies the cookie's path attribute.</span></span> <span data-ttu-id="2de60-147">L’attribut de chemin d’accès permet au développeur limiter l’étendue d’un cookie pour une hiérarchie de répertoires particulière.</span><span class="sxs-lookup"><span data-stu-id="2de60-147">The path attribute enables a developer to limit the scope of a cookie to a particular directory hierarchy.</span></span> <span data-ttu-id="2de60-148">La valeur par défaut est /, qui informe le navigateur à envoyer le cookie de ticket d’authentification pour toute demande adressée au domaine.</span><span class="sxs-lookup"><span data-stu-id="2de60-148">The default value is /, which informs the browser to send the authentication ticket cookie to any request made to the domain.</span></span> |
| <span data-ttu-id="2de60-149">protection</span><span class="sxs-lookup"><span data-stu-id="2de60-149">protection</span></span> | <span data-ttu-id="2de60-150">Indique quelles techniques sont utilisées pour protéger le ticket d’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-150">Indicates what techniques are used to protect the forms authentication ticket.</span></span> <span data-ttu-id="2de60-151">Les valeurs autorisées sont : toutes les (la valeur par défaut) ; Chiffrement ; None ; et la Validation.</span><span class="sxs-lookup"><span data-stu-id="2de60-151">The allowable values are: All (the default); Encryption; None; and Validation.</span></span> <span data-ttu-id="2de60-152">Ces paramètres sont décrits en détail à l’étape 3.</span><span class="sxs-lookup"><span data-stu-id="2de60-152">These settings are discussed in detail in Step 3.</span></span> |
| <span data-ttu-id="2de60-153">requireSSL</span><span class="sxs-lookup"><span data-stu-id="2de60-153">requireSSL</span></span> | <span data-ttu-id="2de60-154">Valeur booléenne qui indique si une connexion SSL est requise pour transmettre le cookie d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-154">A Boolean value that indicates whether an SSL connection is required to transmit the authentication cookie.</span></span> <span data-ttu-id="2de60-155">La valeur par défaut est false.</span><span class="sxs-lookup"><span data-stu-id="2de60-155">The default value is false.</span></span> |
| <span data-ttu-id="2de60-156">SlidingExpiration</span><span class="sxs-lookup"><span data-stu-id="2de60-156">slidingExpiration</span></span> | <span data-ttu-id="2de60-157">Valeur booléenne qui indique si le délai d’expiration du cookie d’authentification est réinitialisé chaque fois que l’utilisateur visite le site pendant une session unique.</span><span class="sxs-lookup"><span data-stu-id="2de60-157">A Boolean value that indicates whether the authentication cookie's timeout is reset each time the user visits the site during a single session.</span></span> <span data-ttu-id="2de60-158">La valeur par défaut est true.</span><span class="sxs-lookup"><span data-stu-id="2de60-158">The default value is true.</span></span> <span data-ttu-id="2de60-159">La stratégie de délai d’expiration du ticket d’authentification est décrite plus en détail dans la spécification section sur les valeurs de délai d’expiration du Ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-159">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span> |
| <span data-ttu-id="2de60-160">délai d'expiration</span><span class="sxs-lookup"><span data-stu-id="2de60-160">timeout</span></span> | <span data-ttu-id="2de60-161">Spécifie la durée, en minutes, après laquelle le cookie de ticket d’authentification expire.</span><span class="sxs-lookup"><span data-stu-id="2de60-161">Specifies the time, in minutes, after which the authentication ticket cookie expires.</span></span> <span data-ttu-id="2de60-162">La valeur par défaut est 30.</span><span class="sxs-lookup"><span data-stu-id="2de60-162">The default value is 30.</span></span> <span data-ttu-id="2de60-163">La stratégie de délai d’expiration du ticket d’authentification est décrite plus en détail dans la spécification section sur les valeurs de délai d’expiration du Ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-163">The authentication ticket timeout policy is discussed in more detail in the Specifying the Ticket's Timeout Value section.</span></span> |

<span data-ttu-id="2de60-164">**Tableau 1**: un récapitulatif de le &lt;forms&gt; attributs de l’élément</span><span class="sxs-lookup"><span data-stu-id="2de60-164">**Table 1**: A Summary of the &lt;forms&gt; Element's Attributes</span></span>

<span data-ttu-id="2de60-165">Dans ASP.NET 2.0 et versions ultérieures, la valeur par défaut des valeurs d’authentification forms sont codés en dur dans la classe FormsAuthenticationConfiguration dans le .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2de60-165">In ASP.NET 2.0 and beyond, the default forms authentication values are hard-coded in the FormsAuthenticationConfiguration class in the .NET Framework.</span></span> <span data-ttu-id="2de60-166">Toutes les modifications doivent être appliquées sur une base de l’application en application dans le fichier Web.config.</span><span class="sxs-lookup"><span data-stu-id="2de60-166">Any modifications must be applied on an application-by-application basis in the Web.config file.</span></span> <span data-ttu-id="2de60-167">Cela diffère de ASP.NET 1.x, où les valeurs de l’authentification de formulaires par défaut ont été stockées dans le fichier machine.config (et par conséquent peut être modifiés via la modification de machine.config).</span><span class="sxs-lookup"><span data-stu-id="2de60-167">This differs from ASP.NET 1.x, where the default forms authentication values were stored in the machine.config file (and could therefore be modified via editing machine.config).</span></span> <span data-ttu-id="2de60-168">Sur la rubrique d’ASP.NET 1.x, il est judicieux de mentionner que plusieurs les paramètres du système d’authentification forms ont des valeurs par défaut différentes dans ASP.NET 2.0 et autres fonctionnalités que dans ASP.NET 1.x.</span><span class="sxs-lookup"><span data-stu-id="2de60-168">While on the topic of ASP.NET 1.x, it is worthwhile to mention that a number of the forms authentication system settings have different default values in ASP.NET 2.0 and beyond than in ASP.NET 1.x.</span></span> <span data-ttu-id="2de60-169">Si vous migrez votre application à partir d’un environnement de 1.x ASP.NET, il est important de connaître ces différences.</span><span class="sxs-lookup"><span data-stu-id="2de60-169">If you are migrating your application from an ASP.NET 1.x environment, it is important to be aware of these differences.</span></span> <span data-ttu-id="2de60-170">Consultez [le &lt;forms&gt; documentation technique d’élément](https://msdn.microsoft.com/library/1d3t3c61.aspx) pour obtenir la liste des différences.</span><span class="sxs-lookup"><span data-stu-id="2de60-170">Consult [the &lt;forms&gt; element technical documentation](https://msdn.microsoft.com/library/1d3t3c61.aspx) for a list of the differences.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-171">Plusieurs paramètres d’authentification de formulaires, tels que le délai d’attente, le domaine et le chemin d’accès, spécifient les détails pour le cookie de ticket d’authentification forms résultant.</span><span class="sxs-lookup"><span data-stu-id="2de60-171">Several forms authentication settings, such as the timeout, domain, and path, specify details for the resulting forms authentication ticket cookie.</span></span> <span data-ttu-id="2de60-172">Pour plus d’informations sur les cookies, leur fonctionnement et leurs différentes propriétés, consultez [ce didacticiel Cookies](http://www.quirksmode.org/js/cookies.html).</span><span class="sxs-lookup"><span data-stu-id="2de60-172">For more information on cookies, how they work, and their various properties, read [this Cookies tutorial](http://www.quirksmode.org/js/cookies.html).</span></span>


### <a name="specifying-the-tickets-timeout-value"></a><span data-ttu-id="2de60-173">En spécifiant la valeur de délai d’attente du Ticket</span><span class="sxs-lookup"><span data-stu-id="2de60-173">Specifying the Ticket's Timeout Value</span></span>

<span data-ttu-id="2de60-174">Le ticket d’authentification par formulaires est un jeton qui représente une identité.</span><span class="sxs-lookup"><span data-stu-id="2de60-174">The forms authentication ticket is a token that represents an identity.</span></span> <span data-ttu-id="2de60-175">Avec les tickets d’authentification basée sur les cookies, ce jeton est conservé sous la forme d’un cookie et envoyé au serveur à chaque demande web.</span><span class="sxs-lookup"><span data-stu-id="2de60-175">With cookie-based authentication tickets, this token is held in the form of a cookie and sent to the web server on each request.</span></span> <span data-ttu-id="2de60-176">Possession du jeton, par essence, déclare, je *nom d’utilisateur*, je ne se sont déjà connectés et est utilisée pour que l’identité d’un utilisateur peut être mémorisée une visite de la page.</span><span class="sxs-lookup"><span data-stu-id="2de60-176">Possession of the token, in essence, declares, I am *username*, I have already logged in, and is used so that a user's identity can be remembered across page visits.</span></span>

<span data-ttu-id="2de60-177">Le ticket d’authentification forms comprend l’identité de l’utilisateur mais contient également des informations pour aider à garantir l’intégrité et la sécurité du jeton.</span><span class="sxs-lookup"><span data-stu-id="2de60-177">The forms authentication ticket not only includes the user's identity, but also contains information to help ensure the integrity and security of the token.</span></span> <span data-ttu-id="2de60-178">Après tout, nous ne voulons pas un utilisateur malveillant pour pouvoir créer un jeton de contrefaçon, ou pour modifier un jeton légitimes d’une certaine façon underhanded.</span><span class="sxs-lookup"><span data-stu-id="2de60-178">After all, we don't want a nefarious user to be able to create a counterfeit token, or to modify a legit token in some underhanded way.</span></span>

<span data-ttu-id="2de60-179">Un bit de ce type d’informations inclus dans le ticket est un *expiration*, qui est la date et l’heure que le ticket n’est plus valide.</span><span class="sxs-lookup"><span data-stu-id="2de60-179">One such bit of information included in the ticket is an *expiry*, which is the date and time the ticket is no longer valid.</span></span> <span data-ttu-id="2de60-180">Chaque fois que le FormsAuthenticationModule inspecte un ticket d’authentification, elle garantit que les expiration du ticket n’a pas encore réussi.</span><span class="sxs-lookup"><span data-stu-id="2de60-180">Each time the FormsAuthenticationModule inspects an authentication ticket, it ensures that the ticket's expiry has not yet passed.</span></span> <span data-ttu-id="2de60-181">S’il a, il ignore le ticket et identifie l’utilisateur comme étant anonyme.</span><span class="sxs-lookup"><span data-stu-id="2de60-181">If it has, it disregards the ticket and identifies the user as being anonymous.</span></span> <span data-ttu-id="2de60-182">Cette précaution vous protège contre les attaques par relecture.</span><span class="sxs-lookup"><span data-stu-id="2de60-182">This safeguard helps protect against replay attacks.</span></span> <span data-ttu-id="2de60-183">Sans un délai d’expiration, si un pirate a été en mesure d’obtenir ses mains sur un ticket d’authentification valide d’un utilisateur - peut-être par l’accès physique à leur ordinateur et racine via leurs cookies - ils pourrait envoyer une demande au serveur avec ce ticket d’authentification volé et peut accéder.</span><span class="sxs-lookup"><span data-stu-id="2de60-183">Without an expiry, if a hacker was able to get her hands on a user's valid authentication ticket - perhaps by gaining physical access to their computer and rooting through their cookies - they could send a request to the server with this stolen authentication ticket and gain entry.</span></span> <span data-ttu-id="2de60-184">Alors que l’expiration n’empêche pas ce scénario, il ne limite la fenêtre au cours de laquelle une telle attaque peut réussir.</span><span class="sxs-lookup"><span data-stu-id="2de60-184">While the expiry doesn't prevent this scenario, it does limit the window during which such an attack can succeed.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-185">Étape 3 détails techniques supplémentaires utilisées par le système d’authentification de formulaires pour protéger le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-185">Step 3 details additional techniques used by the forms authentication system to protect the authentication ticket.</span></span>


<span data-ttu-id="2de60-186">Lorsque vous créez le ticket d’authentification, le système d’authentification forms détermine son expiration en consultant le paramètre de délai d’attente.</span><span class="sxs-lookup"><span data-stu-id="2de60-186">When creating the authentication ticket, the forms authentication system determines its expiry by consulting the timeout setting.</span></span> <span data-ttu-id="2de60-187">Comme indiqué dans le tableau 1, le délai d’attente définissant les valeurs par défaut à 30 minutes, ce qui signifie que lors de la création du ticket d’authentification forms son expiration est définie à une date et heure, 30 minutes dans le futur.</span><span class="sxs-lookup"><span data-stu-id="2de60-187">As noted in Table 1, the timeout setting defaults to 30 minutes, meaning that when the forms authentication ticket is created its expiry is set to a date and time 30 minutes in the future.</span></span>

<span data-ttu-id="2de60-188">L’expiration définit une heure absolue à l’avenir lorsque le ticket d’authentification forms expire.</span><span class="sxs-lookup"><span data-stu-id="2de60-188">The expiry defines an absolute time in the future when the forms authentication ticket expires.</span></span> <span data-ttu-id="2de60-189">Toutefois, généralement aux développeurs d’implémenter une expiration décalée, qui est réinitialisé chaque fois que l’utilisateur visite le site.</span><span class="sxs-lookup"><span data-stu-id="2de60-189">But usually developers want to implement a sliding expiry, one that is reset every time the user revisits the site.</span></span> <span data-ttu-id="2de60-190">Ce comportement est déterminé par les paramètres de slidingExpiration.</span><span class="sxs-lookup"><span data-stu-id="2de60-190">This behavior is determined by the slidingExpiration settings.</span></span> <span data-ttu-id="2de60-191">Si la valeur true (valeur par défaut), chaque fois que le FormsAuthenticationModule authentifie un utilisateur, il met à jour les expiration du ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-191">If set to true (the default), each time the FormsAuthenticationModule authenticates a user, it updates the ticket's expiry.</span></span> <span data-ttu-id="2de60-192">Si la valeur est false, l’expiration n’est pas mis à jour à chaque demande, ce qui provoquera l’expiration du délai d’attente exactement les nombre de minutes après le ticket lors de la première du ticket est créé.</span><span class="sxs-lookup"><span data-stu-id="2de60-192">If set to false, the expiry is not updated on each request, thereby causing the ticket to expire exactly timeout number of minutes past when the ticket was first created.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-193">L’expiration stockée dans le ticket d’authentification est une date absolue et la valeur d’heure, tel que 2 août 2008 11:34:00.</span><span class="sxs-lookup"><span data-stu-id="2de60-193">The expiry stored in the authentication ticket is an absolute date and time value, like August 2, 2008 11:34 AM.</span></span> <span data-ttu-id="2de60-194">En outre, la date et l’heure sont par rapport au temps de local du serveur web.</span><span class="sxs-lookup"><span data-stu-id="2de60-194">Moreover, the date and time are relative to the web server's local time.</span></span> <span data-ttu-id="2de60-195">Cette décision peut avoir des effets intéressants autour de l’heure d’été (DST), c'est-à-dire lorsque les horloges aux États-Unis sont déplacés en avance d’une heure (en supposant que le serveur web est hébergé dans les paramètres régionaux où l’heure d’été est prise en charge).</span><span class="sxs-lookup"><span data-stu-id="2de60-195">This design decision can have some interesting side effects around Daylight Saving Time (DST), which is when clocks in the United States are moved ahead one hour (assuming the web server is hosted in a locale where Daylight Saving Time is observed).</span></span> <span data-ttu-id="2de60-196">Envisagez les conséquences d’un site Web d’ASP.NET avec une expiration de 30 minutes près de l’heure de début de l’heure d’été (qui correspond à 2 h 00).</span><span class="sxs-lookup"><span data-stu-id="2de60-196">Consider what would happen for an ASP.NET website with a 30 minute expiry near the time that DST begins (which is at 2:00 AM).</span></span> <span data-ttu-id="2de60-197">Imaginez qu'un visiteur se connecte sur le site du 11 mars 2008 à 1 h 55.</span><span class="sxs-lookup"><span data-stu-id="2de60-197">Imagine a visitor signs on to the site on March 11, 2008 at 1:55 AM.</span></span> <span data-ttu-id="2de60-198">Cela génère un ticket d’authentification de formulaires qui expire à 11 mars 2008 à 2 h 25 (30 minutes dans le futur).</span><span class="sxs-lookup"><span data-stu-id="2de60-198">This would generate a forms authentication ticket that expires at March 11, 2008 at 2:25 AM (30 minutes in the future).</span></span> <span data-ttu-id="2de60-199">Toutefois, une fois que la prochaine 2 h 00, l’horloge passe à 3:00 AM en raison de l’heure d’été.</span><span class="sxs-lookup"><span data-stu-id="2de60-199">However, once 2:00 AM rolls around, the clock jumps to 3:00 AM because of DST.</span></span> <span data-ttu-id="2de60-200">Lorsque l’utilisateur charge une nouvelle page six minutes après l’ouverture de session (à 3 h 01), FormsAuthenticationModule note que le ticket a expiré et qu’il redirige l’utilisateur vers la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="2de60-200">When the user loads a new page six minutes after signing in (at 3:01 AM), the FormsAuthenticationModule notes that the ticket has expired and redirects the user to the login page.</span></span> <span data-ttu-id="2de60-201">Pour une discussion plus approfondie sur cela et autres singularités de délai d’expiration de ticket d’authentification, ainsi que solutions de contournement, ils récupèrent une copie de Stefan Schackow *Professional ASP.NET 2.0 sécurité, l’appartenance et la gestion des rôles* (ISBN : 978-0-7645-9698-8).</span><span class="sxs-lookup"><span data-stu-id="2de60-201">For a more thorough discussion on this and other authentication ticket timeout oddities, as well as workarounds, pick up a copy of Stefan Schackow's *Professional ASP.NET 2.0 Security, Membership, and Role Management* (ISBN: 978-0-7645-9698-8).</span></span>


<span data-ttu-id="2de60-202">La figure 1 illustre le flux de travail lorsque slidingExpiration est définie sur false et le délai d’attente est défini sur 30.</span><span class="sxs-lookup"><span data-stu-id="2de60-202">Figure 1 illustrates the workflow when slidingExpiration is set to false and timeout is set to 30.</span></span> <span data-ttu-id="2de60-203">Notez que le ticket d’authentification généré lors de la connexion contient la date d’expiration, et cette valeur n’est pas mis à jour sur les demandes suivantes.</span><span class="sxs-lookup"><span data-stu-id="2de60-203">Note that the authentication ticket generated at login contains the expiration date, and this value is not updated on subsequent requests.</span></span> <span data-ttu-id="2de60-204">Si le FormsAuthenticationModule détecte que le ticket a expiré, il supprime et traite la requête comme anonyme.</span><span class="sxs-lookup"><span data-stu-id="2de60-204">If the FormsAuthenticationModule finds that the ticket has expired, it discards it and treats the request as anonymous.</span></span>


<span data-ttu-id="2de60-205">[![Une représentation graphique de slidingExpiration d’expiration lors du Ticket d’authentification de formulaires a la valeur false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-205">[![A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false](forms-authentication-configuration-and-advanced-topics-cs/_static/image2.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image1.png)</span></span>

<span data-ttu-id="2de60-206">**Figure 01**: représentation graphique de slidingExpiration d’expiration lors du Ticket d’authentification de formulaires est false ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-206">**Figure 01**: A Graphical Representation of the Forms Authentication Ticket's Expiry When slidingExpiration is false([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image3.png))</span></span>


<span data-ttu-id="2de60-207">La figure 2 illustre le flux de travail lorsque slidingExpiration est définie sur true et le délai d’attente est défini sur 30.</span><span class="sxs-lookup"><span data-stu-id="2de60-207">Figure 2 shows the workflow when slidingExpiration is set to true and timeout is set to 30.</span></span> <span data-ttu-id="2de60-208">Lorsqu’une demande authentifiée est reçue (avec un ticket non expirés) son expiration est mis à jour au nombre de délai d’attente de minutes dans le futur.</span><span class="sxs-lookup"><span data-stu-id="2de60-208">When an authenticated request is received (with a non-expired ticket) its expiry is updated to timeout number of minutes in the future.</span></span>


<span data-ttu-id="2de60-209">[![Une représentation graphique du Ticket d’authentification de formulaires lorsque slidingExpiration est true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-209">[![A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true](forms-authentication-configuration-and-advanced-topics-cs/_static/image5.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image4.png)</span></span>

<span data-ttu-id="2de60-210">**Figure 02**: représentation graphique du Ticket d’authentification de formulaires lorsque slidingExpiration est true ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-210">**Figure 02**: A Graphical Representation of the Forms Authentication Ticket's When slidingExpiration is true  ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image6.png))</span></span>


<span data-ttu-id="2de60-211">Lors de l’utilisation de tickets d’authentification basée sur les cookies (la valeur par défaut), cette discussion devient un peu plus compliquée, car les cookies peuvent également avoir leurs propre expirations dans le spécifié.</span><span class="sxs-lookup"><span data-stu-id="2de60-211">When using cookie-based authentication tickets (the default), this discussion becomes a little more confusing because cookies can also have their own expiries specified.</span></span> <span data-ttu-id="2de60-212">Expiration d’un cookie (ou d’absence de ce) indique au navigateur lorsque le cookie doit être détruit.</span><span class="sxs-lookup"><span data-stu-id="2de60-212">A cookie's expiry (or lack thereof) instructs the browser when the cookie should be destroyed.</span></span> <span data-ttu-id="2de60-213">Si le cookie ne dispose pas d’un délai d’expiration, il est détruit lorsque le navigateur s’arrête.</span><span class="sxs-lookup"><span data-stu-id="2de60-213">If the cookie lacks an expiry, it is destroyed when the browser shuts down.</span></span> <span data-ttu-id="2de60-214">Si un délai d’expiration est présent, toutefois, le cookie reste stocké sur l’ordinateur de l’utilisateur jusqu'à la date et heure spécifiée dans l’expiration est passée.</span><span class="sxs-lookup"><span data-stu-id="2de60-214">If an expiry is present, however, the cookie remains stored on the user's computer until the date and time specified in the expiry has passed.</span></span> <span data-ttu-id="2de60-215">Lorsqu’un cookie est détruit par le navigateur, il n’est plus envoyé au serveur web.</span><span class="sxs-lookup"><span data-stu-id="2de60-215">When a cookie is destroyed by the browser, it is no longer sent to the web server.</span></span> <span data-ttu-id="2de60-216">Par conséquent, la destruction d’un cookie est analogue à l’utilisateur de journalisation du site.</span><span class="sxs-lookup"><span data-stu-id="2de60-216">Therefore, the destruction of a cookie is analogous to the user logging out of the site.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-217">Bien entendu, un utilisateur peut supprimer proactive de tous les cookies stockés sur leur ordinateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-217">Of course, a user may proactively remove any cookies stored on their computer.</span></span> <span data-ttu-id="2de60-218">Dans Internet Explorer 7, vous accédez à outils, Options et cliquez sur le bouton Supprimer dans la section de l’historique de navigation.</span><span class="sxs-lookup"><span data-stu-id="2de60-218">In Internet Explorer 7, you would go to Tools, Options, and click the Delete button in the Browsing history section.</span></span> <span data-ttu-id="2de60-219">À partir de là, cliquez sur Supprimer les cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-219">From there, click the Delete cookies button.</span></span>


<span data-ttu-id="2de60-220">Le système d’authentification de formulaires crée des cookies de session ou d’expiration en fonction de la valeur transmise à la *persistCookie* paramètre.</span><span class="sxs-lookup"><span data-stu-id="2de60-220">The forms authentication system creates session-based or expiry-based cookies depending on the value passed in to the *persistCookie* parameter.</span></span> <span data-ttu-id="2de60-221">Souvenez-vous que la classe FormsAuthentication GetAuthCookie, SetAuthCookie et RedirectFromLoginPage acceptent deux paramètres d’entrée : *nom d’utilisateur* et *persistCookie*.</span><span class="sxs-lookup"><span data-stu-id="2de60-221">Recall that the FormsAuthentication class's GetAuthCookie, SetAuthCookie, and RedirectFromLoginPage methods take in two input parameters: *username* and *persistCookie*.</span></span> <span data-ttu-id="2de60-222">La page de connexion que nous avons créés dans le didacticiel précédent inclus une Mémoriser mes informations case à cocher, de déterminer si un cookie persistant a été créé.</span><span class="sxs-lookup"><span data-stu-id="2de60-222">The login page we created in the preceding tutorial included a Remember me CheckBox, which determined whether a persistent cookie was created.</span></span> <span data-ttu-id="2de60-223">Les cookies persistants sont en fonction d’expiration ; cookies non persistants sont basés sur une session.</span><span class="sxs-lookup"><span data-stu-id="2de60-223">Persistent cookies are expiry-based; non-persistent cookies are session-based.</span></span>

<span data-ttu-id="2de60-224">Les concepts de délai d’attente et slidingExpiration présentés précédemment appliquent la même pour les deux cookies basées sur session et d’expiration.</span><span class="sxs-lookup"><span data-stu-id="2de60-224">The timeout and slidingExpiration concepts already discussed apply the same to both session- and expiry-based cookies.</span></span> <span data-ttu-id="2de60-225">Il existe uniquement une petite différence au niveau de l’exécution : lors de l’utilisation de cookies d’expiration avec slidingTimeout la valeur true, les expiration du cookie sont uniquement mis à jour lorsque plus de la moitié du temps spécifié écoulé.</span><span class="sxs-lookup"><span data-stu-id="2de60-225">There is only one minor difference in execution: when using expiry-based cookies with slidingTimeout set to true, the cookie's expiry is only updated when more than half of the specified time has elapsed.</span></span>

<span data-ttu-id="2de60-226">Nous allons mettre à jour les stratégies de délai d’expiration de ticket d’authentification de notre site Web afin que des tickets de délai d’attente après une heure (60 minutes), à l’aide d’une expiration décalée.</span><span class="sxs-lookup"><span data-stu-id="2de60-226">Let's update our website's authentication ticket timeout policies so that tickets timeout after one hour (60 minutes), using a sliding expiration.</span></span> <span data-ttu-id="2de60-227">Pour effectuer cette modification, mettre à jour le fichier Web.config, ajout d’un &lt;forms&gt; élément à la &lt;l’authentification&gt; élément par le balisage suivant :</span><span class="sxs-lookup"><span data-stu-id="2de60-227">To effect this change, update the Web.config file, adding a &lt;forms&gt; element to the &lt;authentication&gt; element with the following markup:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample2.xml)]

### <a name="using-an-login-page-url-other-than-loginaspx"></a><span data-ttu-id="2de60-228">À l’aide d’une URL de Page de connexion autres que Login.aspx</span><span class="sxs-lookup"><span data-stu-id="2de60-228">Using an Login Page URL Other than Login.aspx</span></span>

<span data-ttu-id="2de60-229">Étant donné que FormsAuthenticationModule redirige automatiquement les utilisateurs non autorisés vers la page de connexion, il a besoin de connaître l’URL de la page de connexion.</span><span class="sxs-lookup"><span data-stu-id="2de60-229">Since the FormsAuthenticationModule automatically redirects unauthorized users to the login page, it needs to know the login page's URL.</span></span> <span data-ttu-id="2de60-230">Cette URL est spécifiée par l’attribut loginUrl dans le &lt;forms&gt; élément et la valeur par défaut est login.aspx.</span><span class="sxs-lookup"><span data-stu-id="2de60-230">This URL is specified by the loginUrl attribute in the &lt;forms&gt; element and defaults to login.aspx.</span></span> <span data-ttu-id="2de60-231">Si vous déplacez sur un site Web existant, vous avez peut-être déjà une page de connexion avec une autre URL, ce qui a déjà été contenant un signet et indexé par les moteurs de recherche.</span><span class="sxs-lookup"><span data-stu-id="2de60-231">If you are porting over an existing website, you may already have a login page with a different URL, one that has already been bookmarked and indexed by search engines.</span></span> <span data-ttu-id="2de60-232">Au lieu de renommer votre page de connexion existante vers login.aspx et avec rupture des liens et les signets d’utilisateurs, vous pouvez à la place modifier l’attribut loginUrl pour pointer vers votre page de connexion.</span><span class="sxs-lookup"><span data-stu-id="2de60-232">Rather than renaming your existing login page to login.aspx and breaking links and users' bookmarks, you can instead modify the loginUrl attribute to point to your login page.</span></span>

<span data-ttu-id="2de60-233">Par exemple, si votre page de connexion a été nommé SignIn.aspx et se trouvait dans l’annuaire d’utilisateurs, vous pouvez pointer le paramètre de configuration loginUrl à ~/Users/SignIn.aspx comme suit :</span><span class="sxs-lookup"><span data-stu-id="2de60-233">For example, if your login page was named SignIn.aspx and was located in the Users directory, you could point the loginUrl configuration setting to ~/Users/SignIn.aspx like so:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample3.xml)]

<span data-ttu-id="2de60-234">Étant donné que notre application a déjà en cours a une page de connexion nommée Login.aspx, il est inutile de spécifier une valeur personnalisée dans le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="2de60-234">Since our current application already has a login page named Login.aspx, there's no need to specify a custom value in the &lt;forms&gt; element.</span></span>

## <a name="step-2-using-cookieless-forms-authentication-tickets"></a><span data-ttu-id="2de60-235">Étape 2 : À l’aide de Tickets d’authentification par formulaire sans cookie</span><span class="sxs-lookup"><span data-stu-id="2de60-235">Step 2: Using Cookieless Forms Authentication Tickets</span></span>

<span data-ttu-id="2de60-236">Par défaut, le système d’authentification forms détermine s’il faut stocker ses tickets d’authentification dans la collection de cookies ou de les incorporer dans l’URL en fonction de l’agent utilisateur visitant le site.</span><span class="sxs-lookup"><span data-stu-id="2de60-236">By default the forms authentication system determines whether to store its authentication tickets in the cookies collection or embed them in the URL based on the user agent visiting the site.</span></span> <span data-ttu-id="2de60-237">Tous les navigateurs de bureau standard comme Internet Explorer, Firefox, Opera et Safari, les cookies de prise en charge, mais pas tous les appareils mobiles ne.</span><span class="sxs-lookup"><span data-stu-id="2de60-237">All mainstream desktop browsers like Internet Explorer, Firefox, Opera, and Safari, support cookies, but not all mobile devices do.</span></span>

<span data-ttu-id="2de60-238">La stratégie utilisée par le système d’authentification forms varie selon le paramètre cookieless dans le &lt;forms&gt; élément, ce qui peut être assigné à une des quatre valeurs :</span><span class="sxs-lookup"><span data-stu-id="2de60-238">The cookie policy used by the forms authentication system depends on the cookieless setting in the &lt;forms&gt; element, which can be assigned one of four values:</span></span>

- <span data-ttu-id="2de60-239">UseCookies - Spécifie que les tickets d’authentification basée sur le cookie seront toujours utilisés.</span><span class="sxs-lookup"><span data-stu-id="2de60-239">UseCookies - specifies that cookie-based authentication tickets will always be used.</span></span>
- <span data-ttu-id="2de60-240">UseUri - indique que les tickets de l’authentification par cookie ne seront jamais utilisées.</span><span class="sxs-lookup"><span data-stu-id="2de60-240">UseUri - indicates that cookie-based authentication tickets will never be used.</span></span>
- <span data-ttu-id="2de60-241">Détection automatique - si le profil de périphérique ne prend pas en charge les cookies, les tickets de l’authentification basée sur les cookies ne sont pas utilisés. Si le profil du périphérique prend en charge les cookies, un mécanisme de détection permet de déterminer si les cookies sont activés.</span><span class="sxs-lookup"><span data-stu-id="2de60-241">AutoDetect - if the device profile does not support cookies, cookie-based authentication tickets are not used; if the device profile supports cookies, a probing mechanism is used to determine if cookies are enabled.</span></span>
- <span data-ttu-id="2de60-242">UseDeviceProfile - la valeur par défaut ; utilise des tickets de l’authentification par cookie uniquement si le profil du périphérique prend en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-242">UseDeviceProfile - the default; uses cookie-based authentication tickets only if the device profile supports cookies.</span></span> <span data-ttu-id="2de60-243">Aucun mécanisme de détection n’est utilisé.</span><span class="sxs-lookup"><span data-stu-id="2de60-243">No probing mechanism is used.</span></span>

<span data-ttu-id="2de60-244">Les paramètres de détection automatique et UseDeviceProfile s’appuient sur une *profil de périphérique* de déterminer s’il faut utiliser des tickets d’authentification basé sur cookie ou sans cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-244">The AutoDetect and UseDeviceProfile settings rely on a *device profile* in ascertaining whether to use cookie-based or cookieless authentication tickets.</span></span> <span data-ttu-id="2de60-245">ASP.NET gère une base de données de différents appareils et de leurs fonctionnalités, telles que s’ils prennent en charge les cookies, quelle version de JavaScript, ils prennent en charge et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="2de60-245">ASP.NET maintains a database of various devices and their capabilities, such as whether they support cookies, what version of JavaScript they support, and so on.</span></span> <span data-ttu-id="2de60-246">Chaque fois qu’un périphérique demande une page web à partir d’un serveur web qu’il envoie le long d’un *agent utilisateur* en-tête HTTP qui identifie le type de périphérique.</span><span class="sxs-lookup"><span data-stu-id="2de60-246">Each time a device requests a web page from a web server it sends along a *user-agent* HTTP header that identifies the device type.</span></span> <span data-ttu-id="2de60-247">ASP.NET met automatiquement en correspondance la chaîne user-agent fourni avec le profil correspondant spécifié dans sa base de données.</span><span class="sxs-lookup"><span data-stu-id="2de60-247">ASP.NET automatically matches the supplied user-agent string with the corresponding profile specified in its database.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-248">Cette base de données de fonctionnalités de l’appareil est stocké dans un nombre de fichiers XML qui respectent le [schéma de fichier de définition de navigateur](https://msdn.microsoft.com/library/ms228122.aspx).</span><span class="sxs-lookup"><span data-stu-id="2de60-248">This database of device capabilities is stored in a number of XML files that adhere to the [Browser Definition File schema](https://msdn.microsoft.com/library/ms228122.aspx).</span></span> <span data-ttu-id="2de60-249">Les fichiers de profil de périphérique par défaut se trouvent dans % WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span><span class="sxs-lookup"><span data-stu-id="2de60-249">The default device profile files are located in %WINDIR%\Microsoft.Net\Framework\v2.0.50727\CONFIG\Browsers.</span></span> <span data-ttu-id="2de60-250">Vous pouvez également ajouter des fichiers personnalisés à application votre application\_dossier des navigateurs.</span><span class="sxs-lookup"><span data-stu-id="2de60-250">You can also add custom files to your application's App\_Browsers folder.</span></span> <span data-ttu-id="2de60-251">Pour plus d’informations, consultez [Comment : détecter les Types de navigateurs dans les Pages Web ASP.NET](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span><span class="sxs-lookup"><span data-stu-id="2de60-251">For more information, see [How To: Detect Browser Types in ASP.NET Web Pages](https://msdn.microsoft.com/library/3yekbd5b.aspx).</span></span>


<span data-ttu-id="2de60-252">Étant donné que le paramètre par défaut est UseDeviceProfile, tickets d’authentification par formulaire sans cookies seront utilisés lorsque le site est visité par un périphérique dont le profil signale qu’il ne prend pas en charge les cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-252">Because the default setting is UseDeviceProfile, cookieless forms authentication tickets will be used when the site is visited by a device whose profile reports that it does not support cookies.</span></span>

### <a name="encoding-the-authentication-ticket-in-the-url"></a><span data-ttu-id="2de60-253">Le Ticket d’authentification dans l’URL de l’encodage</span><span class="sxs-lookup"><span data-stu-id="2de60-253">Encoding the Authentication Ticket in the URL</span></span>

<span data-ttu-id="2de60-254">Les cookies sont un support naturel des informations à partir du navigateur dans chaque demande d’un site Web particulier, c’est pourquoi les paramètres d’authentification de formulaires par défaut utilisent des cookies si l’appareil visite les prend en charge.</span><span class="sxs-lookup"><span data-stu-id="2de60-254">Cookies are a natural medium for including information from the browser in each request to a particular website, which is why the default forms authentication settings use cookies if the visiting device supports them.</span></span> <span data-ttu-id="2de60-255">Si les cookies ne sont pas pris en charge, d’autres moyens pour transmettre le ticket d’authentification du client au serveur doit être utilisée.</span><span class="sxs-lookup"><span data-stu-id="2de60-255">If cookies are not supported, an alternate means for passing the authentication ticket from the client to the server must be employed.</span></span> <span data-ttu-id="2de60-256">Une solution courante utilisée dans des environnements sans cookie consiste à encoder les données de cookie dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-256">A common workaround used in cookieless environments is to encode the cookie data in the URL.</span></span>

<span data-ttu-id="2de60-257">La meilleure façon de voir comment ces informations peuvent être incorporées dans l’URL est pour forcer le site utilise des tickets d’authentification sans cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-257">The best way to see how such information can be embedded within the URL is to force the site to use cookieless authentication tickets.</span></span> <span data-ttu-id="2de60-258">Cela peut être accompli en définissant le paramètre de configuration sans cookie pour UseUri :</span><span class="sxs-lookup"><span data-stu-id="2de60-258">This can be accomplished by setting the cookieless configuration setting to UseUri:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample4.xml)]

<span data-ttu-id="2de60-259">Une fois que vous avez apporté cette modification, visitez le site via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-259">Once you have made this change, visit the site through a browser.</span></span> <span data-ttu-id="2de60-260">Lors de la visite en tant qu’utilisateur anonyme, l’URL ressemble exactement comme auparavant.</span><span class="sxs-lookup"><span data-stu-id="2de60-260">When visiting as an anonymous user, the URLs will look exactly like they did before.</span></span> <span data-ttu-id="2de60-261">Par exemple, lorsque vous visitez la page Default.aspx barre d’adresses de mon navigateur affiche l’URL suivante :</span><span class="sxs-lookup"><span data-stu-id="2de60-261">For example, when visiting Default.aspx page my browser's address bar shows the following URL:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/default.aspx`

<span data-ttu-id="2de60-262">Toutefois, lors de la connexion, le ticket d’authentification par formulaires est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-262">However, upon logging in, the forms authentication ticket is embedded into the URL.</span></span> <span data-ttu-id="2de60-263">Par exemple, après la visite de la page de connexion et d’ouverture de session en tant que Sam, je reviens à la page Default.aspx, mais cette fois de l’URL est :</span><span class="sxs-lookup"><span data-stu-id="2de60-263">For example, after visiting the login page and logging in as Sam, I am returned to the Default.aspx page, but the URL this time is:</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/default.aspx`

<span data-ttu-id="2de60-264">Le ticket d’authentification forms a été intégré dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-264">The forms authentication ticket has been embedded within the URL.</span></span> <span data-ttu-id="2de60-265">La chaîne (F (jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) représente les informations de ticket d’authentification de codé en hexadécimal, et sont les mêmes données sont généralement stockées dans un cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-265">The string (F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2) represents the hex-encoded authentication ticket information, and is the same data that is usually stored within a cookie.</span></span>

<span data-ttu-id="2de60-266">Dans l’ordre cookieless tickets d’authentification à utiliser, le système doit encoder toutes les URL dans la page pour inclure les données de ticket d’authentification, sinon le ticket d’authentification seront perdu lorsque l’utilisateur clique sur un lien.</span><span class="sxs-lookup"><span data-stu-id="2de60-266">In order for cookieless authentication tickets to work, the system must encode all URLs on the page to include the authentication ticket data, otherwise the authentication ticket will be lost when the user clicks on a link.</span></span> <span data-ttu-id="2de60-267">Heureusement, cette logique d’incorporation est effectuée automatiquement.</span><span class="sxs-lookup"><span data-stu-id="2de60-267">Thankfully, this embedding logic is performed automatically.</span></span> <span data-ttu-id="2de60-268">Pour illustrer cette fonctionnalité, ouvrez la page Default.aspx et ajouter un contrôle de lien hypertexte, en définissant ses propriétés Text et NavigateUrl pour tester le lien et SomePage.aspx, respectivement.</span><span class="sxs-lookup"><span data-stu-id="2de60-268">To demonstrate this functionality, open the Default.aspx page and add a HyperLink control, setting its Text and NavigateUrl properties to Test Link and SomePage.aspx, respectively.</span></span> <span data-ttu-id="2de60-269">Peu importe qu’il n’est pas vraiment une page dans notre projet nommé SomePage.aspx.</span><span class="sxs-lookup"><span data-stu-id="2de60-269">It doesn't matter that there really isn't a page in our project named SomePage.aspx.</span></span>

<span data-ttu-id="2de60-270">Enregistrez les modifications dans Default.aspx, puis vous accédez il via un navigateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-270">Save the changes to Default.aspx and then visit it through a browser.</span></span> <span data-ttu-id="2de60-271">Ouvrez une session le site afin que le ticket d’authentification par formulaires est incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-271">Log on to the site so that the forms authentication ticket is embedded in the URL.</span></span> <span data-ttu-id="2de60-272">Ensuite, à partir de Default.aspx, cliquez sur le lien de lien de Test.</span><span class="sxs-lookup"><span data-stu-id="2de60-272">Next, from Default.aspx, click the Test Link link.</span></span> <span data-ttu-id="2de60-273">Que s'est-il passé ?</span><span class="sxs-lookup"><span data-stu-id="2de60-273">What happened?</span></span> <span data-ttu-id="2de60-274">Si aucune page nommé SomePage.aspx existe, puis une erreur 404 s’est produite, mais qui n’est pas ce qui est important ici.</span><span class="sxs-lookup"><span data-stu-id="2de60-274">If no page named SomePage.aspx exists, then a 404 error occurred, but that's not what's important here.</span></span> <span data-ttu-id="2de60-275">Concentrez-vous plutôt sur la barre d’adresses dans votre navigateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-275">Instead, focus on the Address bar in your browser.</span></span> <span data-ttu-id="2de60-276">Notez qu’il inclut le ticket d’authentification de formulaires dans l’URL !</span><span class="sxs-lookup"><span data-stu-id="2de60-276">Note that it includes the forms authentication ticket in the URL!</span></span>

`http://localhost:2448/ASPNET\_Security\_Tutorial\_03\_CS/(F(jaIOIDTJxIr12xYS-VVgkqKCVAuIoW30Bu0diWi6flQC-FyMaLXJfow\_Vd9GZkB2Cv-rfezq0gKadKX0YPZCkA2))/SomePage.aspx`

<span data-ttu-id="2de60-277">L’URL SomePage.aspx dans le lien a été automatiquement convertie en une URL incluant le ticket d’authentification - nous n’aviez pas à écrire la moindre ligne de code !</span><span class="sxs-lookup"><span data-stu-id="2de60-277">The URL SomePage.aspx in the link was automatically converted into a URL that included the authentication ticket - we didn't have to write a lick of code!</span></span> <span data-ttu-id="2de60-278">Le ticket d’authentification par formulaire est incorporé automatiquement dans l’URL pour tous les liens hypertexte qui ne commencent pas par http:// ou /.</span><span class="sxs-lookup"><span data-stu-id="2de60-278">The form authentication ticket will automatically be embedded in the URL for any hyperlinks that do not start with http:// or /.</span></span> <span data-ttu-id="2de60-279">Peu importe si le lien hypertexte s’affiche dans un appel de Response.Redirect, dans un contrôle de lien hypertexte ou dans un élément d’ancrage HTML (par exemple, &lt;un href = «... »&gt;... &lt;/a&gt;).</span><span class="sxs-lookup"><span data-stu-id="2de60-279">It doesn't matter if the hyperlink appears in a call to Response.Redirect, in a HyperLink control, or in an anchor HTML element (i.e., &lt;a href="..."&gt;...&lt;/a&gt;).</span></span> <span data-ttu-id="2de60-280">Tant que l’URL n’est pas quelque chose comme http://www.someserver.com/SomePage.aspx ou /SomePage.aspx, le ticket d’authentification forms est incorporé pour nous.</span><span class="sxs-lookup"><span data-stu-id="2de60-280">As long as the URL isn't something like http://www.someserver.com/SomePage.aspx or /SomePage.aspx, the forms authentication ticket will be embedded for us.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-281">Tickets d’authentification par formulaire sans cookies respectent les mêmes stratégies de délai d’attente que les tickets d’authentification basée sur le cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-281">Cookieless forms authentication tickets adhere to the same timeout policies as cookie-based authentication tickets.</span></span> <span data-ttu-id="2de60-282">Toutefois, les tickets d’authentification sans cookies sont plus sujets aux attaques par relecture, car le ticket d’authentification est directement incorporé dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-282">However, cookieless authentication tickets are more prone to replay attacks since the authentication ticket is embedded directly in the URL.</span></span> <span data-ttu-id="2de60-283">Imaginez un utilisateur visite un site Web, se connecte, puis colle l’URL dans un message électronique à un collègue.</span><span class="sxs-lookup"><span data-stu-id="2de60-283">Imagine a user who visits a website, logs in, and then pastes the URL in an email to a colleague.</span></span> <span data-ttu-id="2de60-284">Si la collègue clique sur ce lien avant l’expiration est atteint, elles seront enregistrées en tant que l’utilisateur qui a envoyé le message électronique !</span><span class="sxs-lookup"><span data-stu-id="2de60-284">If the colleague clicks on that link before the expiry is reached, they will be logged in as the user who sent the email!</span></span>


## <a name="step-3-securing-the-authentication-ticket"></a><span data-ttu-id="2de60-285">Étape 3 : Sécurisation le Ticket d’authentification</span><span class="sxs-lookup"><span data-stu-id="2de60-285">Step 3: Securing the Authentication Ticket</span></span>

<span data-ttu-id="2de60-286">Le ticket d’authentification par formulaires est transmis via le réseau soit dans un cookie ou incorporée directement dans l’URL.</span><span class="sxs-lookup"><span data-stu-id="2de60-286">The forms authentication ticket is transmitted over the wire either in a cookie or embedded directly within the URL.</span></span> <span data-ttu-id="2de60-287">En plus des informations d’identité, le ticket d’authentification peut également inclure des données utilisateur (comme nous allons le voir à l’étape 4).</span><span class="sxs-lookup"><span data-stu-id="2de60-287">In addition to identity information, the authentication ticket can also include user data (as we will see in Step 4).</span></span> <span data-ttu-id="2de60-288">Par conséquent, il est important que les données du ticket sont chiffrées des regards et (surtout) que le système d’authentification forms peut garantir que le ticket a été pas falsifié.</span><span class="sxs-lookup"><span data-stu-id="2de60-288">Consequently, it is important that the ticket's data is encrypted from prying eyes and (even more importantly) that the forms authentication system can guarantee that the ticket was not tampered with.</span></span>

<span data-ttu-id="2de60-289">Pour garantir la confidentialité des données du ticket, le système d’authentification forms peut chiffrer les données de ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-289">To ensure the privacy of the ticket's data, the forms authentication system can encrypt the ticket data.</span></span> <span data-ttu-id="2de60-290">Échec de chiffrer les données de ticket envoie des informations potentiellement sensibles sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="2de60-290">Failure to encrypt the ticket data sends potentially sensitive information over the wire in plain-text.</span></span>

<span data-ttu-id="2de60-291">Pour garantir l’authenticité d’un ticket, le système d’authentification forms doit *valider* le ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-291">To guarantee a ticket's authenticity, the forms authentication system must *validate* the ticket.</span></span> <span data-ttu-id="2de60-292">La validation est le fait de s’assurer qu’une portion de données n’a pas été modifiée et s’effectue un  *[le code d’authentification (MAC) du message](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span><span class="sxs-lookup"><span data-stu-id="2de60-292">Validation is the act of ensuring that a particular piece of data has not been modified, and is accomplished via a *[message authentication code (MAC)](http://en.wikipedia.org/wiki/Message_authentication_code)*.</span></span> <span data-ttu-id="2de60-293">En bref, le MAC est une petite partie des informations qui identifient les données qui devant être validée (dans ce cas, le ticket).</span><span class="sxs-lookup"><span data-stu-id="2de60-293">In a nutshell, the MAC is a small piece of information that identifies the data that needs to be validated (in this case, the ticket).</span></span> <span data-ttu-id="2de60-294">Si les données représentées par le MAC sont modifiées, puis le MAC et les données ne correspondront pas.</span><span class="sxs-lookup"><span data-stu-id="2de60-294">If the data represented by the MAC is modified, then the MAC and the data will not match up.</span></span> <span data-ttu-id="2de60-295">En outre, il est par le calcul difficile pour un pirate à modifier les données et générer son propre MAC pour correspondre avec les données modifiées.</span><span class="sxs-lookup"><span data-stu-id="2de60-295">Moreover, it is computationally hard for a hacker to both modify the data and generate his own MAC to correspond with the modified data.</span></span>

<span data-ttu-id="2de60-296">Lors de la création (ou modification) un ticket, le système d’authentification forms crée un MAC et l’attache aux données du ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-296">When creating (or modifying) a ticket, the forms authentication system creates a MAC and attaches it to the ticket's data.</span></span> <span data-ttu-id="2de60-297">Lorsqu’une demande suivante arrive, le système d’authentification de formulaires compare les données de ticket et le MAC pour valider l’authenticité des données de ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-297">When a subsequent request arrives, the forms authentication system compares the MAC and ticket data to validate the authenticity of the ticket data.</span></span> <span data-ttu-id="2de60-298">La figure 3 illustre ce flux de travail sous forme graphique.</span><span class="sxs-lookup"><span data-stu-id="2de60-298">Figure 3 illustrates this workflow graphically.</span></span>


<span data-ttu-id="2de60-299">[![L’authenticité du Ticket est assurée via un MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-299">[![The Ticket's Authenticity is Ensured through a MAC](forms-authentication-configuration-and-advanced-topics-cs/_static/image8.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image7.png)</span></span>

<span data-ttu-id="2de60-300">**Figure 03**: authenticité du Ticket est assurée via un MAC ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-300">**Figure 03**: The Ticket's Authenticity is Ensured through a MAC ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image9.png))</span></span>


<span data-ttu-id="2de60-301">Les mesures de sécurité sont appliquées pour le ticket d’authentification varie selon le paramètre de protection dans le &lt;forms&gt; élément.</span><span class="sxs-lookup"><span data-stu-id="2de60-301">What security measures are applied to the authentication ticket depends on the protection setting in the &lt;forms&gt; element.</span></span> <span data-ttu-id="2de60-302">Le paramètre de protection peut-être être affecté à une des trois valeurs suivantes :</span><span class="sxs-lookup"><span data-stu-id="2de60-302">The protection setting may be assigned to one of the following three values:</span></span>

- <span data-ttu-id="2de60-303">Tout - le ticket est chiffré et signé numériquement (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="2de60-303">All - the ticket is both encrypted and digitally signed (the default).</span></span>
- <span data-ttu-id="2de60-304">Chiffrement : uniquement le cryptage est appliqué : aucun MAC n’est généré.</span><span class="sxs-lookup"><span data-stu-id="2de60-304">Encryption - only encryption is applied - no MAC is generated.</span></span>
- <span data-ttu-id="2de60-305">Aucun - le ticket n’est ni chiffré ni signé numériquement.</span><span class="sxs-lookup"><span data-stu-id="2de60-305">None - the ticket is neither encrypted nor digitally signed.</span></span>
- <span data-ttu-id="2de60-306">Validation - un MAC est générée, mais les données de ticket sont envoyées sur le réseau en texte brut.</span><span class="sxs-lookup"><span data-stu-id="2de60-306">Validation - a MAC is generated, but the ticket data is sent over the wire in plain-text.</span></span>

<span data-ttu-id="2de60-307">Microsoft recommande l’utilisation du paramètre toutes les.</span><span class="sxs-lookup"><span data-stu-id="2de60-307">Microsoft strongly recommends using the All setting.</span></span>

### <a name="setting-the-validation-and-decryption-keys"></a><span data-ttu-id="2de60-308">Définition de la Validation et les clés de déchiffrement</span><span class="sxs-lookup"><span data-stu-id="2de60-308">Setting the Validation and Decryption Keys</span></span>

<span data-ttu-id="2de60-309">Le chiffrement et les algorithmes de hachage utilisés par le système d’authentification de formulaires pour chiffrer et valider le ticket d’authentification sont personnalisables par le biais du [ &lt;machineKey&gt; élément](https://msdn.microsoft.com/library/w8h3skw9.aspx) dans le fichier Web.config. Le tableau 2 décrit les &lt;machineKey&gt; attributs de l’élément et leurs valeurs possibles.</span><span class="sxs-lookup"><span data-stu-id="2de60-309">The encryption and hashing algorithms used by the forms authentication system to encrypt and validate the authentication ticket are customizable through the [&lt;machineKey&gt; element](https://msdn.microsoft.com/library/w8h3skw9.aspx) in Web.config. Table 2 outlines the &lt;machineKey&gt; element's attributes and their possible values.</span></span>

| <span data-ttu-id="2de60-310">**Attribut**</span><span class="sxs-lookup"><span data-stu-id="2de60-310">**Attribute**</span></span> | <span data-ttu-id="2de60-311">**Description**</span><span class="sxs-lookup"><span data-stu-id="2de60-311">**Description**</span></span> |
| --- | --- |
| <span data-ttu-id="2de60-312">déchiffrement</span><span class="sxs-lookup"><span data-stu-id="2de60-312">decryption</span></span> | <span data-ttu-id="2de60-313">Indique l’algorithme utilisé pour le chiffrement.</span><span class="sxs-lookup"><span data-stu-id="2de60-313">Indicates the algorithm used for encryption.</span></span> <span data-ttu-id="2de60-314">Cet attribut peut avoir une des quatre valeurs suivantes : - Auto - la valeur par défaut ; Détermine l’algorithme en fonction de la longueur de l’attribut validationKey.</span><span class="sxs-lookup"><span data-stu-id="2de60-314">This attribute can have one of the following four values: - Auto - the default; determines the algorithm based on the length of the decryptionKey attribute.</span></span> <span data-ttu-id="2de60-315">-AES - utilise le [Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithme.</span><span class="sxs-lookup"><span data-stu-id="2de60-315">- AES - uses the [Advanced Encryption Standard (AES)](http://en.wikipedia.org/wiki/Advanced_Encryption_Standard) algorithm.</span></span> <span data-ttu-id="2de60-316">-DES - utilise le [Standard DES (Data Encryption)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) cet algorithme est considérée comme faible de nombreuses ressources de calcul et ne doit pas être utilisé.</span><span class="sxs-lookup"><span data-stu-id="2de60-316">- DES - uses the [Data Encryption Standard (DES)](http://en.wikipedia.org/wiki/Data_Encryption_Standard) This algorithm is considered computationally weak and should not be used.</span></span> <span data-ttu-id="2de60-317">-3DES - utilise le [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithme, qui fonctionne en appliquant l’algorithme DES trois fois.</span><span class="sxs-lookup"><span data-stu-id="2de60-317">- 3DES - uses the [Triple DES](http://en.wikipedia.org/wiki/Triple_DES) algorithm, which works by applying the DES algorithm three times.</span></span> |
| <span data-ttu-id="2de60-318">validationKey</span><span class="sxs-lookup"><span data-stu-id="2de60-318">decryptionKey</span></span> | <span data-ttu-id="2de60-319">La clé secrète utilisée par l’algorithme de chiffrement.</span><span class="sxs-lookup"><span data-stu-id="2de60-319">The secret key used by the encryption algorithm.</span></span> <span data-ttu-id="2de60-320">Cette valeur doit être une chaîne hexadécimale de longueur appropriée (selon la valeur de déchiffrement), AutoGenerate ou une valeur ajoutée, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="2de60-320">This value must either be a hexadecimal string of the appropriate length (based on the value in decryption), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="2de60-321">Ajout de IsolateApps indique à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="2de60-321">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="2de60-322">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="2de60-322">The default is AutoGenerate,IsolateApps.</span></span> |
| <span data-ttu-id="2de60-323">validation</span><span class="sxs-lookup"><span data-stu-id="2de60-323">validation</span></span> | <span data-ttu-id="2de60-324">Indique l’algorithme utilisé pour la validation.</span><span class="sxs-lookup"><span data-stu-id="2de60-324">Indicates the algorithm used for validation.</span></span> <span data-ttu-id="2de60-325">Cet attribut peut avoir une des quatre valeurs suivantes : - AES - utilise l’algorithme Advanced Encryption Standard (AES).</span><span class="sxs-lookup"><span data-stu-id="2de60-325">This attribute can have one of the following four values: - AES - uses the Advanced Encryption Standard (AES) algorithm.</span></span> <span data-ttu-id="2de60-326">-MD5 - utilise le [Message Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithme.</span><span class="sxs-lookup"><span data-stu-id="2de60-326">- MD5 - uses the [Message-Digest 5 (MD5)](http://en.wikipedia.org/wiki/MD5) algorithm.</span></span> <span data-ttu-id="2de60-327">-SHA1 - utilise le [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithme (la valeur par défaut).</span><span class="sxs-lookup"><span data-stu-id="2de60-327">- SHA1 - uses the [SHA1](http://en.wikipedia.org/wiki/Sha1) algorithm (the default).</span></span> <span data-ttu-id="2de60-328">-3DES - utilise l’algorithme Triple DES.</span><span class="sxs-lookup"><span data-stu-id="2de60-328">- 3DES - uses the Triple DES algorithm.</span></span> |
| <span data-ttu-id="2de60-329">validationKey</span><span class="sxs-lookup"><span data-stu-id="2de60-329">validationKey</span></span> | <span data-ttu-id="2de60-330">La clé secrète utilisée par l’algorithme de validation.</span><span class="sxs-lookup"><span data-stu-id="2de60-330">The secret key used by the validation algorithm.</span></span> <span data-ttu-id="2de60-331">Cette valeur doit être une chaîne hexadécimale de la longueur appropriée (basé sur la valeur de validation), AutoGenerate ou une valeur ajoutée, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="2de60-331">This value must either be a hexadecimal string of the appropriate length (based on the value in validation), AutoGenerate, or either value appended with,IsolateApps.</span></span> <span data-ttu-id="2de60-332">Ajout de IsolateApps indique à ASP.NET d’utiliser une valeur unique pour chaque application.</span><span class="sxs-lookup"><span data-stu-id="2de60-332">Adding IsolateApps instructs ASP.NET to use a unique value for each application.</span></span> <span data-ttu-id="2de60-333">La valeur par défaut est AutoGenerate, IsolateApps.</span><span class="sxs-lookup"><span data-stu-id="2de60-333">The default is AutoGenerate,IsolateApps.</span></span> |

<span data-ttu-id="2de60-334">**Tableau 2**: le &lt;machineKey&gt; des attributs d’élément</span><span class="sxs-lookup"><span data-stu-id="2de60-334">**Table 2**: The &lt;machineKey&gt; Element Attributes</span></span>

<span data-ttu-id="2de60-335">Une discussion détaillée de ces options de chiffrement et la validation et les professionnels de l’et les inconvénients des différents algorithmes, sont dépasse le cadre de ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="2de60-335">A thorough discussion of these encryption and validation options, and the pros and cons of the various algorithms, is beyond the scope of this tutorial.</span></span> <span data-ttu-id="2de60-336">Pour en profondeur examiner ces problèmes, notamment des conseils sur les algorithmes de chiffrement et de validation à utiliser, les longueurs de clé à utiliser et comment mieux générer ces clés, reportez-vous à *Professional ASP.NET 2.0 sécurité, l’appartenance et la gestion des rôles* .</span><span class="sxs-lookup"><span data-stu-id="2de60-336">For an in-depth look at these issues, including guidance on what encryption and validation algorithms to use, what key lengths to use, and how best to generate these keys, refer to *Professional ASP.NET 2.0 Security, Membership, and Role Management*.</span></span>

<span data-ttu-id="2de60-337">Par défaut, les clés utilisées pour le chiffrement et la validation sont générés automatiquement pour chaque application, et ces clés sont stockées dans l’autorité de sécurité locale (LSA).</span><span class="sxs-lookup"><span data-stu-id="2de60-337">By default, the keys used for encryption and validation are generated automatically for each application, and these keys are stored in the Local Security Authority (LSA).</span></span> <span data-ttu-id="2de60-338">En bref, les paramètres par défaut garantit que les clés uniques sur un serveur web-par-serveur web et l’application par application.</span><span class="sxs-lookup"><span data-stu-id="2de60-338">In short, the default settings guarantee unique keys on a web server-by-web server and application-by-application basis.</span></span> <span data-ttu-id="2de60-339">Par conséquent, ce comportement par défaut ne fonctionne pas pour les deux scénarios suivants :</span><span class="sxs-lookup"><span data-stu-id="2de60-339">Consequently, this default behavior will not work for the two following scenarios:</span></span>

- <span data-ttu-id="2de60-340">**Batteries de serveurs Web** : dans un [batterie de serveurs web](http://en.wikipedia.org/wiki/Web_farm) scénario, une seule application web est hébergé sur plusieurs serveurs web à des fins d’évolutivité et de redondance.</span><span class="sxs-lookup"><span data-stu-id="2de60-340">**Web Farms** - in a [web farm](http://en.wikipedia.org/wiki/Web_farm) scenario, a single web application is hosted on multiple web servers for purposes of scalability and redundancy.</span></span> <span data-ttu-id="2de60-341">Chaque demande entrante est distribué à un serveur dans la batterie de serveurs, ce qui signifie que la durée de vie d’une session utilisateur, des serveurs différents peuvent utilisés pour gérer ses différentes requêtes.</span><span class="sxs-lookup"><span data-stu-id="2de60-341">Each incoming request is dispatched to a server in the farm, meaning that over the lifetime of a user's session, different servers may be used to handle his various requests.</span></span> <span data-ttu-id="2de60-342">Par conséquent, chaque serveur doit utiliser les mêmes clés de chiffrement et de validation afin que le ticket d’authentification forms créés, chiffré et validé sur un serveur peut être déchiffré et validé sur un autre serveur dans la batterie de serveurs.</span><span class="sxs-lookup"><span data-stu-id="2de60-342">Consequently, each server must use the same encryption and validation keys so that the forms authentication ticket created, encrypted, and validated on one server can be decrypted and validated on a different server in the farm.</span></span>
- <span data-ttu-id="2de60-343">**Cross-partage d’Application Ticket** -un serveur web peut héberger plusieurs applications ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2de60-343">**Cross Application Ticket Sharing** - a single web server may host multiple ASP.NET applications.</span></span> <span data-ttu-id="2de60-344">Si vous avez besoin pour ces différentes applications partager un ticket d’authentification unique de formulaires, il est impératif que leurs clés de chiffrement et validation correspondent.</span><span class="sxs-lookup"><span data-stu-id="2de60-344">If you need for these different applications to share a single forms authentication ticket, it is imperative that their encryption and validation keys match up.</span></span>

<span data-ttu-id="2de60-345">Lorsque vous travaillez dans une batterie de serveurs web, paramètre ou le partage de tickets d’authentification entre les applications sur le même serveur, vous devez configurer le &lt;machineKey&gt; élément dans les applications affectées afin que leur validationKey et les valeurs validationKey correspondent.</span><span class="sxs-lookup"><span data-stu-id="2de60-345">When working in a web farm setting or sharing authentication tickets across applications on the same server, you will need to configure the &lt;machineKey&gt; element in the affected applications so that their decryptionKey and validationKey values match up.</span></span>

<span data-ttu-id="2de60-346">Alors qu’aucun des scénarios ci-dessus s’applique à notre exemple d’application, nous pouvons toujours spécifier validationKey explicite et les valeurs validationKey et définir les algorithmes à utiliser.</span><span class="sxs-lookup"><span data-stu-id="2de60-346">While neither of the above scenarios applies to our sample application, we can still specify explicit decryptionKey and validationKey values and define the algorithms to be used.</span></span> <span data-ttu-id="2de60-347">Ajouter un &lt;machineKey&gt; paramètre au fichier Web.config :</span><span class="sxs-lookup"><span data-stu-id="2de60-347">Add a &lt;machineKey&gt; setting to the Web.config file:</span></span>

[!code-xml[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample5.xml)]

<span data-ttu-id="2de60-348">Pour plus d’informations consultez [comment faire : configurer MachineKey dans ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span><span class="sxs-lookup"><span data-stu-id="2de60-348">For more information check out [How To: Configure MachineKey in ASP.NET 2.0](https://msdn.microsoft.com/library/ms998288.aspx).</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-349">Les valeurs ValidationKey et validationKey ont été effectuées à partir de [Steve Gibson](http://www.grc.com/stevegibson.htm)de [parfait des mots de passe web page](https://www.grc.com/passwords.htm), ce qui génère de 64 caractères hexadécimaux aléatoires sur chaque visite de la page.</span><span class="sxs-lookup"><span data-stu-id="2de60-349">The decryptionKey and validationKey values were taken from [Steve Gibson](http://www.grc.com/stevegibson.htm)'s [Perfect Passwords web page](https://www.grc.com/passwords.htm), which generates 64 random hexadecimal characters on each page visit.</span></span> <span data-ttu-id="2de60-350">Pour réduire la probabilité de ces clés atteindre dans vos applications de production, il est conseillé de remplacer par ceux généré de manière aléatoire à partir de la page des mots de passe parfait clés ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="2de60-350">To lessen the likelihood of these keys making their way into your production applications, you are encouraged to replace the above keys with randomly generated ones from the Perfect Passwords page.</span></span>


## <a name="step-4-storing-additional-user-data-in-the-ticket"></a><span data-ttu-id="2de60-351">Étape 4 : Stockage des données utilisateur supplémentaires dans le Ticket</span><span class="sxs-lookup"><span data-stu-id="2de60-351">Step 4: Storing Additional User Data in the Ticket</span></span>

<span data-ttu-id="2de60-352">De nombreuses applications web, affichent des informations sur ou affichage de la page de base sur l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="2de60-352">Many web applications display information about or base the page's display on the currently logged on user.</span></span> <span data-ttu-id="2de60-353">Par exemple, une page web peut afficher le nom d’utilisateur et la date qu'elle dernière session dans l’angle supérieur de chaque page.</span><span class="sxs-lookup"><span data-stu-id="2de60-353">For example, a web page might show the user's name and the date she last logged on in the upper corner of every page.</span></span> <span data-ttu-id="2de60-354">Le ticket d’authentification forms stocke le nom d’utilisateur de l’utilisateur actuellement connecté, mais toute autre information est nécessaire, la page doit se trouver dans le magasin de l’utilisateur - en général, une base de données - pour rechercher les informations non stockées dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-354">The forms authentication ticket stores the currently logged on user's username, but when any other information is needed, the page must go to the user store - typically a database - to lookup the information not stored in the authentication ticket.</span></span>

<span data-ttu-id="2de60-355">Avec un peu de code, nous pouvons stocker des informations utilisateur supplémentaires dans le ticket d’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-355">With a little bit of code we can store additional user information in the forms authentication ticket.</span></span> <span data-ttu-id="2de60-356">Ces données peuvent être exprimées par les [classe FormsAuthenticationTicket](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)de [propriété UserData](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span><span class="sxs-lookup"><span data-stu-id="2de60-356">Such data can be expressed through the [FormsAuthenticationTicket class](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.aspx)'s [UserData property](https://msdn.microsoft.com/library/system.web.security.formsauthenticationticket.userdata.aspx).</span></span> <span data-ttu-id="2de60-357">Cela est utile pour placer de petites quantités d’informations sur l’utilisateur qui est souvent nécessaire.</span><span class="sxs-lookup"><span data-stu-id="2de60-357">This is a useful place to put small amounts of information about the user that is commonly needed.</span></span> <span data-ttu-id="2de60-358">La valeur spécifiée dans le UserData propriété inclus dans le cadre du cookie de ticket d’authentification et, comme les autres champs de ticket, est chiffrée et validée basée sur la configuration du système de l’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-358">The value specified in the UserData property is included as part of the authentication ticket cookie and, like the other ticket fields, is encrypted and validated based on the forms authentication system's configuration.</span></span> <span data-ttu-id="2de60-359">Par défaut, UserData est une chaîne vide.</span><span class="sxs-lookup"><span data-stu-id="2de60-359">By default, UserData is an empty string.</span></span>

<span data-ttu-id="2de60-360">Pour stocker les données utilisateur dans le ticket d’authentification, nous devons écrire du code dans la page de connexion qui extrait les informations spécifiques à l’utilisateur et le stocke dans le ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-360">In order to store user data in the authentication ticket, we need to write a bit of code in the login page that grabs the user-specific information and stores it in the ticket.</span></span> <span data-ttu-id="2de60-361">UserData étant une propriété de type chaîne, les données qu’elle contient doivent être correctement sérialisées sous forme de chaîne.</span><span class="sxs-lookup"><span data-stu-id="2de60-361">Since UserData is a property of type string, the data stored in it must be properly serialized as a string.</span></span> <span data-ttu-id="2de60-362">Par exemple, imaginez que notre magasin de l’utilisateur inclus la date de naissance de chaque utilisateur et le nom de l’employeur et nous voulions stocker les valeurs de ces deux propriétés dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-362">For example, imagine that our user store included each user's date of birth and the name of their employer, and we wanted to store these two property values in the authentication ticket.</span></span> <span data-ttu-id="2de60-363">Nous avons sérialiser ces valeurs dans une chaîne en concaténant date de l’utilisateur de la chaîne de naissance avec une barre verticale (|), suivi du nom de l’employeur.</span><span class="sxs-lookup"><span data-stu-id="2de60-363">We could serialize these values into a string by concatenating the user's date of birth's string with a pipe ( | ), followed by the employer name.</span></span> <span data-ttu-id="2de60-364">Pour un utilisateur né le 15 août 1974 fonctionne pour Northwind Traders, nous allons affecter la chaîne à la propriété UserData : 1974-08-15 | Northwind Traders.</span><span class="sxs-lookup"><span data-stu-id="2de60-364">For a user born on August 15, 1974 that works for Northwind Traders, we would assign the UserData property the string: 1974-08-15|Northwind Traders .</span></span>

<span data-ttu-id="2de60-365">Chaque fois que nous avons besoin d’accéder aux données stockées dans le ticket, nous pouvons faire, en saisissant FormsAuthenticationTicket de la demande actuelle et de la désérialisation de la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="2de60-365">Whenever we need to access the data stored in the ticket, we can do so by grabbing the current request's FormsAuthenticationTicket and deserializing the UserData property.</span></span> <span data-ttu-id="2de60-366">Dans le cas de la date de naissance et employeur exemple de nom, nous fractionne la chaîne UserData en deux sous-chaînes en fonction du délimiteur (|).</span><span class="sxs-lookup"><span data-stu-id="2de60-366">In the case of the date of birth and employer name example, we would split the UserData string into two substrings based on the delimiter ( | ).</span></span>


<span data-ttu-id="2de60-367">[![Informations utilisateur supplémentaires peuvent être stockées dans le Ticket d’authentification](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-367">[![Additional User Information Can Be Stored in the Authentication Ticket](forms-authentication-configuration-and-advanced-topics-cs/_static/image11.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image10.png)</span></span>

<span data-ttu-id="2de60-368">**Figure 04**: supplémentaires utilisateur informations peuvent être stockées dans le Ticket d’authentification ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-368">**Figure 04**: Additional User Information Can Be Stored in the Authentication Ticket ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image12.png))</span></span>


### <a name="writing-information-to-userdata"></a><span data-ttu-id="2de60-369">Écriture d’informations dans UserData</span><span class="sxs-lookup"><span data-stu-id="2de60-369">Writing Information to UserData</span></span>

<span data-ttu-id="2de60-370">Malheureusement, l’ajout d’informations spécifiques à l’utilisateur à un ticket d’authentification de formulaires n’est pas aussi simple que celle attendue.</span><span class="sxs-lookup"><span data-stu-id="2de60-370">Unfortunately, adding user-specific information to a forms authentication ticket is not as straightforward as one might expect.</span></span> <span data-ttu-id="2de60-371">La propriété UserData de la classe FormsAuthenticationTicket est en lecture seule et ne peut être spécifiée via le constructeur de classe FormsAuthenticationTicket.</span><span class="sxs-lookup"><span data-stu-id="2de60-371">The UserData property of the FormsAuthenticationTicket class is read-only and can only be specified through the FormsAuthenticationTicket class constructor.</span></span> <span data-ttu-id="2de60-372">Lorsque vous spécifiez la propriété UserData dans le constructeur, nous devons également fournir le ticket d’autres valeurs : le nom d’utilisateur, la date d’émission, l’expiration et ainsi de suite.</span><span class="sxs-lookup"><span data-stu-id="2de60-372">When specifying the UserData property in the constructor, we also need to provide the ticket's other values: the username, the issue date, the expiration, and so on.</span></span> <span data-ttu-id="2de60-373">Lorsque nous avons créé la page de connexion dans le didacticiel précédent, cela a été toutes prises en charge par la classe FormsAuthentication.</span><span class="sxs-lookup"><span data-stu-id="2de60-373">When we created the login page in the preceding tutorial, this was all handled for us by the FormsAuthentication class.</span></span> <span data-ttu-id="2de60-374">Lorsque vous ajoutez UserData à FormsAuthenticationTicket, vous devrez écrire du code pour la plupart des fonctionnalités fournies par la classe FormsAuthentication répliquer.</span><span class="sxs-lookup"><span data-stu-id="2de60-374">When adding UserData to the FormsAuthenticationTicket, we will need to write code to replicate much of the functionality already provided by the FormsAuthentication class.</span></span>

<span data-ttu-id="2de60-375">Examinons le code nécessaire pour l’utilisation des UserData en mettant à jour de la page Login.aspx pour enregistrer des informations supplémentaires sur l’utilisateur pour le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-375">Let's explore the necessary code for working with UserData by updating the Login.aspx page to record additional information about the user to the authentication ticket.</span></span> <span data-ttu-id="2de60-376">Supposons que notre magasin de l’utilisateur contient des informations sur la société de l’utilisateur travaille pour et leur titre et que vous voulez capturer ces informations dans le ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-376">Pretend that our user store contains information about the company the user works for and their title, and that we want to capture this information in the authentication ticket.</span></span> <span data-ttu-id="2de60-377">Mise à jour LoginButton Gestionnaire d’événements de la page Login.aspx afin que le code ressemble à ceci :</span><span class="sxs-lookup"><span data-stu-id="2de60-377">Update the Login.aspx page's LoginButton Click event handler so that the code looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample6.cs)]

<span data-ttu-id="2de60-378">Examinons ce code ligne par ligne à la fois.</span><span class="sxs-lookup"><span data-stu-id="2de60-378">Let's step through this code one line at a time.</span></span> <span data-ttu-id="2de60-379">La méthode commence par définir quatre tableaux de chaînes : les utilisateurs, les mots de passe, companyName et titleAtCompany.</span><span class="sxs-lookup"><span data-stu-id="2de60-379">The method starts by defining four string arrays: users, passwords, companyName, and titleAtCompany.</span></span> <span data-ttu-id="2de60-380">Ces tableaux contiennent les noms d’utilisateur, les mots de passe, noms de société et des titres pour les comptes d’utilisateur dans le système, de laquelle il existe trois : Scott Jisun et Sam.</span><span class="sxs-lookup"><span data-stu-id="2de60-380">These arrays hold the usernames, passwords, company names, and titles for the user accounts in the system, of which there are three: Scott, Jisun, and Sam.</span></span> <span data-ttu-id="2de60-381">Dans une application réelle, ces valeurs seraient être interrogées à partir du magasin de l’utilisateur, ne pas codé en dur dans le code source de la page.</span><span class="sxs-lookup"><span data-stu-id="2de60-381">In a real application, these values would be queried from the user store, not hard-coded in the page's source code.</span></span>

<span data-ttu-id="2de60-382">Dans le didacticiel précédent, si les informations d’identification valides. nous vous avons appelé simplement FormsAuthentication.RedirectFromLoginPage (UserName.Text, RememberMe.Checked), qui a effectué les étapes suivantes :</span><span class="sxs-lookup"><span data-stu-id="2de60-382">In the previous tutorial, if the supplied credentials were valid we simply called FormsAuthentication.RedirectFromLoginPage(UserName.Text, RememberMe.Checked), which performed the following steps:</span></span>

1. <span data-ttu-id="2de60-383">Créé les formulaires ticket d’authentification</span><span class="sxs-lookup"><span data-stu-id="2de60-383">Created the forms authentication ticket</span></span>
2. <span data-ttu-id="2de60-384">Écriture du ticket dans le magasin approprié.</span><span class="sxs-lookup"><span data-stu-id="2de60-384">Wrote the ticket to the appropriate store.</span></span> <span data-ttu-id="2de60-385">Pour les tickets d’authentification basée sur les cookies, de la collection de cookies du navigateur est utilisée ; cookieless tickets d’authentification, les données de ticket sont sérialisées dans l’URL</span><span class="sxs-lookup"><span data-stu-id="2de60-385">For cookies-based authentication tickets, the browser's cookies collection is used; for cookieless authentication tickets, the ticket data is serialized into the URL</span></span>
3. <span data-ttu-id="2de60-386">Rediriger l’utilisateur à la page appropriée</span><span class="sxs-lookup"><span data-stu-id="2de60-386">Redirected the user to the appropriate page</span></span>

<span data-ttu-id="2de60-387">Ces étapes sont répliqués dans le code ci-dessus.</span><span class="sxs-lookup"><span data-stu-id="2de60-387">These steps are replicated in the code above.</span></span> <span data-ttu-id="2de60-388">Tout d’abord, la chaîne que nous allons finalement stocker dans la propriété UserData est formée en combinant le nom de la société et le titre, délimitant les deux valeurs avec une barre verticale (|).</span><span class="sxs-lookup"><span data-stu-id="2de60-388">First, the string we will eventually store in the UserData property is formed by combining the company name and the title, delimiting the two values with a pipe character ( | ).</span></span>

<span data-ttu-id="2de60-389">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span><span class="sxs-lookup"><span data-stu-id="2de60-389">string userDataString = string.Concat(companyName[i], "|", titleAtCompany[i]);</span></span>

<span data-ttu-id="2de60-390">Ensuite, le FormsAuthentication.GetAuthCookie méthode est appelée, ce qui crée le ticket d’authentification, chiffre valide selon les paramètres de configuration et le place dans un objet HttpCookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-390">Next, the FormsAuthentication.GetAuthCookie method is invoked, which creates the authentication ticket, encrypts and validates it according to the configuration settings, and places it in an HttpCookie object.</span></span>

<span data-ttu-id="2de60-391">HttpCookie authCookie = FormsAuthentication.GetAuthCookie (UserName.Text, RememberMe.Checked) ;</span><span class="sxs-lookup"><span data-stu-id="2de60-391">HttpCookie authCookie = FormsAuthentication.GetAuthCookie(UserName.Text, RememberMe.Checked);</span></span>

<span data-ttu-id="2de60-392">Afin de travailler avec le FormAuthenticationTicket incorporé dans le cookie, il faut appeler la classe FormAuthentication [déchiffrer méthode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), en passant la valeur du cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-392">In order to work with the FormAuthenticationTicket embedded within the cookie, we need to call the FormAuthentication class's [Decrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.decrypt.aspx), passing in the cookie value.</span></span>

<span data-ttu-id="2de60-393">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span><span class="sxs-lookup"><span data-stu-id="2de60-393">FormsAuthenticationTicket ticket = FormsAuthentication.Decrypt(authCookie.Value);</span></span>

<span data-ttu-id="2de60-394">Ensuite, nous créons un *nouvelle* FormsAuthenticationTicket instance selon les valeurs de FormsAuthenticationTicket existant.</span><span class="sxs-lookup"><span data-stu-id="2de60-394">We then create a *new* FormsAuthenticationTicket instance based on the existing FormsAuthenticationTicket's values.</span></span> <span data-ttu-id="2de60-395">Toutefois, ce nouveau ticket inclut les informations spécifiques à l’utilisateur (userDataString).</span><span class="sxs-lookup"><span data-stu-id="2de60-395">However, this new ticket includes the user-specific information (userDataString).</span></span>

<span data-ttu-id="2de60-396">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span><span class="sxs-lookup"><span data-stu-id="2de60-396">FormsAuthenticationTicket newTicket = new FormsAuthenticationTicket(ticket.Version, ticket.Name, ticket.IssueDate, ticket.Expiration, ticket.IsPersistent, userDataString);</span></span>

<span data-ttu-id="2de60-397">Nous puis chiffrer (et valider) la nouvelle instance de FormsAuthenticationTicket en appelant le [chiffrer méthode](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx)et remettre ces données chiffrées (et validées) dans authCookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-397">We then encrypt (and validate) the new FormsAuthenticationTicket instance by calling the [Encrypt method](https://msdn.microsoft.com/library/system.web.security.formsauthentication.encrypt.aspx), and put this encrypted (and validated) data back into authCookie.</span></span>

<span data-ttu-id="2de60-398">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span><span class="sxs-lookup"><span data-stu-id="2de60-398">authCookie.Value = FormsAuthentication.Encrypt(newTicket);</span></span>

<span data-ttu-id="2de60-399">Enfin, authCookie est ajouté à la collection Response.Cookies et la méthode GetRedirectUrl est appelée pour déterminer la page appropriée à envoyer à l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-399">Finally, authCookie is added to the Response.Cookies collection and the GetRedirectUrl method is called to determine the appropriate page to send the user.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample7.cs)]

<span data-ttu-id="2de60-400">Tout ce code est nécessaire, car la propriété UserData est en lecture seule et de la classe FormsAuthentication ne fournit pas de méthode pour spécifier les informations UserData dans ses méthodes GetAuthCookie, SetAuthCookie ou RedirectFromLoginPage.</span><span class="sxs-lookup"><span data-stu-id="2de60-400">All of this code is needed because the UserData property is read-only and the FormsAuthentication class does not provide any methods for specifying UserData information in its GetAuthCookie, SetAuthCookie, or RedirectFromLoginPage methods.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-401">Le code que nous avons examiné simplement stocke les informations spécifiques à l’utilisateur dans un ticket d’authentification basée sur les cookies.</span><span class="sxs-lookup"><span data-stu-id="2de60-401">The code we just examined stores user-specific information in a cookies-based authentication ticket.</span></span> <span data-ttu-id="2de60-402">Les classes doit sérialiser le ticket d’authentification de formulaires à l’URL sont internes au .NET Framework.</span><span class="sxs-lookup"><span data-stu-id="2de60-402">The classes responsible for serializing the forms authentication ticket to the URL are internal to the .NET Framework.</span></span> <span data-ttu-id="2de60-403">Résumer, vous ne pouvez pas stocker les données utilisateur dans un ticket d’authentification de formulaires sans cookie.</span><span class="sxs-lookup"><span data-stu-id="2de60-403">Long story short, you cannot store user data in a cookieless forms authentication ticket.</span></span>


### <a name="accessing-the-userdata-information"></a><span data-ttu-id="2de60-404">Accéder aux informations UserData</span><span class="sxs-lookup"><span data-stu-id="2de60-404">Accessing the UserData Information</span></span>

<span data-ttu-id="2de60-405">À ce stade nom de la société et le titre de chaque utilisateur sont stockées dans la propriété UserData du ticket d’authentification de formulaires lors de la connexion.</span><span class="sxs-lookup"><span data-stu-id="2de60-405">At this point each user's company name and title is stored in the forms authentication ticket's UserData property when they log in.</span></span> <span data-ttu-id="2de60-406">Cette information est accessible à partir du ticket d’authentification sur n’importe quelle page sans nécessiter un aller-retour vers le magasin de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-406">This information can be accessed from the authentication ticket on any page without requiring a trip to the user store.</span></span> <span data-ttu-id="2de60-407">Pour illustrer la façon dont ces informations peuvent être récupérées à partir de la propriété UserData, nous allons mettre à jour Default.aspx afin que son message d’accueil inclut non seulement le nom d’utilisateur, mais également l’entreprise qu’ils fonctionnent pour et leur titre.</span><span class="sxs-lookup"><span data-stu-id="2de60-407">To illustrate how this information can be retrieved from the UserData property, let's update Default.aspx so that its welcome message includes not only the user's name, but also the company they work for and their title.</span></span>

<span data-ttu-id="2de60-408">Actuellement, Default.aspx contient un panneau AuthenticatedMessagePanel avec un contrôle Label nommé WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="2de60-408">Currently, Default.aspx contains an AuthenticatedMessagePanel Panel with a Label control named WelcomeBackMessage.</span></span> <span data-ttu-id="2de60-409">Ce volet s’affiche uniquement pour les utilisateurs authentifiés.</span><span class="sxs-lookup"><span data-stu-id="2de60-409">This Panel is only displayed to authenticated users.</span></span> <span data-ttu-id="2de60-410">Mettre à jour le code dans la Page de Default.aspx\_charger le Gestionnaire d’événements pour qu’il ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="2de60-410">Update the code in Default.aspx's Page\_Load event handler so that it looks like the following:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample8.cs)]

<span data-ttu-id="2de60-411">Si Request.IsAuthenticated est true, alors du WelcomeBackMessage texte est tout d’abord définie sur Bienvenue, *nom d’utilisateur*.</span><span class="sxs-lookup"><span data-stu-id="2de60-411">If Request.IsAuthenticated is true, then the WelcomeBackMessage's Text property is first set to Welcome back, *username*.</span></span> <span data-ttu-id="2de60-412">Ensuite, la propriété User.Identity est effectuée à un objet FormsIdentity afin que nous pouvons accéder à FormsAuthenticationTicket sous-jacent.</span><span class="sxs-lookup"><span data-stu-id="2de60-412">Then, the User.Identity property is cast to a FormsIdentity object so that we can access the underlying FormsAuthenticationTicket.</span></span> <span data-ttu-id="2de60-413">Une fois que nous avons FormsAuthenticationTicket, nous désérialiser la propriété UserData dans le nom de la société et le titre.</span><span class="sxs-lookup"><span data-stu-id="2de60-413">Once we have the FormsAuthenticationTicket, we deserialize the UserData property into the company name and title.</span></span> <span data-ttu-id="2de60-414">Pour cela, vous devez fractionner la chaîne sur la barre verticale.</span><span class="sxs-lookup"><span data-stu-id="2de60-414">This is accomplished by splitting the string on the pipe character.</span></span> <span data-ttu-id="2de60-415">Le nom de la société et le titre sont ensuite affichés dans l’étiquette WelcomeBackMessage.</span><span class="sxs-lookup"><span data-stu-id="2de60-415">The company name and title are then displayed in the WelcomeBackMessage Label.</span></span>

<span data-ttu-id="2de60-416">La figure 5 illustre une capture d’écran de cet affichage en action.</span><span class="sxs-lookup"><span data-stu-id="2de60-416">Figure 5 shows a screenshot of this display in action.</span></span> <span data-ttu-id="2de60-417">Se connecter en tant que Scott affiche un message d’accueil précédent qui inclut la société et le titre de Scott.</span><span class="sxs-lookup"><span data-stu-id="2de60-417">Logging in as Scott displays a welcome back message that includes Scott's company and title.</span></span>


<span data-ttu-id="2de60-418">[![Société actuellement connecté sur l’utilisateur et le titre sont affichent.](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-418">[![The Currently Logged On User's Company and Title are Displayed](forms-authentication-configuration-and-advanced-topics-cs/_static/image14.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image13.png)</span></span>

<span data-ttu-id="2de60-419">**Figure 05**: société et le titre actuellement connecté sur l’utilisateur sont affichés ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-419">**Figure 05**: The Currently Logged On User's Company and Title are Displayed ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image15.png))</span></span>


> [!NOTE]
> <span data-ttu-id="2de60-420">Propriété de UserData du ticket d’authentification sert un cache pour le magasin de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-420">The authentication ticket's UserData property serves as a cache for the user store.</span></span> <span data-ttu-id="2de60-421">Comme tous les caches, il doit être mis à jour lorsque les données sous-jacentes sont modifiées.</span><span class="sxs-lookup"><span data-stu-id="2de60-421">Like any cache, it needs to be updated when the underlying data is modified.</span></span> <span data-ttu-id="2de60-422">Par exemple, s’il existe une page web à partir de laquelle les utilisateurs peuvent mettre à jour leur profil, les champs mis en cache dans la propriété UserData doivent être actualisés pour refléter les modifications apportées par l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-422">For example, if there is a web page from which users can update their profile, the fields cached in the UserData property must be refreshed to reflect the changes made by the user.</span></span>


## <a name="step-5-using-a-custom-principal"></a><span data-ttu-id="2de60-423">Étape 5 : À l’aide d’un principal de sécurité personnalisée</span><span class="sxs-lookup"><span data-stu-id="2de60-423">Step 5: Using a Custom Principal</span></span>

<span data-ttu-id="2de60-424">Sur chaque demande entrante FormsAuthenticationModule tente d’authentifier l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-424">On each incoming request the FormsAuthenticationModule attempts to authenticate the user.</span></span> <span data-ttu-id="2de60-425">Si un ticket d’authentification de non expiré est présent, FormsAuthenticationModule assigne la propriété HttpContext.User vers un nouvel objet GenericPrincipal.</span><span class="sxs-lookup"><span data-stu-id="2de60-425">If a non-expired authentication ticket is present, the FormsAuthenticationModule assigns the HttpContext.User property to a new GenericPrincipal object.</span></span> <span data-ttu-id="2de60-426">Cet objet GenericPrincipal a une identité de type FormsIdentity, qui inclut une référence pour le ticket d’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-426">This GenericPrincipal object has an Identity of type FormsIdentity, which includes a reference to the forms authentication ticket.</span></span> <span data-ttu-id="2de60-427">La classe GenericPrincipal contient les fonctionnalités minimales système requises par une classe qui implémente IPrincipal : elle doit simplement une propriété d’identité et à une méthode IsInRole.</span><span class="sxs-lookup"><span data-stu-id="2de60-427">The GenericPrincipal class contains the bare minimum functionality needed by a class that implements IPrincipal - it just has an Identity property and an IsInRole method.</span></span>

<span data-ttu-id="2de60-428">L’objet principal a deux tâches : pour indiquer quels rôles appartient l’utilisateur et pour fournir des informations d’identité.</span><span class="sxs-lookup"><span data-stu-id="2de60-428">The principal object has two responsibilities: to indicate what roles the user belongs to and to provide identity information.</span></span> <span data-ttu-id="2de60-429">Cela s’effectue via IsInRole l’interface IPrincipal (*roleName*) méthode et la propriété Identity, respectivement.</span><span class="sxs-lookup"><span data-stu-id="2de60-429">This is accomplished through the IPrincipal interface's IsInRole(*roleName*) method and Identity property, respectively.</span></span> <span data-ttu-id="2de60-430">La classe GenericPrincipal permet un tableau de chaînes des noms de rôles à être spécifié via son constructeur. son IsInRole (*roleName*) vérifie simplement pour voir si passé dans *roleName* existe dans le tableau de chaînes.</span><span class="sxs-lookup"><span data-stu-id="2de60-430">The GenericPrincipal class allows for a string array of role names to be specified via its constructor; its IsInRole(*roleName*) method merely checks to see if the passed in *roleName* exists within the string array.</span></span> <span data-ttu-id="2de60-431">Lorsque FormsAuthenticationModule crée l’objet GenericPrincipal, il passe au constructeur de la classe de GenericPrincipal dans un tableau de chaînes vide.</span><span class="sxs-lookup"><span data-stu-id="2de60-431">When the FormsAuthenticationModule creates the GenericPrincipal, it passes in an empty string array to the GenericPrincipal's constructor.</span></span> <span data-ttu-id="2de60-432">Par conséquent, un appel à IsInRole renvoie toujours false.</span><span class="sxs-lookup"><span data-stu-id="2de60-432">Consequently, any call to IsInRole will always return false.</span></span>

<span data-ttu-id="2de60-433">La classe GenericPrincipal répond aux besoins de la plupart des scénarios de l’authentification basée sur des formulaires où les rôles ne sont pas utilisés.</span><span class="sxs-lookup"><span data-stu-id="2de60-433">The GenericPrincipal class meets the needs for most forms based authentication scenarios where roles are not used.</span></span> <span data-ttu-id="2de60-434">Pour les cas où la gestion de rôle par défaut est insuffisante ou lorsque vous devez associer un objet IIdentity personnalisé à l’utilisateur, vous pouvez créer un objet IPrincipal personnalisé pendant le flux de travail de l’authentification et l’affecter à la propriété HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="2de60-434">For those situations where the default role handling is insufficient or when you need to associate a custom IIdentity object with the user, you can create a custom IPrincipal object during the authentication workflow and assign it to the HttpContext.User property.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-435">Comme nous le verrons dans les futures didacticiels, lorsque ASP. Infrastructure de rôles du réseau est activée qu’il crée un objet principal personnalisé de type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) et remplace l’objet GenericPrincipal créés par l’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-435">As we will see in future tutorials, when ASP.NET's Roles framework is enabled it creates a custom principal object of type [RolePrincipal](https://msdn.microsoft.com/library/system.web.security.roleprincipal.aspx) and overwrites the forms authentication-created GenericPrincipal object.</span></span> <span data-ttu-id="2de60-436">Il procède ainsi afin de personnaliser la méthode IsInRole du principal pour interagir avec les API de l’infrastructure de rôles.</span><span class="sxs-lookup"><span data-stu-id="2de60-436">It does this in order to customize the principal's IsInRole method to interface with the Roles framework's API.</span></span>


<span data-ttu-id="2de60-437">Étant donné que nous n'avons pas concerné nous-mêmes avec des rôles encore, la seule raison pour laquelle que nous aurait pour la création d’un objet principal personnalisé à partir de là serait pour associer un objet IIdentity personnalisé à l’entité de sécurité.</span><span class="sxs-lookup"><span data-stu-id="2de60-437">Since we have not concerned ourselves with roles yet, the only reason we would have for creating a custom principal at this juncture would be to associate a custom IIdentity object to the principal.</span></span> <span data-ttu-id="2de60-438">À l’étape 4, nous avons étudié le stockage des informations utilisateur supplémentaires dans la propriété UserData du ticket d’authentification, en particulier, leur titre et le nom de la société de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-438">In Step 4 we looked at storing additional user information in the authentication ticket's UserData property, in particular the user's company name and their title.</span></span> <span data-ttu-id="2de60-439">Toutefois, les informations UserData sont uniquement accessible via le ticket d’authentification et puis uniquement sous forme de chaîne sérialisée, ce qui signifie que chaque fois que vous souhaitez afficher les informations d’utilisateur stockées dans le ticket nous devons analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="2de60-439">However, the UserData information is only accessible through the authentication ticket and only then as a serialized string, meaning that anytime we want to view the user information stored in the ticket we need to parse the UserData property.</span></span>

<span data-ttu-id="2de60-440">Nous pouvons améliorer l’expérience du développeur en créant une classe qui implémente IIdentity et inclut des propriétés CompanyName et titre.</span><span class="sxs-lookup"><span data-stu-id="2de60-440">We can improve the developer experience by creating a class that implements IIdentity and includes CompanyName and Title properties.</span></span> <span data-ttu-id="2de60-441">De cette façon, un développeur peut accéder au nom de la société de l’utilisateur actuellement connecté et titre directement via les propriétés du titre et CompanyName sans nécessaire de savoir comment analyser la propriété UserData.</span><span class="sxs-lookup"><span data-stu-id="2de60-441">That way, a developer can access the currently logged on user's company name and title directly through the CompanyName and Title properties without needed to know how to parse the UserData property.</span></span>

### <a name="creating-the-custom-identity-and-principal-classes"></a><span data-ttu-id="2de60-442">Création de l’identité personnalisée et les Classes principales</span><span class="sxs-lookup"><span data-stu-id="2de60-442">Creating the Custom Identity and Principal Classes</span></span>

<span data-ttu-id="2de60-443">Pour ce didacticiel, nous allons créer les objets principal et identity personnalisés dans l’application\_dossier de Code.</span><span class="sxs-lookup"><span data-stu-id="2de60-443">For this tutorial, let's create the custom principal and identity objects in the App\_Code folder.</span></span> <span data-ttu-id="2de60-444">Commencez par ajouter une application\_dossier à votre projet de Code - avec le bouton droit sur le nom du projet dans l’Explorateur de solutions, sélectionnez l’option Ajouter le dossier ASP.NET et choisissez application\_Code.</span><span class="sxs-lookup"><span data-stu-id="2de60-444">Start by adding an App\_Code folder to your project - right-click on the project name in Solution Explorer, select the Add ASP.NET Folder option, and choose App\_Code.</span></span> <span data-ttu-id="2de60-445">L’application\_dossier de Code est un dossier spécial ASP.NET qui contient les fichiers de classes spécifiques au site Web.</span><span class="sxs-lookup"><span data-stu-id="2de60-445">The App\_Code folder is a special ASP.NET folder that holds class files specific to the website.</span></span>

> [!NOTE]
> <span data-ttu-id="2de60-446">L’application\_dossier de Code ne doit être utilisé lors de la gestion de votre projet via le modèle de projet de site Web.</span><span class="sxs-lookup"><span data-stu-id="2de60-446">The App\_Code folder should only be used when managing your project through the Website Project Model.</span></span> <span data-ttu-id="2de60-447">Si vous utilisez la [le modèle de projet d’Application Web](https://msdn.microsoft.com/asp.net/Aa336618.aspx), créez un dossier standard et qui renforcent les classes.</span><span class="sxs-lookup"><span data-stu-id="2de60-447">If you are using the [Web Application Project Model](https://msdn.microsoft.com/asp.net/Aa336618.aspx), create a standard folder and add the classes to that.</span></span> <span data-ttu-id="2de60-448">Par exemple, vous pourriez ajouter un nouveau dossier nommé Classes et placer votre code il.</span><span class="sxs-lookup"><span data-stu-id="2de60-448">For example, you could add a new folder named Classes, and place your code there.</span></span>


<span data-ttu-id="2de60-449">Ensuite, ajoutez deux nouveaux fichiers de classe à l’application\_dossier de Code, un CustomIdentity.cs nommée et l’autre nommé CustomPrincipal.cs.</span><span class="sxs-lookup"><span data-stu-id="2de60-449">Next, add two new class files to the App\_Code folder, one named CustomIdentity.cs and one named CustomPrincipal.cs.</span></span>


<span data-ttu-id="2de60-450">[![Ajoutez les CustomIdentity et les Classes de CustomPrincipal à votre projet](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-450">[![Add the CustomIdentity and CustomPrincipal Classes to Your Project](forms-authentication-configuration-and-advanced-topics-cs/_static/image17.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image16.png)</span></span>

<span data-ttu-id="2de60-451">**Figure 06**: ajouter les CustomIdentity et les Classes de CustomPrincipal à votre projet ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-451">**Figure 06**: Add the CustomIdentity and CustomPrincipal Classes to Your Project ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image18.png))</span></span>


<span data-ttu-id="2de60-452">La classe CustomIdentity est responsable de l’implémentation de l’interface IIdentity, qui définit les propriétés nom AuthenticationType et IsAuthenticated.</span><span class="sxs-lookup"><span data-stu-id="2de60-452">The CustomIdentity class is responsible for implementing the IIdentity interface, which defines the AuthenticationType, IsAuthenticated, and Name properties.</span></span> <span data-ttu-id="2de60-453">En plus de ces propriétés requises, nous sommes intéressés par exposer le sous-jacent ticket d’authentification forms ainsi que des propriétés pour le nom de la société et le titre de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-453">In addition to those required properties, we are interested in exposing the underlying forms authentication ticket as well as properties for the user's company name and title.</span></span> <span data-ttu-id="2de60-454">Entrez le code suivant dans la classe CustomIdentity.</span><span class="sxs-lookup"><span data-stu-id="2de60-454">Enter the following code into the CustomIdentity class.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample9.cs)]

<span data-ttu-id="2de60-455">Notez que la classe contient une variable de membre FormsAuthenticationTicket (\_ticket) et que ces informations de ticket doivent être fournies par le constructeur.</span><span class="sxs-lookup"><span data-stu-id="2de60-455">Note that the class includes a FormsAuthenticationTicket member variable (\_ticket) and that this ticket information must be supplied through the constructor.</span></span> <span data-ttu-id="2de60-456">Les données de ce ticket sont utilisées pour renvoyer le nom de l’identité ; Pour renvoyer les valeurs des propriétés CompanyName et titre, sa propriété UserData est analysée.</span><span class="sxs-lookup"><span data-stu-id="2de60-456">This ticket data is used in returning the identity's Name; its UserData property is parsed to return the values for the CompanyName and Title properties.</span></span>

<span data-ttu-id="2de60-457">Ensuite, créez la classe CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="2de60-457">Next, create the CustomPrincipal class.</span></span> <span data-ttu-id="2de60-458">Étant donné que nous ne sont pas concernés par les rôles à partir de là, constructeur de la classe CustomPrincipal accepte uniquement un objet CustomIdentity ; sa méthode IsInRole renvoie toujours false.</span><span class="sxs-lookup"><span data-stu-id="2de60-458">Since we are not concerned with roles at this juncture, the CustomPrincipal class's constructor accepts only a CustomIdentity object; its IsInRole method always returns false.</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample10.cs)]

### <a name="assigning-a-customprincipal-object-to-the-incoming-requests-security-context"></a><span data-ttu-id="2de60-459">Affectation d’un objet CustomPrincipal au contexte de sécurité de la demande entrante</span><span class="sxs-lookup"><span data-stu-id="2de60-459">Assigning a CustomPrincipal Object to the Incoming Request's Security Context</span></span>

<span data-ttu-id="2de60-460">Nous disposons désormais d’une classe qui étend la spécification d’identité par défaut pour inclure des propriétés CompanyName et titre, ainsi que d’une classe d’entité personnalisée qui utilise l’identité personnalisée.</span><span class="sxs-lookup"><span data-stu-id="2de60-460">We now have a class that extends the default IIdentity specification to include CompanyName and Title properties, as well as a custom principal class that uses the custom identity.</span></span> <span data-ttu-id="2de60-461">Nous prêts à l’étape dans le pipeline ASP.NET et que vous affectez de notre objet principal personnalisé au contexte de sécurité de la demande entrante.</span><span class="sxs-lookup"><span data-stu-id="2de60-461">We are ready to step into the ASP.NET pipeline and assign our custom principal object to the incoming request's security context.</span></span>

<span data-ttu-id="2de60-462">Le pipeline ASP.NET accepte une demande entrante et traite par le biais d’un nombre d’étapes.</span><span class="sxs-lookup"><span data-stu-id="2de60-462">The ASP.NET pipeline takes an incoming request and processes it through a number of steps.</span></span> <span data-ttu-id="2de60-463">À chaque étape, un événement particulier soit déclenché, ce qui permet aux développeurs d’exploiter le pipeline ASP.NET et modifiez la requête à certains points du cycle de vie.</span><span class="sxs-lookup"><span data-stu-id="2de60-463">At each step, a particular event is raised, making it possible for developers to tap into the ASP.NET pipeline and modify the request at certain points in its lifecycle.</span></span> <span data-ttu-id="2de60-464">FormsAuthenticationModule, par exemple, attend que ASP.NET déclencher le [événement AuthenticateRequest](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), à quel point il examine la demande entrante d’un ticket d’authentification.</span><span class="sxs-lookup"><span data-stu-id="2de60-464">The FormsAuthenticationModule, for example, waits for ASP.NET to raise the [AuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.authenticaterequest.aspx), at which point it inspects the incoming request for an authentication ticket.</span></span> <span data-ttu-id="2de60-465">Si un ticket d’authentification est trouvé, un objet GenericPrincipal est créé et affecté à la propriété HttpContext.User.</span><span class="sxs-lookup"><span data-stu-id="2de60-465">If an authentication ticket is found, a GenericPrincipal object is created and assigned to the HttpContext.User property.</span></span>

<span data-ttu-id="2de60-466">Après l’événement AuthenticateRequest, le pipeline ASP.NET déclenche le [PostAuthenticateRequest événement](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), qui est où nous pouvons remplacer l’objet GenericPrincipal créé par FormsAuthenticationModule avec une instance de notre Objet CustomPrincipal.</span><span class="sxs-lookup"><span data-stu-id="2de60-466">After the AuthenticateRequest event, the ASP.NET pipeline raises the [PostAuthenticateRequest event](https://msdn.microsoft.com/library/system.web.httpapplication.postauthenticaterequest.aspx), which is where we can replace the GenericPrincipal object created by the FormsAuthenticationModule with an instance of our CustomPrincipal object.</span></span> <span data-ttu-id="2de60-467">La figure 7 illustre ce flux de travail.</span><span class="sxs-lookup"><span data-stu-id="2de60-467">Figure 7 depicts this workflow.</span></span>


<span data-ttu-id="2de60-468">[![La classe GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-468">[![The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event](forms-authentication-configuration-and-advanced-topics-cs/_static/image20.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image19.png)</span></span>

<span data-ttu-id="2de60-469">**Figure 07**: le GenericPrincipal est remplacé par un CustomPrincipal dans l’événement PostAuthenticationRequest ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-469">**Figure 07**: The GenericPrincipal is Replaced by a CustomPrincipal in the PostAuthenticationRequest Event ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image21.png))</span></span>


<span data-ttu-id="2de60-470">Pour exécuter le code en réponse à un événement du pipeline ASP.NET, nous pouvons créer le Gestionnaire d’événements appropriée dans Global.asax ou créer votre propre HTTP Module.</span><span class="sxs-lookup"><span data-stu-id="2de60-470">In order to execute code in response to an ASP.NET pipeline event, we can either create the appropriate event handler in Global.asax or create our own HTTP Module.</span></span> <span data-ttu-id="2de60-471">Pour ce didacticiel nous allons créer le Gestionnaire d’événements dans Global.asax.</span><span class="sxs-lookup"><span data-stu-id="2de60-471">For this tutorial let's create the event handler in Global.asax.</span></span> <span data-ttu-id="2de60-472">Commencez par ajouter Global.asax à votre site Web.</span><span class="sxs-lookup"><span data-stu-id="2de60-472">Start by adding Global.asax to your website.</span></span> <span data-ttu-id="2de60-473">Avec le bouton droit sur le nom du projet dans l’Explorateur de solutions et ajouter un élément de type de classe d’Application globale nommé Global.asax.</span><span class="sxs-lookup"><span data-stu-id="2de60-473">Right-click on the project name in Solution Explorer and add an item of type Global Application Class named Global.asax.</span></span>


<span data-ttu-id="2de60-474">[![Ajouter un fichier Global.asax à votre site Web](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span><span class="sxs-lookup"><span data-stu-id="2de60-474">[![Add a Global.asax File to Your Website](forms-authentication-configuration-and-advanced-topics-cs/_static/image23.png)](forms-authentication-configuration-and-advanced-topics-cs/_static/image22.png)</span></span>

<span data-ttu-id="2de60-475">**Figure 08**: ajouter un fichier Global.asax pour votre site Web ([cliquez pour afficher l’image en taille réelle](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span><span class="sxs-lookup"><span data-stu-id="2de60-475">**Figure 08**: Add a Global.asax File to Your Website ([Click to view full-size image](forms-authentication-configuration-and-advanced-topics-cs/_static/image24.png))</span></span>


<span data-ttu-id="2de60-476">Le modèle de Global.asax par défaut inclut des gestionnaires d’événements pour un nombre d’événements de pipeline ASP.NET, y compris le début, fin et [événement d’erreur](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), entre autres.</span><span class="sxs-lookup"><span data-stu-id="2de60-476">The default Global.asax template includes event handlers for a number of the ASP.NET pipeline events, including the Start, End and [Error event](https://msdn.microsoft.com/library/system.web.httpapplication.error.aspx), among others.</span></span> <span data-ttu-id="2de60-477">N’hésitez pas à supprimer ces gestionnaires d’événements, comme nous ne les requièrent pas de cette application.</span><span class="sxs-lookup"><span data-stu-id="2de60-477">Feel free to remove these event handlers, as we do not need them for this application.</span></span> <span data-ttu-id="2de60-478">L’événement que nous sommes intéressés est PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="2de60-478">The event we are interested in is PostAuthenticateRequest.</span></span> <span data-ttu-id="2de60-479">Mettre à jour le fichier Global.asax afin de son balisage ressemble à ce qui suit :</span><span class="sxs-lookup"><span data-stu-id="2de60-479">Update your Global.asax file so its markup looks similar to the following:</span></span>

[!code-aspx[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample11.aspx)]

<span data-ttu-id="2de60-480">L’Application\_OnPostAuthenticateRequest méthode s’exécute chaque fois que le runtime ASP.NET déclenche l’événement PostAuthenticateRequest, ce qui se produit une fois sur chaque demande entrante de la page.</span><span class="sxs-lookup"><span data-stu-id="2de60-480">The Application\_OnPostAuthenticateRequest method executes each time the ASP.NET runtime raises the PostAuthenticateRequest event, which happens once on each incoming page request.</span></span> <span data-ttu-id="2de60-481">Le Gestionnaire d’événements commence par vérifier si l’utilisateur est authentifié et a été authentifié via l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="2de60-481">The event handler starts by checking to see if the user is authenticated and was authenticated via forms authentication.</span></span> <span data-ttu-id="2de60-482">Dans ce cas, un nouvel objet CustomIdentity est créé et passé le ticket d’authentification de la requête actuelle dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="2de60-482">If so, a new CustomIdentity object is created and passed the current request's authentication ticket in its constructor.</span></span> <span data-ttu-id="2de60-483">Un objet CustomPrincipal est créé et passé l’objet CustomIdentity nouvellement créé dans son constructeur.</span><span class="sxs-lookup"><span data-stu-id="2de60-483">Following that, a CustomPrincipal object is created and passed the just-created CustomIdentity object in its constructor.</span></span> <span data-ttu-id="2de60-484">Enfin, contexte de sécurité de la demande en cours est affecté à l’objet CustomPrincipal nouvellement créé.</span><span class="sxs-lookup"><span data-stu-id="2de60-484">Finally, the current request's security context is assigned to the newly created CustomPrincipal object.</span></span>

<span data-ttu-id="2de60-485">Notez que la dernière étape - associant l’objet CustomPrincipal du contexte de sécurité de la demande - assigne l’entité de sécurité à deux propriétés : HttpContext.User et Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="2de60-485">Note that the last step - associating the CustomPrincipal object with the request's security context - assigns the principal to two properties: HttpContext.User and Thread.CurrentPrincipal.</span></span> <span data-ttu-id="2de60-486">Ces deux affectations sont nécessaires en raison de la façon de contextes de sécurité sont gérées dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2de60-486">These two assignments are necessary because of the way security contexts are handled in ASP.NET.</span></span> <span data-ttu-id="2de60-487">Le .NET Framework associe un contexte de sécurité à chaque thread en cours d’exécution ; Ces informations sont disponibles en tant qu’objet IPrincipal via la [objet Thread](https://msdn.microsoft.com/library/system.threading.thread.aspx)de [propriété CurrentPrincipal](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span><span class="sxs-lookup"><span data-stu-id="2de60-487">The .NET Framework associates a security context with each running thread; this information is available as an IPrincipal object through the [Thread object](https://msdn.microsoft.com/library/system.threading.thread.aspx)'s [CurrentPrincipal property](https://msdn.microsoft.com/library/system.threading.thread.currentcontext.aspx).</span></span> <span data-ttu-id="2de60-488">Une confusion est que ASP.NET possède ses propres informations de contexte de sécurité (HttpContext.User).</span><span class="sxs-lookup"><span data-stu-id="2de60-488">What is a confusing is that ASP.NET has its own security context information (HttpContext.User).</span></span>

<span data-ttu-id="2de60-489">Dans certains scénarios, la propriété Thread.CurrentPrincipal est examinée pour déterminer le contexte de sécurité ; dans d’autres scénarios, HttpContext.User est utilisé.</span><span class="sxs-lookup"><span data-stu-id="2de60-489">In certain scenarios, the Thread.CurrentPrincipal property is examined when determining the security context; in other scenarios, HttpContext.User is used.</span></span> <span data-ttu-id="2de60-490">Par exemple, il existe des fonctionnalités de sécurité dans .NET qui permettent aux développeurs de façon déclarative indiquer ce que les utilisateurs ou rôles peuvent instancier une classe ou d’appeler des méthodes spécifiques (voir [Ajout de règles d’autorisation à l’entreprise et les données à l’aide de couches PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span><span class="sxs-lookup"><span data-stu-id="2de60-490">For example, there are security features in .NET that allow developers to declaratively state what users or roles can instantiate a class or invoke specific methods (see [Adding Authorization Rules to Business and Data Layers Using PrincipalPermissionAttributes](https://weblogs.asp.net/scottgu/archive/2006/10/04/Tip_2F00_Trick_3A00_-Adding-Authorization-Rules-to-Business-and-Data-Layers-using-PrincipalPermissionAttributes.aspx)).</span></span> <span data-ttu-id="2de60-491">Dans les coulisses, ces techniques déclaratives déterminent le contexte de sécurité via la propriété Thread.CurrentPrincipal.</span><span class="sxs-lookup"><span data-stu-id="2de60-491">Underneath the covers, these declarative techniques determine the security context via the Thread.CurrentPrincipal property.</span></span>

<span data-ttu-id="2de60-492">Dans d’autres scénarios, la propriété HttpContext.User est utilisée.</span><span class="sxs-lookup"><span data-stu-id="2de60-492">In other scenarios, the HttpContext.User property is used.</span></span> <span data-ttu-id="2de60-493">Par exemple, dans le didacticiel précédent, nous avons utilisé cette propriété pour afficher le nom d’utilisateur de l’utilisateur actuellement connecté.</span><span class="sxs-lookup"><span data-stu-id="2de60-493">For example, in the previous tutorial we used this property to display the currently logged on user's username.</span></span> <span data-ttu-id="2de60-494">Clairement, puis, il est impératif que les informations de contexte de sécurité dans les propriétés Thread.CurrentPrincipal et HttpContext.User correspondent.</span><span class="sxs-lookup"><span data-stu-id="2de60-494">Clearly, then, it is imperative that the security context information in the Thread.CurrentPrincipal and HttpContext.User properties match up.</span></span>

<span data-ttu-id="2de60-495">Le runtime ASP.NET synchronise automatiquement ces valeurs de propriété pour nous.</span><span class="sxs-lookup"><span data-stu-id="2de60-495">The ASP.NET runtime automatically syncs these property values for us.</span></span> <span data-ttu-id="2de60-496">Toutefois, cette synchronisation se produit après l’événement AuthenticateRequest, mais *avant* l’événement PostAuthenticateRequest.</span><span class="sxs-lookup"><span data-stu-id="2de60-496">However, this synchronization occurs after the AuthenticateRequest event, but *before* the PostAuthenticateRequest event.</span></span> <span data-ttu-id="2de60-497">Par conséquent, lors de l’ajout d’un objet principal personnalisé dans l’événement PostAuthenticateRequest nous devons être certains attribuer manuellement le Thread.CurrentPrincipal sinon Thread.CurrentPrincipal et HttpContext.User sera synchronisée. Consultez [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) pour plus d’informations sur ce problème.</span><span class="sxs-lookup"><span data-stu-id="2de60-497">Consequently, when adding a custom principal in the PostAuthenticateRequest event we need to be certain to manually assign the Thread.CurrentPrincipal or else Thread.CurrentPrincipal and HttpContext.User will be out of sync. See [Context.User vs. Thread.CurrentPrincipal](http://leastprivilege.com/2005/11/23/context-user-vs-thread-currentprincipal/) for a more detailed discussion on this issue.</span></span>

### <a name="accessing-the-companyname-and-title-properties"></a><span data-ttu-id="2de60-498">Accédez à le CompanyName et les propriétés du titre</span><span class="sxs-lookup"><span data-stu-id="2de60-498">Accessing the CompanyName and Title Properties</span></span>

<span data-ttu-id="2de60-499">Chaque fois qu’une demande arrive et qu’il soit distribuée au moteur ASP.NET, l’Application\_Gestionnaire d’événements OnPostAuthenticateRequest dans global.asax et se déclenche.</span><span class="sxs-lookup"><span data-stu-id="2de60-499">Whenever a request arrives and is dispatched to the ASP.NET engine, the Application\_OnPostAuthenticateRequest event handler in Global.asax will fire.</span></span> <span data-ttu-id="2de60-500">Si la demande a été correctement authentifiée par FormsAuthenticationModule, le Gestionnaire d’événements créera un nouvel objet CustomPrincipal avec un objet CustomIdentity selon le ticket d’authentification de formulaires.</span><span class="sxs-lookup"><span data-stu-id="2de60-500">If the request has been successfully authenticated by the FormsAuthenticationModule, the event handler will create a new CustomPrincipal object with a CustomIdentity object based on the forms authentication ticket.</span></span> <span data-ttu-id="2de60-501">Avec cette logique en place, l’accès aux informations sur le nom de la société et le titre de l’utilisateur actuellement connecté est extrêmement simple.</span><span class="sxs-lookup"><span data-stu-id="2de60-501">With this logic in place, accessing information about the currently logged on user's company name and title is incredibly straightforward.</span></span>

<span data-ttu-id="2de60-502">Revenir à la Page\_Gestionnaire d’événements de chargement dans Default.aspx, où à l’étape 4, nous avons rédigé code pour récupérer le ticket d’authentification par formulaire et analyser la propriété UserData afin d’afficher le nom de la société et le titre de l’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="2de60-502">Return to the Page\_Load event handler in Default.aspx, where in Step 4 we wrote code to retrieve the form authentication ticket and parse the UserData property in order to display the user's company name and title.</span></span> <span data-ttu-id="2de60-503">Avec les objets CustomPrincipal et CustomIdentity en cours d’utilisation maintenant, il est inutile pour analyser les valeurs de propriété de UserData du ticket.</span><span class="sxs-lookup"><span data-stu-id="2de60-503">With the CustomPrincipal and CustomIdentity objects in use now, there's no need to parse the values out of the ticket's UserData property.</span></span> <span data-ttu-id="2de60-504">Au lieu de cela, obtenir une référence à l’objet CustomIdentity simplement et utiliser ses propriétés CompanyName et titre :</span><span class="sxs-lookup"><span data-stu-id="2de60-504">Instead, simply get a reference to the CustomIdentity object and use its CompanyName and Title properties:</span></span>

[!code-csharp[Main](forms-authentication-configuration-and-advanced-topics-cs/samples/sample12.cs)]

## <a name="summary"></a><span data-ttu-id="2de60-505">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="2de60-505">Summary</span></span>

<span data-ttu-id="2de60-506">Dans ce didacticiel, nous avons examiné comment personnaliser les paramètres du système d’authentification forms via le fichier Web.config. Nous avons examiné comment les expiration du ticket d’authentification est gérée et comment les mécanismes de protection de chiffrement et la validation sont utilisés pour protéger le ticket d’inspection et de modification.</span><span class="sxs-lookup"><span data-stu-id="2de60-506">In this tutorial we examined how to customize the forms authentication system's settings via Web.config. We looked at how the authentication ticket's expiration is handled and how the encryption and validation safeguards are used to protect the ticket from inspection and modification.</span></span> <span data-ttu-id="2de60-507">Enfin, nous avons abordé à l’aide de la propriété UserData du ticket d’authentification pour stocker des informations utilisateur supplémentaires dans le ticket lui-même et comment utiliser des objets principal et identity personnalisés d’exposer ces informations de manière plus conviviales et.</span><span class="sxs-lookup"><span data-stu-id="2de60-507">Finally, we discussed using the authentication ticket's UserData property to store additional user information in the ticket itself, and how to use custom principal and identity objects to expose this information in a more developer-friendly manner.</span></span>

<span data-ttu-id="2de60-508">Ce didacticiel conclut notre examen de l’authentification par formulaire dans ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="2de60-508">This tutorial concludes our examination of forms authentication in ASP.NET.</span></span> <span data-ttu-id="2de60-509">Le didacticiel suivant démarre notre voyage dans le cadre de l’appartenance.</span><span class="sxs-lookup"><span data-stu-id="2de60-509">The next tutorial starts our journey into the Membership framework.</span></span>

<span data-ttu-id="2de60-510">Bonne programmation !</span><span class="sxs-lookup"><span data-stu-id="2de60-510">Happy Programming!</span></span>

### <a name="further-reading"></a><span data-ttu-id="2de60-511">informations supplémentaires</span><span class="sxs-lookup"><span data-stu-id="2de60-511">Further Reading</span></span>

<span data-ttu-id="2de60-512">Pour plus d’informations sur les sujets abordés dans ce didacticiel, consultez les ressources suivantes :</span><span class="sxs-lookup"><span data-stu-id="2de60-512">For more information on the topics discussed in this tutorial, refer to the following resources:</span></span>

- [<span data-ttu-id="2de60-513">Ayant été disséqué de l’authentification par formulaire</span><span class="sxs-lookup"><span data-stu-id="2de60-513">Dissecting Forms Authentication</span></span>](http://aspnet.4guysfromrolla.com/articles/072005-1.aspx)
- [<span data-ttu-id="2de60-514">Expliqué : L’authentification par formulaire dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="2de60-514">Explained: Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/aa480476.aspx)
- [<span data-ttu-id="2de60-515">Comment : Protéger l’authentification par formulaire dans ASP.NET 2.0</span><span class="sxs-lookup"><span data-stu-id="2de60-515">How To: Protect Forms Authentication in ASP.NET 2.0</span></span>](https://msdn.microsoft.com/library/ms998310.aspx)
- <span data-ttu-id="2de60-516">[Professionnel ASP.NET 2.0 sécurité, l’appartenance et la gestion des rôles](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN : 978-0-7645-9698 MSSQLServer-8)</span><span class="sxs-lookup"><span data-stu-id="2de60-516">[Professional ASP.NET 2.0 Security, Membership, and Role Management](http://www.wrox.com/WileyCDA/WroxTitle/productCd-0764596985.html) (ISBN: 978-0-7645-9698-8)</span></span>
- [<span data-ttu-id="2de60-517">Sécurisation des contrôles de connexion</span><span class="sxs-lookup"><span data-stu-id="2de60-517">Securing Login Controls</span></span>](https://msdn.microsoft.com/library/ms178346.aspx)
- [<span data-ttu-id="2de60-518">Le &lt;authentification&gt; élément</span><span class="sxs-lookup"><span data-stu-id="2de60-518">The &lt;authentication&gt; Element</span></span>](https://msdn.microsoft.com/library/532aee0e.aspx)
- [<span data-ttu-id="2de60-519">Le &lt;forms&gt; , élément pour &lt;l’authentification&gt;</span><span class="sxs-lookup"><span data-stu-id="2de60-519">The &lt;forms&gt; Element for &lt;authentication&gt;</span></span>](https://msdn.microsoft.com/library/1d3t3c61.aspx)
- [<span data-ttu-id="2de60-520">Le &lt;machineKey&gt; élément</span><span class="sxs-lookup"><span data-stu-id="2de60-520">The &lt;machineKey&gt; Element</span></span>](https://msdn.microsoft.com/library/w8h3skw9.aspx)
- [<span data-ttu-id="2de60-521">Comprendre le Ticket d’authentification de formulaires et de cookies</span><span class="sxs-lookup"><span data-stu-id="2de60-521">Understanding the Forms Authentication Ticket and Cookie</span></span>](https://support.microsoft.com/kb/910443)

### <a name="video-training-on-topics-contained-in-this-tutorial"></a><span data-ttu-id="2de60-522">Formations vidéo sur les rubriques contenues dans ce didacticiel</span><span class="sxs-lookup"><span data-stu-id="2de60-522">Video Training on Topics Contained in this Tutorial</span></span>

- [<span data-ttu-id="2de60-523">Comment modifier les propriétés d’authentification de formulaires</span><span class="sxs-lookup"><span data-stu-id="2de60-523">How to Change the Forms Authentication Properties</span></span>](../../../videos/authentication/how-to-change-the-forms-authentication-properties.md)
- [<span data-ttu-id="2de60-524">Comment le programme d’installation et utilisez l’authentification sans Cookie dans une Application ASP.NET</span><span class="sxs-lookup"><span data-stu-id="2de60-524">How to Setup and Use Cookie-less Authentication in an ASP.NET Application</span></span>](../../../videos/authentication/how-to-setup-and-use-cookie-less-authentication-in-an-aspnet-application.md)
- [<span data-ttu-id="2de60-525">Réadressage de connexion par formulaires ASP</span><span class="sxs-lookup"><span data-stu-id="2de60-525">ASP Forms Login Relocation</span></span>](../../../videos/authentication/asp-forms-login-relocation.md)
- [<span data-ttu-id="2de60-526">Configuration de clé personnalisée de la connexion par formulaires</span><span class="sxs-lookup"><span data-stu-id="2de60-526">Forms Login Custom Key Configuration</span></span>](../../../videos/authentication/forms-login-custom-key-configuration.md)
- [<span data-ttu-id="2de60-527">Ajouter des données personnalisées à la méthode d’authentification</span><span class="sxs-lookup"><span data-stu-id="2de60-527">Add Custom Data to the Authentication Method</span></span>](../../../videos/authentication/add-custom-data-to-the-authentication-method.md)
- [<span data-ttu-id="2de60-528">Utiliser des objets de principal personnalisés</span><span class="sxs-lookup"><span data-stu-id="2de60-528">Use Custom Principal Objects</span></span>](../../../videos/authentication/use-custom-principal-objects.md)

### <a name="about-the-author"></a><span data-ttu-id="2de60-529">À propos de l’auteur</span><span class="sxs-lookup"><span data-stu-id="2de60-529">About the Author</span></span>

<span data-ttu-id="2de60-530">Scott Mitchell, auteur de plusieurs livres sur ASP/ASP.NET et créateur de 4GuysFromRolla.com, travaille avec les technologies Web Microsoft depuis 1998.</span><span class="sxs-lookup"><span data-stu-id="2de60-530">Scott Mitchell, author of multiple ASP/ASP.NET books and founder of 4GuysFromRolla.com, has been working with Microsoft Web technologies since 1998.</span></span> <span data-ttu-id="2de60-531">Scott fonctionne comme un consultant indépendant, formateur et writer.</span><span class="sxs-lookup"><span data-stu-id="2de60-531">Scott works as an independent consultant, trainer, and writer.</span></span> <span data-ttu-id="2de60-532">Son dernier ouvrage est  *[SAM animer vous-même ASP.NET 2.0 des dernières 24 heures](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span><span class="sxs-lookup"><span data-stu-id="2de60-532">His latest book is *[Sams Teach Yourself ASP.NET 2.0 in 24 Hours](https://www.amazon.com/exec/obidos/ASIN/0672327384/4guysfromrollaco)*.</span></span> <span data-ttu-id="2de60-533">Scott peut être atteint à [ mitchell@4guysfromrolla.com ](mailto:mitchell@4guysfromrolla.com) ou via son blog à [http://ScottOnWriting.NET](http://scottonwriting.net/).</span><span class="sxs-lookup"><span data-stu-id="2de60-533">Scott can be reached at [mitchell@4guysfromrolla.com](mailto:mitchell@4guysfromrolla.com) or via his blog at [http://ScottOnWriting.NET](http://scottonwriting.net/).</span></span>

### <a name="special-thanks-to"></a><span data-ttu-id="2de60-534">Remerciements</span><span class="sxs-lookup"><span data-stu-id="2de60-534">Special Thanks To</span></span>

<span data-ttu-id="2de60-535">Cette série de didacticiels a été révisée par plusieurs réviseurs utiles.</span><span class="sxs-lookup"><span data-stu-id="2de60-535">This tutorial series was reviewed by many helpful reviewers.</span></span> <span data-ttu-id="2de60-536">Entraîner un réviseur pour ce didacticiel a été Alicja Maziarz.</span><span class="sxs-lookup"><span data-stu-id="2de60-536">Lead reviewer for this tutorial was Alicja Maziarz.</span></span> <span data-ttu-id="2de60-537">Vous souhaitez consulter mes prochains articles MSDN ?</span><span class="sxs-lookup"><span data-stu-id="2de60-537">Interested in reviewing my upcoming MSDN articles?</span></span> <span data-ttu-id="2de60-538">Dans ce cas, me supprimer une ligne à [ mitchell@4GuysFromRolla.com ](mailto:mitchell@4guysfromrolla.com).</span><span class="sxs-lookup"><span data-stu-id="2de60-538">If so, drop me a line at [mitchell@4GuysFromRolla.com](mailto:mitchell@4guysfromrolla.com).</span></span>

>[!div class="step-by-step"]
<span data-ttu-id="2de60-539">[Précédent](an-overview-of-forms-authentication-cs.md)
[Suivant](security-basics-and-asp-net-support-vb.md)</span><span class="sxs-lookup"><span data-stu-id="2de60-539">[Previous](an-overview-of-forms-authentication-cs.md)
[Next](security-basics-and-asp-net-support-vb.md)</span></span>
