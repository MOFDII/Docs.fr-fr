---
uid: mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
title: "Créer une application de web ASP.NET MVC 5 sécurisée avec se connectent, envoyer par courrier électronique de confirmation et le mot de passe de la réinitialisation (c#) | Documents Microsoft"
author: Rick-Anderson
description: "Ce didacticiel vous montre comment créer une application de web ASP.NET MVC 5 avec confirmation par courrier électronique et le mot de passe réinitialisé à l’aide du système d’appartenance ASP.NET Identity. Autorité de certification vous..."
ms.author: aspnetcontent
manager: wpickett
ms.date: 03/26/2015
ms.topic: article
ms.assetid: d4911cb3-1afb-4805-b860-10818c4b1280
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/security/create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset
msc.type: authoredcontent
ms.openlocfilehash: 5689031015279484cc616090a767a8c25eefa3c1
ms.sourcegitcommit: 060879fcf3f73d2366b5c811986f8695fff65db8
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 01/24/2018
---
<a name="create-a-secure-aspnet-mvc-5-web-app-with-log-in-email-confirmation-and-password-reset-c"></a><span data-ttu-id="bd8bf-104">Créer une application de web ASP.NET MVC 5 sécurisée avec se connectent, envoyer par courrier électronique de confirmation et le mot de passe de la réinitialisation (c#)</span><span class="sxs-lookup"><span data-stu-id="bd8bf-104">Create a secure ASP.NET MVC 5 web app with log in, email confirmation and password reset (C#)</span></span>
====================
<span data-ttu-id="bd8bf-105">Par [Rick Anderson](https://github.com/Rick-Anderson)</span><span class="sxs-lookup"><span data-stu-id="bd8bf-105">by [Rick Anderson](https://github.com/Rick-Anderson)</span></span>

> <span data-ttu-id="bd8bf-106">Ce didacticiel vous montre comment créer une application de web ASP.NET MVC 5 avec confirmation par courrier électronique et le mot de passe réinitialisé à l’aide du système d’appartenance ASP.NET Identity.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-106">This tutorial shows you how to build an ASP.NET MVC 5 web app with email confirmation and password reset using the ASP.NET Identity membership system.</span></span> <span data-ttu-id="bd8bf-107">Vous pouvez télécharger l’application terminée [ici](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-107">You can download the completed application [here](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span></span> <span data-ttu-id="bd8bf-108">Le téléchargement contient les programmes d’assistance de débogage qui vous permettent de tester une confirmation par courrier électronique et SMS sans configurer d’un courrier électronique ou le fournisseur SMS.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-108">The download contains debugging helpers that let you test email confirmation and SMS without setting up an email or SMS provider.</span></span>
> 
> <span data-ttu-id="bd8bf-109">Ce didacticiel a été écrit par [Rick Anderson](https://blogs.msdn.com/rickAndy) (Twitter : [ @RickAndMSFT ](https://twitter.com/RickAndMSFT) ).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-109">This tutorial was written by [Rick Anderson](https://blogs.msdn.com/rickAndy) ( Twitter: [@RickAndMSFT](https://twitter.com/RickAndMSFT) ).</span></span>


<a id="createMvc"></a>
## <a name="create-an-aspnet-mvc-app"></a><span data-ttu-id="bd8bf-110">Créer une application ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="bd8bf-110">Create an ASP.NET MVC app</span></span>

<span data-ttu-id="bd8bf-111">Commencez par installer et exécuter [Visual Studio Express 2013 pour le Web](https://go.microsoft.com/fwlink/?LinkId=299058) ou [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-111">Start by installing and running [Visual Studio Express 2013 for Web](https://go.microsoft.com/fwlink/?LinkId=299058) or [Visual Studio 2013](https://go.microsoft.com/fwlink/?LinkId=306566).</span></span> <span data-ttu-id="bd8bf-112">Installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-112">Install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher.</span></span>

> [!NOTE]
> <span data-ttu-id="bd8bf-113">Avertissement : Vous devez installer [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) ou une version ultérieure pour effectuer ce didacticiel.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-113">Warning: You must install [Visual Studio 2013 Update 3](https://go.microsoft.com/fwlink/?LinkId=390465) or higher to complete this tutorial.</span></span>


1. <span data-ttu-id="bd8bf-114">Créez un projet Web ASP.NET et sélectionnez le modèle MVC.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-114">Create a new ASP.NET Web project and select the MVC template.</span></span> <span data-ttu-id="bd8bf-115">Web Forms prend également en charge ASP.NET Identity, afin que vous pouvez suivre des étapes similaires dans une application de formulaires web.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-115">Web Forms also supports ASP.NET Identity, so you could follow similar steps in a web forms app.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image1.png)
2. <span data-ttu-id="bd8bf-116">Laissez l’authentification par défaut en tant que **comptes d’utilisateur individuels**.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-116">Leave the default authentication as **Individual User Accounts**.</span></span> <span data-ttu-id="bd8bf-117">Si vous souhaitez héberger l’application dans Azure, laissez la case à cocher activée.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-117">If you'd like to host the app in Azure, leave the check box checked.</span></span> <span data-ttu-id="bd8bf-118">Plus loin dans ce didacticiel, nous déploiera vers Azure.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-118">Later in the tutorial we will deploy to Azure.</span></span> <span data-ttu-id="bd8bf-119">Vous pouvez [ouvrir un compte Azure gratuitement](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-119">You can [open an Azure account for free](https://azure.microsoft.com/pricing/free-trial/?WT.mc_id=A261C142F).</span></span>
3. <span data-ttu-id="bd8bf-120">Définir le [projet pour utiliser SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-120">Set the [project to use SSL](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md).</span></span>
4. <span data-ttu-id="bd8bf-121">Exécuter l’application, cliquez sur le **inscrire** lier et inscrire un utilisateur.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-121">Run the app, click the **Register** link and register a user.</span></span> <span data-ttu-id="bd8bf-122">À ce stade, la seule validation de l’adresse de messagerie est avec le [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribut.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-122">At this point, the only validation on the email is with the [[EmailAddress]](https://msdn.microsoft.com/library/system.componentmodel.dataannotations.emailaddressattribute(v=vs.110).aspx) attribute.</span></span>
5. <span data-ttu-id="bd8bf-123">Dans l’Explorateur de serveurs, accédez à **données Connections\DefaultConnection\Tables\AspNetUsers**avec le bouton droit sur et sélectionnez **ouvrir la définition de la table**.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-123">In Server Explorer, navigate to **Data Connections\DefaultConnection\Tables\AspNetUsers**, right click and select **Open table definition**.</span></span>

    <span data-ttu-id="bd8bf-124">L’illustration suivante montre le `AspNetUsers` schéma :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-124">The following image shows the `AspNetUsers` schema:</span></span>

    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image2.png)
6. <span data-ttu-id="bd8bf-125">Cliquez avec le bouton droit sur le **AspNetUsers** de table et sélectionnez **afficher les données de Table**.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-125">Right click on the **AspNetUsers** table and select **Show Table Data**.</span></span>  
    ![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image3.png)  
 <span data-ttu-id="bd8bf-126">À ce stade l’adresse de messagerie n’a pas été confirmé.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-126">At this point the email has not been confirmed.</span></span>
7. <span data-ttu-id="bd8bf-127">Cliquez sur la ligne et sélectionnez Supprimer.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-127">Click on the row and select delete.</span></span> <span data-ttu-id="bd8bf-128">Vous allez ajouter cette adresse de messagerie à nouveau à l’étape suivante et envoyer un message électronique de confirmation.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-128">You'll add this email again in the next step, and send a confirmation email.</span></span>

## <a name="email-confirmation"></a><span data-ttu-id="bd8bf-129">E-mail de confirmation</span><span class="sxs-lookup"><span data-stu-id="bd8bf-129">Email confirmation</span></span>

<span data-ttu-id="bd8bf-130">Il est recommandé de confirmer l’adresse de messagerie d’un nouvel enregistrement d’utilisateur pour vérifier qu’ils n’empruntent pas une autre personne (autrement dit, ils n’ont pas inscrit avec par quelqu'un d’autre adresse de messagerie).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-130">It's a best practice to confirm the email of a new user registration to verify they are not impersonating someone else (that is, they haven't registered with someone else's email).</span></span> <span data-ttu-id="bd8bf-131">Supposons que vous aviez un forum de discussion, vous pouvez empêcher `"bob@example.com"` lors de l’inscription en tant que `"joe@contoso.com"`.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-131">Suppose you had a discussion forum, you would want to prevent `"bob@example.com"` from registering as `"joe@contoso.com"`.</span></span> <span data-ttu-id="bd8bf-132">Sans la confirmation par courrier électronique, `"joe@contoso.com"` Impossible d’obtenir le courrier indésirable à partir de votre application.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-132">Without email confirmation, `"joe@contoso.com"` could get unwanted email from your app.</span></span> <span data-ttu-id="bd8bf-133">Supposons que Bob accidentellement inscrit en tant que `"bib@example.com"` et vous n’aviez pas remarqué, il ne serait pas en mesure d’utiliser le mot de passe de récupération, car l’application n’a pas son e-mail valable.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-133">Suppose Bob accidently registered as `"bib@example.com"` and hadn't noticed it, he wouldn't be able to use password recover because the app doesn't have his correct email.</span></span> <span data-ttu-id="bd8bf-134">E-mail de confirmation offre uniquement une protection limitée de robots et ne fournit la protection à partir des expéditeurs déterminés, ils ont plusieurs alias de messagerie de travail qu’ils peuvent utiliser pour enregistrer.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-134">Email confirmation provides only limited protection from bots and doesn't provide protection from determined spammers, they have many working email aliases they can use to register.</span></span>

<span data-ttu-id="bd8bf-135">En règle générale, vous souhaitez empêcher les nouveaux utilisateurs à partir de la validation des données à votre site web avant qu’ils ont été confirmées par courrier électronique, un message texte ou un autre mécanisme.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-135">You generally want to prevent new users from posting any data to your web site before they have been confirmed by email, a SMS text message or another mechanism.</span></span> <a id="build"></a><span data-ttu-id="bd8bf-136">Dans les sections ci-dessous, nous activer la confirmation de courrier électronique et modifier le code pour empêcher les utilisateurs qui vient d’être inscrits de se connecter jusqu'à ce que leur courrier électronique a été confirmée.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-136">In the sections below, we will enable email confirmation and modify the code to prevent newly registered users from logging in until their email has been confirmed.</span></span>

<a id="SG"></a>
## <a name="hook-up-sendgrid"></a><span data-ttu-id="bd8bf-137">Raccorder SendGrid</span><span class="sxs-lookup"><span data-stu-id="bd8bf-137">Hook up SendGrid</span></span>

<span data-ttu-id="bd8bf-138">Bien que ce didacticiel montre uniquement comment ajouter la notification par courrier électronique via [SendGrid](http://sendgrid.com/), vous pouvez envoyer un e-mail à l’aide de SMTP et autres mécanismes (consultez [des ressources supplémentaires](#addRes)).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-138">Although this tutorial only shows how to add email notification through [SendGrid](http://sendgrid.com/), you can send email using SMTP and other mechanisms (see [additional resources](#addRes)).</span></span>

1. <span data-ttu-id="bd8bf-139">Dans la Console du Gestionnaire de Package, entrez ce qui suit la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-139">In the Package Manager Console, enter the following the following command:</span></span> 

    [!code-console[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample1.cmd)]
2. <span data-ttu-id="bd8bf-140">Accédez à la [page d’inscription Azure SendGrid](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) et l’inscrire pour un compte SendGrid.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-140">Go to the [Azure SendGrid sign up page](https://go.microsoft.com/fwlink/?linkid=271033&clcid=0x409) and register for free SendGrid account.</span></span> <span data-ttu-id="bd8bf-141">Ajoutez un code similaire à ce qui suit pour configurer SendGrid :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-141">Add code similar to the following to configure SendGrid:</span></span>

    [!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample2.cs?highlight=3,5)]

<span data-ttu-id="bd8bf-142">Vous devrez ajouter qu'inclut les éléments suivants :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-142">You'll need to add the following includes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample3.cs)]

<span data-ttu-id="bd8bf-143">Pour simplifier cet exemple, nous allons stocker les paramètres d’application dans le *web.config* fichier :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-143">To keep this sample simple, we'll store the app settings in the *web.config* file:</span></span>

[!code-xml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample4.xml)]

> [!WARNING]
> <span data-ttu-id="bd8bf-144">Sécurité - magasin jamais des données sensibles dans votre code source.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-144">Security - Never store sensitive data in your source code.</span></span> <span data-ttu-id="bd8bf-145">Le compte et les informations d’identification sont stockées dans l’appSetting.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-145">The account and credentials are stored in the appSetting.</span></span> <span data-ttu-id="bd8bf-146">Sur Azure, vous pouvez stocker en toute sécurité des ces valeurs sur le  **[configurer](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)**  onglet dans le portail Azure.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-146">On Azure, you can securely store these values on the **[Configure](https://blogs.msdn.com/b/webdev/archive/2014/06/04/queuebackgroundworkitem-to-reliably-schedule-and-run-long-background-process-in-asp-net.aspx)** tab in the Azure portal.</span></span> <span data-ttu-id="bd8bf-147">Consultez [meilleures pratiques pour le déploiement des mots de passe et autres données sensibles sur ASP.NET et Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-147">See [Best practices for deploying passwords and other sensitive data to ASP.NET and Azure](../../../identity/overview/features-api/best-practices-for-deploying-passwords-and-other-sensitive-data-to-aspnet-and-azure.md).</span></span>


### <a name="enable-email-confirmation-in-the-account-controller"></a><span data-ttu-id="bd8bf-148">Activer la confirmation de courrier électronique dans le contrôleur de compte</span><span class="sxs-lookup"><span data-stu-id="bd8bf-148">Enable email confirmation in the Account controller</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample5.cs?highlight=16-21)]

<span data-ttu-id="bd8bf-149">Vérifiez le *Views\Account\ConfirmEmail.cshtml* fichier possède la syntaxe razor correct.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-149">Verify the *Views\Account\ConfirmEmail.cshtml* file has correct razor syntax.</span></span> <span data-ttu-id="bd8bf-150">(Le @ caractère dans la première ligne peut être manquant.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-150">( The @ character in the first line might be missing.</span></span> <span data-ttu-id="bd8bf-151">)</span><span class="sxs-lookup"><span data-stu-id="bd8bf-151">)</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample6.cshtml?highlight=1)]

<span data-ttu-id="bd8bf-152">Exécutez l’application et cliquez sur le lien du Registre.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-152">Run the app and click the Register link.</span></span> <span data-ttu-id="bd8bf-153">Une fois que vous envoyez le formulaire d’inscription, vous êtes connecté.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-153">Once you submit the registration form, you are logged in.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image4.png)

<span data-ttu-id="bd8bf-154">Vérifiez votre compte de messagerie, puis cliquez sur le lien pour confirmer votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-154">Check your email account and click on the link to confirm your email.</span></span>

<a id="require"></a>
## <a name="require-email-confirmation-before-log-in"></a><span data-ttu-id="bd8bf-155">Exigez une confirmation par courrier électronique avant de journal dans</span><span class="sxs-lookup"><span data-stu-id="bd8bf-155">Require email confirmation before log in</span></span>

<span data-ttu-id="bd8bf-156">Actuellement une fois qu’un utilisateur termine le formulaire d’inscription, il est connecté.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-156">Currently once a user completes the registration form, they are logged in.</span></span> <span data-ttu-id="bd8bf-157">En règle générale, vous souhaitez confirmer leur adresse de messagerie avant de les enregistrer.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-157">You generally want to confirm their email before logging them in.</span></span> <span data-ttu-id="bd8bf-158">Dans la section ci-dessous, nous allons modifier le code pour demander aux nouveaux utilisateurs pour qu’un message électronique de confirmation avant d’être enregistrées (authentifié).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-158">In the section below, we will modify the code to require new users to have a confirmed email before they are logged in (authenticated).</span></span> <span data-ttu-id="bd8bf-159">Mise à jour le `HttpPost Register` méthode avec les modifications en surbrillance suivantes :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-159">Update the `HttpPost Register` method with the following highlighted changes:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample7.cs?highlight=14-15,23-30)]

<span data-ttu-id="bd8bf-160">En supprimant le `SignInAsync` (méthode), l’utilisateur ne sera pas signé par l’inscription.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-160">By commenting out the `SignInAsync` method, the user will not be signed in by the registration.</span></span> <span data-ttu-id="bd8bf-161">Le `TempData["ViewBagLink"] = callbackUrl;` ligne peut être utilisé pour [déboguer l’application](#dbg) et tester l’inscription sans envoyer par courrier électronique.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-161">The `TempData["ViewBagLink"] = callbackUrl;` line can be used to [debug the app](#dbg) and test registration without sending email.</span></span> <span data-ttu-id="bd8bf-162">`ViewBag.Message`Permet d’afficher les instructions de confirmation.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-162">`ViewBag.Message` is used to display the confirm instructions.</span></span> <span data-ttu-id="bd8bf-163">Le [télécharger exemple](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contient du code pour tester l’e-mail de confirmation sans configurer la messagerie et peut également être utilisé pour déboguer l’application.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-163">The [download sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952) contains code to test email confirmation without setting up email, and can also be used to debug the application.</span></span>

<span data-ttu-id="bd8bf-164">Créer un `Views\Shared\Info.cshtml` et ajoutez le balisage razor suivant :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-164">Create a `Views\Shared\Info.cshtml` file and add the following razor markup:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample8.cshtml)]

<span data-ttu-id="bd8bf-165">Ajouter le [attribut Authorize](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) à la `Contact` méthode d’action du contrôleur Home.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-165">Add the [Authorize attribute](https://msdn.microsoft.com/library/system.web.mvc.authorizeattribute(v=vs.118).aspx) to the `Contact` action method of the Home controller.</span></span> <span data-ttu-id="bd8bf-166">Vous pouvez utiliser le clic sur le **Contact** lien pour vérifier les utilisateurs anonymes n’ont accès et les utilisateurs authentifiés n’ont pas accès.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-166">You can use click on the **Contact** link to verify anonymous users don't have access and authenticated users do have access.</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample9.cs?highlight=1)]

<span data-ttu-id="bd8bf-167">Vous devez également mettre à jour le `HttpPost Login` méthode d’action :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-167">You must also update the `HttpPost Login` action method:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample10.cs?highlight=13-22)]

<span data-ttu-id="bd8bf-168">Mise à jour la *Views\Shared\Error.cshtml* pour afficher le message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-168">Update the *Views\Shared\Error.cshtml* view to display the error message:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample11.cshtml?highlight=8-17)]

<span data-ttu-id="bd8bf-169">Supprimez tous les comptes dans le **AspNetUsers** table qui contient l’alias de messagerie électronique que vous souhaitez tester.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-169">Delete any accounts in the **AspNetUsers** table that contain the email alias you wish to test with.</span></span> <span data-ttu-id="bd8bf-170">Exécutez l’application et vérifiez que vous ne pouvez pas vous connecter avant d’avoir confirmé votre adresse de messagerie.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-170">Run the app and verify you can't log in until you have confirmed your email address.</span></span> <span data-ttu-id="bd8bf-171">Après avoir confirmé votre adresse de messagerie, cliquez sur le **Contact** lien.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-171">Once you confirm your email address, click the **Contact** link.</span></span>

<a id="reset"></a>
## <a name="password-recoveryreset"></a><span data-ttu-id="bd8bf-172">Récupération/réinitialisation de mot de passe</span><span class="sxs-lookup"><span data-stu-id="bd8bf-172">Password recovery/reset</span></span>

<span data-ttu-id="bd8bf-173">Supprimez les caractères de commentaire de la `HttpPost ForgotPassword` méthode d’action dans le contrôleur de compte :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-173">Remove the comment characters from the `HttpPost ForgotPassword` action method in the account controller:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample12.cs?highlight=17-20)]

<span data-ttu-id="bd8bf-174">Supprimez les caractères de commentaire de la `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) dans les *Views\Account\Login.cshtml* fichier de vue razor :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-174">Remove the comment characters from the `ForgotPassword` [ActionLink](https://msdn.microsoft.com/library/system.web.mvc.html.linkextensions.actionlink(v=vs.118).aspx) in the *Views\Account\Login.cshtml* razor view file:</span></span>

[!code-cshtml[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample13.cshtml?highlight=47-50)]

<span data-ttu-id="bd8bf-175">La page de connexion affiche maintenant un lien pour réinitialiser le mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-175">The Log in page will now show a link to reset the password.</span></span>

<a id="rsend"></a>
## <a name="resend-email-confirmation-link"></a><span data-ttu-id="bd8bf-176">Renvoyer le lien de confirmation par courrier électronique</span><span class="sxs-lookup"><span data-stu-id="bd8bf-176">Resend email confirmation link</span></span>

<span data-ttu-id="bd8bf-177">Une fois qu’un utilisateur crée un nouveau compte local, elles sont envoyées par courrier électronique un lien de confirmation qu’ils doivent utiliser avant de se connecter.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-177">Once a user creates a new local account, they are emailed a confirmation link they are required to use before they can log on.</span></span> <span data-ttu-id="bd8bf-178">Si l’utilisateur accidentellement supprime le message de confirmation, ou le message électronique n’arrive jamais, ils doivent le lien de confirmation envoyé à nouveau.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-178">If the user accidently deletes the confirmation email, or the email never arrives, they will need the confirmation link sent again.</span></span> <span data-ttu-id="bd8bf-179">Les modifications de code suivants montrent comment activer cette option.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-179">The following code changes show how to enable this.</span></span>

<span data-ttu-id="bd8bf-180">Ajoutez la méthode d’assistance suivante vers le bas de la *Controllers\AccountController.cs* fichier :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-180">Add the following helper method to the bottom of the *Controllers\AccountController.cs* file:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample14.cs)]

<span data-ttu-id="bd8bf-181">Mise à jour de la méthode Register pour utiliser l’Assistant Nouvelle :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-181">Update the Register method to use the new helper:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample15.cs?highlight=17)]

<span data-ttu-id="bd8bf-182">Mettre à jour de la méthode de connexion pour renvoyer le mot de passe lorsque si le compte d’utilisateur n’a pas été confirmé :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-182">Update the Login method to resend the password when if the user account has not been confirmed:</span></span>

[!code-csharp[Main](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/samples/sample16.cs?highlight=20)]

<a id="combine"></a>
## <a name="combine-social-and-local-login-accounts"></a><span data-ttu-id="bd8bf-183">Combiner des comptes de connexion de réseaux sociaux et local</span><span class="sxs-lookup"><span data-stu-id="bd8bf-183">Combine social and local login accounts</span></span>

<span data-ttu-id="bd8bf-184">Vous pouvez combiner les comptes locaux et réseaux sociaux en cliquant sur le lien de votre messagerie.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-184">You can combine local and social accounts by clicking on your email link.</span></span> <span data-ttu-id="bd8bf-185">Dans l’ordre suivant  **RickAndMSFT@gmail.com**  est tout d’abord créé en tant qu’une connexion locale, mais vous pouvez créer le compte en tant qu’un journal social en premier, puis ajouter une connexion locale.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-185">In the following sequence **RickAndMSFT@gmail.com** is first created as a local login, but you can create the account as a social log in first, then add a local login.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image5.png)

<span data-ttu-id="bd8bf-186">Cliquez sur le **gérer** lien.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-186">Click on the **Manage** link.</span></span> <span data-ttu-id="bd8bf-187">Notez la valeur 0 externe (connexions sociales) associé à ce compte.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-187">Note the 0 external (social logins) associated with this account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image6.png)

<span data-ttu-id="bd8bf-188">Cliquez sur le lien vers un autre journal dans le service et accepter les demandes d’application.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-188">Click the link to another log in service and accept the app requests.</span></span> <span data-ttu-id="bd8bf-189">Les deux comptes ont été combinés, vous ne pourrez pas vous connecter avec un compte.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-189">The two accounts have been combined, you will be able to log on with either account.</span></span> <span data-ttu-id="bd8bf-190">Vous pourriez vos utilisateurs pour ajouter des comptes locaux au cas où le journal des réseaux sociaux dans le service d’authentification est arrêté, ou plus probable qu’ils ont perdu l’accès à leur compte sociaux.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-190">You might want your users to add local accounts in case their social log in authentication service is down, or more likely they have lost access to their social account.</span></span>

<span data-ttu-id="bd8bf-191">Dans l’image suivante, Tom est un journal des réseaux sociaux dans (que vous pouvez visualiser à partir de la **Logins externes : 1** présentée sur la page).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-191">In the following image, Tom is a social log in (which you can see from the **External Logins: 1** shown on the page).</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image7.png)

<span data-ttu-id="bd8bf-192">En cliquant sur **choisir un mot de passe** vous permet d’ajouter un journal local sur avec le même compte.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-192">Clicking on **Pick a password** allows you to add a local log on associated with the same account.</span></span>

![](create-an-aspnet-mvc-5-web-app-with-email-confirmation-and-password-reset/_static/image8.png)

## <a name="email-confirmation-in-more-depth"></a><span data-ttu-id="bd8bf-193">E-mail de confirmation de manière plus approfondie</span><span class="sxs-lookup"><span data-stu-id="bd8bf-193">Email confirmation in more depth</span></span>

<span data-ttu-id="bd8bf-194">Mon didacticiel [Confirmation du compte et la récupération de mot de passe avec ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) sont placées dans cette rubrique avec plus de détails.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-194">My tutorial [Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) goes into this topic with more details.</span></span>

<a id="dbg"></a>
## <a name="debugging-the-app"></a><span data-ttu-id="bd8bf-195">Débogage de l’application</span><span class="sxs-lookup"><span data-stu-id="bd8bf-195">Debugging the app</span></span>

<span data-ttu-id="bd8bf-196">Si vous n’obtenez pas un message électronique contenant le lien :</span><span class="sxs-lookup"><span data-stu-id="bd8bf-196">If you don't get an email containing the link:</span></span>

- <span data-ttu-id="bd8bf-197">Vérifiez votre dossier courrier indésirable ou le courrier indésirable.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-197">Check your junk or spam folder.</span></span>
- <span data-ttu-id="bd8bf-198">Connectez-vous à votre compte SendGrid, puis cliquez sur le [lien de l’activité de messagerie](https://sendgrid.com/logs/index).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-198">Log into your SendGrid account and click on the [Email Activity link](https://sendgrid.com/logs/index).</span></span>

<span data-ttu-id="bd8bf-199">Pour tester le lien de vérification sans par courrier électronique, vous devez télécharger le [exemple terminé](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-199">To test the verification link without email, download the [completed sample](https://code.msdn.microsoft.com/MVC-5-with-2FA-email-8f26d952).</span></span> <span data-ttu-id="bd8bf-200">Le lien de confirmation et les codes de confirmation seront affichera sur la page.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-200">The confirmation link and confirmation codes will be displayed on the page.</span></span>

<a id="addRes"></a>
## <a name="additional-resources"></a><span data-ttu-id="bd8bf-201">Ressources supplémentaires</span><span class="sxs-lookup"><span data-stu-id="bd8bf-201">Additional Resources</span></span>

- [<span data-ttu-id="bd8bf-202">Des liens vers ASP.NET Identity recommandé de ressources</span><span class="sxs-lookup"><span data-stu-id="bd8bf-202">Links to ASP.NET Identity Recommended Resources</span></span>](../../../identity/overview/getting-started/aspnet-identity-recommended-resources.md)
- <span data-ttu-id="bd8bf-203">[Compte de Confirmation et récupération de mot de passe avec ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) des informations plus détaillées sur la confirmation de compte et de récupération du mot de passe.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-203">[Account Confirmation and Password Recovery with ASP.NET Identity](../../../identity/overview/features-api/account-confirmation-and-password-recovery-with-aspnet-identity.md) Goes into more detail on password recovery and account confirmation.</span></span>
- <span data-ttu-id="bd8bf-204">[Application MVC est 5 avec Facebook, Twitter, LinkedIn et d’authentification Google OAuth2](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) ce didacticiel vous montre comment écrire une application ASP.NET MVC 5 avec autorisation Facebook et Google OAuth 2.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-204">[MVC 5 App with Facebook, Twitter, LinkedIn and Google OAuth2 Sign-on](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md) This tutorial shows you how to write an ASP.NET MVC 5 app with Facebook and Google OAuth 2 authorization.</span></span> <span data-ttu-id="bd8bf-205">Il montre également comment ajouter des données supplémentaires à la base de données d’identité.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-205">It also shows how to add additional data to the Identity database.</span></span>
- <span data-ttu-id="bd8bf-206">[Déployer une application sécurisée ASP.NET MVC avec l’appartenance, OAuth et base de données SQL Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="bd8bf-206">[Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="bd8bf-207">Ce didacticiel ajoute le déploiement d’Azure, la sécurisation de votre application avec les rôles, l’utilisation de l’API d’appartenance pour ajouter des utilisateurs et des rôles et des fonctionnalités de sécurité supplémentaires.</span><span class="sxs-lookup"><span data-stu-id="bd8bf-207">This tutorial adds Azure deployment, how to secure your app with roles, how to use the membership API to add users and roles, and additional security features.</span></span>
- [<span data-ttu-id="bd8bf-208">Création d’une application de Google OAuth 2 et la connexion de l’application au projet</span><span class="sxs-lookup"><span data-stu-id="bd8bf-208">Creating a Google app for OAuth 2 and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#goog)
- [<span data-ttu-id="bd8bf-209">Création de l’application de Facebook et la connexion de l’application au projet</span><span class="sxs-lookup"><span data-stu-id="bd8bf-209">Creating the app in Facebook and connecting the app to the project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#fb)
- [<span data-ttu-id="bd8bf-210">Configuration de SSL dans le projet</span><span class="sxs-lookup"><span data-stu-id="bd8bf-210">Setting up SSL in the Project</span></span>](create-an-aspnet-mvc-5-app-with-facebook-and-google-oauth2-and-openid-sign-on.md#ssl)
