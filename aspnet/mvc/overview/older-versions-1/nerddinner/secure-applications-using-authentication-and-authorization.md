---
uid: mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
title: Sécuriser des Applications à l’aide de l’authentification et autorisation | Documents Microsoft
author: microsoft
description: Étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: 9e4d5cac-b071-440c-b044-20b6d0c964fb
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/secure-applications-using-authentication-and-authorization
msc.type: authoredcontent
ms.openlocfilehash: 4a9b1e6d7d453bd8dc5a61b1f1cec4617af7d693
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
<a name="secure-applications-using-authentication-and-authorization"></a><span data-ttu-id="ced08-103">Sécuriser des Applications à l’aide de l’authentification et autorisation</span><span class="sxs-lookup"><span data-stu-id="ced08-103">Secure Applications Using Authentication and Authorization</span></span>
====================
<span data-ttu-id="ced08-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="ced08-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="ced08-105">Télécharger le PDF</span><span class="sxs-lookup"><span data-stu-id="ced08-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="ced08-106">Il s’agit d’étape 9 a gratuit [« « l’application NerdDinner](introducing-the-nerddinner-tutorial.md) qui parcours à comment générer un petit, mais se termine, application web à l’aide d’ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="ced08-106">This is step 9 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="ced08-107">Étape 9 montre comment ajouter l’authentification et l’autorisation pour sécuriser notre application NerdDinner, afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer le nouveau préparés et seul l’utilisateur qui héberge un dîner peut le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="ced08-107">Step 9 shows how to add authentication and authorization to secure our NerdDinner application, so that users need to register and login to the site to create new dinners, and only the user who is hosting a dinner can edit it later.</span></span>
> 
> <span data-ttu-id="ced08-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre les [mise en route a démarré avec MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [magasin de musique MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) didacticiels.</span><span class="sxs-lookup"><span data-stu-id="ced08-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-9-authentication-and-authorization"></a><span data-ttu-id="ced08-109">De NerdDinner étape 9 : L’authentification et l’autorisation</span><span class="sxs-lookup"><span data-stu-id="ced08-109">NerdDinner Step 9: Authentication and Authorization</span></span>

<span data-ttu-id="ced08-110">Maintenant notre NerdDinner application accorde toute personne visitant le site de la possibilité de créer et modifier les détails de n’importe quel dinner.</span><span class="sxs-lookup"><span data-stu-id="ced08-110">Right now our NerdDinner application grants anyone visiting the site the ability to create and edit the details of any dinner.</span></span> <span data-ttu-id="ced08-111">Nous allons maintenant changer cela afin que les utilisateurs ont besoin inscrire et de la connexion au site pour créer le nouveau préparés et ajouter une restriction afin que seul l’utilisateur qui héberge un dîner peut le modifier ultérieurement.</span><span class="sxs-lookup"><span data-stu-id="ced08-111">Let's change this so that users need to register and login to the site to create new dinners, and add a restriction so that only the user who is hosting a dinner can edit it later.</span></span>

<span data-ttu-id="ced08-112">Pour ce faire, nous allons utiliser l’authentification et l’autorisation pour sécuriser votre application.</span><span class="sxs-lookup"><span data-stu-id="ced08-112">To enable this we'll use authentication and authorization to secure our application.</span></span>

### <a name="understanding-authentication-and-authorization"></a><span data-ttu-id="ced08-113">Autorisation et la compréhension de l’authentification</span><span class="sxs-lookup"><span data-stu-id="ced08-113">Understanding Authentication and Authorization</span></span>

<span data-ttu-id="ced08-114">*Authentification* est le processus d’identification et de validation de l’identité d’un client de l’accès à une application.</span><span class="sxs-lookup"><span data-stu-id="ced08-114">*Authentication* is the process of identifying and validating the identity of a client accessing an application.</span></span> <span data-ttu-id="ced08-115">Plus simplement, il est sur l’identification « qui est « l’utilisateur final lorsqu’ils visitent un site Web.</span><span class="sxs-lookup"><span data-stu-id="ced08-115">Put more simply, it is about identifying "who" the end-user is when they visit a website.</span></span> <span data-ttu-id="ced08-116">ASP.NET prend en charge plusieurs façons pour authentifier les utilisateurs du navigateur.</span><span class="sxs-lookup"><span data-stu-id="ced08-116">ASP.NET supports multiple ways to authenticate browser users.</span></span> <span data-ttu-id="ced08-117">Pour les applications web Internet, l’approche la plus courante d’authentification utilisée est appelée « Authentification de formulaires ».</span><span class="sxs-lookup"><span data-stu-id="ced08-117">For Internet web applications, the most common authentication approach used is called "Forms Authentication".</span></span> <span data-ttu-id="ced08-118">L’authentification par formulaire permet à un développeur créer un formulaire de connexion HTML dans leur application, puis valider le nom d’utilisateur/le mot de passe que l’utilisateur final envoie par rapport à une base de données ou une autre banque d’informations d’identification de mot de passe.</span><span class="sxs-lookup"><span data-stu-id="ced08-118">Forms Authentication enables a developer to author an HTML login form within their application, and then validate the username/password an end-user submits against a database or other password credential store.</span></span> <span data-ttu-id="ced08-119">Si la combinaison nom d’utilisateur/mot de passe est correcte, le développeur peut demander puis à émettre un cookie HTTP chiffré pour identifier l’utilisateur entre les futures demandes ASP.NET.</span><span class="sxs-lookup"><span data-stu-id="ced08-119">If the username/password combination is correct, the developer can then ask ASP.NET to issue an encrypted HTTP cookie to identify the user across future requests.</span></span> <span data-ttu-id="ced08-120">Nous allons à l’aide de l’authentification par formulaire avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="ced08-120">We'll by using forms authentication with our NerdDinner application.</span></span>

<span data-ttu-id="ced08-121">*Autorisation* est le processus permettant de déterminer si un utilisateur authentifié est autorisé à accéder à une ressource d’URL/particulier ou pour effectuer une action.</span><span class="sxs-lookup"><span data-stu-id="ced08-121">*Authorization* is the process of determining whether an authenticated user has permission to access a particular URL/resource or to perform some action.</span></span> <span data-ttu-id="ced08-122">Par exemple, dans notre application NerdDinner nous vous souhaitez autoriser que seuls les utilisateurs qui sont connectés peuvent accéder à la *préparés/créer* URL et créer de nouveau préparés.</span><span class="sxs-lookup"><span data-stu-id="ced08-122">For example, within our NerdDinner application we'll want to authorize that only users who are logged in can access the */Dinners/Create* URL and create new Dinners.</span></span> <span data-ttu-id="ced08-123">Nous allons également ajouter une logique d’autorisation afin que seul l’utilisateur qui héberge un dîner modification – et de refuser l’accès en modification à tous les autres utilisateurs.</span><span class="sxs-lookup"><span data-stu-id="ced08-123">We'll also want to add authorization logic so that only the user who is hosting a dinner can edit it – and deny edit access to all other users.</span></span>

### <a name="forms-authentication-and-the-accountcontroller"></a><span data-ttu-id="ced08-124">L’authentification par formulaire et la AccountController</span><span class="sxs-lookup"><span data-stu-id="ced08-124">Forms Authentication and the AccountController</span></span>

<span data-ttu-id="ced08-125">Le modèle de projet Visual Studio par défaut pour ASP.NET MVC active automatiquement l’authentification par formulaire lors de la création de nouvelles applications ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="ced08-125">The default Visual Studio project template for ASP.NET MVC automatically enables forms authentication when new ASP.NET MVC applications are created.</span></span> <span data-ttu-id="ced08-126">Il ajoute également automatiquement une implémentation de page de connexion de compte avant génération au projet, ce qui le rend très facile d’intégrer la sécurité au sein d’un site.</span><span class="sxs-lookup"><span data-stu-id="ced08-126">It also automatically adds a pre-built account login page implementation to the project – which makes it really easy to integrate security within a site.</span></span>

<span data-ttu-id="ced08-127">La page maître Site.master de valeur par défaut affiche un lien « Session » à l’angle supérieur droit du site lorsque l’utilisateur qu’il n’est pas authentifié :</span><span class="sxs-lookup"><span data-stu-id="ced08-127">The default Site.master master page displays a "Log On" link at the top-right of the site when the user accessing it is not authenticated:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image1.png)

<span data-ttu-id="ced08-128">En cliquant sur le lien « Session » amène un utilisateur vers le */Account / d’ouverture de session* URL :</span><span class="sxs-lookup"><span data-stu-id="ced08-128">Clicking the "Log On" link takes a user to the */Account/LogOn* URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image2.png)

<span data-ttu-id="ced08-129">Les visiteurs qui n’ont pas inscrits peuvent le faire en cliquant sur le lien « Register » – qui mène à la */Account/Register* URL et les autoriser à entrer les détails du compte :</span><span class="sxs-lookup"><span data-stu-id="ced08-129">Visitors who haven't registered can do so by clicking the "Register" link – which will take them to the */Account/Register* URL and allow them to enter account details:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image3.png)

<span data-ttu-id="ced08-130">En cliquant sur le bouton « Enregistrer » crée un nouvel utilisateur dans le système d’appartenance d’ASP.NET et authentifier l’utilisateur sur le site à l’aide de l’authentification par formulaire.</span><span class="sxs-lookup"><span data-stu-id="ced08-130">Clicking the "Register" button will create a new user within the ASP.NET Membership system, and authenticate the user onto the site using forms authentication.</span></span>

<span data-ttu-id="ced08-131">Lorsqu’un utilisateur est connecté, la page Site.master change haut à droite de la page vers la sortie d’un « Bienvenue [username] ! »</span><span class="sxs-lookup"><span data-stu-id="ced08-131">When a user is logged-in, the Site.master changes the top-right of the page to output a "Welcome [username]!"</span></span> <span data-ttu-id="ced08-132">message et restitue une « session » lier au lieu d’une « session » un.</span><span class="sxs-lookup"><span data-stu-id="ced08-132">message and renders a "Log Off" link instead of a "Log On" one.</span></span> <span data-ttu-id="ced08-133">En cliquant sur le lien « Session » déconnecte l’utilisateur :</span><span class="sxs-lookup"><span data-stu-id="ced08-133">Clicking the "Log Off" link logs out the user:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image4.png)

<span data-ttu-id="ced08-134">La fonctionnalité de connexion, de déconnexion et d’enregistrement ci-dessus est implémentée dans la classe AccountController qui a été ajoutée à notre projet par Visual Studio lors de sa création du projet.</span><span class="sxs-lookup"><span data-stu-id="ced08-134">The above login, logout, and registration functionality is implemented within the AccountController class that was added to our project by Visual Studio when it created the project.</span></span> <span data-ttu-id="ced08-135">L’interface utilisateur pour le AccountController est implémentée à l’aide de modèles d’affichage dans le répertoire \Views\Account :</span><span class="sxs-lookup"><span data-stu-id="ced08-135">The UI for the AccountController is implemented using view templates within the \Views\Account directory:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image5.png)

<span data-ttu-id="ced08-136">La classe AccountController utilise le système d’authentification par formulaire ASP.NET pour émettre des cookies d’authentification chiffrées et l’API d’appartenance ASP.NET pour stocker et de valider les noms d’utilisateur/mots de passe.</span><span class="sxs-lookup"><span data-stu-id="ced08-136">The AccountController class uses the ASP.NET Forms Authentication system to issue encrypted authentication cookies, and the ASP.NET Membership API to store and validate usernames/passwords.</span></span> <span data-ttu-id="ced08-137">L’API de l’appartenance ASP.NET est extensible et permet de n’importe quel magasin d’informations d’identification de mot de passe à utiliser.</span><span class="sxs-lookup"><span data-stu-id="ced08-137">The ASP.NET Membership API is extensible and enables any password credential store to be used.</span></span> <span data-ttu-id="ced08-138">ASP.NET est fourni avec les implémentations de fournisseurs d’appartenances intégrés qui stockent le nom d’utilisateur/mots de passe dans une base de données SQL, ou dans Active Directory.</span><span class="sxs-lookup"><span data-stu-id="ced08-138">ASP.NET ships with built-in membership provider implementations that store username/passwords within a SQL database, or within Active Directory.</span></span>

<span data-ttu-id="ced08-139">Nous pouvons configurer le fournisseur d’appartenances notre application de NerdDinner doit utiliser par l’ouverture du fichier « web.config » à la racine du projet et en recherchant le &lt;appartenance&gt; section qu’il contient.</span><span class="sxs-lookup"><span data-stu-id="ced08-139">We can configure which membership provider our NerdDinner application should use by opening the "web.config" file at the root of the project and looking for the &lt;membership&gt; section within it.</span></span> <span data-ttu-id="ced08-140">Web.config par défaut ajoutés lorsque le projet a été créé inscrit le fournisseur d’appartenances SQL et le configure pour utiliser une chaîne de connexion nommée « ApplicationServices » pour spécifier l’emplacement de la base de données.</span><span class="sxs-lookup"><span data-stu-id="ced08-140">The default web.config added when the project was created registers the SQL membership provider, and configures it to use a connection-string named "ApplicationServices" to specify the database location.</span></span>

<span data-ttu-id="ced08-141">La chaîne de connexion par défaut « ApplicationServices » (qui est spécifiée dans le &lt;connectionStrings&gt; section du fichier web.config) est configuré pour utiliser SQL Express.</span><span class="sxs-lookup"><span data-stu-id="ced08-141">The default "ApplicationServices" connection string (which is specified within the &lt;connectionStrings&gt; section of the web.config file) is configured to use SQL Express.</span></span> <span data-ttu-id="ced08-142">Il pointe vers une base de données SQL Express, nommé « ASPNETDB. MDF » sous l’application « application\_données » active.</span><span class="sxs-lookup"><span data-stu-id="ced08-142">It points to a SQL Express database named "ASPNETDB.MDF" under the application's "App\_Data" directory.</span></span> <span data-ttu-id="ced08-143">Si cette base de données n’existe pas la première utilisation de l’API de l’appartenance au sein de l’application, ASP.NET sera automatiquement créer la base de données et configurer le schéma de base de données d’appartenance appropriés qu’il contient :</span><span class="sxs-lookup"><span data-stu-id="ced08-143">If this database doesn't exist the first time the Membership API is used within the application, ASP.NET will automatically create the database and provision the appropriate membership database schema within it:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image6.png)

<span data-ttu-id="ced08-144">Si au lieu d’utiliser SQL Express nous souhaitons utiliser une instance de SQL Server complète (ou se connecter à une base de données distante), tout ce que nous devez action consiste à mettre à jour la chaîne de connexion « ApplicationServices » dans le fichier web.config et assurez-vous que le schéma d’adhésion appropriées a été ajouté à la base de données à laquelle sur qu'il pointe.</span><span class="sxs-lookup"><span data-stu-id="ced08-144">If instead of using SQL Express we wanted to use a full SQL Server instance (or connect to a remote database), all we'd need to-do is to update the "ApplicationServices" connection string within the web.config file and make sure that the appropriate membership schema has been added to the database it points at.</span></span> <span data-ttu-id="ced08-145">Vous pouvez exécuter le « aspnet\_regsql.exe « utilitaire dans le répertoire \Windows\Microsoft.NET\Framework\v2.0.50727\ pour ajouter le schéma approprié pour l’appartenance et les autres services d’application ASP.NET pour une base de données.</span><span class="sxs-lookup"><span data-stu-id="ced08-145">You can run the "aspnet\_regsql.exe" utility within the \Windows\Microsoft.NET\Framework\v2.0.50727\ directory to add the appropriate schema for membership and the other ASP.NET application services to a database.</span></span>

### <a name="authorizing-the-dinnerscreate-url-using-the-authorize-filter"></a><span data-ttu-id="ced08-146">Autoriser l’URL préparés/créer en utilisant le filtre [Authorize]</span><span class="sxs-lookup"><span data-stu-id="ced08-146">Authorizing the /Dinners/Create URL using the [Authorize] filter</span></span>

<span data-ttu-id="ced08-147">Nous n’aviez pas à écrire du code pour activer une authentification sécurisée et l’implémentation de gestion de compte pour l’application de NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="ced08-147">We didn't have to write any code to enable a secure authentication and account management implementation for the NerdDinner application.</span></span> <span data-ttu-id="ced08-148">Les utilisateurs peuvent inscrire de nouveaux comptes avec notre application et la connexion/déconnexion du site.</span><span class="sxs-lookup"><span data-stu-id="ced08-148">Users can register new accounts with our application, and login/logout of the site.</span></span>

<span data-ttu-id="ced08-149">Maintenant, nous pouvons ajouter la logique d’autorisation à l’application et permet de contrôler ce qu’ils peuvent et ne peuvent pas faire dans le site de l’état de l’authentification et le nom d’utilisateur de visiteurs.</span><span class="sxs-lookup"><span data-stu-id="ced08-149">Now we can add authorization logic to the application, and use the authentication status and username of visitors to control what they can and can't do within the site.</span></span> <span data-ttu-id="ced08-150">Nous allons commencer en ajoutant une logique d’autorisation pour les méthodes d’action « Créer » de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="ced08-150">Let's begin by adding authorization logic to the "Create" action methods of our DinnersController class.</span></span> <span data-ttu-id="ced08-151">Plus précisément, nous nécessite que les utilisateurs accédant à la *préparés/créer* URL doit être enregistré dans.</span><span class="sxs-lookup"><span data-stu-id="ced08-151">Specifically, we will require that users accessing the */Dinners/Create* URL must be logged in.</span></span> <span data-ttu-id="ced08-152">Si elles ne sont pas consignées dans nous allons les rediriger vers la page de connexion afin qu’ils peuvent se connecter au.</span><span class="sxs-lookup"><span data-stu-id="ced08-152">If they aren't logged in we'll redirect them to the login page so that they can sign-in.</span></span>

<span data-ttu-id="ced08-153">L’implémentation de cette logique est assez facile.</span><span class="sxs-lookup"><span data-stu-id="ced08-153">Implementing this logic is pretty easy.</span></span> <span data-ttu-id="ced08-154">Il suffit d’action consiste à ajouter un attribut de filtre [Authorize] à nos méthodes d’action Créer comme suit :</span><span class="sxs-lookup"><span data-stu-id="ced08-154">All we need to-do is to add an [Authorize] filter attribute to our Create action methods like so:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample1.cs)]

<span data-ttu-id="ced08-155">ASP.NET MVC prend en charge la capacité de créer des « filtres d’action » qui peuvent être utilisés pour implémenter la logique réutilisable qui peut être appliquée de façon déclarative aux méthodes d’action.</span><span class="sxs-lookup"><span data-stu-id="ced08-155">ASP.NET MVC supports the ability to create "action filters" that can be used to implement re-usable logic that can be declaratively applied to action methods.</span></span> <span data-ttu-id="ced08-156">Le filtre [Authorize] est un des filtres d’action intégrés fournis par ASP.NET MVC, et il permet à un développeur de façon déclarative appliquer des règles d’autorisation pour les méthodes d’action et les classes de contrôleur.</span><span class="sxs-lookup"><span data-stu-id="ced08-156">The [Authorize] filter is one of the built-in action filters provided by ASP.NET MVC, and it enables a developer to declaratively apply authorization rules to action methods and controller classes.</span></span>

<span data-ttu-id="ced08-157">En cas d’application sans paramètres (comme ci-dessus) le filtre [Authorize] impose que l’utilisateur qui effectue la requête de méthode d’action doit être connecté, et il sera automatiquement rediriger le navigateur vers l’URL de connexion qui ne sont pas.</span><span class="sxs-lookup"><span data-stu-id="ced08-157">When applied without any parameters (like above) the [Authorize] filter enforces that the user making the action method request must be logged in – and it will automatically redirect the browser to the login URL if they aren't.</span></span> <span data-ttu-id="ced08-158">Cette redirection de l’URL demandée à l’origine est passé comme argument de chaîne de requête lors de l’exécution (par exemple : / Account / d’ouverture de session ? ReturnUrl = % 2fDinners % 2fCreate).</span><span class="sxs-lookup"><span data-stu-id="ced08-158">When doing this redirect the originally requested URL is passed as a querystring argument (for example: /Account/LogOn?ReturnUrl=%2fDinners%2fCreate).</span></span> <span data-ttu-id="ced08-159">Le AccountController puis redirige l’utilisateur vers l’URL demandée à l’origine une fois qu’il se connecte.</span><span class="sxs-lookup"><span data-stu-id="ced08-159">The AccountController will then redirect the user back to the originally requested URL once they login.</span></span>

<span data-ttu-id="ced08-160">Le filtre [Authorize] éventuellement prend en charge la possibilité de spécifier une propriété « Utilisateurs » ou « Rôles » qui peut être utilisée pour exiger que l’utilisateur est connecté et dans une liste d’utilisateurs autorisés ou un membre d’un rôle de sécurité autorisées.</span><span class="sxs-lookup"><span data-stu-id="ced08-160">The [Authorize] filter optionally supports the ability to specify a "Users" or "Roles" property that can be used to require that the user is both logged in and within a list of allowed users or a member of an allowed security role.</span></span> <span data-ttu-id="ced08-161">Par exemple, le code ci-dessous permet uniquement de deux utilisateurs spécifiques, « scottgu » et « billg » accéder à l’URL préparés/Create :</span><span class="sxs-lookup"><span data-stu-id="ced08-161">For example, the code below only allows two specific users, "scottgu" and "billg", to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample2.cs)]

<span data-ttu-id="ced08-162">Incorporation des noms d’utilisateur spécifique dans du code a tendance à être assez non facile à gérer si.</span><span class="sxs-lookup"><span data-stu-id="ced08-162">Embedding specific user names within code tends to be pretty un-maintainable though.</span></span> <span data-ttu-id="ced08-163">Une meilleure approche consiste à définir de niveau supérieur « rôles » que le code vérifie, puis de mapper les utilisateurs dans le rôle à l’aide d’une base de données ou le système Active Directory (l’activation de la liste de mappage de l’utilisateur réel à stocker en externe à partir du code).</span><span class="sxs-lookup"><span data-stu-id="ced08-163">A better approach is to define higher-level "roles" that the code checks against, and then to map users into the role using either a database or active directory system (enabling the actual user mapping list to be stored externally from the code).</span></span> <span data-ttu-id="ced08-164">ASP.NET inclut une API de gestion de rôle intégré ainsi que d’un ensemble prédéfini de fournisseurs de rôles (tels que SQL et Active Directory) qui peuvent aider à effectuer ce mappage de rôle d’utilisateur.</span><span class="sxs-lookup"><span data-stu-id="ced08-164">ASP.NET includes a built-in role management API as well as a built-in set of role providers (including ones for SQL and Active Directory) that can help perform this user/role mapping.</span></span> <span data-ttu-id="ced08-165">Nous avons ensuite mettre à jour le code pour autoriser uniquement les utilisateurs dans un rôle spécifique « admin » accéder à l’URL préparés/Create :</span><span class="sxs-lookup"><span data-stu-id="ced08-165">We could then update the code to only allow users within a specific "admin" role to access the /Dinners/Create URL:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample3.cs)]

### <a name="using-the-useridentityname-property-when-creating-dinners"></a><span data-ttu-id="ced08-166">À l’aide de la propriété User.Identity.Name lors de la création préparés</span><span class="sxs-lookup"><span data-stu-id="ced08-166">Using the User.Identity.Name property when Creating Dinners</span></span>

<span data-ttu-id="ced08-167">Nous pouvons récupérer le nom d’utilisateur de l’utilisateur actuellement connecté en tant d’une demande à l’aide de la propriété User.Identity.Name exposée sur la classe de base du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="ced08-167">We can retrieve the username of the currently logged-in user of a request using the User.Identity.Name property exposed on the Controller base class.</span></span>

<span data-ttu-id="ced08-168">Antérieure mise en œuvre de la version HTTP-POST de la méthode d’action Create() nous avons dû codé en dur la propriété « HostedBy » de la dîner à une chaîne statique.</span><span class="sxs-lookup"><span data-stu-id="ced08-168">Earlier when we implemented the HTTP-POST version of our Create() action method we had hardcoded the "HostedBy" property of the Dinner to a static string.</span></span> <span data-ttu-id="ced08-169">Nous pouvons maintenant mettre à jour de ce code pour utiliser à la place de la propriété User.Identity.Name, mais aussi ajouter automatiquement une réponse pour l’hôte de créer le dîner :</span><span class="sxs-lookup"><span data-stu-id="ced08-169">We can now update this code to instead use the User.Identity.Name property, as well as automatically add an RSVP for the host creating the Dinner:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample4.cs)]

<span data-ttu-id="ced08-170">Étant donné que nous avons ajouté un attribut [Authorize] à la méthode Create(), ASP.NET MVC permet de s’assurer que la méthode d’action s’exécute uniquement si l’utilisateur visite de l’URL préparés/créer s’est connecté sur le site.</span><span class="sxs-lookup"><span data-stu-id="ced08-170">Because we have added an [Authorize] attribute to the Create() method, ASP.NET MVC ensures that the action method only executes if the user visiting the /Dinners/Create URL is logged in on the site.</span></span> <span data-ttu-id="ced08-171">Par conséquent, la valeur de propriété User.Identity.Name contient toujours un nom d’utilisateur valide.</span><span class="sxs-lookup"><span data-stu-id="ced08-171">As such, the User.Identity.Name property value will always contain a valid username.</span></span>

### <a name="using-the-useridentityname-property-when-editing-dinners"></a><span data-ttu-id="ced08-172">À l’aide de la propriété User.Identity.Name lors de la modification préparés</span><span class="sxs-lookup"><span data-stu-id="ced08-172">Using the User.Identity.Name property when Editing Dinners</span></span>

<span data-ttu-id="ced08-173">Ajoutons maintenant une logique d’autorisation qui limite les utilisateurs afin qu’ils puissent modifier uniquement des propriétés de préparés qu'eux-mêmes hébergent.</span><span class="sxs-lookup"><span data-stu-id="ced08-173">Let's now add some authorization logic that restricts users so that they can only edit the properties of dinners they themselves are hosting.</span></span>

<span data-ttu-id="ced08-174">Pour résoudre cela, nous allons tout d’abord ajouter une méthode d’assistance de « IsHostedBy(username) » à notre objet Dinner (au sein de la classe partielle Dinner.cs que nous avons créé précédemment).</span><span class="sxs-lookup"><span data-stu-id="ced08-174">To help with this, we'll first add an "IsHostedBy(username)" helper method to our Dinner object (within the Dinner.cs partial class we built earlier).</span></span> <span data-ttu-id="ced08-175">Cette méthode d’assistance retourne true ou false selon si un nom d’utilisateur fourni correspond à la propriété Dinner HostedBy et encapsule la logique nécessaire pour effectuer une comparaison de chaînes de casse d'entre eux :</span><span class="sxs-lookup"><span data-stu-id="ced08-175">This helper method returns true or false depending on whether a supplied username matches the Dinner HostedBy property, and encapsulates the logic necessary to perform a case-insensitive string comparison of them:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample5.cs)]

<span data-ttu-id="ced08-176">Nous allons ensuite ajouter un attribut [Authorize] pour les méthodes d’action Edit() au sein de notre classe DinnersController.</span><span class="sxs-lookup"><span data-stu-id="ced08-176">We'll then add an [Authorize] attribute to the Edit() action methods within our DinnersController class.</span></span> <span data-ttu-id="ced08-177">Cela garantit que les utilisateurs doivent être connectés à la demande un */Dinners/modification / [id]* URL.</span><span class="sxs-lookup"><span data-stu-id="ced08-177">This will ensure that users must be logged in to request a */Dinners/Edit/[id]* URL.</span></span>

<span data-ttu-id="ced08-178">Nous pouvons ensuite ajouter le code à nos méthodes de modification qui utilise la méthode d’assistance Dinner.IsHostedBy(username) pour vérifier que l’utilisateur connecté correspond à l’hôte de Dinner.</span><span class="sxs-lookup"><span data-stu-id="ced08-178">We can then add code to our Edit methods that uses the Dinner.IsHostedBy(username) helper method to verify that the logged-in user matches the Dinner host.</span></span> <span data-ttu-id="ced08-179">Si l’utilisateur n’est pas l’ordinateur hôte, nous afficher une vue « InvalidOwner » et mettre fin à la demande.</span><span class="sxs-lookup"><span data-stu-id="ced08-179">If the user is not the host, we'll display an "InvalidOwner" view and terminate the request.</span></span> <span data-ttu-id="ced08-180">Le code se présente comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="ced08-180">The code to do this looks like below:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample6.cs)]

<span data-ttu-id="ced08-181">Nous pouvons ensuite avec le bouton droit sur le répertoire \Views\Dinners et choisissez Ajouter -&gt;afficher la commande de menu pour créer une nouvelle vue « InvalidOwner ».</span><span class="sxs-lookup"><span data-stu-id="ced08-181">We can then right-click on the \Views\Dinners directory and choose the Add-&gt;View menu command to create a new "InvalidOwner" view.</span></span> <span data-ttu-id="ced08-182">Nous allons la remplir avec le message d’erreur ci-après :</span><span class="sxs-lookup"><span data-stu-id="ced08-182">We'll populate it with the below error message:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample7.aspx)]

<span data-ttu-id="ced08-183">Et maintenant lorsqu’un utilisateur tente de modifier un dîner, qu'ils ne possèdent pas, ils obtenez un message d’erreur :</span><span class="sxs-lookup"><span data-stu-id="ced08-183">And now when a user attempts to edit a dinner they don't own, they'll get an error message:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image7.png)

<span data-ttu-id="ced08-184">Nous pouvons Répétez ces étapes pour les méthodes d’action Delete() dans notre contrôleur verrouiller autorisation pour supprimer également les préparés et vous assurer que seul l’hôte d’un dîner peut le supprimer.</span><span class="sxs-lookup"><span data-stu-id="ced08-184">We can repeat the same steps for the Delete() action methods within our controller to lock down permission to delete Dinners as well, and ensure that only the host of a Dinner can delete it.</span></span>

### <a name="showinghiding-edit-and-delete-links"></a><span data-ttu-id="ced08-185">Affichage/masquage modifier et les liens de suppression</span><span class="sxs-lookup"><span data-stu-id="ced08-185">Showing/Hiding Edit and Delete Links</span></span>

<span data-ttu-id="ced08-186">Nous sommes liaison à la méthode d’action de modification et suppression de notre classe DinnersController à partir de notre URL détails :</span><span class="sxs-lookup"><span data-stu-id="ced08-186">We are linking to the Edit and Delete action method of our DinnersController class from our Details URL:</span></span>

![](secure-applications-using-authentication-and-authorization/_static/image8.png)

<span data-ttu-id="ced08-187">Actuellement, nous montrons les modifier et supprimer des liens d’action que l’ordinateur hôte de le dinner soit le visiteur à l’URL de détails.</span><span class="sxs-lookup"><span data-stu-id="ced08-187">Currently we are showing the Edit and Delete action links regardless of whether the visitor to the details URL is the host of the dinner.</span></span> <span data-ttu-id="ced08-188">Nous allons modifier afin que les liens sont affichés uniquement si l’utilisateur visite est le propriétaire de la dîner.</span><span class="sxs-lookup"><span data-stu-id="ced08-188">Let's change this so that the links are only displayed if the visiting user is the owner of the dinner.</span></span>

<span data-ttu-id="ced08-189">La méthode d’action Details() dans notre DinnersController récupère un objet Dinner et puis le passe en tant que l’objet de modèle à notre modèle de vue :</span><span class="sxs-lookup"><span data-stu-id="ced08-189">The Details() action method within our DinnersController retrieves a Dinner object and then passes it as the model object to our view template:</span></span>

[!code-csharp[Main](secure-applications-using-authentication-and-authorization/samples/sample8.cs)]

<span data-ttu-id="ced08-190">Nous pouvons mettre à jour notre modèle d’affichage pour conditionnellement afficher/masquer les liens modifier et supprimer à l’aide de la Dinner.IsHostedBy() méthode d’assistance comme ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="ced08-190">We can update our view template to conditionally show/hide the Edit and Delete links by using the Dinner.IsHostedBy() helper method like below:</span></span>

[!code-aspx[Main](secure-applications-using-authentication-and-authorization/samples/sample9.aspx)]

#### <a name="next-steps"></a><span data-ttu-id="ced08-191">Étapes suivantes</span><span class="sxs-lookup"><span data-stu-id="ced08-191">Next Steps</span></span>

<span data-ttu-id="ced08-192">Nous allons maintenant voir comment nous pouvons activer les utilisateurs authentifiés à RSVP pour préparés à l’aide d’AJAX.</span><span class="sxs-lookup"><span data-stu-id="ced08-192">Let's now look at how we can enable authenticated users to RSVP for dinners using AJAX.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="ced08-193">[Précédent](implement-efficient-data-paging.md)
> [Suivant](use-ajax-to-deliver-dynamic-updates.md)</span><span class="sxs-lookup"><span data-stu-id="ced08-193">[Previous](implement-efficient-data-paging.md)
[Next](use-ajax-to-deliver-dynamic-updates.md)</span></span>
