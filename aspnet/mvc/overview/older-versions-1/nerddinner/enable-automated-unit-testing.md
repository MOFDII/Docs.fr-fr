---
uid: mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
title: Activer automatisée de tests unitaires | Documents Microsoft
author: microsoft
description: Étape 12 montre comment développer une suite de tests unitaires automatisés pour vérifier nos fonctionnalités de NerdDinner, et qui donne la confiance pour apporter des modifications...
ms.author: aspnetcontent
manager: wpickett
ms.date: 07/27/2010
ms.topic: article
ms.assetid: a19ff2ce-3f7e-4358-9a51-a1403da9c63e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/older-versions-1/nerddinner/enable-automated-unit-testing
msc.type: authoredcontent
ms.openlocfilehash: fede08be7e06327c6d04fa5d36f7dd818d79b380
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
<a name="enable-automated-unit-testing"></a><span data-ttu-id="8ed2e-103">Activer le test unitaire automatisé</span><span class="sxs-lookup"><span data-stu-id="8ed2e-103">Enable Automated Unit Testing</span></span>
====================
<span data-ttu-id="8ed2e-104">par [Microsoft](https://github.com/microsoft)</span><span class="sxs-lookup"><span data-stu-id="8ed2e-104">by [Microsoft](https://github.com/microsoft)</span></span>

[<span data-ttu-id="8ed2e-105">Télécharger le PDF</span><span class="sxs-lookup"><span data-stu-id="8ed2e-105">Download PDF</span></span>](http://aspnetmvcbook.s3.amazonaws.com/aspnetmvc-nerdinner_v1.pdf)

> <span data-ttu-id="8ed2e-106">Il s’agit d’étape 12 a gratuit [« « l’application NerdDinner](introducing-the-nerddinner-tutorial.md) qui parcours à comment générer un petit, mais se termine, application web à l’aide d’ASP.NET MVC 1.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-106">This is step 12 of a free ["NerdDinner" application tutorial](introducing-the-nerddinner-tutorial.md) that walks-through how to build a small, but complete, web application using ASP.NET MVC 1.</span></span>
> 
> <span data-ttu-id="8ed2e-107">Étape 12 montre comment développer une suite de tests unitaires automatisés pour vérifier nos fonctionnalités de NerdDinner, et qui donne la confiance pour apporter des modifications et améliorations apportées à l’application dans le futur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-107">Step 12 shows how to develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>
> 
> <span data-ttu-id="8ed2e-108">Si vous utilisez ASP.NET MVC 3, nous vous recommandons de suivre les [mise en route a démarré avec MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) ou [magasin de musique MVC](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) didacticiels.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-108">If you are using ASP.NET MVC 3, we recommend you follow the [Getting Started With MVC 3](../../older-versions/getting-started-with-aspnet-mvc3/cs/intro-to-aspnet-mvc-3.md) or [MVC Music Store](../../older-versions/mvc-music-store/mvc-music-store-part-1.md) tutorials.</span></span>


## <a name="nerddinner-step-12-unit-testing"></a><span data-ttu-id="8ed2e-109">NerdDinner étape 12 : Tests unitaires</span><span class="sxs-lookup"><span data-stu-id="8ed2e-109">NerdDinner Step 12: Unit Testing</span></span>

<span data-ttu-id="8ed2e-110">Nous allons développer une suite de tests unitaires automatisés pour vérifier nos fonctionnalités de NerdDinner, et qui donne la confiance pour apporter des modifications et améliorations apportées à l’application dans le futur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-110">Let's develop a suite of automated unit tests that verify our NerdDinner functionality, and which will give us the confidence to make changes and improvements to the application in the future.</span></span>

### <a name="why-unit-test"></a><span data-ttu-id="8ed2e-111">Pourquoi de Test unitaire ?</span><span class="sxs-lookup"><span data-stu-id="8ed2e-111">Why Unit Test?</span></span>

<span data-ttu-id="8ed2e-112">Sur le lecteur en une journée de travail, vous avez un disque mémoire flash soudain d’inspiration sur une application que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-112">On the drive into work one morning you have a sudden flash of inspiration about an application you are working on.</span></span> <span data-ttu-id="8ed2e-113">Vous réalisez une modification est que vous pouvez implémenter qui permettront à l’application améliorera considérablement.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-113">You realize there is a change you can implement that will make the application dramatically better.</span></span> <span data-ttu-id="8ed2e-114">Il peut être une refactorisation qui nettoie le code, ajoute une nouvelle fonctionnalité ou qui corrige un bogue.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-114">It might be a refactoring that cleans up the code, adds a new feature, or fixes a bug.</span></span>

<span data-ttu-id="8ed2e-115">La question qui vous confronts lorsque vous arrivez à votre ordinateur est : « mode sans échec en faire de cette amélioration ? »</span><span class="sxs-lookup"><span data-stu-id="8ed2e-115">The question that confronts you when you arrive at your computer is – "how safe is it to make this improvement?"</span></span> <span data-ttu-id="8ed2e-116">Que se passe-t-il si la modification a des effets secondaires ou s’arrête quelque chose ?</span><span class="sxs-lookup"><span data-stu-id="8ed2e-116">What if making the change has side effects or breaks something?</span></span> <span data-ttu-id="8ed2e-117">La modification peut être simple et prendra que quelques minutes à implémenter, mais que se passe-t-il s’il faut heures pour tester manuellement tous les scénarios d’application ?</span><span class="sxs-lookup"><span data-stu-id="8ed2e-117">The change might be simple and only take a few minutes to implement, but what if it takes hours to manually test out all of the application scenarios?</span></span> <span data-ttu-id="8ed2e-118">Que se passe-t-il si vous oubliez couvrir un scénario et une application interrompue mise en production ?</span><span class="sxs-lookup"><span data-stu-id="8ed2e-118">What if you forget to cover a scenario and a broken application goes into production?</span></span> <span data-ttu-id="8ed2e-119">Cette amélioration vraiment toutes la peine fait ?</span><span class="sxs-lookup"><span data-stu-id="8ed2e-119">Is making this improvement really worth all the effort?</span></span>

<span data-ttu-id="8ed2e-120">Des tests unitaires automatisés peuvent fournir un filet de sécurité qui vous permet d’améliorer en permanence de vos applications et éviter d’être peur du code que vous utilisez.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-120">Automated unit tests can provide a safety net that enables you to continually enhance your applications, and avoid being afraid of the code you are working on.</span></span> <span data-ttu-id="8ed2e-121">Avoir automatisée des tests qui vérifient rapidement la fonctionnalité vous permet de code en toute confiance – et vous aider à apporter des améliorations, vous pouvez sinon pas avoir effectuée en cours.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-121">Having automated tests that quickly verify functionality enables you to code with confidence – and empower you to make improvements you might otherwise not have felt comfortable doing.</span></span> <span data-ttu-id="8ed2e-122">Ils aident également à créer des solutions qui sont plus faciles à gérer et ont une durée de vie plus longue - qui entraîne un meilleur retour sur investissement.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-122">They also help create solutions that are more maintainable and have a longer lifetime - which leads to a much higher return on investment.</span></span>

<span data-ttu-id="8ed2e-123">L’infrastructure ASP.NET MVC rend simple et naturelle à la fonctionnalité de l’application test unitaire.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-123">The ASP.NET MVC Framework makes it easy and natural to unit test application functionality.</span></span> <span data-ttu-id="8ed2e-124">Il permet également d’un flux de travail de développement de pilotée par les tests (TDD) qui permet le développement en fonction de test en premier.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-124">It also enables a Test Driven Development (TDD) workflow that enables test-first based development.</span></span>

### <a name="nerddinnertests-project"></a><span data-ttu-id="8ed2e-125">NerdDinner.Tests projet</span><span class="sxs-lookup"><span data-stu-id="8ed2e-125">NerdDinner.Tests Project</span></span>

<span data-ttu-id="8ed2e-126">Lorsque nous avons créé notre application NerdDinner au début de ce didacticiel, nous avons invités avec une boîte de dialogue vous demandant si nous voulons créer un projet de test unitaire pour accéder en même temps que le projet d’application :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-126">When we created our NerdDinner application at the beginning of this tutorial, we were prompted with a dialog asking whether we wanted to create a unit test project to go along with the application project:</span></span>

![](enable-automated-unit-testing/_static/image1.png)

<span data-ttu-id="8ed2e-127">Nous avons conservé la « Oui, créer un projet de test unitaire » case sélectionnée, ce qui a entraîné un projet de « NerdDinner.Tests » ajouté à notre solution :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-127">We kept the "Yes, create a unit test project" radio button selected – which resulted in a "NerdDinner.Tests" project being added to our solution:</span></span>

![](enable-automated-unit-testing/_static/image2.png)

<span data-ttu-id="8ed2e-128">Le projet NerdDinner.Tests fait référence à l’assembly de projet d’application de NerdDinner et nous permet d’ajouter facilement des tests automatisés qui vérifient les fonctionnalités de l’application.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-128">The NerdDinner.Tests project references the NerdDinner application project assembly, and enables us to easily add automated tests to it that verify the application functionality.</span></span>

### <a name="creating-unit-tests-for-our-dinner-model-class"></a><span data-ttu-id="8ed2e-129">Création de Tests unitaires pour notre classe de modèle dîner</span><span class="sxs-lookup"><span data-stu-id="8ed2e-129">Creating Unit Tests for our Dinner Model Class</span></span>

<span data-ttu-id="8ed2e-130">Vous allez ajouter des tests à notre projet NerdDinner.Tests qui permettent de vérifier la classe Dinner que nous avons créé lorsque nous avons créé la couche de notre modèle.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-130">Let's add some tests to our NerdDinner.Tests project that verify the Dinner class we created when we built our model layer.</span></span>

<span data-ttu-id="8ed2e-131">Nous allons commencer en créant un nouveau dossier dans notre projet de test appelée « Modèles » où nous allons placer nos tests modèle lié.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-131">We'll start by creating a new folder within our test project called "Models" where we'll place our model-related tests.</span></span> <span data-ttu-id="8ed2e-132">Nous allons ensuite avec le bouton droit sur le dossier et choisissez le **Add -&gt;nouveau Test** commande de menu.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-132">We'll then right-click on the folder and choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="8ed2e-133">La boîte de dialogue « Ajouter un nouveau Test » s’affiche.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-133">This will bring up the "Add New Test" dialog.</span></span>

<span data-ttu-id="8ed2e-134">Nous allons choisir créer un « Test unitaire » et le nommer « DinnerTest.cs » :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-134">We'll choose to create a "Unit Test" and name it "DinnerTest.cs":</span></span>

![](enable-automated-unit-testing/_static/image3.png)

<span data-ttu-id="8ed2e-135">Lorsque vous cliquez sur le bouton « OK » Visual Studio ajoute (et l’ouvre) un fichier DinnerTest.cs au projet :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-135">When we click the "ok" button Visual Studio will add (and open) a DinnerTest.cs file to the project:</span></span>

![](enable-automated-unit-testing/_static/image4.png)

<span data-ttu-id="8ed2e-136">Le modèle de test unitaire Visual Studio par défaut comporte beaucoup de maquette code que je trouve un peu confu.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-136">The default Visual Studio unit test template has a bunch of boiler-plate code within it that I find a little messy.</span></span> <span data-ttu-id="8ed2e-137">Nous allons nettoyer simplement contenir le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-137">Let's clean it up to just contain the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample1.cs)]

<span data-ttu-id="8ed2e-138">L’attribut [TestClass] sur la classe DinnerTest ci-dessus identifie comme une classe qui contiendra les tests, ainsi que l’initialisation de test facultatif et code de destruction.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-138">The [TestClass] attribute on the DinnerTest class above identifies it as a class that will contain tests, as well as optional test initialization and teardown code.</span></span> <span data-ttu-id="8ed2e-139">Nous pouvons définir les tests qu’il contient en ajoutant des méthodes publiques qui ont un attribut [TestMethod] sur ces derniers.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-139">We can define tests within it by adding public methods that have a [TestMethod] attribute on them.</span></span>

<span data-ttu-id="8ed2e-140">Voici la première des deux tests, nous allons ajouter qui exercent notre classe dîner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-140">Below are the first of two tests we'll add that exercise our Dinner class.</span></span> <span data-ttu-id="8ed2e-141">Le premier test vérifie que notre dîner n’est pas valide si un nouveau dîner est créé sans que toutes les propriétés sont correctement définies.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-141">The first test verifies that our Dinner is invalid if a new Dinner is created without all properties being set correctly.</span></span> <span data-ttu-id="8ed2e-142">Le deuxième test vérifie que notre dîner est valide lorsqu’un dîner possède toutes les propriétés définies avec les valeurs valides :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-142">The second test verifies that our Dinner is valid when a Dinner has all properties set with valid values:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample2.cs)]

<span data-ttu-id="8ed2e-143">Vous remarquerez que ci-dessus que notre test les noms sont très explicite (et quelque peu détaillée).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-143">You'll notice above that our test names are very explicit (and somewhat verbose).</span></span> <span data-ttu-id="8ed2e-144">Ce faisant, nous allons étant donné que nous pouvons mettre fin à des centaines, voire des milliers de tests peu de créer, et nous permet de déterminer rapidement l’objectif et le comportement de chacun d’eux (en particulier lorsque nous recherchons dans une liste d’erreurs dans un test runner).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-144">We are doing this because we might end up creating hundreds or thousands of small tests, and we want to make it easy to quickly determine the intent and behavior of each of them (especially when we are looking through a list of failures in a test runner).</span></span> <span data-ttu-id="8ed2e-145">Les noms de test doivent être nommés d’après les fonctionnalités qu’ils testent.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-145">The test names should be named after the functionality they are testing.</span></span> <span data-ttu-id="8ed2e-146">Ci-dessus, nous utilisons un « nom\_doit\_verbe « modèle d’affectation de noms.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-146">Above we are using a "Noun\_Should\_Verb" naming pattern.</span></span>

<span data-ttu-id="8ed2e-147">Nous sommes structurer les tests à l’aide de tests pattern – ce qui signifie « Arrange, Act, Assert » « AAA » :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-147">We are structuring the tests using the "AAA" testing pattern – which stands for "Arrange, Act, Assert":</span></span>

- <span data-ttu-id="8ed2e-148">Réorganiser : Le programme d’installation l’unité en cours de test</span><span class="sxs-lookup"><span data-stu-id="8ed2e-148">Arrange: Setup the unit being tested</span></span>
- <span data-ttu-id="8ed2e-149">ACT : Testez le test unitaire et capturer les résultats</span><span class="sxs-lookup"><span data-stu-id="8ed2e-149">Act: Exercise the unit under test and capture results</span></span>
- <span data-ttu-id="8ed2e-150">Assertion : Vérifier le comportement</span><span class="sxs-lookup"><span data-stu-id="8ed2e-150">Assert: Verify the behavior</span></span>

<span data-ttu-id="8ed2e-151">Écriture des tests, que nous voulons éviter que les tests individuels faire trop.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-151">When we write tests we want to avoid having the individual tests do too much.</span></span> <span data-ttu-id="8ed2e-152">Au lieu de cela, chaque test doit vérifier un concept unique (ce qui rend beaucoup plus facile d’identifier la cause des échecs).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-152">Instead each test should verify only a single concept (which will make it much easier to pinpoint the cause of failures).</span></span> <span data-ttu-id="8ed2e-153">Il est recommandé de tenter disposent uniquement d’une seule instruction pour chaque test d’assertion.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-153">A good guideline is to try and only have a single assert statement for each test.</span></span> <span data-ttu-id="8ed2e-154">Si vous avez plus d’une instruction dans une méthode de test d’assertion, assurez-vous qu’ils sont tous est utilisés pour tester le même concept.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-154">If you have more than one assert statement in a test method, make sure they are all being used to test the same concept.</span></span> <span data-ttu-id="8ed2e-155">En cas de doute, vérifiez un autre test.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-155">When in doubt, make another test.</span></span>

### <a name="running-tests"></a><span data-ttu-id="8ed2e-156">Exécution des tests</span><span class="sxs-lookup"><span data-stu-id="8ed2e-156">Running Tests</span></span>

<span data-ttu-id="8ed2e-157">Visual Studio 2008 Professional (et versions supérieures) incluent un testeur intégré qui peut être utilisé pour exécuter des projets de tests unitaires Visual Studio dans l’IDE.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-157">Visual Studio 2008 Professional (and higher editions) includes a built-in test runner that can be used to run Visual Studio Unit Test projects within the IDE.</span></span> <span data-ttu-id="8ed2e-158">Nous pouvons sélectionner la **Test -&gt;exécuter -&gt;tous les Tests de la Solution** menu command (ou type Ctrl R, A) pour exécuter l’ensemble de nos tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-158">We can select the **Test-&gt;Run-&gt;All Tests in Solution** menu command (or type Ctrl R, A) to run all of our unit tests.</span></span> <span data-ttu-id="8ed2e-159">Ou vous pouvez également nous pouvons notre curseur est placé dans une méthode de test ou de la classe de test spécifiques et utiliser le **Test -&gt;exécuter -&gt;Tests dans le contexte actuel** commande de menu (ou type Ctrl R, T) pour exécuter un sous-ensemble des tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-159">Or alternatively we can position our cursor within a specific test class or test method and use the **Test-&gt;Run-&gt;Tests in Current Context** menu command (or type Ctrl R, T) to run a subset of the unit tests.</span></span>

<span data-ttu-id="8ed2e-160">Nous allons notre curseur est placé dans la classe DinnerTest et tapez « Ctrl R, T » pour exécuter les deux des tests que nous venons de définir.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-160">Let's position our cursor within the DinnerTest class and type "Ctrl R, T" to run the two tests we just defined.</span></span> <span data-ttu-id="8ed2e-161">Lorsque vous faire une fenêtre « Résultats de Test » s’affiche dans Visual Studio et nous verrons les résultats de nos tests répertoriés dans celui-ci :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-161">When we do this a "Test Results" window will appear within Visual Studio and we'll see the results of our test run listed within it:</span></span>

![](enable-automated-unit-testing/_static/image5.png)

<span data-ttu-id="8ed2e-162">*Remarque : La fenêtre Résultats des tests Visual Studio n’affiche pas la colonne nom de la classe par défaut. Vous pouvez ajouter cela en cliquant dans la fenêtre Résultats des tests et à l’aide de la commande de menu Ajouter/supprimer des colonnes.*</span><span class="sxs-lookup"><span data-stu-id="8ed2e-162">*Note: The VS test results window does not show the Class Name column by default. You can add this by right-clicking within the Test Results window and using the Add/Remove Columns menu command.*</span></span>

<span data-ttu-id="8ed2e-163">Nos deux tests a duré qu’une fraction de seconde à exécuter et que vous pouvez voir les deux passés.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-163">Our two tests took only a fraction of a second to run – and as you can see they both passed.</span></span> <span data-ttu-id="8ed2e-164">Nous pouvons maintenant passer et les enrichir en créant des tests supplémentaires pour vérifier les validations de règle spécifique, ainsi que pour couvrent les deux méthodes d’assistance - IsUserHost() et IsUserRegisterd() – que nous avons ajouté à la classe Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-164">We can now go on and augment them by creating additional tests that verify specific rule validations, as well as cover the two helper methods - IsUserHost() and IsUserRegisterd() – that we added to the Dinner class.</span></span> <span data-ttu-id="8ed2e-165">Absence de tous ces tests pour la classe Dinner rend beaucoup plus facile et plus sûr d’ajouter des règles d’entreprise et des validations à ce dernier dans le futur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-165">Having all these tests in place for the Dinner class will make it much easier and safer to add new business rules and validations to it in the future.</span></span> <span data-ttu-id="8ed2e-166">Nous pouvons ajouter notre nouvelle logique de règle à dîner et puis vérifiez qu’elle n’a pas encore scindée un de nos fonctionnalités logique précédente en quelques secondes.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-166">We can add our new rule logic to Dinner, and then within seconds verify that it hasn't broken any of our previous logic functionality.</span></span>

<span data-ttu-id="8ed2e-167">Notez comment à l’aide d’un nom descriptif test permet de facilement comprendre rapidement ce que chaque test consiste à vérifier.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-167">Notice how using a descriptive test name makes it easy to quickly understand what each test is verifying.</span></span> <span data-ttu-id="8ed2e-168">Je vous recommandons d’utiliser le **Tools -&gt;Options** commande de menu, ouvrir les outils de Test -&gt;écran de configuration d’exécution de tests et la vérification du » en double-cliquant sur un résultat de test unitaire Échec ou non concluant affiche case à cocher du point de défaillance dans le test ».</span><span class="sxs-lookup"><span data-stu-id="8ed2e-168">I recommend using the **Tools-&gt;Options** menu command, opening the Test Tools-&gt;Test Execution configuration screen, and checking the "Double-clicking a failed or inconclusive unit test result displays the point of failure in the test" checkbox.</span></span> <span data-ttu-id="8ed2e-169">Cela vous permettra de double-cliquer sur une erreur dans la fenêtre Résultats des tests et passer immédiatement à l’échec d’assertion.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-169">This will allow you to double-click on a failure in the test results window and jump immediately to the assert failure.</span></span>

### <a name="creating-dinnerscontroller-unit-tests"></a><span data-ttu-id="8ed2e-170">Création de Tests unitaires de DinnersController</span><span class="sxs-lookup"><span data-stu-id="8ed2e-170">Creating DinnersController Unit Tests</span></span>

<span data-ttu-id="8ed2e-171">Nous allons maintenant créer des tests unitaires qui vérifient les fonctionnalités de notre DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-171">Let's now create some unit tests that verify our DinnersController functionality.</span></span> <span data-ttu-id="8ed2e-172">Nous allons démarrer en cliquant sur le dossier « Contrôleurs » dans notre projet de Test, puis choisissez le **Add -&gt;nouveau Test** commande de menu.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-172">We'll start by right-clicking on the "Controllers" folder within our Test project and then choose the **Add-&gt;New Test** menu command.</span></span> <span data-ttu-id="8ed2e-173">Nous allons créer un « Test unitaire » et nommez-le « DinnersControllerTest.cs ».</span><span class="sxs-lookup"><span data-stu-id="8ed2e-173">We'll create a "Unit Test" and name it "DinnersControllerTest.cs".</span></span>

<span data-ttu-id="8ed2e-174">Nous allons créer deux méthodes de test qui vérifient la méthode d’action Details() sur le DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-174">We'll create two test methods that verify the Details() action method on the DinnersController.</span></span> <span data-ttu-id="8ed2e-175">Le premier vérifie qu’une vue est retournée lorsqu’un dîner existant est demandé.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-175">The first will verify that a View is returned when an existing Dinner is requested.</span></span> <span data-ttu-id="8ed2e-176">Le second vérifie qu’une vue « NotFound » est retournée lorsqu’un dîner inexistante est demandé :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-176">The second will verify that a "NotFound" view is returned when a non-existent Dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample3.cs)]

<span data-ttu-id="8ed2e-177">Le code ci-dessus compile le nettoyage.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-177">The above code compiles clean.</span></span> <span data-ttu-id="8ed2e-178">Si nous exécutons les tests, cependant, tous les deux échouent :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-178">When we run the tests, though, they both fail:</span></span>

![](enable-automated-unit-testing/_static/image6.png)

<span data-ttu-id="8ed2e-179">Si vous examinez les messages d’erreur, vous verrez que les tests ont échoué était dû car notre classe DinnersRepository n’a pas pu se connecter à une base de données.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-179">If we look at the error messages, we'll see that the reason the tests failed was because our DinnersRepository class was unable to connect to a database.</span></span> <span data-ttu-id="8ed2e-180">Notre application NerdDinner utilise une chaîne de connexion dans un fichier local SQL Server Express qui se trouve sous le \App\_répertoire de données du projet d’application de NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-180">Our NerdDinner application is using a connection-string to a local SQL Server Express file which lives under the \App\_Data directory of the NerdDinner application project.</span></span> <span data-ttu-id="8ed2e-181">Étant donné que notre projet NerdDinner.Tests compile et s’exécute dans un autre répertoire puis le projet d’application, l’emplacement de chemin d’accès relatif de la chaîne de connexion est incorrect.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-181">Because our NerdDinner.Tests project compiles and runs in a different directory then the application project, the relative path location of our connection-string is incorrect.</span></span>

<span data-ttu-id="8ed2e-182">Nous *impossible* résoudre ce problème en copiant le fichier de base de données SQL Express à notre projet de test, puis ajoutez une chaîne de connexion de test appropriés à ce dernier dans le fichier App.config de votre projet de test.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-182">We *could* fix this by copying the SQL Express database file to our test project, and then add an appropriate test connection-string to it in the App.config of our test project.</span></span> <span data-ttu-id="8ed2e-183">Cela obtiendriez les tests ci-dessus débloqué et en cours d’exécution.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-183">This would get the above tests unblocked and running.</span></span>

<span data-ttu-id="8ed2e-184">Tests unitaires de code à l’aide d’une base de données réel, cependant, offre un certain nombre de défis.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-184">Unit testing code using a real database, though, brings with it a number of challenges.</span></span> <span data-ttu-id="8ed2e-185">Plus précisément :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-185">Specifically:</span></span>

- <span data-ttu-id="8ed2e-186">Cela ralentit considérablement le temps d’exécution de tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-186">It significantly slows down the execution time of unit tests.</span></span> <span data-ttu-id="8ed2e-187">Plus nécessaire pour exécuter des tests, vous êtes susceptible de moins pour les exécuter fréquemment.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-187">The longer it takes to run tests, the less likely you are to execute them frequently.</span></span> <span data-ttu-id="8ed2e-188">Dans l’idéal, vous souhaitez que vos tests unitaires pour pouvoir être exécuté en secondes et qu’elle soit chose comme naturellement en tant que la compilation du projet.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-188">Ideally you want your unit tests to be able to be run in seconds – and have it be something you do as naturally as compiling the project.</span></span>
- <span data-ttu-id="8ed2e-189">Elle complique la logique de configuration et de nettoyage au sein de tests.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-189">It complicates the setup and cleanup logic within tests.</span></span> <span data-ttu-id="8ed2e-190">Vous souhaitez que chaque test unitaire isolé et indépendant des autres (sans effets secondaires ou avec dépendances).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-190">You want each unit test to be isolated and independent of others (with no side effects or dependencies).</span></span> <span data-ttu-id="8ed2e-191">Lorsque vous travaillez sur une base de données réelle, que vous devez penser d’état et de le réinitialiser entre les tests.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-191">When working against a real database you have to be mindful of state and reset it between tests.</span></span>

<span data-ttu-id="8ed2e-192">Examinons un modèle de conception appelé « injection de dépendance » qui peut nous aider à contourner ces problèmes et d’éviter la nécessité d’utiliser une base de données réel avec nos tests.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-192">Let's look at a design pattern called "dependency injection" that can help us work around these issues and avoid the need to use a real database with our tests.</span></span>

### <a name="dependency-injection"></a><span data-ttu-id="8ed2e-193">Injection de dépendances</span><span class="sxs-lookup"><span data-stu-id="8ed2e-193">Dependency Injection</span></span>

<span data-ttu-id="8ed2e-194">Maintenant DinnersController est « étroitement » à la classe DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-194">Right now DinnersController is tightly "coupled" to the DinnerRepository class.</span></span> <span data-ttu-id="8ed2e-195">« COUPLAGE » fait référence à une situation où une classe explicitement s’appuie sur une autre classe afin de fonctionner :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-195">"Coupling" refers to a situation where a class explicitly relies on another class in order to work:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample4.cs)]

<span data-ttu-id="8ed2e-196">Étant donné que la classe DinnerRepository nécessite l’accès à une base de données, la dépendance étroitement couplée la classe DinnersController a aux extrémités DinnerRepository demande à une base de données dans l’ordre pour les méthodes d’action DinnersController à tester.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-196">Because the DinnerRepository class requires access to a database, the tightly coupled dependency the DinnersController class has on the DinnerRepository ends up requiring us to have a database in order for the DinnersController action methods to be tested.</span></span>

<span data-ttu-id="8ed2e-197">Nous pouvons contourner ce problème en utilisant un modèle de conception appelé « injection de dépendances : « ce qui constitue une approche où les dépendances (comme les classes de référentiel qui fournissent l’accès aux données) n’est plus implicitement créées dans les classes qui les utilisent.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-197">We can get around this by employing a design pattern called "dependency injection" – which is an approach where dependencies (like repository classes that provide data access) are no longer implicitly created within classes that use them.</span></span> <span data-ttu-id="8ed2e-198">Au lieu de cela, des dépendances peuvent être explicitement transmis à la classe qui les utilise à l’aide des arguments de constructeur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-198">Instead, dependencies can be explicitly passed to the class that uses them using constructor arguments.</span></span> <span data-ttu-id="8ed2e-199">Si les dépendances sont définies à l’aide des interfaces, nous avons ensuite la possibilité de passer dans les implémentations de la dépendance « faux » pour des scénarios de test unitaire.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-199">If the dependencies are defined using interfaces, we then have the flexibility to pass in "fake" dependency implementations for unit test scenarios.</span></span> <span data-ttu-id="8ed2e-200">Cela permet de créer des implémentations de dépendance spécifiques aux tests qui ne nécessitent pas réellement d’accès à une base de données.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-200">This enables us to create test-specific dependency implementations that do not actually require access to a database.</span></span>

<span data-ttu-id="8ed2e-201">Pour le voir en action, nous allons implémenter l’injection de dépendance avec notre DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-201">To see this in action, let's implement dependency injection with our DinnersController.</span></span>

#### <a name="extracting-an-idinnerrepository-interface"></a><span data-ttu-id="8ed2e-202">Extraction d’une interface IDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="8ed2e-202">Extracting an IDinnerRepository interface</span></span>

<span data-ttu-id="8ed2e-203">La première étape est de créer une nouvelle interface IDinnerRepository qui encapsule le contrat de référentiel que nos contrôleurs nécessitent pour récupérer et mettre à jour préparés.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-203">Our first step will be to create a new IDinnerRepository interface that encapsulates the repository contract our controllers require to retrieve and update Dinners.</span></span>

<span data-ttu-id="8ed2e-204">Nous pouvons définir ce contrat d’interface manuellement en cliquant sur le dossier \Models, puis en choisissant le **Add -&gt;un nouvel élément** commande de menu et la création d’une nouvelle interface nommée IDinnerRepository.cs.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-204">We can define this interface contract manually by right-clicking on the \Models folder, and then choosing the **Add-&gt;New Item** menu command and creating a new interface named IDinnerRepository.cs.</span></span>

<span data-ttu-id="8ed2e-205">Nous pouvons également utiliser l’extraction de refactorisation outils intégrés à Visual Studio Professional (et versions supérieures) à automatiquement et créer une interface pour nous de notre classe DinnerRepository existant.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-205">Alternatively we can use the refactoring tools built-into Visual Studio Professional (and higher editions) to automatically extract and create an interface for us from our existing DinnerRepository class.</span></span> <span data-ttu-id="8ed2e-206">Pour extraire cette interface à l’aide de Visual Studio, simplement placer le curseur de l’éditeur de texte sur la classe DinnerRepository, puis avec le bouton droit et sélectionnez le **refactoriser -&gt;extraire l’Interface** commande de menu :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-206">To extract this interface using VS, simply position the cursor in the text editor on the DinnerRepository class, and then right-click and choose the **Refactor-&gt;Extract Interface** menu command:</span></span>

![](enable-automated-unit-testing/_static/image7.png)

<span data-ttu-id="8ed2e-207">Cela lancer la boîte de dialogue « Extraire l’Interface » et nous demander le nom de l’interface à créer.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-207">This will launch the "Extract Interface" dialog and prompt us for the name of the interface to create.</span></span> <span data-ttu-id="8ed2e-208">Il sera par défaut IDinnerRepository et sélectionner automatiquement toutes les méthodes publiques sur la classe DinnerRepository existante à ajouter à l’interface :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-208">It will default to IDinnerRepository and automatically select all public methods on the existing DinnerRepository class to add to the interface:</span></span>

![](enable-automated-unit-testing/_static/image8.png)

<span data-ttu-id="8ed2e-209">Lorsque vous cliquez sur le bouton « OK », Visual Studio ajoute une nouvelle interface IDinnerRepository à notre application :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-209">When we click the "ok" button, Visual Studio will add a new IDinnerRepository interface to our application:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample5.cs)]

<span data-ttu-id="8ed2e-210">Et notre classe DinnerRepository existante sera mise à jour afin qu’elle implémente l’interface :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-210">And our existing DinnerRepository class will be updated so that it implements the interface:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample6.cs)]

#### <a name="updating-dinnerscontroller-to-support-constructor-injection"></a><span data-ttu-id="8ed2e-211">DinnersController mise à jour pour prendre en charge d’injection de constructeurs</span><span class="sxs-lookup"><span data-stu-id="8ed2e-211">Updating DinnersController to support constructor injection</span></span>

<span data-ttu-id="8ed2e-212">Nous allons maintenant mettre à jour de la classe DinnersController pour utiliser la nouvelle interface.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-212">We'll now update the DinnersController class to use the new interface.</span></span>

<span data-ttu-id="8ed2e-213">Actuellement DinnersController est codé en dur telles que son champ « dinnerRepository » est toujours une classe DinnerRepository :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-213">Currently DinnersController is hard-coded such that its "dinnerRepository" field is always a DinnerRepository class:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample7.cs)]

<span data-ttu-id="8ed2e-214">Nous allons le modifier afin que le champ « dinnerRepository » est de type IDinnerRepository au lieu de DinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-214">We'll change it so that the "dinnerRepository" field is of type IDinnerRepository instead of DinnerRepository.</span></span> <span data-ttu-id="8ed2e-215">Nous allons ensuite ajouter deux constructeurs DinnersController publics.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-215">We'll then add two public DinnersController constructors.</span></span> <span data-ttu-id="8ed2e-216">Un des constructeurs permet une IDinnerRepository à passer en tant qu’argument.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-216">One of the constructors allows an IDinnerRepository to be passed as an argument.</span></span> <span data-ttu-id="8ed2e-217">L’autre est un constructeur par défaut qui utilise notre implémentation DinnerRepository existante :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-217">The other is a default constructor that uses our existing DinnerRepository implementation:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample8.cs)]

<span data-ttu-id="8ed2e-218">Étant donné que ASP.NET MVC par défaut crée des classes de contrôleur à l’aide des constructeurs par défaut, notre DinnersController lors de l’exécution continue à utiliser la classe DinnerRepository pour accéder aux données.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-218">Because ASP.NET MVC by default creates controller classes using default constructors, our DinnersController at runtime will continue to use the DinnerRepository class to perform data access.</span></span>

<span data-ttu-id="8ed2e-219">Nous pouvons maintenant mettre à jour de nos tests unitaires, cependant, pour passer dans une implémentation de référentiel dinner « faux » en utilisant le paramètre de constructeur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-219">We can now update our unit tests, though, to pass in a "fake" dinner repository implementation using the parameter constructor.</span></span> <span data-ttu-id="8ed2e-220">Ce référentiel dinner « faux » ne nécessite pas d’accès à une base de données réel et à la place utilise les données d’exemple en mémoire.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-220">This "fake" dinner repository will not require access to a real database, and instead will use in-memory sample data.</span></span>

#### <a name="creating-the-fakedinnerrepository-class"></a><span data-ttu-id="8ed2e-221">Création de la classe FakeDinnerRepository</span><span class="sxs-lookup"><span data-stu-id="8ed2e-221">Creating the FakeDinnerRepository class</span></span>

<span data-ttu-id="8ed2e-222">Nous allons créer une classe FakeDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-222">Let's create a FakeDinnerRepository class.</span></span>

<span data-ttu-id="8ed2e-223">Nous commencez par créer un répertoire « Fakes » dans notre projet NerdDinner.Tests et puis ajoutez une nouvelle classe FakeDinnerRepository lui (avec le bouton droit sur le dossier et choisissez **Add -&gt;nouvelle classe**) :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-223">We'll begin by creating a "Fakes" directory within our NerdDinner.Tests project and then add a new FakeDinnerRepository class to it (right-click on the folder and choose **Add-&gt;New Class**):</span></span>

![](enable-automated-unit-testing/_static/image9.png)

<span data-ttu-id="8ed2e-224">Nous allons mettre à jour le code afin que la classe FakeDinnerRepository implémente l’interface IDinnerRepository.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-224">We'll update the code so that the FakeDinnerRepository class implements the IDinnerRepository interface.</span></span> <span data-ttu-id="8ed2e-225">Nous pouvons ensuite avec le bouton droit dessus et choisissez la commande de menu contextuel « Implémenter l’interface IDinnerRepository » :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-225">We can then right-click on it and choose the "Implement interface IDinnerRepository" context menu command:</span></span>

![](enable-automated-unit-testing/_static/image10.png)

<span data-ttu-id="8ed2e-226">Cela entraîne de Visual Studio pour tous les membres d’interface IDinnerRepository ajouter automatiquement à la classe FakeDinnerRepository avec les implémentations par défaut « stub out » :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-226">This will cause Visual Studio to automatically add all of the IDinnerRepository interface members to our FakeDinnerRepository class with default "stub out" implementations:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample9.cs)]

<span data-ttu-id="8ed2e-227">Nous pouvons puis mettre à jour l’implémentation FakeDinnerRepository pour travailler sur une liste en mémoire&lt;Dinner&gt; collection passée comme un argument de constructeur :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-227">We can then update the FakeDinnerRepository implementation to work off of an in-memory List&lt;Dinner&gt; collection passed to it as a constructor argument:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample10.cs)]

<span data-ttu-id="8ed2e-228">Nous disposons désormais d’une implémentation IDinnerRepository factice qui ne nécessite pas d’une base de données et peut fonctionner à la place une liste en mémoire des objets de Dinner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-228">We now have a fake IDinnerRepository implementation that does not require a database, and can instead work off an in-memory list of Dinner objects.</span></span>

#### <a name="using-the-fakedinnerrepository-with-unit-tests"></a><span data-ttu-id="8ed2e-229">À l’aide de la FakeDinnerRepository avec des Tests unitaires</span><span class="sxs-lookup"><span data-stu-id="8ed2e-229">Using the FakeDinnerRepository with Unit Tests</span></span>

<span data-ttu-id="8ed2e-230">Revenons aux tests unitaires DinnersController qui a échoué précédemment, car la base de données n’était pas disponible.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-230">Let's return to the DinnersController unit tests that failed earlier because the database wasn't available.</span></span> <span data-ttu-id="8ed2e-231">Nous pouvons mettre à jour les méthodes de test pour utiliser un FakeDinnerRepository rempli avec des données de dîner exemple en mémoire pour le DinnersController en utilisant le code ci-dessous :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-231">We can update the test methods to use a FakeDinnerRepository populated with sample in-memory Dinner data to the DinnersController using the code below:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample11.cs)]

<span data-ttu-id="8ed2e-232">Et si nous exécutons ces tests qu’elles réussissent maintenant :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-232">And now when we run these tests they both pass:</span></span>

![](enable-automated-unit-testing/_static/image11.png)

<span data-ttu-id="8ed2e-233">De plus, elles nécessitent qu’une fraction de seconde à exécuter et ne nécessitent pas une logique complexe d’installation/nettoyage.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-233">Best of all, they take only a fraction of a second to run, and do not require any complicated setup/cleanup logic.</span></span> <span data-ttu-id="8ed2e-234">Nous pouvons maintenant de test unitaire tous notre code de la méthode action DinnersController (y compris la liste, la pagination, plus d’informations, créer, mettre à jour et supprimer) sans avoir à se connecter à une base de données réel.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-234">We can now unit test all of our DinnersController action method code (including listing, paging, details, create, update and delete) without ever needing to connect to a real database.</span></span>

| <span data-ttu-id="8ed2e-235">**Côté rubrique : Infrastructures de d’Injection de dépendance**</span><span class="sxs-lookup"><span data-stu-id="8ed2e-235">**Side Topic: Dependency Injection Frameworks**</span></span> |
| --- |
| <span data-ttu-id="8ed2e-236">Exécution d’injection de dépendance manuelle (par exemple, nous sommes ci-dessus) fonctionne correctement, mais devient-elle plus difficile à gérer en tant que le nombre de dépendances et les composants d’une application augmente.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-236">Performing manual dependency injection (like we are above) works fine, but does become harder to maintain as the number of dependencies and components in an application increases.</span></span> <span data-ttu-id="8ed2e-237">Plusieurs infrastructures d’injection de dépendance existent pour .NET qui peuvent aider à fournir davantage souplesse de gestion de dépendance.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-237">Several dependency injection frameworks exist for .NET that can help provide even more dependency management flexibility.</span></span> <span data-ttu-id="8ed2e-238">Ces infrastructures, également appelés des conteneurs de « Inversion de contrôle » (IoC), fournissent des mécanismes qui permettent à un niveau supplémentaire de prise en charge de configuration pour spécifier et en passant des dépendances pour les objets lors de l’exécution (généralement à l’aide d’injection de constructeur ).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-238">These frameworks, also sometimes called "Inversion of Control" (IoC) containers, provide mechanisms that enable an additional level of configuration support for specifying and passing dependencies to objects at runtime (most often using constructor injection).</span></span> <span data-ttu-id="8ed2e-239">Parmi les plus populaires Injection de dépendances OSS / incluent des infrastructures d’inversion de contrôle dans .NET : AutoFac, Ninject, Spring.NET, StructureMap et Windsor.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-239">Some of the more popular OSS Dependency Injection / IOC frameworks in .NET include: AutoFac, Ninject, Spring.NET, StructureMap, and Windsor.</span></span> <span data-ttu-id="8ed2e-240">Expose les API qui permettent aux développeurs de participer à la résolution et l’instanciation des contrôleurs et qui permet l’Injection de dépendances d’extensibilité ASP.NET MVC / infrastructures d’inversion de contrôle pour être correctement intégré au sein de ce processus.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-240">ASP.NET MVC exposes extensibility APIs that enable developers to participate in the resolution and instantiation of controllers, and which enables Dependency Injection / IoC frameworks to be cleanly integrated within this process.</span></span> <span data-ttu-id="8ed2e-241">À l’aide d’une infrastructure de ce type est également nous permettent de supprimer le constructeur par défaut à partir de notre DinnersController – supprimer complètement le couplage entre lui-même et le DinnerRepositorys.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-241">Using a DI/IOC framework would also enable us to remove the default constructor from our DinnersController – which would completely remove the coupling between it and the DinnerRepositorys.</span></span> <span data-ttu-id="8ed2e-242">Nous n’utiliserez pas une injection de dépendances / framework IOC avec notre application NerdDinner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-242">We won't be using a dependency injection / IOC framework with our NerdDinner application.</span></span> <span data-ttu-id="8ed2e-243">Mais il est quelque chose que nous avons prendre en compte pour l’avenir si les fonctionnalités de NerdDinner-base de code a fait l’objet.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-243">But it is something we could consider for the future if the NerdDinner code-base and capabilities grew.</span></span> |

### <a name="creating-edit-action-unit-tests"></a><span data-ttu-id="8ed2e-244">Création de Tests unitaires de Action Edition</span><span class="sxs-lookup"><span data-stu-id="8ed2e-244">Creating Edit Action Unit Tests</span></span>

<span data-ttu-id="8ed2e-245">Nous allons maintenant créer des tests unitaires qui permettent de vérifier la fonctionnalité d’édition de la DinnersController.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-245">Let's now create some unit tests that verify the Edit functionality of the DinnersController.</span></span> <span data-ttu-id="8ed2e-246">Nous allons commencer par tester la version HTTP-GET de notre modifier l’action :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-246">We'll start by testing the HTTP-GET version of our Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample12.cs)]

<span data-ttu-id="8ed2e-247">Nous allons créer un test qui vérifie qu’une vue soutenue par un objet DinnerFormViewModel est rendue à un dîner valid est demandé :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-247">We'll create a test that verifies that a View backed by a DinnerFormViewModel object is rendered back when a valid dinner is requested:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample13.cs)]

<span data-ttu-id="8ed2e-248">Lorsque nous exécutons le test, cependant, nous trouverez qu’il échoue, car une exception NullReferenceException est levée lorsque la méthode Edit accède à la propriété User.Identity.Name pour effectuer la vérification de Dinner.IsHostedBy().</span><span class="sxs-lookup"><span data-stu-id="8ed2e-248">When we run the test, though, we'll find that it fails because a null reference exception is thrown when the Edit method accesses the User.Identity.Name property to perform the Dinner.IsHostedBy() check.</span></span>

<span data-ttu-id="8ed2e-249">L’objet utilisateur sur la classe de base de contrôleur contient des informations sur l’utilisateur connecté et est remplie par ASP.NET MVC lorsqu’il crée le contrôleur lors de l’exécution.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-249">The User object on the Controller base class encapsulates details about the logged-in user, and is populated by ASP.NET MVC when it creates the controller at runtime.</span></span> <span data-ttu-id="8ed2e-250">Étant donné que nous testons la DinnersController en dehors d’un environnement de serveur web, l’objet utilisateur n’est pas défini (par conséquent, l’exception de référence null).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-250">Because we are testing the DinnersController outside of a web-server environment, the User object isn't set (hence the null reference exception).</span></span>

### <a name="mocking-the-useridentityname-property"></a><span data-ttu-id="8ed2e-251">Simulation de la propriété User.Identity.Name</span><span class="sxs-lookup"><span data-stu-id="8ed2e-251">Mocking the User.Identity.Name property</span></span>

<span data-ttu-id="8ed2e-252">Infrastructures factices faciliter le test en permettant de créer dynamiquement des versions fausses des objets dépendants qui prennent en charge de nos tests.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-252">Mocking frameworks make testing easier by enabling us to dynamically create fake versions of dependent objects that support our tests.</span></span> <span data-ttu-id="8ed2e-253">Par exemple, nous pouvons utiliser une infrastructure mocking dans notre test d’action de modification pour créer dynamiquement un objet utilisateur que notre DinnersController peut utiliser pour rechercher un nom d’utilisateur simulé.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-253">For example, we can use a mocking framework in our Edit action test to dynamically create a User object that our DinnersController can use to lookup a simulated username.</span></span> <span data-ttu-id="8ed2e-254">Cela permet d’éviter une référence null ne soit levée si nous exécutons notre test.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-254">This will avoid a null reference from being thrown when we run our test.</span></span>

<span data-ttu-id="8ed2e-255">Il existe de nombreuses .NET simulation des infrastructures qui peuvent être utilisés avec ASP.NET MVC (vous pouvez voir une liste ici : [ http://www.mockframeworks.com/ ](http://www.mockframeworks.com/)).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-255">There are many .NET mocking frameworks that can be used with ASP.NET MVC (you can see a list of them here: [http://www.mockframeworks.com/](http://www.mockframeworks.com/)).</span></span> <span data-ttu-id="8ed2e-256">Test de notre application NerdDinner que nous allons utiliser une open source simulation infrastructure appelée « Moq », qui peut être téléchargé gratuitement à partir de [ http://www.mockframeworks.com/moq ](http://www.mockframeworks.com/moq).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-256">For testing our NerdDinner application we'll use an open source mocking framework called "Moq", which can be downloaded for free from [http://www.mockframeworks.com/moq](http://www.mockframeworks.com/moq).</span></span>

<span data-ttu-id="8ed2e-257">Une fois téléchargé, nous allons ajouter une référence dans notre projet NerdDinner.Tests à l’assembly Moq.dll :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-257">Once downloaded, we'll add a reference in our NerdDinner.Tests project to the Moq.dll assembly:</span></span>

![](enable-automated-unit-testing/_static/image12.png)

<span data-ttu-id="8ed2e-258">Nous allons ensuite ajouter une méthode d’assistance de « CreateDinnersControllerAs(username) » à notre classe de test qui prend un nom d’utilisateur comme paramètre et qui, puis la propriété User.Identity.Name sur l’instance DinnersController « mocks » :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-258">We'll then add a "CreateDinnersControllerAs(username)" helper method to our test class that takes a username as a parameter, and which then "mocks" the User.Identity.Name property on the DinnersController instance:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample14.cs)]

<span data-ttu-id="8ed2e-259">Ci-dessus, nous utilisons Moq pour créer un objet fictifs que fakes un objet ControllerContext (qui est ce que ASP.NET MVC passe aux classes de contrôleur d’exposer des objets runtime tels que l’utilisateur, de demande, de réponse et de Session).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-259">Above we are using Moq to create a Mock object that fakes a ControllerContext object (which is what ASP.NET MVC passes to Controller classes to expose runtime objects like User, Request, Response, and Session).</span></span> <span data-ttu-id="8ed2e-260">Nous appelons la méthode « SetupGet » sur l’objet fictif pour indiquer que la propriété HttpContext.User.Identity.Name sur ControllerContext doit retourner la chaîne de nom d’utilisateur que nous avons passés à la méthode d’assistance.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-260">We are calling the "SetupGet" method on the Mock to indicate that the HttpContext.User.Identity.Name property on ControllerContext should return the username string we passed to the helper method.</span></span>

<span data-ttu-id="8ed2e-261">Nous pouvons simuler un nombre quelconque de ControllerContext propriétés et méthodes.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-261">We can mock any number of ControllerContext properties and methods.</span></span> <span data-ttu-id="8ed2e-262">Pour illustrer ceci, j’ai également ajouté un appel SetupGet() pour la propriété Request.IsAuthenticated (qui n’est pas réellement nécessaire pour les tests ci-dessous, mais qui permet d’illustrer comment vous pouvez simuler des propriétés de la demande).</span><span class="sxs-lookup"><span data-stu-id="8ed2e-262">To illustrate this I've also added a SetupGet() call for the Request.IsAuthenticated property (which isn't actually needed for the tests below – but which helps illustrate how you can mock Request properties).</span></span> <span data-ttu-id="8ed2e-263">Lorsque nous avons terminé nous assigner une instance de l’objet factice ControllerContext à la DinnersController notre méthode d’assistance est retournée.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-263">When we are done we assign an instance of the ControllerContext mock to the DinnersController our helper method returns.</span></span>

<span data-ttu-id="8ed2e-264">Nous pouvons désormais écrire des tests unitaires qui utilisent cette méthode d’assistance pour modifier les scénarios impliquant des différents utilisateurs de test :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-264">We can now write unit tests that use this helper method to test Edit scenarios involving different users:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample15.cs)]

<span data-ttu-id="8ed2e-265">Et si nous exécutons les tests qu’ils réussissent maintenant :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-265">And now when we run the tests they pass:</span></span>

![](enable-automated-unit-testing/_static/image13.png)

### <a name="testing-updatemodel-scenarios"></a><span data-ttu-id="8ed2e-266">Scénarios de test UpdateModel()</span><span class="sxs-lookup"><span data-stu-id="8ed2e-266">Testing UpdateModel() scenarios</span></span>

<span data-ttu-id="8ed2e-267">Nous avons créé des tests qui couvrent la version HTTP-GET de l’action de modification.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-267">We've created tests that cover the HTTP-GET version of the Edit action.</span></span> <span data-ttu-id="8ed2e-268">Nous allons maintenant créer des tests qui vérifient la version HTTP-POST de l’action de modification :</span><span class="sxs-lookup"><span data-stu-id="8ed2e-268">Let's now create some tests that verify the HTTP-POST version of the Edit action:</span></span>

[!code-csharp[Main](enable-automated-unit-testing/samples/sample16.cs)]

<span data-ttu-id="8ed2e-269">Le scénario de test nouveau intéressant pour nous prendre en charge avec cette méthode d’action est l’utilisation de la méthode d’assistance UpdateModel() sur la classe de base du contrôleur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-269">The interesting new testing scenario for us to support with this action method is its usage of the UpdateModel() helper method on the Controller base class.</span></span> <span data-ttu-id="8ed2e-270">Nous utilisons cette méthode d’assistance pour lier des valeurs de publication de formulaire à notre instance d’objet dîner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-270">We are using this helper method to bind form-post values to our Dinner object instance.</span></span>

<span data-ttu-id="8ed2e-271">Voici deux tests qui montre comment nous puissions fournir le formulaire publié des valeurs pour la méthode d’assistance UpdateModel() à utiliser.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-271">Below are two tests that demonstrates how we can supply form posted values for the UpdateModel() helper method to use.</span></span> <span data-ttu-id="8ed2e-272">Nous allons faire cela en créant et en remplissant un objet FormCollection et assigner à la propriété « ValueProvider » sur le contrôleur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-272">We'll do this by creating and populating a FormCollection object, and then assign it to the "ValueProvider" property on the Controller.</span></span>

<span data-ttu-id="8ed2e-273">Le premier test vérifie qu’une sauvegarde réussie, le navigateur est redirigé vers l’action détails.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-273">The first test verifies that on a successful save the browser is redirected to the details action.</span></span> <span data-ttu-id="8ed2e-274">Le deuxième test vérifie que lors de la validation d’entrée non valide l’action actualise l’affichage de modifier à nouveau avec un message d’erreur.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-274">The second test verifies that when invalid input is posted the action redisplays the edit view again with an error message.</span></span>


[!code-csharp[Main](enable-automated-unit-testing/samples/sample17.cs)]

### <a name="testing-wrap-up"></a><span data-ttu-id="8ed2e-275">Synthèse de test</span><span class="sxs-lookup"><span data-stu-id="8ed2e-275">Testing Wrap-Up</span></span>

<span data-ttu-id="8ed2e-276">Nous avons couvert les concepts principaux impliqués dans les classes de contrôleur de test unitaire.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-276">We've covered the core concepts involved in unit testing controller classes.</span></span> <span data-ttu-id="8ed2e-277">Nous pouvons utiliser ces techniques pour créer facilement des centaines de tests simples qui vérifient le comportement de notre application.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-277">We can use these techniques to easily create hundreds of simple tests that verify the behavior of our application.</span></span>

<span data-ttu-id="8ed2e-278">Étant donné que notre contrôleur et les tests de modèle ne nécessitent pas une base de données réel, ils sont extrêmement rapide et facile à exécuter.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-278">Because our controller and model tests do not require a real database, they are extremely fast and easy to run.</span></span> <span data-ttu-id="8ed2e-279">Nous serons en mesure d’exécuter des centaines de tests automatisés en secondes et obtenez immédiatement des commentaires que nous avons apporté une modification de quelque chose s’est arrêtée si.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-279">We'll be able to execute hundreds of automated tests in seconds, and immediately get feedback as to whether a change we made broke something.</span></span> <span data-ttu-id="8ed2e-280">Cela permettra de nous faire part de la confiance pour améliorer, refactoriser et affiner notre application régulièrement.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-280">This will help provide us the confidence to continually improve, refactor, and refine our application.</span></span>

<span data-ttu-id="8ed2e-281">Nous avons abordé de test en tant que la dernière rubrique de ce chapitre – mais pas parce que le test est un élément à la fin d’un processus de développement !</span><span class="sxs-lookup"><span data-stu-id="8ed2e-281">We covered testing as the last topic in this chapter – but not because testing is something you should do at the end of a development process!</span></span> <span data-ttu-id="8ed2e-282">Au contraire, vous devez écrire des tests automatisés dès que possible dans votre processus de développement.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-282">On the contrary, you should write automated tests as early as possible in your development process.</span></span> <span data-ttu-id="8ed2e-283">Cette opération permet donc immédiatement obtenir des commentaires lorsque vous développez, vous permet de considérer réfléchie sur les scénarios d’utilisation de votre application et vous guide pour concevoir votre application avec propre superposition et n’oubliez pas de couplage.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-283">Doing so enables you to get immediate feedback as you develop, helps you think thoughtfully about your application's use case scenarios, and guides you to design your application with clean layering and coupling in mind.</span></span>

<span data-ttu-id="8ed2e-284">Traite un chapitre ultérieur dans le carnet de développement piloté par des tests (TDD) et comment l’utiliser avec ASP.NET MVC.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-284">A later chapter in the book will discuss Test Driven Development (TDD), and how to use it with ASP.NET MVC.</span></span> <span data-ttu-id="8ed2e-285">TDD est une pratique de codage itérative dans lequel vous écrivez d’abord les tests répondant à votre code qui en résulte.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-285">TDD is an iterative coding practice where you first write the tests that your resulting code will satisfy.</span></span> <span data-ttu-id="8ed2e-286">Avec TDD commencer chaque fonctionnalité en créant un test qui vérifie que la fonctionnalité que vous allez implémenter.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-286">With TDD you begin each feature by creating a test that verifies the functionality you are about to implement.</span></span> <span data-ttu-id="8ed2e-287">L’écriture de l’unité de test permet tout d’abord vous assurer que vous comprenez clairement la fonctionnalité et comment il est censé pour fonctionner.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-287">Writing the unit test first helps ensure that you clearly understand the feature and how it is supposed to work.</span></span> <span data-ttu-id="8ed2e-288">Une fois que le test est écrit (et que vous avez vérifié qu’il échoue) ne vous puis implémenter les fonctionnalités réelle, que le test vérifie.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-288">Only after the test is written (and you have verified that it fails) do you then implement the actual functionality the test verifies.</span></span> <span data-ttu-id="8ed2e-289">Étant donné que vous avez déjà passé de temps à réfléchir sur le cas d’utilisation de la façon dont la fonction est supposée fonctionne, vous aurez une meilleure compréhension de la configuration requise et la meilleure façon de les implémenter.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-289">Because you've already spent time thinking about the use case of how the feature is supposed to work, you will have a better understanding of the requirements and how best to implement them.</span></span> <span data-ttu-id="8ed2e-290">Lorsque vous avez terminé avec l’implémentation, vous pouvez réexécuter le test – et immédiatement obtenir des commentaires en tant que si la fonctionnalité fonctionne correctement.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-290">When you are done with the implementation you can re-run the test – and get immediate feedback as to whether the feature works correctly.</span></span> <span data-ttu-id="8ed2e-291">Nous aborderons TDD plus dans le chapitre 10.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-291">We'll cover TDD more in Chapter 10.</span></span>

### <a name="next-step"></a><span data-ttu-id="8ed2e-292">Étape suivante</span><span class="sxs-lookup"><span data-stu-id="8ed2e-292">Next Step</span></span>

<span data-ttu-id="8ed2e-293">Certains wrap finale des commentaires.</span><span class="sxs-lookup"><span data-stu-id="8ed2e-293">Some final wrap up comments.</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="8ed2e-294">[Précédent](use-ajax-to-implement-mapping-scenarios.md)
> [Suivant](nerddinner-wrap-up.md)</span><span class="sxs-lookup"><span data-stu-id="8ed2e-294">[Previous](use-ajax-to-implement-mapping-scenarios.md)
[Next](nerddinner-wrap-up.md)</span></span>
