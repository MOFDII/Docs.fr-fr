---
uid: mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
title: Code First Migrations et déploiement avec Entity Framework dans une Application ASP.NET MVC | Documents Microsoft
author: tdykstra
description: L’exemple d’application web Contoso University montre comment créer des applications ASP.NET MVC 5 à l’aide de l’Entity Framework 6 Code First et Visual Studio en cours...
ms.author: aspnetcontent
manager: wpickett
ms.date: 11/07/2014
ms.topic: article
ms.assetid: d4dfc435-bda6-4621-9762-9ba270f8de4e
ms.technology: dotnet-mvc
ms.prod: .net-framework
msc.legacyurl: /mvc/overview/getting-started/getting-started-with-ef-using-mvc/migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application
msc.type: authoredcontent
ms.openlocfilehash: 04d393edca0469df140f06a7d083a48aa8f84b65
ms.sourcegitcommit: f8852267f463b62d7f975e56bea9aa3f68fbbdeb
ms.translationtype: MT
ms.contentlocale: fr-FR
ms.lasthandoff: 04/06/2018
---
<a name="code-first-migrations-and-deployment-with-the-entity-framework-in-an-aspnet-mvc-application"></a><span data-ttu-id="6eaa8-103">Code First Migrations et déploiement avec Entity Framework dans une Application ASP.NET MVC</span><span class="sxs-lookup"><span data-stu-id="6eaa8-103">Code First Migrations and Deployment with the Entity Framework in an ASP.NET MVC Application</span></span>
====================
<span data-ttu-id="6eaa8-104">par [Tom Dykstra](https://github.com/tdykstra)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-104">by [Tom Dykstra](https://github.com/tdykstra)</span></span>

<span data-ttu-id="6eaa8-105">[Télécharger le projet terminé](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) ou [télécharger le PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-105">[Download Completed Project](http://code.msdn.microsoft.com/ASPNET-MVC-Application-b01a9fe8) or [Download PDF](http://download.microsoft.com/download/0/F/B/0FBFAA46-2BFD-478F-8E56-7BF3C672DF9D/Getting%20Started%20with%20Entity%20Framework%206%20Code%20First%20using%20MVC%205.pdf)</span></span>

> <span data-ttu-id="6eaa8-106">L’exemple d’application web Contoso University montre comment créer des applications ASP.NET MVC 5 à l’aide de l’Entity Framework 6 Code First et Visual Studio 2013.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-106">The Contoso University sample web application demonstrates how to create ASP.NET MVC 5 applications using the Entity Framework 6 Code First and Visual Studio 2013.</span></span> <span data-ttu-id="6eaa8-107">Pour obtenir des informations sur la série de didacticiels, consultez [le premier didacticiel de la série](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-107">For information about the tutorial series, see [the first tutorial in the series](creating-an-entity-framework-data-model-for-an-asp-net-mvc-application.md).</span></span>

<span data-ttu-id="6eaa8-108">Jusqu'à présent l’application a été exécuté localement dans IIS Express sur votre ordinateur de développement.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-108">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="6eaa8-109">Pour rendre une application réelle disponible pour d’autres personnes à utiliser sur Internet, vous devez déployer vers un fournisseur d’hébergement web.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-109">To make a real application available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="6eaa8-110">Dans ce didacticiel, vous allez déployer l’application Contoso University au cloud dans Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-110">In this tutorial, you'll deploy the Contoso University application to the cloud in Azure.</span></span>

<span data-ttu-id="6eaa8-111">Ce didacticiel contient les sections suivantes :</span><span class="sxs-lookup"><span data-stu-id="6eaa8-111">The tutorial contains the following sections:</span></span>

- <span data-ttu-id="6eaa8-112">Activer les Migrations Code First.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-112">Enable Code First Migrations.</span></span> <span data-ttu-id="6eaa8-113">La fonctionnalité de migration vous permet de modifier le modèle de données et de déployer vos modifications en production en mettant à jour le schéma de base de données sans devoir supprimer et recréer la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-113">The Migrations feature enables you to change the data model and deploy your changes to production by updating the database schema without having to drop and re-create the database.</span></span>
- <span data-ttu-id="6eaa8-114">Déployer sur Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-114">Deploy to Azure.</span></span> <span data-ttu-id="6eaa8-115">Cette étape est facultative. Vous pouvez continuer avec les autres didacticiels sans avoir déployé le projet.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-115">This step is optional; you can continue with the remaining tutorials without having deployed the project.</span></span>

<span data-ttu-id="6eaa8-116">Nous vous recommandons d’utiliser un processus d’intégration continue avec contrôle de code source pour le déploiement, mais ce didacticiel ne couvre pas ces rubriques.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-116">We recommend that you use a continuous integration process with source control for deployment, but this tutorial does not cover those topics.</span></span> <span data-ttu-id="6eaa8-117">Pour plus d’informations, consultez la [contrôle de code source](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) et [intégration continue](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapitres de la [génération d’applications Cloud réel avec Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction) livres.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-117">For more information, see the [source control](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/source-control) and [continuous integration](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/continuous-integration-and-continuous-delivery) chapters of the [Building Real-World Cloud Apps with Azure](xref:aspnet/overview/developing-apps-with-windows-azure/building-real-world-cloud-apps-with-windows-azure/introduction) e-book.</span></span>

## <a name="enable-code-first-migrations"></a><span data-ttu-id="6eaa8-118">Activer les Migrations Code First</span><span class="sxs-lookup"><span data-stu-id="6eaa8-118">Enable Code First Migrations</span></span>

<span data-ttu-id="6eaa8-119">Quand vous développez une nouvelle application, votre modèle de données change fréquemment et, chaque fois que le modèle change, il n’est plus en synchronisation avec la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-119">When you develop a new application, your data model changes frequently, and each time the model changes, it gets out of sync with the database.</span></span> <span data-ttu-id="6eaa8-120">Vous avez configuré pour automatiquement supprimer et recréer la base de données chaque fois que vous modifiez le modèle de données Entity Framework.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-120">You have configured the Entity Framework to automatically drop and re-create the database each time you change the data model.</span></span> <span data-ttu-id="6eaa8-121">Lorsque vous ajouter, supprimer ou modifier des classes d’entité ou modifier votre `DbContext` classe, la prochaine fois que vous exécutez l’application elle supprime de votre base de données existante, crée un nouveau qui correspond au modèle et l’alimente avec les données de test d’automatiquement.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-121">When you add, remove, or change entity classes or change your `DbContext` class, the next time you run the application it automatically deletes your existing database, creates a new one that matches the model, and seeds it with test data.</span></span>

<span data-ttu-id="6eaa8-122">Cette méthode pour conserver la base de données en synchronisation avec le modèle de données fonctionne bien jusqu’au déploiement de l’application en production.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-122">This method of keeping the database in sync with the data model works well until you deploy the application to production.</span></span> <span data-ttu-id="6eaa8-123">Lorsque l’application est en cours d’exécution en production, il stocke généralement les données que vous souhaitez conserver, et vous ne voulez pas perdre tous les éléments chaque fois que vous apportez des modifications telles que l’ajout d’une nouvelle colonne.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-123">When the application is running in production, it is usually storing data that you want to keep, and you don't want to lose everything each time you make a change such as adding a new column.</span></span> <span data-ttu-id="6eaa8-124">Le [Migrations Code First](https://msdn.microsoft.com/data/jj591621) fonctionnalité résout ce problème en activant Code First mettre à jour le schéma de base de données au lieu de devoir supprimer et recréer la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-124">The [Code First Migrations](https://msdn.microsoft.com/data/jj591621) feature solves this problem by enabling Code First to update the database schema instead of dropping and re-creating the database.</span></span> <span data-ttu-id="6eaa8-125">Dans ce didacticiel, vous allez déployer l’application, et pour préparer pour que vous allez activer les Migrations.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-125">In this tutorial, you'll deploy the application, and to prepare for that you'll enable Migrations.</span></span>

1. <span data-ttu-id="6eaa8-126">Désactiver l’initialiseur que vous avez configurée précédemment en supprimant ou en supprimant le `contexts` élément que vous avez ajouté au fichier Web.config de l’application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-126">Disable the initializer that you set up earlier by commenting out or deleting the `contexts` element that you added to the application Web.config file.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample1.xml?highlight=2,6)]
2. <span data-ttu-id="6eaa8-127">Également dans l’application *Web.config* , modifiez le nom de la base de données dans la chaîne de connexion à ContosoUniversity2.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-127">Also in the application *Web.config* file, change the name of the database in the connection string to ContosoUniversity2.</span></span>

    [!code-xml[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample2.xml?highlight=2)]

    <span data-ttu-id="6eaa8-128">Cette modification configure le projet de façon à ce que la première migration crée une nouvelle base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-128">This change sets up the project so that the first migration will create a new database.</span></span> <span data-ttu-id="6eaa8-129">Cela n’est pas nécessaire, mais vous le verrez plus tard pourquoi il est judicieux.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-129">This isn't required but you'll see later why it's a good idea.</span></span>
3. <span data-ttu-id="6eaa8-130">À partir de la **outils** menu, cliquez sur **Gestionnaire de Package de bibliothèque** , puis **Package Manager Console**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-130">From the **Tools** menu, click **Library Package Manager** and then **Package Manager Console**.</span></span>

    ![Selecting_Package_Manager_Console](https://asp.net/media/4336350/1pm.png)
4. <span data-ttu-id="6eaa8-132">À la `PM>` invite Entrez les commandes suivantes :</span><span class="sxs-lookup"><span data-stu-id="6eaa8-132">At the `PM>` prompt enter the following commands:</span></span>

    `enable-migrations`  
    `add-migration InitialCreate`

    ![commande Enable-migrations](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image1.png)

    <span data-ttu-id="6eaa8-134">Le `enable-migrations` commande crée un *Migrations* dossier dans le projet ContosoUniversity et il place dans ce dossier un *Configuration.cs* fichier que vous pouvez modifier pour configurer des Migrations.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-134">The `enable-migrations` command creates a *Migrations* folder in the ContosoUniversity project, and it puts in that folder a *Configuration.cs* file that you can edit to configure Migrations.</span></span>

    <span data-ttu-id="6eaa8-135">(À l’issue de l’étape précédente qui dirige vous permet de modifier le nom de la base de données, les Migrations seront rechercher la base de données existante et faire automatiquement la `add-migration` commande.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-135">(If you missed the step above that directs you to change the database name, Migrations will find the existing database and automatically do the `add-migration` command.</span></span> <span data-ttu-id="6eaa8-136">OK, cela signifie simplement que ne sera pas exécuter un test du code migrations avant de déployer la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-136">That's OK, it just means you won't run a test of the migrations code before you deploy the database.</span></span> <span data-ttu-id="6eaa8-137">Ultérieures lorsque vous exécutez le `update-database` commande rien ne se produira, car la base de données existe déjà.)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-137">Later when you run the `update-database` command nothing will happen because the database will already exist.)</span></span>

    ![Dossier migrations](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image2.png)

    <span data-ttu-id="6eaa8-139">Comme la classe de l’initialiseur que vous avez vu précédemment, le `Configuration` classe inclut un `Seed` (méthode).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-139">Like the initializer class that you saw earlier, the `Configuration` class includes a `Seed` method.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample3.cs)]

    <span data-ttu-id="6eaa8-140">L’objectif de la [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) méthode consiste à vous permettent d’insérer ou mettre à jour des données de test après le premier Code crée ou met à jour la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-140">The purpose of the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is to enable you to insert or update test data after Code First creates or updates the database.</span></span> <span data-ttu-id="6eaa8-141">La méthode est appelée lorsque la base de données est créé et chaque fois que le schéma de base de données est mise à jour après la modification d’un modèle de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-141">The method is called when the database is created and every time the database schema is updated after a data model change.</span></span>

### <a name="set-up-the-seed-method"></a><span data-ttu-id="6eaa8-142">Définir la méthode de valeur initiale</span><span class="sxs-lookup"><span data-stu-id="6eaa8-142">Set up the Seed Method</span></span>

<span data-ttu-id="6eaa8-143">Lorsque vous supprimez et recréer la base de données pour chaque modification de modèle de données, vous utilisez la classe de l’initialiseur `Seed` méthode pour insérer des données de test, car après chaque modification de modèle, la base de données est supprimée et toutes les données de test sont perdus.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-143">When you are dropping and re-creating the database for every data model change, you use the initializer class's `Seed` method to insert test data, because after every model change the database is dropped and all the test data is lost.</span></span> <span data-ttu-id="6eaa8-144">Avec Migrations Code First, test, les données sont conservées après des modifications de la base de données, par conséquent, y compris les données de test dans le [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) méthode n’est généralement pas nécessaire.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-144">With Code First Migrations, test data is retained after database changes, so including test data in the [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method is typically not necessary.</span></span> <span data-ttu-id="6eaa8-145">En fait, vous ne souhaitez pas que le `Seed` méthode pour insérer des données de test si vous allez utiliser les Migrations à déployer la base de données en production, car le `Seed` méthode s’exécute en production.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-145">In fact, you don't want the `Seed` method to insert test data if you'll be using Migrations to deploy the database to production, because the `Seed` method will run in production.</span></span> <span data-ttu-id="6eaa8-146">Dans ce cas, vous souhaitez le `Seed` méthode pour insérer dans la base de données uniquement les données dont vous avez besoin en production.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-146">In that case you want the `Seed` method to insert into the database only the data that you need in production.</span></span> <span data-ttu-id="6eaa8-147">Par exemple, vous souhaitez la base de données pour inclure les noms de service réel dans le `Department` lorsque l’application est disponible en production de la table.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-147">For example, you might want the database to include actual department names in the `Department` table when the application becomes available in production.</span></span>

<span data-ttu-id="6eaa8-148">Pour ce didacticiel, vous allez utiliser les Migrations pour le déploiement, mais votre `Seed` méthode insère des données de test tout de même pour le rendre plus facile de déterminer le fonctionne de la fonctionnalité de l’application sans avoir à insérer manuellement une grande quantité de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-148">For this tutorial, you'll be using Migrations for deployment, but your `Seed` method will insert test data anyway in order to make it easier to see how application functionality works without having to manually insert a lot of data.</span></span>

1. <span data-ttu-id="6eaa8-149">Remplacez le contenu de la *Configuration.cs* fichier avec le code suivant, qui charge des données de test dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-149">Replace the contents of the *Configuration.cs* file with the following code, which will load test data into the new database.</span></span> 

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample4.cs)]

    <span data-ttu-id="6eaa8-150">Le [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) méthode prend l’objet de contexte de base de données en tant que paramètre d’entrée, et le code dans la méthode utilise cet objet pour ajouter de nouvelles entités à la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-150">The [Seed](https://msdn.microsoft.com/library/hh829453(v=vs.103).aspx) method takes the database context object as an input parameter, and the code in the method uses that object to add new entities to the database.</span></span> <span data-ttu-id="6eaa8-151">Pour chaque type d’entité, le code crée une collection de nouvelles entités, les ajoute à la liste appropriée [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) propriété, puis enregistre les modifications apportées à la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-151">For each entity type, the code creates a collection of new entities, adds them to the appropriate [DbSet](https://msdn.microsoft.com/library/system.data.entity.dbset(v=vs.103).aspx) property, and then saves the changes to the database.</span></span> <span data-ttu-id="6eaa8-152">Il n’est pas nécessaire d’appeler le [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) méthode après chaque groupe d’entités, comme le fait ici, mais cela vous permet de localiser la source d’un problème si une exception se produit pendant que le code écrit dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-152">It isn't necessary to call the [SaveChanges](https://msdn.microsoft.com/library/system.data.entity.dbcontext.savechanges(v=VS.103).aspx) method after each group of entities, as is done here, but doing that helps you locate the source of a problem if an exception occurs while the code is writing to the database.</span></span>

    <span data-ttu-id="6eaa8-153">Certains des instructions qui insèrent des données utilisent le [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) méthode pour effectuer une opération « upsert ».</span><span class="sxs-lookup"><span data-stu-id="6eaa8-153">Some of the statements that insert data use the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method to perform an "upsert" operation.</span></span> <span data-ttu-id="6eaa8-154">Étant donné que la `Seed` méthode s’exécute chaque fois que vous exécutez le `update-database` de commande, généralement après chaque migration, vous ne peut pas simplement insérer des données, car les lignes que vous essayez d’ajouter sera déjà présente après la migration initiale qui crée la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-154">Because the `Seed` method runs every time you execute the `update-database` command, typically after each migration, you can't just insert data, because the rows you are trying to add will already be there after the first migration that creates the database.</span></span> <span data-ttu-id="6eaa8-155">L’opération « upsert » empêche toute erreur qui se passerait si vous essayez d’insérer une ligne qui existe déjà, mais il ***substitue*** les modifications apportées aux données que vous avez apportées lors du test de l’application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-155">The "upsert" operation prevents errors that would happen if you try to insert a row that already exists, but it ***overrides*** any changes to data that you may have made while testing the application.</span></span> <span data-ttu-id="6eaa8-156">Avec des données de test dans certaines tables vous pouvez qui doit se produire : dans certains cas lorsque vous modifiez des données pendant le test vous souhaitez que vos modifications restant après les mises à jour de la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-156">With test data in some tables you might not want that to happen: in some cases when you change data while testing you want your changes to remain after database updates.</span></span> <span data-ttu-id="6eaa8-157">Dans ce cas, vous souhaitez effectuer une opération d’insertion conditionnel : insérer une ligne uniquement si elle n’existe pas déjà.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-157">In that case you want to do a conditional insert operation: insert a row only if it doesn't already exist.</span></span> <span data-ttu-id="6eaa8-158">La méthode de valeur initiale utilise les deux approches.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-158">The Seed method uses both approaches.</span></span>

    <span data-ttu-id="6eaa8-159">Le premier paramètre passé à la [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) méthode spécifie la propriété à utiliser pour vérifier si une ligne existe déjà.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-159">The first parameter passed to the [AddOrUpdate](https://msdn.microsoft.com/library/system.data.entity.migrations.idbsetextensions.addorupdate(v=vs.103).aspx) method specifies the property to use to check if a row already exists.</span></span> <span data-ttu-id="6eaa8-160">Pour les données de student de test que vous fournissez, le `LastName` propriété peut être utilisée à cet effet dans la mesure où chaque nom dans la liste est unique :</span><span class="sxs-lookup"><span data-stu-id="6eaa8-160">For the test student data that you are providing, the `LastName` property can be used for this purpose since each last name in the list is unique:</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample5.cs)]

    <span data-ttu-id="6eaa8-161">Ce code suppose que les noms sont uniques.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-161">This code assumes that last names are unique.</span></span> <span data-ttu-id="6eaa8-162">Si vous ajoutez manuellement un étudiant avec un nom en double, vous obtenez l’exception suivante, la prochaine fois que vous effectuez une migration.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-162">If you manually add a student with a duplicate last name, you'll get the following exception the next time you perform a migration.</span></span>

    <span data-ttu-id="6eaa8-163">La séquence contient plusieurs éléments</span><span class="sxs-lookup"><span data-stu-id="6eaa8-163">Sequence contains more than one element</span></span>

    <span data-ttu-id="6eaa8-164">Pour plus d’informations sur la gestion des données redondantes, telles que deux stagiaires nommés « Alexander Carson », consultez [Seeding et les bases de données Entity Framework (EF) débogage](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) sur le blog de Rick Anderson.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-164">For information about how to handle redundant data such as two students named "Alexander Carson", see [Seeding and Debugging Entity Framework (EF) DBs](https://blogs.msdn.com/b/rickandy/archive/2013/02/12/seeding-and-debugging-entity-framework-ef-dbs.aspx) on Rick Anderson's blog.</span></span> <span data-ttu-id="6eaa8-165">Pour plus d’informations sur la `AddOrUpdate` méthode, consultez [soyez prudent avec EF 4.3 AddOrUpdate méthode](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) sur le blog de Julie Lerman.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-165">For more information about the `AddOrUpdate` method, see [Take care with EF 4.3 AddOrUpdate Method](http://thedatafarm.com/blog/data-access/take-care-with-ef-4-3-addorupdate-method/) on Julie Lerman's blog.</span></span>

    <span data-ttu-id="6eaa8-166">Le code qui crée `Enrollment` entités suppose que le `ID` valeur dans les entités dans le `students` collection, bien que vous n’avez pas définir cette propriété dans le code qui crée la collection.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-166">The code that creates `Enrollment` entities assumes you have the `ID` value in the entities in the `students` collection, although you didn't set that property in the code that creates the collection.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample6.cs?highlight=2)]

    <span data-ttu-id="6eaa8-167">Vous pouvez utiliser la `ID` propriété ici, car le `ID` valeur est définie lorsque vous appelez `SaveChanges` pour la `students` collection.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-167">You can use the `ID` property here because the `ID` value is set when you call `SaveChanges` for the `students` collection.</span></span> <span data-ttu-id="6eaa8-168">EF obtient automatiquement la valeur de clé primaire lorsqu’il insère une entité dans la base de données, et il met à jour le `ID` propriété de l’entité dans la mémoire.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-168">EF automatically gets the primary key value when it inserts an entity into the database, and it updates the `ID` property of the entity in memory.</span></span>

    <span data-ttu-id="6eaa8-169">Le code qui ajoute chaque `Enrollment` entité à la `Enrollments` jeu d’entités n’utilise pas le `AddOrUpdate` (méthode).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-169">The code that adds each `Enrollment` entity to the `Enrollments` entity set doesn't use the `AddOrUpdate` method.</span></span> <span data-ttu-id="6eaa8-170">Il vérifie si une entité existe déjà et qu’il insère l’entité si elle n’existe pas.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-170">It checks if an entity already exists and inserts the entity if it doesn't exist.</span></span> <span data-ttu-id="6eaa8-171">Cette approche conserve les modifications que vous apportez à un niveau d’inscription à l’aide de l’interface utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-171">This approach will preserve changes you make to an enrollment grade by using the application UI.</span></span> <span data-ttu-id="6eaa8-172">Le code effectue une itération sur chaque membre de la `Enrollment` [liste](https://msdn.microsoft.com/library/6sh2ey19.aspx) et si l’inscription est introuvable dans la base de données, il ajoute l’inscription à la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-172">The code loops through each member of the `Enrollment`[List](https://msdn.microsoft.com/library/6sh2ey19.aspx) and if the enrollment is not found in the database, it adds the enrollment to the database.</span></span> <span data-ttu-id="6eaa8-173">La première fois que vous mettez à jour la base de données, la base de données sera vide, donc il ajoute chaque inscription.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-173">The first time you update the database, the database will be empty, so it will add each enrollment.</span></span>

    [!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample7.cs)]
2. <span data-ttu-id="6eaa8-174">Générez le projet.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-174">Build the project.</span></span>

### <a name="execute-the-first-migration"></a><span data-ttu-id="6eaa8-175">Exécution de la Migration en premier</span><span class="sxs-lookup"><span data-stu-id="6eaa8-175">Execute the First Migration</span></span>

<span data-ttu-id="6eaa8-176">Lorsque vous avez exécuté le `add-migration` Migrations généré le code susceptibles de créer la base de données à partir de zéro de la commande.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-176">When you executed the `add-migration` command, Migrations generated the code that would create the database from scratch.</span></span> <span data-ttu-id="6eaa8-177">Ce code est également dans le *Migrations* dossier, dans le fichier nommé  *&lt;timestamp&gt;\_InitialCreate.cs*.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-177">This code is also in the *Migrations* folder, in the file named *&lt;timestamp&gt;\_InitialCreate.cs*.</span></span> <span data-ttu-id="6eaa8-178">Le `Up` méthode de la `InitialCreate` classe crée les tables de base de données qui correspondent aux jeux d’entités de modèle de données, et le `Down` méthode les supprime.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-178">The `Up` method of the `InitialCreate` class creates the database tables that correspond to the data model entity sets, and the `Down` method deletes them.</span></span>

[!code-csharp[Main](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/samples/sample8.cs)]

<span data-ttu-id="6eaa8-179">Les migrations appellent la méthode `Up` pour implémenter les modifications de modèle de données pour une migration.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-179">Migrations calls the `Up` method to implement the data model changes for a migration.</span></span> <span data-ttu-id="6eaa8-180">Quand vous entrez une commande pour annuler la mise à jour, Migrations appelle la méthode `Down`.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-180">When you enter a command to roll back the update, Migrations calls the `Down` method.</span></span>

<span data-ttu-id="6eaa8-181">Il s’agit de la migration initiale qui a été créée lorsque vous avez entré la `add-migration InitialCreate` commande.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-181">This is the initial migration that was created when you entered the `add-migration InitialCreate` command.</span></span> <span data-ttu-id="6eaa8-182">Le paramètre (`InitialCreate` dans l’exemple) est utilisé pour le fichier de nommer et peut être tout ce que vous voulez ; vous choisissez généralement un mot ou une expression qui résume ce qui est effectué dans la migration.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-182">The parameter (`InitialCreate` in the example) is used for the file name and can be whatever you want; you typically choose a word or phrase that summarizes what is being done in the migration.</span></span> <span data-ttu-id="6eaa8-183">Par exemple, vous pouvez nommer une migration ultérieure &quot;AddDepartmentTable&quot;.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-183">For example, you might name a later migration &quot;AddDepartmentTable&quot;.</span></span>

<span data-ttu-id="6eaa8-184">Si vous avez créé la migration initiale alors que la base de données existait déjà, le code de création de la base de données est généré, mais il n’est pas nécessaire de l’exécuter, car la base de données correspond déjà au modèle de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-184">If you created the initial migration when the database already exists, the database creation code is generated but it doesn't have to run because the database already matches the data model.</span></span> <span data-ttu-id="6eaa8-185">Quand vous déployez l’application sur un autre environnement où la base de données n’existe pas encore, ce code est exécuté pour créer votre base de données : il est donc judicieux de le tester au préalable.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-185">When you deploy the app to another environment where the database doesn't exist yet, this code will run to create your database, so it's a good idea to test it first.</span></span> <span data-ttu-id="6eaa8-186">C’est la raison pour laquelle vous avez précédemment changé le nom de la base de données dans la chaîne de connexion : les migrations doivent pouvoir créer une base de données à partir de zéro.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-186">That's why you changed the name of the database in the connection string earlier -- so that migrations can create a new one from scratch.</span></span>

1. <span data-ttu-id="6eaa8-187">Dans le **Package Manager Console** fenêtre, entrez la commande suivante :</span><span class="sxs-lookup"><span data-stu-id="6eaa8-187">In the **Package Manager Console** window, enter the following command:</span></span>

    `update-database`

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image3.png)

    <span data-ttu-id="6eaa8-188">Le `update-database` commande s’exécute le `Up` méthode pour créer la base de données, puis il exécute la `Seed` méthode pour remplir la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-188">The `update-database` command runs the `Up` method to create the database and then it runs the `Seed` method to populate the database.</span></span> <span data-ttu-id="6eaa8-189">Le même processus s’exécutera automatiquement en production après avoir déployé l’application, comme vous le verrez dans la section suivante.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-189">The same process will run automatically in production after you deploy the application, as you'll see in the following section.</span></span>
2. <span data-ttu-id="6eaa8-190">Utilisez **l’Explorateur de serveurs** pour inspecter la base de données comme vous le faisiez dans le premier didacticiel, exécutez l’application pour vérifier que tout fonctionne toujours le même qu’avant.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-190">Use **Server Explorer** to inspect the database as you did in the first tutorial, and run the application to verify that everything still works the same as before.</span></span>

## <a name="deploy-to-azure"></a><span data-ttu-id="6eaa8-191">Déployer vers Azure</span><span class="sxs-lookup"><span data-stu-id="6eaa8-191">Deploy to Azure</span></span>

<span data-ttu-id="6eaa8-192">Jusqu'à présent l’application a été exécuté localement dans IIS Express sur votre ordinateur de développement.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-192">So far the application has been running locally in IIS Express on your development computer.</span></span> <span data-ttu-id="6eaa8-193">Pour le rendre disponible pour d’autres personnes à utiliser sur Internet, vous devez déployer vers un fournisseur d’hébergement web.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-193">To make it available for other people to use over the Internet, you have to deploy it to a web hosting provider.</span></span> <span data-ttu-id="6eaa8-194">Dans cette section du didacticiel, vous allez le déployer vers Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-194">In this section of the tutorial you'll deploy it to Azure.</span></span> <span data-ttu-id="6eaa8-195">Cette section est facultative. Vous pouvez ignorer cette étape et continuer le didacticiel suivant, ou vous pouvez adapter les instructions de cette section pour un autre fournisseur d’hébergement de votre choix.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-195">This section is optional; you can skip this and continue with the following tutorial, or you can adapt the instructions in this section for a different hosting provider of your choice.</span></span>

### <a name="using-code-first-migrations-to-deploy-the-database"></a><span data-ttu-id="6eaa8-196">À l’aide de Migrations Code First pour déployer la base de données</span><span class="sxs-lookup"><span data-stu-id="6eaa8-196">Using Code First Migrations to Deploy the Database</span></span>

<span data-ttu-id="6eaa8-197">Pour déployer la base de données, vous utiliserez des Migrations Code First.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-197">To deploy the database you'll use Code First Migrations.</span></span> <span data-ttu-id="6eaa8-198">Lorsque vous créez le profil de publication que vous utilisez pour configurer les paramètres de déploiement à partir de Visual Studio, vous devez sélectionner une case à cocher intitulée **mise à jour de la base de données**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-198">When you create the publish profile that you use to configure settings for deploying from Visual Studio, you'll select a check box labeled **Update Database**.</span></span> <span data-ttu-id="6eaa8-199">Ce paramètre oblige le processus de déploiement configurer automatiquement l’application *Web.config* des fichiers sur le serveur de destination afin qu’utilise le premier Code la `MigrateDatabaseToLatestVersion` classe de l’initialiseur.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-199">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>

<span data-ttu-id="6eaa8-200">Visual Studio ne fait rien avec la base de données pendant le processus de déploiement pendant qu’il copie de votre projet sur le serveur de destination.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-200">Visual Studio doesn't do anything with the database during the deployment process while it is copying your project to the destination server.</span></span> <span data-ttu-id="6eaa8-201">Lorsque vous exécutez l’application déployée, et il accède à la base de données pour la première fois après le déploiement, le premier Code vérifie de si la base de données correspond au modèle de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-201">When you run the deployed application and it accesses the database for the first time after deployment, Code First checks if the database matches the data model.</span></span> <span data-ttu-id="6eaa8-202">S’il existe une incompatibilité, Code First crée automatiquement la base de données (s’il n’existe pas encore) ou met à jour le schéma de base de données vers la dernière version (si une base de données existe mais ne correspond pas au modèle).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-202">If there's a mismatch, Code First automatically creates the database (if it doesn't exist yet) or updates the database schema to the latest version (if a database exists but doesn't match the model).</span></span> <span data-ttu-id="6eaa8-203">Si l’application implémente une Migrations `Seed` méthode, l’exécution de la méthode après la création de la base de données ou le schéma est mis à jour.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-203">If the application implements a Migrations `Seed` method, the method runs after the database is created or the schema is updated.</span></span>

<span data-ttu-id="6eaa8-204">Vos Migrations `Seed` méthode insère les données de test.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-204">Your Migrations `Seed` method inserts test data.</span></span> <span data-ttu-id="6eaa8-205">Si vous déployez dans un environnement de production, vous devrez modifier le `Seed` méthode afin qu’il insère uniquement les données que vous souhaitez insérer dans votre base de données de production.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-205">If you were deploying to a production environment, you would have to change the `Seed` method so that it only inserts data that you want to be inserted into your production database.</span></span> <span data-ttu-id="6eaa8-206">Par exemple, dans votre modèle de données en cours, vous souhaiterez ont cours réels, mais les étudiants fictifs dans la base de données de développement.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-206">For example, in your current data model you might want to have real courses but fictional students in the development database.</span></span> <span data-ttu-id="6eaa8-207">Vous pouvez écrire un `Seed` méthode charger à la fois dans le développement, puis commentez les étudiants fictifs avant de déployer en production.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-207">You can write a `Seed` method to load both in development, and then comment out the fictional students before you deploy to production.</span></span> <span data-ttu-id="6eaa8-208">Ou vous pouvez écrire un `Seed` méthode pour charger uniquement des cours et entrer manuellement des étudiants fictifs dans la base de données de test à l’aide de l’interface utilisateur de l’application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-208">Or you can write a `Seed` method to load only courses, and enter the fictional students in the test database manually by using the application's UI.</span></span>

### <a name="get-an-azure-account"></a><span data-ttu-id="6eaa8-209">Obtenir un compte Azure</span><span class="sxs-lookup"><span data-stu-id="6eaa8-209">Get an Azure account</span></span>

<span data-ttu-id="6eaa8-210">Vous devez avoir un compte Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-210">You'll need an Azure account.</span></span> <span data-ttu-id="6eaa8-211">Si vous n’en avez pas encore, mais vous disposez d’un abonnement Visual Studio, vous pouvez [activer votre abonnement](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-211">If you don't already have one, but you do have a Visual Studio subscription, you can [activate your subscription benefits](https://azure.microsoft.com/pricing/member-offers/msdn-benefits-details/).</span></span> <span data-ttu-id="6eaa8-212">Sinon, vous pouvez créer un compte d’évaluation gratuit en quelques minutes.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-212">Otherwise, you can create a free trial account in just a couple of minutes.</span></span> <span data-ttu-id="6eaa8-213">Pour plus d’informations, consultez [d’évaluation gratuite Azure](https://azure.microsoft.com/free/).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-213">For details, see [Azure Free Trial](https://azure.microsoft.com/free/).</span></span>

### <a name="create-a-web-site-and-a-sql-database-in-azure"></a><span data-ttu-id="6eaa8-214">Créer un site web et une base de données SQL dans Azure</span><span class="sxs-lookup"><span data-stu-id="6eaa8-214">Create a web site and a SQL database in Azure</span></span>

<span data-ttu-id="6eaa8-215">Votre application web dans Azure s’exécute dans un environnement d’hébergement partagé, ce qui signifie qu’il s’exécute sur des machines virtuelles (VM) qui sont partagés avec d’autres clients Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-215">Your web app in Azure will run in a shared hosting environment, which means it runs on virtual machines (VMs) that are shared with other Azure clients.</span></span> <span data-ttu-id="6eaa8-216">Un environnement d’hébergement partagé est un moyen économique pour commencer dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-216">A shared hosting environment is a low-cost way to get started in the cloud.</span></span> <span data-ttu-id="6eaa8-217">Ultérieurement, si le trafic web augmente, l’application peut évoluer pour répondre aux besoins en exécutant sur des machines virtuelles dédiées.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-217">Later, if your web traffic increases, the application can scale to meet the need by running on dedicated VMs.</span></span> <span data-ttu-id="6eaa8-218">Pour en savoir plus sur les Options de tarification pour Azure App Service, consultez la documentation sur [Docs de Azure](https://azure.microsoft.com/pricing/details/app-service/)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-218">To learn more about Pricing Options for Azure App Service, read the documentation on [Azure Docs](https://azure.microsoft.com/pricing/details/app-service/)</span></span>

<span data-ttu-id="6eaa8-219">Vous allez déployer la base de données à la base de données SQL Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-219">You'll deploy the database to Azure SQL Database.</span></span> <span data-ttu-id="6eaa8-220">Base de données SQL est un service de base de données relationnelle informatique qui repose sur les technologies SQL Server.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-220">SQL Database is a cloud-based relational database service that is built on SQL Server technologies.</span></span> <span data-ttu-id="6eaa8-221">Outils et applications qui fonctionnent avec SQL Server fonctionnent également avec la base de données SQL.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-221">Tools and applications that work with SQL Server also work with SQL Database.</span></span>

1. <span data-ttu-id="6eaa8-222">Dans le [portail de gestion Azure](https://portal.azure.com), cliquez sur **nouveau** dans l’onglet gauche, cliquez sur **afficher tous les** dans le nouveau panneau, puis cliquez sur **Web App & SQL** dans le **Web** Section et enfin **créer**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-222">In the [Azure Management Portal](https://portal.azure.com), click **New** in the left tab, click **See all** in new blade, and then click **Web App & SQL** in the **Web** Section and finally **Create**.</span></span>

    ![Nouveau bouton dans le portail de gestion](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/CreateWeb-Sql.png)

   <span data-ttu-id="6eaa8-224">Le **nouvelle application Web & SQL - créer** Assistant s’ouvre.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-224">The **New Web App & SQL - Create** wizard opens.</span></span>

2. <span data-ttu-id="6eaa8-225">Dans le panneau, entrez une chaîne dans le **nom de l’application** à cocher pour utiliser l’URL unique pour votre application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-225">In the blade, enter a string in the **App name** box to use as the unique URL for your application.</span></span> <span data-ttu-id="6eaa8-226">L’URL complète consiste à ce que vous entrez ici ainsi que le domaine par défaut des Services d’application Azure (. azurewebsites.net).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-226">The complete URL will consist of what you enter here plus the default domain of Azure App Services (.azurewebsites.net).</span></span> <span data-ttu-id="6eaa8-227">Si le **nom de l’application** est déjà utilisé, l’Assistant vous avertit avec une croix rouge *le nom de l’application n’est pas disponible* message.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-227">If the **App name** is already taken, the Wizard will notify you of this with a red *The app name is not available* message.</span></span> <span data-ttu-id="6eaa8-228">Si le **nom de l’application** est disponible, vous obtiendrez une coche verte.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-228">If the **App name** is available, you will get a green checkmark.</span></span>

    ![Créer avec un lien de base de données dans le portail de gestion](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Create-WebApp.png)

3. <span data-ttu-id="6eaa8-230">Dans le **abonnement** liste déroulante, choisissez l’abonnement Azure dans lequel vous souhaitez le **du Service d’applications** doit résider.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-230">In the **Subscription** Dropdown, please choose the Azure Subscription in which you want the **App Service** to reside.</span></span>

4. <span data-ttu-id="6eaa8-231">Dans le **groupe de ressources** zone de texte, choisissez un groupe de ressources ou créez-en un.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-231">In the **Resource Group** text box, choose a Resource Group or create a new one.</span></span> <span data-ttu-id="6eaa8-232">Ce paramètre spécifie votre site web s’exécutera dans quel centre de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-232">This setting specifies which data center your web site will run in.</span></span> <span data-ttu-id="6eaa8-233">Pour plus d’informations sur les groupes de ressources, consultez la documentation sur [Azure Docs](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview#resource-groups).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-233">For more information about Resource Groups, read the documentation on [Azure Docs](https://docs.microsoft.com/azure/azure-resource-manager/resource-group-overview#resource-groups).</span></span>
5. <span data-ttu-id="6eaa8-234">Créer un nouveau **Plan App Service** en cliquant sur le *section App Service*, **créer un nouveau**et renseignez **plan App Service** (peut être identique à celui Service d’application), **emplacement**, et **niveau tarifaire** (il existe une option gratuite).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-234">Create a new **App Service Plan** by clicking the *App Service section*, **Create New**, and fill in **App Service plan** (can be same name as App Service), **Location**, and **Pricing tier** (there is a free option).</span></span>

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Create-AppService.png)
6. <span data-ttu-id="6eaa8-235">Cliquez sur le **base de données SQL**, puis choisissez *créer un nouveau* ou sélectionnez une base de données existante</span><span class="sxs-lookup"><span data-stu-id="6eaa8-235">Click the **SQL Database**, and choose *Create New* or select an existing database</span></span>

    ![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Create-Database.png)

7. <span data-ttu-id="6eaa8-236">Dans le **nom** , entrez un nom pour votre base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-236">In the **Name** box, enter a name for your database.</span></span>
8. <span data-ttu-id="6eaa8-237">Cliquez sur le **serveur cible** boîte, sélectionnez **créer un nouveau serveur**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-237">Click the **Target Server** box, select **Create a new server**.</span></span> <span data-ttu-id="6eaa8-238">Vous pouvez également, si vous avez créé précédemment d’un serveur, vous pouvez sélectionner ce serveur à partir de la liste des serveurs disponibles.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-238">Alternatively, if you previously created a server, you can select that server from list of available servers.</span></span>
9. <span data-ttu-id="6eaa8-239">Choisissez **niveau tarifaire** , choisissez *libre*.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-239">Choose **Pricing tier** section, choose *Free*.</span></span> <span data-ttu-id="6eaa8-240">Si des ressources supplémentaires sont nécessaires, la base de données peut être mis à l’échelle à tout moment.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-240">If additional resources are needed, the database can be scaled up at any time.</span></span> <span data-ttu-id="6eaa8-241">Pour en savoir plus sur la tarification de SQL Azure, consultez la documentation sur [Azure Docs](https://azure.microsoft.com/pricing/details/sql-database/).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-241">To learn more on Azure SQL Pricing, read the documentation on [Azure Docs](https://azure.microsoft.com/pricing/details/sql-database/).</span></span>
10. <span data-ttu-id="6eaa8-242">Modifier [classement](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support) en fonction des besoins.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-242">Modify [collation](https://docs.microsoft.com/sql/relational-databases/collations/collation-and-unicode-support) as needed.</span></span>
11. <span data-ttu-id="6eaa8-243">Entrez un administrateur **nom d’utilisateur administrateur de SQL** et **mot de passe administrateur SQL**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-243">Enter an administrator **SQL Admin Username** and **SQL Admin Password**.</span></span> <span data-ttu-id="6eaa8-244">Si vous avez sélectionné **serveur de base de données SQL**, vous n’êtes pas entrer un nom existant et un mot de passe ici, vous entrez un nouveau nom et mot de passe que vous définissez maintenant pour une utilisation ultérieure lorsque vous accédez à la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-244">If you selected **New SQL Database server**, you aren't entering an existing name and password here, you're entering a new name and password that you're defining now to use later when you access the database.</span></span> <span data-ttu-id="6eaa8-245">Si vous avez sélectionné un serveur que vous avez créé précédemment, vous devez entrer les informations d’identification pour ce serveur.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-245">If you selected a server that you created previously, you'll enter credentials for that server.</span></span>
12. <span data-ttu-id="6eaa8-246">Collecte de données de télémétrie peut être activée pour le Service d’applications à l’aide d’Application Insights.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-246">Telemetry collection can be enabled for App Service using Application Insights.</span></span> <span data-ttu-id="6eaa8-247">Application Insights avec peu de configuration collecte les événements précieuses, exception, dépendance, demande et les informations de trace.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-247">Application Insights with little configuration collects valuable event, exception, dependency, request, and trace information.</span></span> <span data-ttu-id="6eaa8-248">Pour en savoir plus sur Application Insights, prise en main de [Azure Docs](https://azure.microsoft.com/services/application-insights/).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-248">To learn more about Application Insights, get started in [Azure Docs](https://azure.microsoft.com/services/application-insights/).</span></span>
13. <span data-ttu-id="6eaa8-249">Cliquez sur **créer** en bas du panneau pour indiquer que vous avez terminé.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-249">Click **Create** at the bottom of the blade to indicate that you're finished.</span></span>
  
    <span data-ttu-id="6eaa8-250">Le portail de gestion renvoie à la page de tableaux de bord et le **Notifications** panneau en haut de la page indique que le site est créé.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-250">The Management Portal returns to the Dashboards page, and the **Notifications** blade at the top of the page shows that the site is being created.</span></span> <span data-ttu-id="6eaa8-251">Après un certain temps (en général moins d’une minute), il y aura une notification indiquant que le déploiement a réussi.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-251">After a while (typically less than a minute), there will be a notification that the Deployment succeeded.</span></span> <span data-ttu-id="6eaa8-252">Dans la barre de navigation à gauche, la nouvelle **du Service d’applications** s’affiche dans le *des Services d’application* section et les nouveaux **base de données SQL** s’affiche dans le *bases de données SQL*  section.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-252">In the navigation bar at the left, the new **App Service** appears in the *App Services* section and the new **SQL Database** appears in the *SQL Databases* section.</span></span>

### <a name="deploy-the-application-to-azure"></a><span data-ttu-id="6eaa8-253">Déployer l’application sur Azure</span><span class="sxs-lookup"><span data-stu-id="6eaa8-253">Deploy the application to Azure</span></span>

1. <span data-ttu-id="6eaa8-254">Dans Visual Studio, cliquez sur le projet dans **l’Explorateur de solutions** et sélectionnez **publier** dans le menu contextuel.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-254">In Visual Studio, right-click the project in **Solution Explorer** and select **Publish** from the context menu.</span></span>
  
    ![Publier dans le menu contextuel du projet](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image10.png)
2. <span data-ttu-id="6eaa8-256">Dans le **profil** onglet de la **publier le site Web** Assistant, cliquez sur **Microsoft Azure App Service**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-256">In the **Profile** tab of the **Publish Web** wizard, click **Microsoft Azure App Service**.</span></span>
  
    ![Importer les paramètres de publication](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-ChooseTarget.png)
3. <span data-ttu-id="6eaa8-258">Si vous n’avez pas précédemment ajouté votre abonnement Azure dans Visual Studio, effectuez les opérations sur l’écran.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-258">If you have not previously added your Azure subscription in Visual Studio, perform the steps on the screen.</span></span> <span data-ttu-id="6eaa8-259">Ces étapes activent Visual Studio pour se connecter à votre abonnement Azure ainsi que la liste des **des Services d’application** inclura votre site web.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-259">These steps enable Visual Studio to connect to your Azure subscription so that the list of **App Services** will include your web site.</span></span>
 
4. <span data-ttu-id="6eaa8-260">Sélectionnez le **abonnement** vous avez ajouté le Service d’application, il doit le **Plan App Service** dossier de votre application de Service est une partie, et enfin la **du Service d’applications** elle-même suivie **Ok**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-260">Select the **Subscription** you added the App Service to, then the **App Service Plan** folder your App Service is a part of, and finally the **App Service** itself followed by **Ok**.</span></span>

    ![Sélectionnez le Service d’applications](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-AppService.png)
5. <span data-ttu-id="6eaa8-262">Une fois que le profil a été configuré, le **connexion** onglet s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-262">After the Profile has been configured, the **Connection** tab will be shown.</span></span> <span data-ttu-id="6eaa8-263">Cliquez sur **valider la connexion** pour vous assurer que les paramètres sont corrects</span><span class="sxs-lookup"><span data-stu-id="6eaa8-263">Click **Validate Connection** to make sure that the settings are correct</span></span>

    ![Valider la connexion](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-Connection.png)
6. <span data-ttu-id="6eaa8-265">Lorsque la connexion a été validée, une coche verte s’affiche en regard du **valider la connexion** bouton.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-265">When the connection has been validated, a green check mark is shown next to the **Validate Connection** button.</span></span> <span data-ttu-id="6eaa8-266">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-266">Click **Next**.</span></span>
  
    ![Connexion validée avec succès](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-SettingsValidated.png)
7. <span data-ttu-id="6eaa8-268">Ouvrez le **chaîne de connexion à distance** liste déroulante sous **SchoolContext** et sélectionnez la chaîne de connexion pour la base de données que vous avez créé.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-268">Open the **Remote connection string** drop-down list under **SchoolContext** and select the connection string for the database you created.</span></span>
8. <span data-ttu-id="6eaa8-269">Sélectionnez **base de données de mise à jour**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-269">Select **Update database**.</span></span>

    ![Onglet Paramètres](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-Settings.png)

    <span data-ttu-id="6eaa8-271">Ce paramètre oblige le processus de déploiement configurer automatiquement l’application *Web.config* des fichiers sur le serveur de destination afin qu’utilise le premier Code la `MigrateDatabaseToLatestVersion` classe de l’initialiseur.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-271">This setting causes the deployment process to automatically configure the application *Web.config* file on the destination server so that Code First uses the `MigrateDatabaseToLatestVersion` initializer class.</span></span>
9. <span data-ttu-id="6eaa8-272">Cliquez sur **Suivant**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-272">Click **Next**.</span></span>
10. <span data-ttu-id="6eaa8-273">Dans le **aperçu** , cliquez sur **démarrer la version préliminaire**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-273">In the **Preview** tab, click **Start Preview**.</span></span>
  
    ![Bouton du démarrage dans l’onglet d’aperçu](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-Preview.png)
  
    <span data-ttu-id="6eaa8-275">L’onglet affiche une liste des fichiers qui seront copiés vers le serveur.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-275">The tab displays a list of the files that will be copied to the server.</span></span> <span data-ttu-id="6eaa8-276">Affichage de l’aperçu n’est pas requise pour publier l’application, mais elle est une fonction utile de connaître.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-276">Displaying the preview isn't required to publish the application but is a useful function to be aware of.</span></span> <span data-ttu-id="6eaa8-277">Dans ce cas, vous n’avez pas besoin de faire quelque chose avec la liste des fichiers qui s’affiche.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-277">In this case, you don't need to do anything with the list of files that is displayed.</span></span> <span data-ttu-id="6eaa8-278">La prochaine fois que vous déployez cette application, seuls les fichiers qui ont été modifiés seront dans cette liste.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-278">The next time you deploy this application, only the files that have changed will be in this list.</span></span>
    <span data-ttu-id="6eaa8-279">![Sortie de fichier du démarrage](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-PreviewLoaded.png)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-279">![StartPreview file output](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-PreviewLoaded.png)</span></span>

11. <span data-ttu-id="6eaa8-280">Cliquez sur **Publier**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-280">Click **Publish**.</span></span>
    <span data-ttu-id="6eaa8-281">Visual Studio lance le processus de copie des fichiers vers le serveur Azure.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-281">Visual Studio begins the process of copying the files to the Azure server.</span></span>
12. <span data-ttu-id="6eaa8-282">Le **sortie** fenêtre affiche les actions de déploiement ont été effectuées et signale la réussite du déploiement.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-282">The **Output** window shows what deployment actions were taken and reports successful completion of the deployment.</span></span>
  
    ![Fenêtre Sortie reporting réussir le déploiement](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-BuildOutput.png)
13. <span data-ttu-id="6eaa8-284">Lors du déploiement réussi, le navigateur par défaut s’ouvre automatiquement à l’URL du site web déployé.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-284">Upon successful deployment, the default browser automatically opens to the URL of the deployed web site.</span></span>
    <span data-ttu-id="6eaa8-285">L’application que vous avez créé est en cours d’exécution dans le cloud.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-285">The application you created is now running in the cloud.</span></span> 
  
    ![Students_index_page_with_paging](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Publish-Site.png)

<span data-ttu-id="6eaa8-287">À ce stade votre *SchoolContext* base de données a été créé dans la base de données SQL Azure, car vous avez sélectionné **exécuter fonctionnalité Migrations Code First (s’exécute sur le démarrage de l’application)**.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-287">At this point your *SchoolContext* database has been created in the Azure SQL Database because you selected **Execute Code First Migrations (runs on app start)**.</span></span> <span data-ttu-id="6eaa8-288">Le *Web.config* dans le site web déployé a été modifié afin que le [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initialiseur s’exécute la première fois que votre code lit ou écrit des données dans la base de données (qui s’est produite Lorsque vous avez sélectionné le **étudiants** onglet) :</span><span class="sxs-lookup"><span data-stu-id="6eaa8-288">The *Web.config* file in the deployed web site has been changed so that the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer runs the first time your code reads or writes data in the database (which happened when you selected the **Students** tab):</span></span>

![](https://asp.net/media/4367421/mig.png)

<span data-ttu-id="6eaa8-289">Le processus de déploiement créé également une nouvelle chaîne de connexion *(SchoolContext\_DatabasePublish*) pour les Migrations Code First à utiliser pour la mise à jour le schéma de base de données et d’amorçage de la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-289">The deployment process also created a new connection string *(SchoolContext\_DatabasePublish*) for Code First Migrations to use for updating the database schema and seeding the database.</span></span>

![Chaîne de connexion Database_Publish](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/image26.png)

<span data-ttu-id="6eaa8-291">Vous pouvez rechercher la version déployée du fichier Web.config sur votre ordinateur dans *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. Vous pouvez accéder à la version déployée *Web.config* fichier lui-même à l’aide de FTP.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-291">You can find the deployed version of the Web.config file on your own computer in *ContosoUniversity\obj\Release\Package\PackageTmp\Web.config*. You can access the deployed *Web.config* file itself by using FTP.</span></span> <span data-ttu-id="6eaa8-292">Pour obtenir des instructions, consultez [déploiement de Web ASP.NET à l’aide de Visual Studio : déploiement d’une mise à jour du Code](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-292">For instructions, see [ASP.NET Web Deployment using Visual Studio: Deploying a Code Update](xref:web-forms/overview/deployment/visual-studio-web-deployment/deploying-a-code-update).</span></span> <span data-ttu-id="6eaa8-293">Suivez les instructions qui commencent par « pour utiliser un outil FTP, vous avez besoin de trois opérations : l’URL du serveur FTP, le nom d’utilisateur et le mot de passe. »</span><span class="sxs-lookup"><span data-stu-id="6eaa8-293">Follow the instructions that start with "To use an FTP tool, you need three things: the FTP URL, the user name, and the password."</span></span>

> [!NOTE]
> <span data-ttu-id="6eaa8-294">L’application web n’implémente pas la sécurité, toute personne qui recherche l’URL permettant de changer les données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-294">The web app doesn't implement security, so anyone who finds the URL can change the data.</span></span> <span data-ttu-id="6eaa8-295">Pour obtenir des instructions sur la façon de sécuriser le site web, consultez [déployer une application sécurisée ASP.NET MVC avec l’appartenance, OAuth et base de données SQL Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-295">For instructions on how to secure the web site, see [Deploy a Secure ASP.NET MVC app with Membership, OAuth, and SQL Database to Azure](https://docs.microsoft.com/aspnet/core/security/authorization/secure-data).</span></span> <span data-ttu-id="6eaa8-296">Vous pouvez empêcher d’autres personnes d’utiliser le site à l’aide du portail de gestion Azure ou **l’Explorateur de serveurs** dans Visual Studio pour arrêter le site.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-296">You can prevent other people from using the site by using the Azure Management Portal or **Server Explorer** in Visual Studio to stop the site.</span></span>


![](migrations-and-deployment-with-the-entity-framework-in-an-asp-net-mvc-application/_static/Stop-Service.png)

## <a name="advanced-migrations-scenarios"></a><span data-ttu-id="6eaa8-297">Scénarios de migration avancée</span><span class="sxs-lookup"><span data-stu-id="6eaa8-297">Advanced Migrations Scenarios</span></span>

<span data-ttu-id="6eaa8-298">Si vous déployez une base de données en exécutant des migrations automatiquement comme indiqué dans ce didacticiel, et que vous déployez sur un site web qui s’exécute sur plusieurs serveurs, vous pouvez obtenir plusieurs serveurs que vous essayez d’exécuter les migrations en même temps.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-298">If you deploy a database by running migrations automatically as shown in this tutorial, and you are deploying to a web site that runs on multiple servers, you could get multiple servers trying to run migrations at the same time.</span></span> <span data-ttu-id="6eaa8-299">Les migrations sont atomiques, afin que si deux serveurs essaient d’exécuter la même migration, une réussit et que l’autre échoue (en supposant que les opérations ne peuvent pas être effectuées deux fois).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-299">Migrations are atomic, so if two servers try to run the same migration, one will succeed and the other will fail (assuming the operations can't be done twice).</span></span> <span data-ttu-id="6eaa8-300">Dans ce scénario si vous souhaitez éviter ces problèmes, vous pouvez appeler manuellement les migrations et définir votre propre code afin qu’il ne se produit qu’une seule fois.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-300">In that scenario if you want to avoid those issues, you can call migrations manually and set up your own code so that it only happens once.</span></span> <span data-ttu-id="6eaa8-301">Pour plus d’informations, consultez [en cours d’exécution et d’écriture de scripts pour les Migrations à partir de Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) sur le blog de Rowan Miller et [Migrate.exe](https://msdn.microsoft.com/data/jj618307) (pour l’exécution de migrations à partir de la ligne de commande) sur MSDN.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-301">For more information, see [Running and Scripting Migrations from Code](http://romiller.com/2012/02/09/running-scripting-migrations-from-code/) on Rowan Miller's blog and [Migrate.exe](https://msdn.microsoft.com/data/jj618307) (for executing migrations from the command line) on MSDN.</span></span>

<span data-ttu-id="6eaa8-302">Pour plus d’informations sur les autres scénarios de migration, consultez [Migrations capture série](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-302">For information about other migrations scenarios, see [Migrations Screencast Series](https://blogs.msdn.com/b/adonet/archive/2014/03/12/migrations-screencast-series.aspx).</span></span>

## <a name="code-first-initializers"></a><span data-ttu-id="6eaa8-303">Initialiseurs de premier code</span><span class="sxs-lookup"><span data-stu-id="6eaa8-303">Code First Initializers</span></span>

<span data-ttu-id="6eaa8-304">Dans la section déploiement, vous avez vu le [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initialiseur utilisé.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-304">In the deployment section you saw the [MigrateDatabaseToLatestVersion](https://msdn.microsoft.com/library/hh829476(v=vs.103).aspx) initializer being used.</span></span> <span data-ttu-id="6eaa8-305">Code tout d’abord fournit également des autres initialiseurs, y compris [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (la valeur par défaut), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (que vous avez utilisé précédemment) et [ DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-305">Code First also provides other initializers, including [CreateDatabaseIfNotExists](https://msdn.microsoft.com/library/gg679221(v=vs.103).aspx) (the default), [DropCreateDatabaseIfModelChanges](https://msdn.microsoft.com/library/gg679604(v=VS.103).aspx) (which you used earlier) and [DropCreateDatabaseAlways](https://msdn.microsoft.com/library/gg679506(v=VS.103).aspx).</span></span> <span data-ttu-id="6eaa8-306">Le `DropCreateAlways` initialiseur peut être utile pour configurer des conditions pour les tests unitaires.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-306">The `DropCreateAlways` initializer can be useful for setting up conditions for unit tests.</span></span> <span data-ttu-id="6eaa8-307">Vous pouvez également écrire votre propre initialiseurs, et vous pouvez appeler explicitement un initialiseur si vous ne souhaitez pas attendre que l’application lit ou écrit dans la base de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-307">You can also write your own initializers, and you can call an initializer explicitly if you don't want to wait until the application reads from or writes to the database.</span></span> <span data-ttu-id="6eaa8-308">Au moment de que ce didacticiel est écrit en novembre 2013, vous ne pouvez utiliser les initialiseurs de créer et DropCreate avant d’activer les migrations.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-308">At the time this tutorial is being written in November, 2013, you can only use the Create and DropCreate initializers before you enable migrations.</span></span> <span data-ttu-id="6eaa8-309">L’équipe de Entity Framework travaille sur la création de ces initialiseurs utilisables avec les migrations ainsi.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-309">The Entity Framework team is working on making these initializers usable with migrations as well.</span></span>

<span data-ttu-id="6eaa8-310">Pour plus d’informations sur les initialiseurs, consultez [compréhension des initialiseurs de base de données dans Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) et chapitre 6 du livre [programmation Entity Framework : Code First](http://shop.oreilly.com/product/0636920022220.do) par Julie Lerman et Rowan Miller.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-310">For more information about initializers, see [Understanding Database Initializers in Entity Framework Code First](http://www.codeguru.com/csharp/article.php/c19999/Understanding-Database-Initializers-in-Entity-Framework-Code-First.htm) and chapter 6 of the book [Programming Entity Framework: Code First](http://shop.oreilly.com/product/0636920022220.do) by Julie Lerman and Rowan Miller.</span></span>

## <a name="summary"></a><span data-ttu-id="6eaa8-311">Récapitulatif</span><span class="sxs-lookup"><span data-stu-id="6eaa8-311">Summary</span></span>

<span data-ttu-id="6eaa8-312">Dans ce didacticiel, vous avez vu comment activer les migrations et déployer l’application.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-312">In this tutorial you've seen how to enable migrations and deploy the application.</span></span> <span data-ttu-id="6eaa8-313">Dans le didacticiel suivant vous commencerez examinant rubriques plus avancées en développant le modèle de données.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-313">In the next tutorial you'll begin looking at more advanced topics by expanding the data model.</span></span>

<span data-ttu-id="6eaa8-314">Veuillez laisser des commentaires sur la façon dont vous avez aimé ce didacticiel et nous pouvons améliorer.</span><span class="sxs-lookup"><span data-stu-id="6eaa8-314">Please leave feedback on how you liked this tutorial and what we could improve.</span></span> <span data-ttu-id="6eaa8-315">Vous pouvez également demander de nouvelles rubriques à [afficher Me comment avec le Code](http://aspnet.uservoice.com/forums/228522-show-me-how-with-code).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-315">You can also request new topics at [Show Me How With Code](http://aspnet.uservoice.com/forums/228522-show-me-how-with-code).</span></span>

<span data-ttu-id="6eaa8-316">Vous trouverez des liens vers d’autres ressources Entity Framework dans [ASP.NET Data Access - ressources recommandées](xref:whitepapers/aspnet-data-access-content-map).</span><span class="sxs-lookup"><span data-stu-id="6eaa8-316">Links to other Entity Framework resources can be found in [ASP.NET Data Access - Recommended Resources](xref:whitepapers/aspnet-data-access-content-map).</span></span>

> [!div class="step-by-step"]
> <span data-ttu-id="6eaa8-317">[Précédent](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
> [Suivant](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span><span class="sxs-lookup"><span data-stu-id="6eaa8-317">[Previous](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/connection-resiliency-and-command-interception-with-the-entity-framework-in-an-asp-net-mvc-application)
[Next](xref:mvc/overview/getting-started/getting-started-with-ef-using-mvc/creating-a-more-complex-data-model-for-an-asp-net-mvc-application)</span></span>
